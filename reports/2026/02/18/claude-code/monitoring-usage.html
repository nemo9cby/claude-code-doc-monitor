<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>monitoring-usage - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>monitoring-usage.md</h1>
            <p class="meta">Changed on 2026-02-18 18:25:13 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+64</span> lines added
            </div>
            <div class="stat removed">
                <span>-46</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span>&gt; ## Documentation Index&para;<br>&gt; Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt&para;<br>&gt; Use this file to discover all available pages before exploring further.&para;<br>&para;<br># Monitoring&para;<br>&para;<br>&gt; Learn how to enable and configure OpenTelemetry for Claude Code.&para;<br>&para;<br></span><ins style="background:#e6ffe6;">Track </ins><span>Claude Code </span><del style="background:#ffe6e6;">supports OpenTelemetry (OTel) metrics and events for monitoring and observability.&para;<br>&para;<br>All</del><ins style="background:#e6ffe6;">usage, costs, and tool activity across your organization by exporting telemetry data through OpenTelemetry (OTel). Claude Code exports</ins><span> metrics a</span><del style="background:#ffe6e6;">re</del><ins style="background:#e6ffe6;">s</ins><span> time series data </span><del style="background:#ffe6e6;">exported via OpenTelemetry's</del><ins style="background:#e6ffe6;">via the</ins><span> standard metrics protocol, and events </span><del style="background:#ffe6e6;">are exported via OpenTelemetry's logs/events protocol. It is the user's responsibility to ensure their metrics and logs backends are properly configured and that the aggregation granularity meets thei</del><ins style="background:#e6ffe6;">via the logs/events protocol. Configure your metrics and logs backends to match you</ins><span>r monitoring requirements.&para;<br>&para;<br>## Quick start&para;<br>&para;<br>Configure OpenTelemetry using environment variables:&para;<br>&para;<br>```bash  theme={null}&para;<br># 1. Enable telemetry&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>&para;<br># 2. Choose exporters (both are optional - configure only what you need)&para;<br>export OTEL_METRICS_EXPORTER=otlp       # Options: otlp, prometheus, console&para;<br>export OTEL_LOGS_EXPORTER=otlp          # Options: otlp, console&para;<br>&para;<br># 3. Configure OTLP endpoint (for OTLP exporter)&para;<br>export OTEL_EXPORTER_OTLP_PROTOCOL=grpc&para;<br>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317&para;<br>&para;<br># 4. Set authentication (if required)&para;<br>export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer your-token"&para;<br>&para;<br># 5. For debugging: reduce export intervals&para;<br>export OTEL_METRIC_EXPORT_INTERVAL=10000  # 10 seconds (default: 60000ms)&para;<br>export OTEL_LOGS_EXPORT_INTERVAL=5000     # 5 seconds (default: 5000ms)&para;<br>&para;<br># 6. Run Claude Code&para;<br>claude&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  The default export intervals are 60 seconds for metrics and 5 seconds for logs. During setup, you may want to use shorter intervals for debugging purposes. Remember to reset these for production use.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>For full configuration options, see the [OpenTelemetry specification](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md#configuration-options).&para;<br>&para;<br>## Administrator configuration&para;<br>&para;<br>Administrators can configure OpenTelemetry settings for all users through the [managed settings file](/en/settings#settings-files). This allows for centralized control of telemetry settings across an organization. See the [settings precedence](/en/settings#settings-precedence) for more information about how settings are applied.&para;<br>&para;<br>Example managed settings configuration:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "env": {&para;<br>    "CLAUDE_CODE_ENABLE_TELEMETRY": "1",&para;<br>    "OTEL_METRICS_EXPORTER": "otlp",&para;<br>    "OTEL_LOGS_EXPORTER": "otlp",&para;<br>    "OTEL_EXPORTER_OTLP_PROTOCOL": "grpc",&para;<br>    "OTEL_EXPORTER_OTLP_ENDPOINT": "http://collector.</span><del style="background:#ffe6e6;">company</del><ins style="background:#e6ffe6;">example</ins><span>.com:4317",&para;<br>    "OTEL_EXPORTER_OTLP_HEADERS": "Authorization=Bearer </span><del style="background:#ffe6e6;">company</del><ins style="background:#e6ffe6;">example</ins><span>-token"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Managed settings can be distributed via MDM (Mobile Device Management) or other device management solutions. Environment variables defined in the managed settings file have high precedence and cannot be overridden by users.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Configuration details&para;<br>&para;<br>### Common configuration variables&para;<br>&para;<br>| Environment Variable                            </span><ins style="background:#e6ffe6;">    </ins><span>| Description                                                                                </span><ins style="background:#e6ffe6;">                           </ins><span>| Example Values                       |&para;<br>| -----------------------------------------------</span><del style="background:#ffe6e6;"> | </del><ins style="background:#e6ffe6;">---- | ------------------</ins><span>------------------------------------------------------------------------------------------</span><ins style="background:#e6ffe6;">---------</ins><span> | ------------------------------------ |&para;<br>| `CLAUDE_CODE_ENABLE_TELEMETRY`                  </span><ins style="background:#e6ffe6;">    </ins><span>| Enables telemetry collection (required)                                                    </span><ins style="background:#e6ffe6;">              </ins><ins style="background:#e6ffe6;">             </ins><span>| `1`                                  |&para;<br>| `OTEL_METRICS_EXPORTER`                         </span><ins style="background:#e6ffe6;">    </ins><span>| Metrics exporter type</span><del style="background:#ffe6e6;">(s) (</del><ins style="background:#e6ffe6;">s, </ins><span>comma-separated</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;">                              </ins><span>                                                 | `console`, `otlp`, `prometheus`      |&para;<br>| `OTEL_LOGS_EXPORTER`                            </span><ins style="background:#e6ffe6;">    </ins><span>| Logs/events exporter type</span><del style="background:#ffe6e6;">(s) (</del><ins style="background:#e6ffe6;">s, </ins><span>comma-separated</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;">                              </ins><span>                                             | `console`, `otlp`                    |&para;<br>| `OTEL_EXPORTER_OTLP_PROTOCOL`                   </span><ins style="background:#e6ffe6;">    </ins><span>| Protocol for OTLP exporter</span><del style="background:#ffe6e6;"> (all signals)</del><ins style="background:#e6ffe6;">, applies to all signals                 </ins><span>                                                   | `grpc`, `http/json`, `http/protobuf` |&para;<br>| `OTEL_EXPORTER_OTLP_ENDPOINT`                   </span><ins style="background:#e6ffe6;">    </ins><span>| OTLP collector endpoint </span><del style="background:#ffe6e6;">(</del><ins style="background:#e6ffe6;">for </ins><span>all signals</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;">                         </ins><span>                                                      | `http://localhost:4317`              |&para;<br>| `OTEL_EXPORTER_OTLP_METRICS_PROTOCOL`           </span><ins style="background:#e6ffe6;">    </ins><span>| Protocol for metrics</span><ins style="background:#e6ffe6;">,</ins><span> </span><del style="background:#ffe6e6;">(</del><span>overrides general</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;"> setting        </ins><span>                                                   </span><ins style="background:#e6ffe6;">            </ins><span>| `grpc`, `http/json`, `http/protobuf` |&para;<br>| `OTEL_EXPORTER_OTLP_METRICS_ENDPOINT`           </span><ins style="background:#e6ffe6;">    </ins><span>| OTLP metrics endpoint</span><ins style="background:#e6ffe6;">,</ins><span> </span><del style="background:#ffe6e6;">(</del><span>overrides general</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;"> setting                    </ins><span>                                                  | `http://localhost:4318/v1/metrics`   |&para;<br>| `OTEL_EXPORTER_OTLP_LOGS_PROTOCOL`              </span><ins style="background:#e6ffe6;">    </ins><span>| Protocol for logs</span><ins style="background:#e6ffe6;">,</ins><span> </span><del style="background:#ffe6e6;">(</del><span>overrides general</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;"> setting                    </ins><span>                                                      | `grpc`, `http/json`, `http/protobuf` |&para;<br>| `OTEL_EXPORTER_OTLP_LOGS_ENDPOINT`              </span><ins style="background:#e6ffe6;">    </ins><span>| OTLP logs endpoint</span><ins style="background:#e6ffe6;">,</ins><span> </span><del style="background:#ffe6e6;">(</del><span>overrides general</span><del style="background:#ffe6e6;">)</del><ins style="background:#e6ffe6;"> setting                    </ins><span>                                                     | `http://localhost:4318/v1/logs`      |&para;<br>| `OTEL_EXPORTER_OTLP_HEADERS`                    </span><ins style="background:#e6ffe6;">    </ins><span>| Authentication headers for OTLP                                                            </span><ins style="background:#e6ffe6;">           </ins><ins style="background:#e6ffe6;">                </ins><span>| `Authorization=Bearer token`         |&para;<br>| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY`         </span><ins style="background:#e6ffe6;">    </ins><span>| Client key for mTLS authentication                                                         </span><ins style="background:#e6ffe6;">      </ins><ins style="background:#e6ffe6;">                     </ins><span>| Path to client key file              |&para;<br>| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE`</span><ins style="background:#e6ffe6;">    </ins><span> | Client certificate for mTLS authentication                                                 </span><ins style="background:#e6ffe6;">  </ins><ins style="background:#e6ffe6;">                         </ins><span>| Path to client cert file             |&para;<br>| `OTEL_METRIC_EXPORT_INTERVAL`                   </span><ins style="background:#e6ffe6;"> </ins><ins style="background:#e6ffe6;">   </ins><span>| Export interval in milliseconds (default: 60000)                                           </span><ins style="background:#e6ffe6;">                        </ins><ins style="background:#e6ffe6;">   </ins><span>| `5000`, `60000`                      |&para;<br>| `OTEL_LOGS_EXPORT_INTERVAL`                     </span><ins style="background:#e6ffe6;">    </ins><span>| Logs export interval in milliseconds (default: 5000)                                       </span><ins style="background:#e6ffe6;">                   </ins><ins style="background:#e6ffe6;">        </ins><span>| `1000`, `10000`                      |&para;<br>| `OTEL_LOG_USER_PROMPTS`                         </span><ins style="background:#e6ffe6;">    </ins><span>| Enable logging of user prompt content (default: disabled)                                  </span><ins style="background:#e6ffe6;">               </ins><ins style="background:#e6ffe6;">            </ins><span>| `1` to enable                        |&para;<br>| `OTEL_LOG_TOOL_DETAILS`</span><ins style="background:#e6ffe6;">    </ins><span>                         | Enable logging of MCP server/tool names and skill names in tool events (default: disabled)</span><ins style="background:#e6ffe6;">                           </ins><span> | `1` to enable                        |&para;<br></span><ins style="background:#e6ffe6;">| `OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE` | Metrics temporality preference (default: `delta`). Set to `cumulative` if your backend expects cumulative temporality | `delta`, `cumulative`                |&para;<br></ins><span>| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS`</span><ins style="background:#e6ffe6;">    </ins><span>   | Interval for refreshing dynamic headers (default: 1740000ms / 29 minutes)</span><ins style="background:#e6ffe6;">                           </ins><span>                  | `900000`                             |&para;<br>&para;<br>### Metrics cardinality control&para;<br>&para;<br>The following environment variables control which attributes are included in metrics to manage cardinality:&para;<br>&para;<br>| Environment Variable                | Description                                     | Default Value | Example to Disable |&para;<br>| ----------------------------------- | ----------------------------------------------- | ------------- | ------------------ |&para;<br>| `OTEL_METRICS_INCLUDE_SESSION_ID`   | Include session.id attribute in metrics         | `true`        | `false`            |&para;<br>| `OTEL_METRICS_INCLUDE_VERSION`      | Include app.version attribute in metrics        | `false`       | `true`             |&para;<br>| `OTEL_METRICS_INCLUDE_ACCOUNT_UUID` | Include user.account\_uuid attribute in metrics | `true`        | `false`            |&para;<br>&para;<br>These variables help control the cardinality of metrics, which affects storage requirements and query performance in your metrics backend. Lower cardinality generally means better performance and lower storage costs but less granular data for analysis.&para;<br>&para;<br>### Dynamic headers&para;<br>&para;<br>For enterprise environments that require dynamic authentication, you can configure a script to generate headers dynamically:&para;<br>&para;<br>#### Settings configuration&para;<br>&para;<br>Add to your `.claude/settings.json`:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "otelHeadersHelper": "/bin/generate_opentelemetry_headers.sh"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Script requirements&para;<br>&para;<br>The script must output valid JSON with string key-value pairs representing HTTP headers:&para;<br>&para;<br>```bash  theme={null}&para;<br>#!/bin/bash&para;<br># Example: Multiple headers&para;<br>echo "{\"Authorization\": \"Bearer $(get-token.sh)\", \"X-API-Key\": \"$(get-api-key.sh)\"}"&para;<br>```&para;<br>&para;<br>#### Refresh behavior&para;<br>&para;<br>The headers helper script runs at startup and periodically thereafter to support token refresh. By default, the script runs every 29 minutes. Customize the interval with the `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS` environment variable.&para;<br>&para;<br>### Multi-team organization support&para;<br>&para;<br>Organizations with multiple teams or departments can add custom attributes to distinguish between different groups using the `OTEL_RESOURCE_ATTRIBUTES` environment variable:&para;<br>&para;<br>```bash  theme={null}&para;<br># Add custom attributes for team identification&para;<br>export OTEL_RESOURCE_ATTRIBUTES="department=engineering,team.id=platform,cost_center=eng-123"&para;<br>```&para;<br>&para;<br>These custom attributes will be included in all metrics and events, allowing you to:&para;<br>&para;<br>* Filter metrics by team or department&para;<br>* Track costs per cost center&para;<br>* Create team-specific dashboards&para;<br>* Set up alerts for specific teams&para;<br>&para;<br>&lt;Warning&gt;&para;<br>  **Important formatting requirements for OTEL\_RESOURCE\_ATTRIBUTES:**&para;<br>&para;<br>  The `OTEL_RESOURCE_ATTRIBUTES` environment variable </span><del style="background:#ffe6e6;">follows the [W3C Baggage specification](https://www.w3.org/TR/baggage/), which has</del><ins style="background:#e6ffe6;">uses comma-separated key=value pairs with</ins><span> strict formatting requirements:&para;<br>&para;<br>  * **No spaces allowed**: Values cannot contain spaces. For example, `user.organizationName=My Company` is invalid&para;<br>  * **Format**: Must be comma-separated key=value pairs: `key1=value1,key2=value2`&para;<br>  * **Allowed characters**: Only US-ASCII characters excluding control characters, whitespace, double quotes, commas, semicolons, and backslashes&para;<br>  * **Special characters**: Characters outside the allowed range must be percent-encoded&para;<br>&para;<br>  **Examples:**&para;<br>&para;<br>  ```bash  theme={null}&para;<br>  # ❌ Invalid - contains spaces&para;<br>  export OTEL_RESOURCE_ATTRIBUTES="org.name=John's Organization"&para;<br>&para;<br>  # ✅ Valid - use underscores or camelCase instead&para;<br>  export OTEL_RESOURCE_ATTRIBUTES="org.name=Johns_Organization"&para;<br>  export OTEL_RESOURCE_ATTRIBUTES="org.name=JohnsOrganization"&para;<br>&para;<br>  # ✅ Valid - percent-encode special characters if needed&para;<br>  export OTEL_RESOURCE_ATTRIBUTES="org.name=John%27s%20Organization"&para;<br>  ```&para;<br>&para;<br>  Note: wrapping values in quotes doesn't escape spaces. For example, `org.name="My Company"` results in the literal value `"My Company"` (with quotes included), not `My Company`.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>### Example configurations&para;<br>&para;<br></span><ins style="background:#e6ffe6;">Set these environment variables before running `claude`. Each block shows a complete configuration for a different exporter or deployment scenario:&para;<br>&para;<br></ins><span>```bash  theme={null}&para;<br># Console debugging (1-second intervals)&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=console&para;<br>export OTEL_METRIC_EXPORT_INTERVAL=1000&para;<br>&para;<br># OTLP/gRPC&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=otlp&para;<br>export OTEL_EXPORTER_OTLP_PROTOCOL=grpc&para;<br>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317&para;<br>&para;<br># Prometheus&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=prometheus&para;<br>&para;<br># Multiple exporters&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=console,otlp&para;<br>export OTEL_EXPORTER_OTLP_PROTOCOL=http/json&para;<br>&para;<br># Different endpoints/backends for metrics and logs&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=otlp&para;<br>export OTEL_LOGS_EXPORTER=otlp&para;<br>export OTEL_EXPORTER_OTLP_METRICS_PROTOCOL=http/protobuf&para;<br>export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://metrics.</span><del style="background:#ffe6e6;">company</del><ins style="background:#e6ffe6;">example</ins><span>.com:4318&para;<br>export OTEL_EXPORTER_OTLP_LOGS_PROTOCOL=grpc&para;<br>export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://logs.</span><del style="background:#ffe6e6;">company</del><ins style="background:#e6ffe6;">example</ins><span>.com:4317&para;<br>&para;<br># Metrics only (no events/logs)&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_METRICS_EXPORTER=otlp&para;<br>export OTEL_EXPORTER_OTLP_PROTOCOL=grpc&para;<br>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317&para;<br>&para;<br># Events/logs only (no metrics)&para;<br>export CLAUDE_CODE_ENABLE_TELEMETRY=1&para;<br>export OTEL_LOGS_EXPORTER=otlp&para;<br>export OTEL_EXPORTER_OTLP_PROTOCOL=grpc&para;<br>export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317&para;<br>```&para;<br>&para;<br>## Available metrics and events&para;<br>&para;<br>### Standard attributes&para;<br>&para;<br>All metrics and events share these standard attributes:&para;<br>&para;<br>| Attribute           | Description                                                       </span><del style="background:#ffe6e6;">   </del><span>| Controlled By                                       |&para;<br>| ------------------- | -----------------------------------------------------------------</span><del style="background:#ffe6e6;">---</del><span> | --------------------------------------------------- |&para;<br>| `session.id`        | Unique session identifier                                         </span><del style="background:#ffe6e6;">   </del><span>| `OTEL_METRICS_INCLUDE_SESSION_ID` (default: true)   |&para;<br>| `app.version`       | Current Claude Code version                                       </span><del style="background:#ffe6e6;">  </del><del style="background:#ffe6e6;"> </del><span>| `OTEL_METRICS_INCLUDE_VERSION` (default: false)     |&para;<br>| `organization.id`   | Organization UUID (when authenticated)                            </span><del style="background:#ffe6e6;">   </del><span>| Always included when available                      |&para;<br>| `user.account_uuid` | Account UUID (when authenticated)                                 </span><del style="background:#ffe6e6;"> </del><del style="background:#ffe6e6;">  </del><span>| `OTEL_METRICS_INCLUDE_ACCOUNT_UUID` (default: true) |&para;<br></span><ins style="background:#e6ffe6;">| `user.id`           | Anonymous user identifier                                         | Always included                                     |&para;<br>| `user.email`        | User email address (when authenticated via OAuth)                 | Always included when available                      |&para;<br></ins><span>| `terminal.type`     | Terminal type</span><del style="background:#ffe6e6;"> (for example,</del><ins style="background:#e6ffe6;">, such as</ins><span> `iTerm.app`, `vscode`, `cursor`,</span><ins style="background:#e6ffe6;"> or</ins><span> `tmux`</span><del style="background:#ffe6e6;">)</del><span> | Always included when detected                       |&para;<br>&para;<br>### Metrics&para;<br>&para;<br>Claude Code exports the following metrics:&para;<br>&para;<br>| Metric Name                           | Description                                     | Unit   |&para;<br>| ------------------------------------- | ----------------------------------------------- | ------ |&para;<br>| `claude_code.session.count`           | Count of CLI sessions started                   | count  |&para;<br>| `claude_code.lines_of_code.count`     | Count of lines of code modified                 | count  |&para;<br>| `claude_code.pull_request.count`      | Number of pull requests created                 | count  |&para;<br>| `claude_code.commit.count`            | Number of git commits created                   | count  |&para;<br>| `claude_code.cost.usage`              | Cost of the Claude Code session                 | USD    |&para;<br>| `claude_code.token.usage`             | Number of tokens used                           | tokens |&para;<br>| `claude_code.code_edit_tool.decision` | Count of code editing tool permission decisions | count  |&para;<br>| `claude_code.active_time.total`       | Total active time in seconds                    | s      |&para;<br>&para;<br>### Metric details&para;<br>&para;<br></span><ins style="background:#e6ffe6;">Each metric includes the standard attributes listed above. Metrics with additional context-specific attributes are noted below.&para;<br>&para;<br></ins><span>#### Session counter&para;<br>&para;<br>Incremented at the start of each session.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>&para;<br>#### Lines of code counter&para;<br>&para;<br>Incremented when code is added or removed.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `type`: (`"added"`, `"removed"`)&para;<br>&para;<br>#### Pull request counter&para;<br>&para;<br>Incremented when creating pull requests via Claude Code.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>&para;<br>#### Commit counter&para;<br>&para;<br>Incremented when creating git commits via Claude Code.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>&para;<br>#### Cost counter&para;<br>&para;<br>Incremented after each API request.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `model`: Model identifier (for example, "claude-sonnet-4-6")&para;<br>&para;<br>#### Token counter&para;<br>&para;<br>Incremented after each API request.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `type`: (`"input"`, `"output"`, `"cacheRead"`, `"cacheCreation"`)&para;<br>* `model`: Model identifier (for example, "claude-sonnet-4-6")&para;<br>&para;<br>#### Code edit tool decision counter&para;<br>&para;<br>Incremented when user accepts or rejects Edit, Write, or NotebookEdit tool usage.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `tool</span><ins style="background:#e6ffe6;">_name</ins><span>`: Tool name (`"Edit"`, `"Write"`, `"NotebookEdit"`)&para;<br>* `decision`: User decision (`"accept"`, `"reject"`)&para;<br></span><ins style="background:#e6ffe6;">* `source`: Decision source - `"config"`, `"hook"`, `"user_permanent"`, `"user_temporary"`, `"user_abort"`, or `"user_reject"`&para;<br></ins><span>* `language`: Programming language of the edited file</span><del style="background:#ffe6e6;"> (for example,</del><ins style="background:#e6ffe6;">, such as</ins><span> `"TypeScript"`, `"Python"`, `"JavaScript"`,</span><ins style="background:#e6ffe6;"> or</ins><span> `"Markdown"`</span><del style="background:#ffe6e6;">)</del><span>. Returns `"unknown"` for unrecognized file extensions.&para;<br>&para;<br>#### Active time counter&para;<br>&para;<br>Tracks actual time spent actively using Claude Code</span><del style="background:#ffe6e6;"> (not</del><ins style="background:#e6ffe6;">, excluding</ins><span> idle time</span><del style="background:#ffe6e6;">)</del><span>. This metric is incremented during user interactions </span><del style="background:#ffe6e6;">such as typing prompts or receiving responses.&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>&para;<br>### Events&para;<br>&para;<br>Claude Code exports the following events via OpenTelemetry logs/events (when `OTEL_LOGS_EXPORTER` is configured):</del><ins style="background:#e6ffe6;">(typing, reading responses) and during CLI processing (tool execution, AI response generation).&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `type`: `"user"` for keyboard interactions, `"cli"` for tool execution and AI responses&para;<br>&para;<br>### Events&para;<br>&para;<br>Claude Code exports the following events via OpenTelemetry logs/events (when `OTEL_LOGS_EXPORTER` is configured):&para;<br>&para;<br>#### Event correlation attributes&para;<br>&para;<br>When a user submits a prompt, Claude Code may make multiple API calls and run several tools. The `prompt.id` attribute lets you tie all of those events back to the single prompt that triggered them.&para;<br>&para;<br>| Attribute   | Description                                                                          |&para;<br>| ----------- | ------------------------------------------------------------------------------------ |&para;<br>| `prompt.id` | UUID v4 identifier linking all events produced while processing a single user prompt |&para;<br>&para;<br>To trace all activity triggered by a single prompt, filter your events by a specific `prompt.id` value. This returns the user\_prompt event, any api\_request events, and any tool\_result events that occurred while processing that prompt.&para;<br>&para;<br>&lt;Note&gt;&para;<br>  `prompt.id` is intentionally excluded from metrics because each prompt generates a unique ID, which would create an ever-growing number of time series. Use it for event-level analysis and audit trails only.&para;<br>&lt;/Note&gt;</ins><span>&para;<br>&para;<br>#### User prompt event&para;<br>&para;<br>Logged when a user submits a prompt.&para;<br>&para;<br>**Event Name**: `claude_code.user_prompt`&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `event.name`: `"user_prompt"`&para;<br>* `event.timestamp`: ISO 8601 timestamp&para;<br>* `event.sequence`: monotonically increasing counter for ordering events within a session&para;<br>* `prompt_length`: Length of the prompt&para;<br>* `prompt`: Prompt content (redacted by default, enable with `OTEL_LOG_USER_PROMPTS=1`)&para;<br>&para;<br>#### Tool result event&para;<br>&para;<br>Logged when a tool completes execution.&para;<br>&para;<br>**Event Name**: `claude_code.tool_result`&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `event.name`: `"tool_result"`&para;<br>* `event.timestamp`: ISO 8601 timestamp&para;<br>* `event.sequence`: monotonically increasing counter for ordering events within a session&para;<br>* `tool_name`: Name of the tool&para;<br>* `success`: `"true"` or `"false"`&para;<br>* `duration_ms`: Execution time in milliseconds&para;<br>* `error`: Error message (if failed)&para;<br>* `decision</span><ins style="background:#e6ffe6;">_type</ins><span>`: Either `"accept"` or `"reject"`&para;<br>* `</span><ins style="background:#e6ffe6;">decision_</ins><span>source`: Decision source - `"config"`,</span><ins style="background:#e6ffe6;"> `"hook"`,</ins><span> `"user_permanent"`, `"user_temporary"`, `"user_abort"`, or `"user_reject"`&para;<br></span><ins style="background:#e6ffe6;">* `tool_result_size_bytes`: Size of the tool result in bytes&para;<br>* `mcp_server_scope`: MCP server scope identifier (for MCP tools)&para;<br></ins><span>* `tool_parameters`: JSON string containing tool-specific parameters (when available)&para;<br>  * For Bash tool: includes `bash_command`, `full_command`, `timeout`, `description`, `</span><del style="background:#ffe6e6;">sandbox`</del><ins style="background:#e6ffe6;">dangerouslyDisableSandbox`, and `git_commit_id` (the commit SHA, when a `git commit` command succeeds)</ins><span>&para;<br>  * For MCP tools (when `OTEL_LOG_TOOL_DETAILS=1`): includes `mcp_server_name`, `mcp_tool_name`&para;<br>  * For Skill tool (when `OTEL_LOG_TOOL_DETAILS=1`): includes `skill_name`&para;<br>&para;<br>#### API request event&para;<br>&para;<br>Logged for each API request to Claude.&para;<br>&para;<br>**Event Name**: `claude_code.api_request`&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `event.name`: `"api_request"`&para;<br>* `event.timestamp`: ISO 8601 timestamp&para;<br>* `event.sequence`: monotonically increasing counter for ordering events within a session&para;<br>* `model`: Model used (for example, "claude-sonnet-4-6")&para;<br>* `cost_usd`: Estimated cost in USD&para;<br>* `duration_ms`: Request duration in milliseconds&para;<br>* `input_tokens`: Number of input tokens&para;<br>* `output_tokens`: Number of output tokens&para;<br>* `cache_read_tokens`: Number of tokens read from cache&para;<br>* `cache_creation_tokens`: Number of tokens used for cache creation</span><ins style="background:#e6ffe6;">&para;<br>* `speed`: `"fast"` or `"normal"`, indicating whether fast mode was active</ins><span>&para;<br>&para;<br>#### API error event&para;<br>&para;<br>Logged when an API request to Claude fails.&para;<br>&para;<br>**Event Name**: `claude_code.api_error`&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `event.name`: `"api_error"`&para;<br>* `event.timestamp`: ISO 8601 timestamp&para;<br>* `event.sequence`: monotonically increasing counter for ordering events within a session&para;<br>* `model`: Model used (for example, "claude-sonnet-4-6")&para;<br>* `error`: Error message&para;<br>* `status_code`: HTTP status code </span><del style="background:#ffe6e6;">(if applicable)</del><ins style="background:#e6ffe6;">as a string, or `"undefined"` for non-HTTP errors</ins><span>&para;<br>* `duration_ms`: Request duration in milliseconds&para;<br>* `attempt`: Attempt number (for retried requests)</span><ins style="background:#e6ffe6;">&para;<br>* `speed`: `"fast"` or `"normal"`, indicating whether fast mode was active</ins><span>&para;<br>&para;<br>#### Tool decision event&para;<br>&para;<br>Logged when a tool permission decision is made (accept/reject).&para;<br>&para;<br>**Event Name**: `claude_code.tool_decision`&para;<br>&para;<br>**Attributes**:&para;<br>&para;<br>* All [standard attributes](#standard-attributes)&para;<br>* `event.name`: `"tool_decision"`&para;<br>* `event.timestamp`: ISO 8601 timestamp&para;<br>* `event.sequence`: monotonically increasing counter for ordering events within a session&para;<br>* `tool_name`: Name of the tool (for example, "Read", "Edit", "Write", "NotebookEdit")&para;<br>* `decision`: Either `"accept"` or `"reject"`&para;<br>* `source`: Decision source - `"config"`,</span><ins style="background:#e6ffe6;"> `"hook"`,</ins><span> `"user_permanent"`, `"user_temporary"`, `"user_abort"`, or `"user_reject"`&para;<br>&para;<br>## Interpret</span><del style="background:#ffe6e6;">ing</del><span> metrics and events data&para;<br>&para;<br>The </span><del style="background:#ffe6e6;">metrics </del><span>exported </span><del style="background:#ffe6e6;">by Claude Code provide valuable insights into usage patterns and productivity. Here are some common visualizations and analyses you can create</del><ins style="background:#e6ffe6;">metrics and events support a range of analyses</ins><span>:&para;<br>&para;<br>### Usage monitoring&para;<br>&para;<br>| Metric                                                        | Analysis Opportunity                                      |&para;<br>| ------------------------------------------------------------- | --------------------------------------------------------- |&para;<br>| `claude_code.token.usage`                                     | Break down by `type` (input/output), user, team, or model |&para;<br>| `claude_code.session.count`                                   | Track adoption and engagement over time                   |&para;<br>| `claude_code.lines_of_code.count`                             | Measure productivity by tracking code additions/removals  |&para;<br>| `claude_code.commit.count` &amp; `claude_code.pull_request.count` | Understand impact on development workflows                |&para;<br>&para;<br>### Cost monitoring&para;<br>&para;<br>The `claude_code.cost.usage` metric helps with:&para;<br>&para;<br>* Tracking usage trends across teams or individuals&para;<br>* Identifying high-usage sessions for optimization&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Cost metrics are approximations. For official billing data, refer to your API provider (Claude Console, AWS Bedrock, or Google Cloud Vertex).&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Alerting and segmentation&para;<br>&para;<br>Common alerts to consider:&para;<br>&para;<br>* Cost spikes&para;<br>* Unusual token consumption&para;<br>* High session volume from specific users&para;<br>&para;<br>All metrics can be segmented by `user.account_uuid`, `organization.id`, `session.id`, `model`, and `app.version`.&para;<br>&para;<br>### Event analysis&para;<br>&para;<br>The event data provides detailed insights into Claude Code interactions:&para;<br>&para;<br>**Tool Usage Patterns**: analyze tool result events to identify:&para;<br>&para;<br>* Most frequently used tools&para;<br>* Tool success rates&para;<br>* Average tool execution times&para;<br>* Error patterns by tool type&para;<br>&para;<br>**Performance Monitoring**: track API request durations and tool execution times to identify performance bottlenecks.&para;<br>&para;<br>## Backend considerations&para;<br>&para;<br>Your choice of metrics and logs backends determines the types of analyses you can perform:&para;<br>&para;<br>### For metrics&para;<br>&para;<br>* **Time series databases (for example, Prometheus)**: Rate calculations, aggregated metrics&para;<br>* **Columnar stores (for example, ClickHouse)**: Complex queries, unique user analysis&para;<br>* **Full-featured observability platforms (for example, Honeycomb, Datadog)**: Advanced querying, visualization, alerting&para;<br>&para;<br>### For events/logs&para;<br>&para;<br>* **Log aggregation systems (for example, Elasticsearch, Loki)**: Full-text search, log analysis&para;<br>* **Columnar stores (for example, ClickHouse)**: Structured event analysis&para;<br>* **Full-featured observability platforms (for example, Honeycomb, Datadog)**: Correlation between metrics and events&para;<br>&para;<br>For organizations requiring Daily/Weekly/Monthly Active User (DAU/WAU/MAU) metrics, consider backends that support efficient unique value queries.&para;<br>&para;<br>## Service information&para;<br>&para;<br>All metrics and events are exported with the following resource attributes:&para;<br>&para;<br>* `service.name`: `claude-code`&para;<br>* `service.version`: Current Claude Code version&para;<br>* `os.type`: Operating system type (for example, `linux`, `darwin`, `windows`)&para;<br>* `os.version`: Operating system version string&para;<br>* `host.arch`: Host architecture (for example, `amd64`, `arm64`)&para;<br>* `wsl.version`: WSL version number (only present when running on Windows Subsystem for Linux)&para;<br>* Meter Name: `com.anthropic.claude_code`&para;<br>&para;<br>## ROI measurement resources&para;<br>&para;<br>For a comprehensive guide on measuring return on investment for Claude Code, including telemetry setup, cost analysis, productivity metrics, and automated reporting, see the [Claude Code ROI Measurement Guide](https://github.com/anthropics/claude-code-monitoring-guide). This repository provides ready-to-use Docker Compose configurations, Prometheus and OpenTelemetry setups, and templates for generating productivity reports integrated with tools like Linear.&para;<br>&para;<br>## Security</span><del style="background:#ffe6e6;">/</del><ins style="background:#e6ffe6;"> and </ins><span>privacy</span><del style="background:#ffe6e6;"> considerations</del><span>&para;<br>&para;<br>* Telemetry is opt-in and requires explicit configuration&para;<br>* </span><del style="background:#ffe6e6;">Sensitive information like API keys or file contents are never included in metrics or events</del><ins style="background:#e6ffe6;">Raw file contents and code snippets are not included in metrics or events. Tool execution events include bash commands and file paths in the `tool_parameters` field, which may contain sensitive values. If your commands may include secrets, configure your telemetry backend to filter or redact `tool_parameters`&para;<br>* When authenticated via OAuth, `user.email` is included in telemetry attributes. If this is a concern for your organization, work with your telemetry backend to filter or redact this field</ins><span>&para;<br>* User prompt content is </span><del style="background:#ffe6e6;">reda</del><ins style="background:#e6ffe6;">not colle</ins><span>cted by default</span><del style="background:#ffe6e6;">, o</del><ins style="background:#e6ffe6;">. O</ins><span>nly prompt length is recorded. To </span><del style="background:#ffe6e6;">enable user</del><ins style="background:#e6ffe6;">include</ins><span> prompt </span><del style="background:#ffe6e6;">logging</del><ins style="background:#e6ffe6;">content</ins><span>, set `OTEL_LOG_USER_PROMPTS=1`&para;<br>* MCP server/tool names and skill names are not logged by default because they can reveal user-specific configurations. To </span><del style="background:#ffe6e6;">enable</del><ins style="background:#e6ffe6;">include them</ins><span>, set `OTEL_LOG_TOOL_DETAILS=1`&para;<br>&para;<br>## Monitor</span><del style="background:#ffe6e6;">ing</del><span> Claude Code on Amazon Bedrock&para;<br>&para;<br>For detailed Claude Code usage monitoring guidance for Amazon Bedrock, see [Claude Code Monitoring Implementation (Bedrock)](https://github.com/aws-solutions-library-samples/guidance-for-claude-code-with-amazon-bedrock/blob/main/assets/docs/MONITORING.md).&para;<br></span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/monitoring-usage.md
+++ b/monitoring-usage.md
@@ -6,9 +6,7 @@
 
 &gt; Learn how to enable and configure OpenTelemetry for Claude Code.
 
-Claude Code supports OpenTelemetry (OTel) metrics and events for monitoring and observability.
-
-All metrics are time series data exported via OpenTelemetry&#39;s standard metrics protocol, and events are exported via OpenTelemetry&#39;s logs/events protocol. It is the user&#39;s responsibility to ensure their metrics and logs backends are properly configured and that the aggregation granularity meets their monitoring requirements.
+Track Claude Code usage, costs, and tool activity across your organization by exporting telemetry data through OpenTelemetry (OTel). Claude Code exports metrics as time series data via the standard metrics protocol, and events via the logs/events protocol. Configure your metrics and logs backends to match your monitoring requirements.
 
 ## Quick start
 
@@ -56,8 +54,8 @@
     &#34;OTEL_METRICS_EXPORTER&#34;: &#34;otlp&#34;,
     &#34;OTEL_LOGS_EXPORTER&#34;: &#34;otlp&#34;,
     &#34;OTEL_EXPORTER_OTLP_PROTOCOL&#34;: &#34;grpc&#34;,
-    &#34;OTEL_EXPORTER_OTLP_ENDPOINT&#34;: &#34;http://collector.company.com:4317&#34;,
-    &#34;OTEL_EXPORTER_OTLP_HEADERS&#34;: &#34;Authorization=Bearer company-token&#34;
+    &#34;OTEL_EXPORTER_OTLP_ENDPOINT&#34;: &#34;http://collector.example.com:4317&#34;,
+    &#34;OTEL_EXPORTER_OTLP_HEADERS&#34;: &#34;Authorization=Bearer example-token&#34;
   }
 }
 ```
@@ -70,25 +68,26 @@
 
 ### Common configuration variables
 
-| Environment Variable                            | Description                                                                                | Example Values                       |
-| ----------------------------------------------- | ------------------------------------------------------------------------------------------ | ------------------------------------ |
-| `CLAUDE_CODE_ENABLE_TELEMETRY`                  | Enables telemetry collection (required)                                                    | `1`                                  |
-| `OTEL_METRICS_EXPORTER`                         | Metrics exporter type(s) (comma-separated)                                                 | `console`, `otlp`, `prometheus`      |
-| `OTEL_LOGS_EXPORTER`                            | Logs/events exporter type(s) (comma-separated)                                             | `console`, `otlp`                    |
-| `OTEL_EXPORTER_OTLP_PROTOCOL`                   | Protocol for OTLP exporter (all signals)                                                   | `grpc`, `http/json`, `http/protobuf` |
-| `OTEL_EXPORTER_OTLP_ENDPOINT`                   | OTLP collector endpoint (all signals)                                                      | `http://localhost:4317`              |
-| `OTEL_EXPORTER_OTLP_METRICS_PROTOCOL`           | Protocol for metrics (overrides general)                                                   | `grpc`, `http/json`, `http/protobuf` |
-| `OTEL_EXPORTER_OTLP_METRICS_ENDPOINT`           | OTLP metrics endpoint (overrides general)                                                  | `http://localhost:4318/v1/metrics`   |
-| `OTEL_EXPORTER_OTLP_LOGS_PROTOCOL`              | Protocol for logs (overrides general)                                                      | `grpc`, `http/json`, `http/protobuf` |
-| `OTEL_EXPORTER_OTLP_LOGS_ENDPOINT`              | OTLP logs endpoint (overrides general)                                                     | `http://localhost:4318/v1/logs`      |
-| `OTEL_EXPORTER_OTLP_HEADERS`                    | Authentication headers for OTLP                                                            | `Authorization=Bearer token`         |
-| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY`         | Client key for mTLS authentication                                                         | Path to client key file              |
-| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE` | Client certificate for mTLS authentication                                                 | Path to client cert file             |
-| `OTEL_METRIC_EXPORT_INTERVAL`                   | Export interval in milliseconds (default: 60000)                                           | `5000`, `60000`                      |
-| `OTEL_LOGS_EXPORT_INTERVAL`                     | Logs export interval in milliseconds (default: 5000)                                       | `1000`, `10000`                      |
-| `OTEL_LOG_USER_PROMPTS`                         | Enable logging of user prompt content (default: disabled)                                  | `1` to enable                        |
-| `OTEL_LOG_TOOL_DETAILS`                         | Enable logging of MCP server/tool names and skill names in tool events (default: disabled) | `1` to enable                        |
-| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS`   | Interval for refreshing dynamic headers (default: 1740000ms / 29 minutes)                  | `900000`                             |
+| Environment Variable                                | Description                                                                                                           | Example Values                       |
+| --------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
+| `CLAUDE_CODE_ENABLE_TELEMETRY`                      | Enables telemetry collection (required)                                                                               | `1`                                  |
+| `OTEL_METRICS_EXPORTER`                             | Metrics exporter types, comma-separated                                                                               | `console`, `otlp`, `prometheus`      |
+| `OTEL_LOGS_EXPORTER`                                | Logs/events exporter types, comma-separated                                                                           | `console`, `otlp`                    |
+| `OTEL_EXPORTER_OTLP_PROTOCOL`                       | Protocol for OTLP exporter, applies to all signals                                                                    | `grpc`, `http/json`, `http/protobuf` |
+| `OTEL_EXPORTER_OTLP_ENDPOINT`                       | OTLP collector endpoint for all signals                                                                               | `http://localhost:4317`              |
+| `OTEL_EXPORTER_OTLP_METRICS_PROTOCOL`               | Protocol for metrics, overrides general setting                                                                       | `grpc`, `http/json`, `http/protobuf` |
+| `OTEL_EXPORTER_OTLP_METRICS_ENDPOINT`               | OTLP metrics endpoint, overrides general setting                                                                      | `http://localhost:4318/v1/metrics`   |
+| `OTEL_EXPORTER_OTLP_LOGS_PROTOCOL`                  | Protocol for logs, overrides general setting                                                                          | `grpc`, `http/json`, `http/protobuf` |
+| `OTEL_EXPORTER_OTLP_LOGS_ENDPOINT`                  | OTLP logs endpoint, overrides general setting                                                                         | `http://localhost:4318/v1/logs`      |
+| `OTEL_EXPORTER_OTLP_HEADERS`                        | Authentication headers for OTLP                                                                                       | `Authorization=Bearer token`         |
+| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY`             | Client key for mTLS authentication                                                                                    | Path to client key file              |
+| `OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE`     | Client certificate for mTLS authentication                                                                            | Path to client cert file             |
+| `OTEL_METRIC_EXPORT_INTERVAL`                       | Export interval in milliseconds (default: 60000)                                                                      | `5000`, `60000`                      |
+| `OTEL_LOGS_EXPORT_INTERVAL`                         | Logs export interval in milliseconds (default: 5000)                                                                  | `1000`, `10000`                      |
+| `OTEL_LOG_USER_PROMPTS`                             | Enable logging of user prompt content (default: disabled)                                                             | `1` to enable                        |
+| `OTEL_LOG_TOOL_DETAILS`                             | Enable logging of MCP server/tool names and skill names in tool events (default: disabled)                            | `1` to enable                        |
+| `OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE` | Metrics temporality preference (default: `delta`). Set to `cumulative` if your backend expects cumulative temporality | `delta`, `cumulative`                |
+| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS`       | Interval for refreshing dynamic headers (default: 1740000ms / 29 minutes)                                             | `900000`                             |
 
 ### Metrics cardinality control
 
@@ -149,7 +148,7 @@
 &lt;Warning&gt;
   **Important formatting requirements for OTEL\_RESOURCE\_ATTRIBUTES:**
 
-  The `OTEL_RESOURCE_ATTRIBUTES` environment variable follows the [W3C Baggage specification](https://www.w3.org/TR/baggage/), which has strict formatting requirements:
+  The `OTEL_RESOURCE_ATTRIBUTES` environment variable uses comma-separated key=value pairs with strict formatting requirements:
 
   * **No spaces allowed**: Values cannot contain spaces. For example, `user.organizationName=My Company` is invalid
   * **Format**: Must be comma-separated key=value pairs: `key1=value1,key2=value2`
@@ -175,6 +174,8 @@
 
 ### Example configurations
 
+Set these environment variables before running `claude`. Each block shows a complete configuration for a different exporter or deployment scenario:
+
 ```bash  theme={null}
 # Console debugging (1-second intervals)
 export CLAUDE_CODE_ENABLE_TELEMETRY=1
@@ -201,9 +202,9 @@
 export OTEL_METRICS_EXPORTER=otlp
 export OTEL_LOGS_EXPORTER=otlp
 export OTEL_EXPORTER_OTLP_METRICS_PROTOCOL=http/protobuf
-export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://metrics.company.com:4318
+export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://metrics.example.com:4318
 export OTEL_EXPORTER_OTLP_LOGS_PROTOCOL=grpc
-export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://logs.company.com:4317
+export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://logs.example.com:4317
 
 # Metrics only (no events/logs)
 export CLAUDE_CODE_ENABLE_TELEMETRY=1
@@ -224,13 +225,15 @@
 
 All metrics and events share these standard attributes:
 
-| Attribute           | Description                                                          | Controlled By                                       |
-| ------------------- | -------------------------------------------------------------------- | --------------------------------------------------- |
-| `session.id`        | Unique session identifier                                            | `OTEL_METRICS_INCLUDE_SESSION_ID` (default: true)   |
-| `app.version`       | Current Claude Code version                                          | `OTEL_METRICS_INCLUDE_VERSION` (default: false)     |
-| `organization.id`   | Organization UUID (when authenticated)                               | Always included when available                      |
-| `user.account_uuid` | Account UUID (when authenticated)                                    | `OTEL_METRICS_INCLUDE_ACCOUNT_UUID` (default: true) |
-| `terminal.type`     | Terminal type (for example, `iTerm.app`, `vscode`, `cursor`, `tmux`) | Always included when detected                       |
+| Attribute           | Description                                                       | Controlled By                                       |
+| ------------------- | ----------------------------------------------------------------- | --------------------------------------------------- |
+| `session.id`        | Unique session identifier                                         | `OTEL_METRICS_INCLUDE_SESSION_ID` (default: true)   |
+| `app.version`       | Current Claude Code version                                       | `OTEL_METRICS_INCLUDE_VERSION` (default: false)     |
+| `organization.id`   | Organization UUID (when authenticated)                            | Always included when available                      |
+| `user.account_uuid` | Account UUID (when authenticated)                                 | `OTEL_METRICS_INCLUDE_ACCOUNT_UUID` (default: true) |
+| `user.id`           | Anonymous user identifier                                         | Always included                                     |
+| `user.email`        | User email address (when authenticated via OAuth)                 | Always included when available                      |
+| `terminal.type`     | Terminal type, such as `iTerm.app`, `vscode`, `cursor`, or `tmux` | Always included when detected                       |
 
 ### Metrics
 
@@ -249,6 +252,8 @@
 
 ### Metric details
 
+Each metric includes the standard attributes listed above. Metrics with additional context-specific attributes are noted below.
+
 #### Session counter
 
 Incremented at the start of each session.
@@ -308,21 +313,37 @@
 **Attributes**:
 
 * All [standard attributes](#standard-attributes)
-* `tool`: Tool name (`&#34;Edit&#34;`, `&#34;Write&#34;`, `&#34;NotebookEdit&#34;`)
+* `tool_name`: Tool name (`&#34;Edit&#34;`, `&#34;Write&#34;`, `&#34;NotebookEdit&#34;`)
 * `decision`: User decision (`&#34;accept&#34;`, `&#34;reject&#34;`)
-* `language`: Programming language of the edited file (for example, `&#34;TypeScript&#34;`, `&#34;Python&#34;`, `&#34;JavaScript&#34;`, `&#34;Markdown&#34;`). Returns `&#34;unknown&#34;` for unrecognized file extensions.
+* `source`: Decision source - `&#34;config&#34;`, `&#34;hook&#34;`, `&#34;user_permanent&#34;`, `&#34;user_temporary&#34;`, `&#34;user_abort&#34;`, or `&#34;user_reject&#34;`
+* `language`: Programming language of the edited file, such as `&#34;TypeScript&#34;`, `&#34;Python&#34;`, `&#34;JavaScript&#34;`, or `&#34;Markdown&#34;`. Returns `&#34;unknown&#34;` for unrecognized file extensions.
 
 #### Active time counter
 
-Tracks actual time spent actively using Claude Code (not idle time). This metric is incremented during user interactions such as typing prompts or receiving responses.
-
-**Attributes**:
-
-* All [standard attributes](#standard-attributes)
+Tracks actual time spent actively using Claude Code, excluding idle time. This metric is incremented during user interactions (typing, reading responses) and during CLI processing (tool execution, AI response generation).
+
+**Attributes**:
+
+* All [standard attributes](#standard-attributes)
+* `type`: `&#34;user&#34;` for keyboard interactions, `&#34;cli&#34;` for tool execution and AI responses
 
 ### Events
 
 Claude Code exports the following events via OpenTelemetry logs/events (when `OTEL_LOGS_EXPORTER` is configured):
+
+#### Event correlation attributes
+
+When a user submits a prompt, Claude Code may make multiple API calls and run several tools. The `prompt.id` attribute lets you tie all of those events back to the single prompt that triggered them.
+
+| Attribute   | Description                                                                          |
+| ----------- | ------------------------------------------------------------------------------------ |
+| `prompt.id` | UUID v4 identifier linking all events produced while processing a single user prompt |
+
+To trace all activity triggered by a single prompt, filter your events by a specific `prompt.id` value. This returns the user\_prompt event, any api\_request events, and any tool\_result events that occurred while processing that prompt.
+
+&lt;Note&gt;
+  `prompt.id` is intentionally excluded from metrics because each prompt generates a unique ID, which would create an ever-growing number of time series. Use it for event-level analysis and audit trails only.
+&lt;/Note&gt;
 
 #### User prompt event
 
@@ -355,10 +376,12 @@
 * `success`: `&#34;true&#34;` or `&#34;false&#34;`
 * `duration_ms`: Execution time in milliseconds
 * `error`: Error message (if failed)
-* `decision`: Either `&#34;accept&#34;` or `&#34;reject&#34;`
-* `source`: Decision source - `&#34;config&#34;`, `&#34;user_permanent&#34;`, `&#34;user_temporary&#34;`, `&#34;user_abort&#34;`, or `&#34;user_reject&#34;`
+* `decision_type`: Either `&#34;accept&#34;` or `&#34;reject&#34;`
+* `decision_source`: Decision source - `&#34;config&#34;`, `&#34;hook&#34;`, `&#34;user_permanent&#34;`, `&#34;user_temporary&#34;`, `&#34;user_abort&#34;`, or `&#34;user_reject&#34;`
+* `tool_result_size_bytes`: Size of the tool result in bytes
+* `mcp_server_scope`: MCP server scope identifier (for MCP tools)
 * `tool_parameters`: JSON string containing tool-specific parameters (when available)
-  * For Bash tool: includes `bash_command`, `full_command`, `timeout`, `description`, `sandbox`
+  * For Bash tool: includes `bash_command`, `full_command`, `timeout`, `description`, `dangerouslyDisableSandbox`, and `git_commit_id` (the commit SHA, when a `git commit` command succeeds)
   * For MCP tools (when `OTEL_LOG_TOOL_DETAILS=1`): includes `mcp_server_name`, `mcp_tool_name`
   * For Skill tool (when `OTEL_LOG_TOOL_DETAILS=1`): includes `skill_name`
 
@@ -381,6 +404,7 @@
 * `output_tokens`: Number of output tokens
 * `cache_read_tokens`: Number of tokens read from cache
 * `cache_creation_tokens`: Number of tokens used for cache creation
+* `speed`: `&#34;fast&#34;` or `&#34;normal&#34;`, indicating whether fast mode was active
 
 #### API error event
 
@@ -396,9 +420,10 @@
 * `event.sequence`: monotonically increasing counter for ordering events within a session
 * `model`: Model used (for example, &#34;claude-sonnet-4-6&#34;)
 * `error`: Error message
-* `status_code`: HTTP status code (if applicable)
+* `status_code`: HTTP status code as a string, or `&#34;undefined&#34;` for non-HTTP errors
 * `duration_ms`: Request duration in milliseconds
 * `attempt`: Attempt number (for retried requests)
+* `speed`: `&#34;fast&#34;` or `&#34;normal&#34;`, indicating whether fast mode was active
 
 #### Tool decision event
 
@@ -414,11 +439,11 @@
 * `event.sequence`: monotonically increasing counter for ordering events within a session
 * `tool_name`: Name of the tool (for example, &#34;Read&#34;, &#34;Edit&#34;, &#34;Write&#34;, &#34;NotebookEdit&#34;)
 * `decision`: Either `&#34;accept&#34;` or `&#34;reject&#34;`
-* `source`: Decision source - `&#34;config&#34;`, `&#34;user_permanent&#34;`, `&#34;user_temporary&#34;`, `&#34;user_abort&#34;`, or `&#34;user_reject&#34;`
-
-## Interpreting metrics and events data
-
-The metrics exported by Claude Code provide valuable insights into usage patterns and productivity. Here are some common visualizations and analyses you can create:
+* `source`: Decision source - `&#34;config&#34;`, `&#34;hook&#34;`, `&#34;user_permanent&#34;`, `&#34;user_temporary&#34;`, `&#34;user_abort&#34;`, or `&#34;user_reject&#34;`
+
+## Interpret metrics and events data
+
+The exported metrics and events support a range of analyses:
 
 ### Usage monitoring
 
@@ -497,13 +522,14 @@
 
 For a comprehensive guide on measuring return on investment for Claude Code, including telemetry setup, cost analysis, productivity metrics, and automated reporting, see the [Claude Code ROI Measurement Guide](https://github.com/anthropics/claude-code-monitoring-guide). This repository provides ready-to-use Docker Compose configurations, Prometheus and OpenTelemetry setups, and templates for generating productivity reports integrated with tools like Linear.
 
-## Security/privacy considerations
+## Security and privacy
 
 * Telemetry is opt-in and requires explicit configuration
-* Sensitive information like API keys or file contents are never included in metrics or events
-* User prompt content is redacted by default, only prompt length is recorded. To enable user prompt logging, set `OTEL_LOG_USER_PROMPTS=1`
-* MCP server/tool names and skill names are not logged by default because they can reveal user-specific configurations. To enable, set `OTEL_LOG_TOOL_DETAILS=1`
-
-## Monitoring Claude Code on Amazon Bedrock
+* Raw file contents and code snippets are not included in metrics or events. Tool execution events include bash commands and file paths in the `tool_parameters` field, which may contain sensitive values. If your commands may include secrets, configure your telemetry backend to filter or redact `tool_parameters`
+* When authenticated via OAuth, `user.email` is included in telemetry attributes. If this is a concern for your organization, work with your telemetry backend to filter or redact this field
+* User prompt content is not collected by default. Only prompt length is recorded. To include prompt content, set `OTEL_LOG_USER_PROMPTS=1`
+* MCP server/tool names and skill names are not logged by default because they can reveal user-specific configurations. To include them, set `OTEL_LOG_TOOL_DETAILS=1`
+
+## Monitor Claude Code on Amazon Bedrock
 
 For detailed Claude Code usage monitoring guidance for Amazon Bedrock, see [Claude Code Monitoring Implementation (Bedrock)](https://github.com/aws-solutions-library-samples/guidance-for-claude-code-with-amazon-bedrock/blob/main/assets/docs/MONITORING.md).
</code></pre>
    </div>
</body>
</html>