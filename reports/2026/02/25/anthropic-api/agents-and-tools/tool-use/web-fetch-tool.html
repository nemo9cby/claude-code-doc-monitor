<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/tool-use/web-fetch-tool - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/tool-use/web-fetch-tool.md</h1>
            <p class="meta">Changed on 2026-02-25 10:57:41 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+8</span> lines added
            </div>
            <div class="stat removed">
                <span>-7</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span># Web fetch tool&para;<br>&para;<br>---&para;<br>&para;<br>The web fetch tool allows Claude to retrieve full content from specified web pages and PDF documents.&para;<br>&para;<br>The latest web fetch tool version (`web_fetch_20260209`) supports **dynamic filtering** with Claude Opus 4.6 and Sonnet 4.6. Claude can write and execute code to filter fetched content before it reaches the context window, keeping only relevant information and discarding the rest. This reduces token consumption while maintaining response quality. The previous tool version (`web_fetch_20250910`) remains available without dynamic filtering.&para;<br>&para;<br>&lt;Note&gt;&para;<br>Please use [this form](https://forms.gle/NhWcgmkcvPCMmPE86) to provide feedback on the quality of the model responses, the API itself, or the quality of the documentation.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Note&gt;&para;<br>This feature is [Zero Data Retention (ZDR)](/docs/en/build-with-claude/zero-data-retention) eligible. When your organization has a ZDR arrangement, data sent through this feature is not stored after the API response is returned.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Enabling the web fetch tool in environments where Claude processes untrusted input alongside sensitive data poses data exfiltration risks. Only use this tool in trusted environments or when handling non-sensitive data.&para;<br>&para;<br>To minimize exfiltration risks, Claude is not allowed to dynamically construct URLs. Claude can only fetch URLs that have been explicitly provided by the user or that come from previous web search or web fetch results. However, there is still residual risk that should be carefully considered when using this tool.&para;<br>&para;<br>If data exfiltration is a concern, consider:&para;<br>- Disabling the web fetch tool entirely&para;<br>- Using the `max_uses` parameter to limit the number of requests&para;<br>- Using the `allowed_domains` parameter to restrict to known safe domains&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>## Supported models&para;<br>&para;<br>Web fetch is available on:&para;<br>&para;<br>- Claude Opus 4.6 (`claude-opus-4-6`)&para;<br>- Claude Opus 4.5 (`claude-opus-4-5-20251101`)&para;<br>- Claude Opus 4.1 (`claude-opus-4-1-20250805`)&para;<br>- Claude Opus 4 (`claude-opus-4-20250514`)&para;<br>- Claude Sonnet 4.6 (`claude-sonnet-4-6`)&para;<br>- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)&para;<br>- Claude Sonnet 4 (`claude-sonnet-4-20250514`)&para;<br>- Claude Sonnet 3.7 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)&para;<br>- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)&para;<br>- Claude Haiku 3.5 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-5-haiku-latest`)&para;<br>&para;<br>## How web fetch works&para;<br>&para;<br>When you add the web fetch tool to your API request:&para;<br>&para;<br>1. Claude decides when to fetch content based on the prompt and available URLs.&para;<br>2. The API retrieves the full text content from the specified URL.&para;<br>3. For PDFs, automatic text extraction is performed.&para;<br>4. Claude analyzes the fetched content and provides a response with optional citations.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The web fetch tool currently does not support web sites dynamically rendered via Javascript.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Dynamic filtering with Opus 4.6 and Sonnet 4.6&para;<br>&para;<br>Fetching full web pages and PDFs can quickly consume tokens, especially when only specific information is needed from large documents. With the `web_fetch_20260209` tool version, Claude can write and execute code to filter the fetched content before loading it into context.&para;<br>&para;<br>This dynamic filtering is particularly useful for:&para;<br>- Extracting specific sections from long documents&para;<br>- Processing structured data from web pages&para;<br>- Filtering relevant information from PDFs&para;<br>- Reducing token costs when working with large documents&para;<br>&para;<br>&lt;Note&gt;&para;<br>Dynamic filtering requires the [code execution tool](/docs/en/agents-and-tools/tool-use/code-execution-tool) to be enabled. The web fetch tool (with and without dynamic filtering) is available on the Claude API and Microsoft Azure.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>To enable dynamic filtering, use the `web_fetch_20260209` tool version:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>    --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    --header "anthropic-version: 2023-06-01" \&para;<br>    --header "content-type: application/json" \&para;<br>    --data '{&para;<br>        "model": "claude-opus-4-6",&para;<br>        "max_tokens": 4096,&para;<br>        "messages": [&para;<br>            {&para;<br>                "role": "user",&para;<br>                "content": "Fetch the content at https://example.com/research-paper and extract the key findings."&para;<br>            }&para;<br>        ],&para;<br>        "tools": [{&para;<br>            "type": "web_fetch_20260209",&para;<br>            "name": "web_fetch"&para;<br>        }]&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=4096,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Fetch the content at https://example.com/research-paper and extract the key findings.",&para;<br>        }&para;<br>    ],&para;<br>    tools=[{"type": "web_fetch_20260209", "name": "web_fetch"}],&para;<br>)&para;<br>print(response)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import { Anthropic } from "@anthropic-ai/sdk";&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>async function main() {&para;<br>  const response = await anthropic.messages.create({&para;<br>    model: "claude-opus-4-6",&para;<br>    max_tokens: 4096,&para;<br>    messages: [&para;<br>      {&para;<br>        role: "user",&para;<br>        content:&para;<br>          "Fetch the content at https://example.com/research-paper and extract the key findings."&para;<br>      }&para;<br>    ],&para;<br>    tools: [{ type: "web_fetch_20260209", name: "web_fetch" }]&para;<br>  });&para;<br>&para;<br>  console.log(response);&para;<br>}&para;<br>&para;<br>main().catch(console.error);&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>## How to use web fetch&para;<br>&para;<br>Provide the web fetch tool in your API request:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>    --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    --header "anthropic-version: 2023-06-01" \&para;<br>    --header "content-type: application/json" \&para;<br>    --data '{&para;<br>        "model": "claude-opus-4-6",&para;<br>        "max_tokens": 1024,&para;<br>        "messages": [&para;<br>            {&para;<br>                "role": "user",&para;<br>                "content": "Please analyze the content at https://example.com/article"&para;<br>            }&para;<br>        ],&para;<br>        "tools": [{&para;<br>            "type": "web_fetch_20250910",&para;<br>            "name": "web_fetch",&para;<br>            "max_uses": 5&para;<br>        }]&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=1024,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Please analyze the content at https://example.com/article",&para;<br>        }&para;<br>    ],&para;<br>    tools=[{"type": "web_fetch_20250910", "name": "web_fetch", "max_uses": 5}],&para;<br>)&para;<br>print(response)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import { Anthropic } from "@anthropic-ai/sdk";&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>async function main() {&para;<br>  const response = await anthropic.messages.create({&para;<br>    model: "claude-opus-4-6",&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      {&para;<br>        role: "user",&para;<br>        content: "Please analyze the content at https://example.com/article"&para;<br>      }&para;<br>    ],&para;<br>    tools: [</span><del style="background:#ffe6e6;">{</del><span>&para;<br></span><ins style="background:#e6ffe6;">      {&para;<br>  </ins><span>      type: "web_fetch_20250910",&para;<br>      </span><ins style="background:#e6ffe6;"> </ins><ins style="background:#e6ffe6;"> </ins><span>name: "web_fetch",&para;<br>      </span><ins style="background:#e6ffe6;">  </ins><span>max_uses: 5&para;<br></span><ins style="background:#e6ffe6;">  </ins><span>    }</span><ins style="background:#e6ffe6;">&para;<br>    </ins><span>]&para;<br>  });&para;<br>&para;<br>  console.log(response);&para;<br>}&para;<br>&para;<br>main().catch(console.error);&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>### Tool definition&para;<br>&para;<br>The web fetch tool supports the following parameters:&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "type": "web_fetch_20250910",&para;<br>  "name": "web_fetch",&para;<br>&para;<br>  // Optional: Limit the number of fetches per request&para;<br>  "max_uses": 10,&para;<br>&para;<br>  // Optional: Only fetch from these domains&para;<br>  "allowed_domains": ["example.com", "docs.example.com"],&para;<br>&para;<br>  // Optional: Never fetch from these domains&para;<br>  "blocked_domains": ["private.example.com"],&para;<br>&para;<br>  // Optional: Enable citations for fetched content&para;<br>  "citations": {&para;<br>    "enabled": true&para;<br>  },&para;<br>&para;<br>  // Optional: Maximum content length in tokens&para;<br>  "max_content_tokens": 100000&para;<br>}&para;<br>```&para;<br>&para;<br>#### Max uses&para;<br>&para;<br>The `max_uses` parameter limits the number of web fetches performed. If Claude attempts more fetches than allowed, the `web_fetch_tool_result` will be an error with the `max_uses_exceeded` error code. There is currently no default limit.&para;<br>&para;<br>#### Domain filtering&para;<br>&para;<br>When using domain filters:&para;<br>&para;<br>- Domains should not include the HTTP/HTTPS scheme (use `example.com` instead of `https://example.com`)&para;<br>- Subdomains are automatically included (`example.com` covers `docs.example.com`)&para;<br>- Subpaths are supported (`example.com/blog`)&para;<br>- You can use either `allowed_domains` or `blocked_domains`, but not both in the same request.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Be aware that Unicode characters in domain names can create security vulnerabilities through homograph attacks, where visually similar characters from different scripts can bypass domain filters. For example, `аmazon.com` (using Cyrillic 'а') may appear identical to `amazon.com` but represents a different domain.&para;<br>&para;<br>When configuring domain allow/block lists:&para;<br>- Use ASCII-only domain names when possible&para;<br>- Consider that URL parsers may handle Unicode normalization differently&para;<br>- Test your domain filters with potential homograph variations&para;<br>- Regularly audit your domain configurations for suspicious Unicode characters&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>#### Content limits&para;<br>&para;<br>The `max_content_tokens` parameter limits the amount of content that will be included in the context. If the fetched content exceeds this limit, it will be truncated. This helps control token usage when fetching large documents.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The `max_content_tokens` parameter limit is approximate. The actual number of input tokens used can vary by a small amount.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### Citations&para;<br>&para;<br>Unlike web search where citations are always enabled, citations are optional for web fetch. Set `"citations": {"enabled": true}` to enable Claude to cite specific passages from fetched documents.&para;<br>&para;<br>&lt;Note&gt;&para;<br>When displaying API outputs directly to end users, citations must be included to the original source. If you are making modifications to API outputs, including by reprocessing and/or combining them with your own material before displaying them to end users, display citations as appropriate based on consultation with your legal team.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Response&para;<br>&para;<br>Here's an example response structure:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    // 1. Claude's decision to fetch&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "I'll fetch the content from the article to analyze it."&para;<br>    },&para;<br>    // 2. The fetch request&para;<br>    {&para;<br>      "type": "server_tool_use",&para;<br>      "id": "srvtoolu_01234567890abcdef",&para;<br>      "name": "web_fetch",&para;<br>      "input": {&para;<br>        "url": "https://example.com/article"&para;<br>      }&para;<br>    },&para;<br>    // 3. Fetch results&para;<br>    {&para;<br>      "type": "web_fetch_tool_result",&para;<br>      "tool_use_id": "srvtoolu_01234567890abcdef",&para;<br>      "content": {&para;<br>        "type": "web_fetch_result",&para;<br>        "url": "https://example.com/article",&para;<br>        "content": {&para;<br>          "type": "document",&para;<br>          "source": {&para;<br>            "type": "text",&para;<br>            "media_type": "text/plain",&para;<br>            "data": "Full text content of the article..."&para;<br>          },&para;<br>          "title": "Article Title",&para;<br>          "citations": {</span><ins style="background:#e6ffe6;"> </ins><span>"enabled": true</span><ins style="background:#e6ffe6;"> </ins><span>}&para;<br>        },&para;<br>        "retrieved_at": "2025-08-25T10:30:00Z"&para;<br>      }&para;<br>    },&para;<br>    // 4. Claude's analysis with citations (if enabled)&para;<br>    {&para;<br>      "text": "Based on the article, ",&para;<br>      "type": "text"&para;<br>    },&para;<br>    {&para;<br>      "text": "the main argument presented is that artificial intelligence will transform healthcare",&para;<br>      "type": "text",&para;<br>      "citations": [&para;<br>        {&para;<br>          "type": "char_location",&para;<br>          "document_index": 0,&para;<br>          "document_title": "Article Title",&para;<br>          "start_char_index": 1234,&para;<br>          "end_char_index": 1456,&para;<br>          "cited_text": "Artificial intelligence is poised to revolutionize healthcare delivery..."&para;<br>        }&para;<br>      ]&para;<br>    }&para;<br>  ],&para;<br>  "id": "msg_a930390d3a",&para;<br>  "usage": {&para;<br>    "input_tokens": 25039,&para;<br>    "output_tokens": 931,&para;<br>    "server_tool_use": {&para;<br>      "web_fetch_requests": 1&para;<br>    }&para;<br>  },&para;<br>  "stop_reason": "end_turn"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Fetch results&para;<br>&para;<br>Fetch results include:&para;<br>&para;<br>- `url`: The URL that was fetched&para;<br>- `content`: A document block containing the fetched content&para;<br>- `retrieved_at`: Timestamp when the content was retrieved&para;<br>&para;<br>&lt;Note&gt;&para;<br>The web fetch tool caches results to improve performance and reduce redundant requests. This means the content returned may not always be the latest version available at the URL. The cache behavior is managed automatically and may change over time to optimize for different content types and usage patterns.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>For PDF documents, the content will be returned as base64-encoded data:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "web_fetch_tool_result",&para;<br>  "tool_use_id": "srvtoolu_02",&para;<br>  "content": {&para;<br>    "type": "web_fetch_result",&para;<br>    "url": "https://example.com/paper.pdf",&para;<br>    "content": {&para;<br>      "type": "document",&para;<br>      "source": {&para;<br>        "type": "base64",&para;<br>        "media_type": "application/pdf",&para;<br>        "data": "JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmo..."&para;<br>      },&para;<br>      "citations": {</span><ins style="background:#e6ffe6;"> </ins><span>"enabled": true</span><ins style="background:#e6ffe6;"> </ins><span>}&para;<br>    },&para;<br>    "retrieved_at": "2025-08-25T10:30:02Z"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### Errors&para;<br>&para;<br>When the web fetch tool encounters an error, the Claude API returns a 200 (success) response with the error represented in the response body:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "web_fetch_tool_result",&para;<br>  "tool_use_id": "srvtoolu_a93jad",&para;<br>  "content": {&para;<br>    "type": "web_fetch_tool_error",&para;<br>    "error_code": "url_not_accessible"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>These are the possible error codes:&para;<br>&para;<br>- `invalid_input`: Invalid URL format&para;<br>- `url_too_long`: URL exceeds maximum length (250 characters)&para;<br>- `url_not_allowed`: URL blocked by domain filtering rules and model restrictions&para;<br>- `url_not_accessible`: Failed to fetch content (HTTP error)&para;<br>- `too_many_requests`: Rate limit exceeded&para;<br>- `unsupported_content_type`: Content type not supported (only text and PDF)&para;<br>- `max_uses_exceeded`: Maximum web fetch tool uses exceeded&para;<br>- `unavailable`: An internal error occurred&para;<br>&para;<br>## URL validation&para;<br>&para;<br>For security reasons, the web fetch tool can only fetch URLs that have previously appeared in the conversation context. This includes:&para;<br>&para;<br>- URLs in user messages&para;<br>- URLs in client-side tool results&para;<br>- URLs from previous web search or web fetch results&para;<br>&para;<br>The tool cannot fetch arbitrary URLs that Claude generates or URLs from container-based server tools (Code Execution, Bash, etc.).&para;<br>&para;<br>## Combined search and fetch&para;<br>&para;<br>Web fetch works seamlessly with web search for comprehensive information gathering:&para;<br>&para;<br>```python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=4096,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Find recent articles about quantum computing and analyze the most relevant one in detail",&para;<br>        }&para;<br>    ],&para;<br>    tools=[&para;<br>        {"type": "web_search_20250305", "name": "web_search", "max_uses": 3},&para;<br>        {&para;<br>            "type": "web_fetch_20250910",&para;<br>            "name": "web_fetch",&para;<br>            "max_uses": 5,&para;<br>            "citations": {"enabled": True},&para;<br>        },&para;<br>    ],&para;<br>)&para;<br>```&para;<br>&para;<br>In this workflow, Claude will:&para;<br>1. Use web search to find relevant articles&para;<br>2. Select the most promising results&para;<br>3. Use web fetch to retrieve full content&para;<br>4. Provide detailed analysis with citations&para;<br>&para;<br>## Prompt caching&para;<br>&para;<br>Web fetch works with [prompt caching](/docs/en/build-with-claude/prompt-caching). To enable prompt caching, add `cache_control` breakpoints in your request. Cached fetch results can be reused across conversation turns.&para;<br>&para;<br>```python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br># First request with web fetch&para;<br>messages = [&para;<br>    {&para;<br>        "role": "user",&para;<br>        "content": "Analyze this research paper: https://arxiv.org/abs/2024.12345",&para;<br>    }&para;<br>]&para;<br>&para;<br>response1 = client.messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{"type": "web_fetch_20250910", "name": "web_fetch"}],&para;<br>)&para;<br>&para;<br># Add Claude's response to conversation&para;<br>messages.append({"role": "assistant", "content": response1.content})&para;<br>&para;<br># Second request with cache breakpoint&para;<br>messages.append(&para;<br>    {&para;<br>        "role": "user",&para;<br>        "content": "What methodology does the paper use?",&para;<br>        "cache_control": {"type": "ephemeral"},&para;<br>    }&para;<br>)&para;<br>&para;<br>response2 = client.messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{"type": "web_fetch_20250910", "name": "web_fetch"}],&para;<br>)&para;<br>&para;<br># The second response benefits from cached fetch results&para;<br>print(f"Cache read tokens: {response2.usage.get('cache_read_input_tokens', 0)}")&para;<br>```&para;<br>&para;<br>## Streaming&para;<br>&para;<br>With streaming enabled, fetch events are part of the stream with a pause during content retrieval:&para;<br>&para;<br>```</span><del style="background:#ffe6e6;">json</del><ins style="background:#e6ffe6;">sse</ins><span>&para;<br>event: message_start&para;<br>data: {"type": "message_start", "message": {"id": "msg_abc123", "type": "message"}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}&para;<br>&para;<br>// Claude's decision to fetch&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 1, "content_block": {"type": "server_tool_use", "id": "srvtoolu_xyz789", "name": "web_fetch"}}&para;<br>&para;<br>// Fetch URL streamed&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 1, "delta": {"type": "input_json_delta", "partial_json": "{\"url\":\"https://example.com/article\"}"}}&para;<br>&para;<br>// Pause while fetch executes&para;<br>&para;<br>// Fetch results streamed&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 2, "content_block": {"type": "web_fetch_tool_result", "tool_use_id": "srvtoolu_xyz789", "content": {"type": "web_fetch_result", "url": "https://example.com/article", "content": {"type": "document", "source": {"type": "text", "media_type": "text/plain", "data": "Article content..."}}}}}&para;<br>&para;<br>// Claude's response continues...&para;<br>```&para;<br>&para;<br>## Batch requests&para;<br>&para;<br>You can include the web fetch tool in the [Messages Batches API](/docs/en/build-with-claude/batch-processing). Web fetch tool calls through the Messages Batches API are priced the same as those in regular Messages API requests.&para;<br>&para;<br>## Usage and pricing&para;<br>&para;<br>Web fetch usage has **no additional charges** beyond standard token costs:&para;<br>&para;<br>```json&para;<br>"usage": {&para;<br>  "input_tokens": 25039,&para;<br>  "output_tokens": 931,&para;<br>  "cache_read_input_tokens": 0,&para;<br>  "cache_creation_input_tokens": 0,&para;<br>  "server_tool_use": {&para;<br>    "web_fetch_requests": 1&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>The web fetch tool is available on the Claude API at **no additional cost**. You only pay standard token costs for the fetched content that becomes part of your conversation context.&para;<br>&para;<br>To protect against inadvertently fetching large content that would consume excessive tokens, use the `max_content_tokens` parameter to set appropriate limits based on your use case and budget considerations.&para;<br>&para;<br>Example token usage for typical content:&para;<br>- Average web page (10KB): ~2,500 tokens&para;<br>- Large documentation page (100KB): ~25,000 tokens  &para;<br>- Research paper PDF (500KB): ~125,000 tokens</span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/tool-use/web-fetch-tool.md
+++ b/agents-and-tools/tool-use/web-fetch-tool.md
@@ -197,11 +197,13 @@
         content: &#34;Please analyze the content at https://example.com/article&#34;
       }
     ],
-    tools: [{
-      type: &#34;web_fetch_20250910&#34;,
-      name: &#34;web_fetch&#34;,
-      max_uses: 5
-    }]
+    tools: [
+      {
+        type: &#34;web_fetch_20250910&#34;,
+        name: &#34;web_fetch&#34;,
+        max_uses: 5
+      }
+    ]
   });
 
   console.log(response);
@@ -315,7 +317,7 @@
             &#34;data&#34;: &#34;Full text content of the article...&#34;
           },
           &#34;title&#34;: &#34;Article Title&#34;,
-          &#34;citations&#34;: {&#34;enabled&#34;: true}
+          &#34;citations&#34;: { &#34;enabled&#34;: true }
         },
         &#34;retrieved_at&#34;: &#34;2025-08-25T10:30:00Z&#34;
       }
@@ -380,7 +382,7 @@
         &#34;media_type&#34;: &#34;application/pdf&#34;,
         &#34;data&#34;: &#34;JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmo...&#34;
       },
-      &#34;citations&#34;: {&#34;enabled&#34;: true}
+      &#34;citations&#34;: { &#34;enabled&#34;: true }
     },
     &#34;retrieved_at&#34;: &#34;2025-08-25T10:30:02Z&#34;
   }
@@ -510,7 +512,7 @@
 
 With streaming enabled, fetch events are part of the stream with a pause during content retrieval:
 
-```json
+```sse
 event: message_start
 data: {&#34;type&#34;: &#34;message_start&#34;, &#34;message&#34;: {&#34;id&#34;: &#34;msg_abc123&#34;, &#34;type&#34;: &#34;message&#34;}}
 
</code></pre>
    </div>
</body>
</html>