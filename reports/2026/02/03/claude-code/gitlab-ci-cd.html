<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gitlab-ci-cd - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>gitlab-ci-cd.md</h1>
            <p class="meta">Changed on 2026-02-03 20:41:54 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+2</span> lines added
            </div>
            <div class="stat removed">
                <span>-2</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span>&gt; ## Documentation Index&para;<br>&gt; Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt&para;<br>&gt; Use this file to discover all available pages before exploring further.&para;<br>&para;<br># Claude Code GitLab CI/CD&para;<br>&para;<br>&gt; Learn about integrating Claude Code into your development workflow with GitLab CI/CD&para;<br>&para;<br>&lt;Info&gt;&para;<br>  Claude Code for GitLab CI/CD is currently in beta. Features and functionality may evolve as we refine the experience.&para;<br>&para;<br>  This integration is maintained by GitLab. For support, see the following [GitLab issue](https://gitlab.com/gitlab-org/gitlab/-/issues/573776).&para;<br>&lt;/Info&gt;&para;<br>&para;<br>&lt;Note&gt;&para;<br>  This integration is built on top of the [Claude Code CLI and </span><ins style="background:#e6ffe6;">Agent </ins><span>SDK](https://</span><del style="background:#ffe6e6;">docs</del><ins style="background:#e6ffe6;">platform</ins><span>.claude.com/</span><del style="background:#ffe6e6;">en/</del><span>docs/</span><ins style="background:#e6ffe6;">en/</ins><span>agent-sdk</span><ins style="background:#e6ffe6;">/overview</ins><span>), enabling programmatic use of Claude in your CI/CD jobs and custom automation workflows.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Why use Claude Code with GitLab?&para;<br>&para;<br>* **Instant MR creation**: Describe what you need, and Claude proposes a complete MR with changes and explanation&para;<br>* **Automated implementation**: Turn issues into working code with a single command or mention&para;<br>* **Project-aware**: Claude follows your `CLAUDE.md` guidelines and existing code patterns&para;<br>* **Simple setup**: Add one job to `.gitlab-ci.yml` and a masked CI/CD variable&para;<br>* **Enterprise-ready**: Choose Claude API, AWS Bedrock, or Google Vertex AI to meet data residency and procurement needs&para;<br>* **Secure by default**: Runs in your GitLab runners with your branch protection and approvals&para;<br>&para;<br>## How it works&para;<br>&para;<br>Claude Code uses GitLab CI/CD to run AI tasks in isolated jobs and commit results back via MRs:&para;<br>&para;<br>1. **Event-driven orchestration**: GitLab listens for your chosen triggers (for example, a comment that mentions `@claude` in an issue, MR, or review thread). The job collects context from the thread and repository, builds prompts from that input, and runs Claude Code.&para;<br>&para;<br>2. **Provider abstraction**: Use the provider that fits your environment:&para;<br>   * Claude API (SaaS)&para;<br>   * AWS Bedrock (IAM-based access, cross-region options)&para;<br>   * Google Vertex AI (GCP-native, Workload Identity Federation)&para;<br>&para;<br>3. **Sandboxed execution**: Each interaction runs in a container with strict network and filesystem rules. Claude Code enforces workspace-scoped permissions to constrain writes. Every change flows through an MR so reviewers see the diff and approvals still apply.&para;<br>&para;<br>Pick regional endpoints to reduce latency and meet data-sovereignty requirements while using existing cloud agreements.&para;<br>&para;<br>## What can Claude do?&para;<br>&para;<br>Claude Code enables powerful CI/CD workflows that transform how you work with code:&para;<br>&para;<br>* Create and update MRs from issue descriptions or comments&para;<br>* Analyze performance regressions and propose optimizations&para;<br>* Implement features directly in a branch, then open an MR&para;<br>* Fix bugs and regressions identified by tests or comments&para;<br>* Respond to follow-up comments to iterate on requested changes&para;<br>&para;<br>## Setup&para;<br>&para;<br>### Quick setup&para;<br>&para;<br>The fastest way to get started is to add a minimal job to your `.gitlab-ci.yml` and set your API key as a masked variable.&para;<br>&para;<br>1. **Add a masked CI/CD variable**&para;<br>   * Go to **Settings** → **CI/CD** → **Variables**&para;<br>   * Add `ANTHROPIC_API_KEY` (masked, protected as needed)&para;<br>&para;<br>2. **Add a Claude job to `.gitlab-ci.yml`**&para;<br>&para;<br>```yaml  theme={null}&para;<br>stages:&para;<br>  - ai&para;<br>&para;<br>claude:&para;<br>  stage: ai&para;<br>  image: node:24-alpine3.21&para;<br>  # Adjust rules to fit how you want to trigger the job:&para;<br>  # - manual runs&para;<br>  # - merge request events&para;<br>  # - web/API triggers when a comment contains '@claude'&para;<br>  rules:&para;<br>    - if: '$CI_PIPELINE_SOURCE == "web"'&para;<br>    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'&para;<br>  variables:&para;<br>    GIT_STRATEGY: fetch&para;<br>  before_script:&para;<br>    - apk update&para;<br>    - apk add --no-cache git curl bash&para;<br>    - curl -fsSL https://claude.ai/install.sh | bash&para;<br>  script:&para;<br>    # Optional: start a GitLab MCP server if your setup provides one&para;<br>    - /bin/gitlab-mcp-server || true&para;<br>    # Use AI_FLOW_* variables when invoking via web/API triggers with context payloads&para;<br>    - echo "$AI_FLOW_INPUT for $AI_FLOW_CONTEXT on $AI_FLOW_EVENT"&para;<br>    - &gt;&para;<br>      claude&para;<br>      -p "${AI_FLOW_INPUT:-'Review this MR and implement the requested changes'}"&para;<br>      --permission-mode acceptEdits&para;<br>      --allowedTools "Bash Read Edit Write mcp__gitlab"&para;<br>      --debug&para;<br>```&para;<br>&para;<br>After adding the job and your `ANTHROPIC_API_KEY` variable, test by running the job manually from **CI/CD** → **Pipelines**, or trigger it from an MR to let Claude propose updates in a branch and open an MR if needed.&para;<br>&para;<br>&lt;Note&gt;&para;<br>  To run on AWS Bedrock or Google Vertex AI instead of the Claude API, see the [Using with AWS Bedrock &amp; Google Vertex AI](#using-with-aws-bedrock--google-vertex-ai) section below for authentication and environment setup.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Manual setup (recommended for production)&para;<br>&para;<br>If you prefer a more controlled setup or need enterprise providers:&para;<br>&para;<br>1. **Configure provider access**:&para;<br>   * **Claude API**: Create and store `ANTHROPIC_API_KEY` as a masked CI/CD variable&para;<br>   * **AWS Bedrock**: **Configure GitLab** → **AWS OIDC** and create an IAM role for Bedrock&para;<br>   * **Google Vertex AI**: **Configure Workload Identity Federation for GitLab** → **GCP**&para;<br>&para;<br>2. **Add project credentials for GitLab API operations**:&para;<br>   * Use `CI_JOB_TOKEN` by default, or create a Project Access Token with `api` scope&para;<br>   * Store as `GITLAB_ACCESS_TOKEN` (masked) if using a PAT&para;<br>&para;<br>3. **Add the Claude job to `.gitlab-ci.yml`** (see examples below)&para;<br>&para;<br>4. **(Optional) Enable mention-driven triggers**:&para;<br>   * Add a project webhook for "Comments (notes)" to your event listener (if you use one)&para;<br>   * Have the listener call the pipeline trigger API with variables like `AI_FLOW_INPUT` and `AI_FLOW_CONTEXT` when a comment contains `@claude`&para;<br>&para;<br>## Example use cases&para;<br>&para;<br>### Turn issues into MRs&para;<br>&para;<br>In an issue comment:&para;<br>&para;<br>```&para;<br>@claude implement this feature based on the issue description&para;<br>```&para;<br>&para;<br>Claude analyzes the issue and codebase, writes changes in a branch, and opens an MR for review.&para;<br>&para;<br>### Get implementation help&para;<br>&para;<br>In an MR discussion:&para;<br>&para;<br>```&para;<br>@claude suggest a concrete approach to cache the results of this API call&para;<br>```&para;<br>&para;<br>Claude proposes changes, adds code with appropriate caching, and updates the MR.&para;<br>&para;<br>### Fix bugs quickly&para;<br>&para;<br>In an issue or MR comment:&para;<br>&para;<br>```&para;<br>@claude fix the TypeError in the user dashboard component&para;<br>```&para;<br>&para;<br>Claude locates the bug, implements a fix, and updates the branch or opens a new MR.&para;<br>&para;<br>## Using with AWS Bedrock &amp; Google Vertex AI&para;<br>&para;<br>For enterprise environments, you can run Claude Code entirely on your cloud infrastructure with the same developer experience.&para;<br>&para;<br>&lt;Tabs&gt;&para;<br>  &lt;Tab title="AWS Bedrock"&gt;&para;<br>    ### Prerequisites&para;<br>&para;<br>    Before setting up Claude Code with AWS Bedrock, you need:&para;<br>&para;<br>    1. An AWS account with Amazon Bedrock access to the desired Claude models&para;<br>    2. GitLab configured as an OIDC identity provider in AWS IAM&para;<br>    3. An IAM role with Bedrock permissions and a trust policy restricted to your GitLab project/refs&para;<br>    4. GitLab CI/CD variables for role assumption:&para;<br>       * `AWS_ROLE_TO_ASSUME` (role ARN)&para;<br>       * `AWS_REGION` (Bedrock region)&para;<br>&para;<br>    ### Setup instructions&para;<br>&para;<br>    Configure AWS to allow GitLab CI jobs to assume an IAM role via OIDC (no static keys).&para;<br>&para;<br>    **Required setup:**&para;<br>&para;<br>    1. Enable Amazon Bedrock and request access to your target Claude models&para;<br>    2. Create an IAM OIDC provider for GitLab if not already present&para;<br>    3. Create an IAM role trusted by the GitLab OIDC provider, restricted to your project and protected refs&para;<br>    4. Attach least-privilege permissions for Bedrock invoke APIs&para;<br>&para;<br>    **Required values to store in CI/CD variables:**&para;<br>&para;<br>    * `AWS_ROLE_TO_ASSUME`&para;<br>    * `AWS_REGION`&para;<br>&para;<br>    Add variables in Settings → CI/CD → Variables:&para;<br>&para;<br>    ```yaml  theme={null}&para;<br>    # For AWS Bedrock:&para;<br>    - AWS_ROLE_TO_ASSUME&para;<br>    - AWS_REGION&para;<br>    ```&para;<br>&para;<br>    Use the AWS Bedrock job example above to exchange the GitLab job token for temporary AWS credentials at runtime.&para;<br>  &lt;/Tab&gt;&para;<br>&para;<br>  &lt;Tab title="Google Vertex AI"&gt;&para;<br>    ### Prerequisites&para;<br>&para;<br>    Before setting up Claude Code with Google Vertex AI, you need:&para;<br>&para;<br>    1. A Google Cloud project with:&para;<br>       * Vertex AI API enabled&para;<br>       * Workload Identity Federation configured to trust GitLab OIDC&para;<br>    2. A dedicated service account with only the required Vertex AI roles&para;<br>    3. GitLab CI/CD variables for WIF:&para;<br>       * `GCP_WORKLOAD_IDENTITY_PROVIDER` (full resource name)&para;<br>       * `GCP_SERVICE_ACCOUNT` (service account email)&para;<br>&para;<br>    ### Setup instructions&para;<br>&para;<br>    Configure Google Cloud to allow GitLab CI jobs to impersonate a service account via Workload Identity Federation.&para;<br>&para;<br>    **Required setup:**&para;<br>&para;<br>    1. Enable IAM Credentials API, STS API, and Vertex AI API&para;<br>    2. Create a Workload Identity Pool and provider for GitLab OIDC&para;<br>    3. Create a dedicated service account with Vertex AI roles&para;<br>    4. Grant the WIF principal permission to impersonate the service account&para;<br>&para;<br>    **Required values to store in CI/CD variables:**&para;<br>&para;<br>    * `GCP_WORKLOAD_IDENTITY_PROVIDER`&para;<br>    * `GCP_SERVICE_ACCOUNT`&para;<br>&para;<br>    Add variables in Settings → CI/CD → Variables:&para;<br>&para;<br>    ```yaml  theme={null}&para;<br>    # For Google Vertex AI:&para;<br>    - GCP_WORKLOAD_IDENTITY_PROVIDER&para;<br>    - GCP_SERVICE_ACCOUNT&para;<br>    - CLOUD_ML_REGION (for example, us-east5)&para;<br>    ```&para;<br>&para;<br>    Use the Google Vertex AI job example above to authenticate without storing keys.&para;<br>  &lt;/Tab&gt;&para;<br>&lt;/Tabs&gt;&para;<br>&para;<br>## Configuration examples&para;<br>&para;<br>Below are ready-to-use snippets you can adapt to your pipeline.&para;<br>&para;<br>### Basic .gitlab-ci.yml (Claude API)&para;<br>&para;<br>```yaml  theme={null}&para;<br>stages:&para;<br>  - ai&para;<br>&para;<br>claude:&para;<br>  stage: ai&para;<br>  image: node:24-alpine3.21&para;<br>  rules:&para;<br>    - if: '$CI_PIPELINE_SOURCE == "web"'&para;<br>    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'&para;<br>  variables:&para;<br>    GIT_STRATEGY: fetch&para;<br>  before_script:&para;<br>    - apk update&para;<br>    - apk add --no-cache git curl bash&para;<br>    - curl -fsSL https://claude.ai/install.sh | bash&para;<br>  script:&para;<br>    - /bin/gitlab-mcp-server || true&para;<br>    - &gt;&para;<br>      claude&para;<br>      -p "${AI_FLOW_INPUT:-'Summarize recent changes and suggest improvements'}"&para;<br>      --permission-mode acceptEdits&para;<br>      --allowedTools "Bash Read Edit Write mcp__gitlab"&para;<br>      --debug&para;<br>  # Claude Code will use ANTHROPIC_API_KEY from CI/CD variables&para;<br>```&para;<br>&para;<br>### AWS Bedrock job example (OIDC)&para;<br>&para;<br>**Prerequisites:**&para;<br>&para;<br>* Amazon Bedrock enabled with access to your chosen Claude model(s)&para;<br>* GitLab OIDC configured in AWS with a role that trusts your GitLab project and refs&para;<br>* IAM role with Bedrock permissions (least privilege recommended)&para;<br>&para;<br>**Required CI/CD variables:**&para;<br>&para;<br>* `AWS_ROLE_TO_ASSUME`: ARN of the IAM role for Bedrock access&para;<br>* `AWS_REGION`: Bedrock region (for example, `us-west-2`)&para;<br>&para;<br>```yaml  theme={null}&para;<br>claude-bedrock:&para;<br>  stage: ai&para;<br>  image: node:24-alpine3.21&para;<br>  rules:&para;<br>    - if: '$CI_PIPELINE_SOURCE == "web"'&para;<br>  before_script:&para;<br>    - apk add --no-cache bash curl jq git python3 py3-pip&para;<br>    - pip install --no-cache-dir awscli&para;<br>    - curl -fsSL https://claude.ai/install.sh | bash&para;<br>    # Exchange GitLab OIDC token for AWS credentials&para;<br>    - export AWS_WEB_IDENTITY_TOKEN_FILE="${CI_JOB_JWT_FILE:-/tmp/oidc_token}"&para;<br>    - if [ -n "${CI_JOB_JWT_V2}" ]; then printf "%s" "$CI_JOB_JWT_V2" &gt; "$AWS_WEB_IDENTITY_TOKEN_FILE"; fi&para;<br>    - &gt;&para;<br>      aws sts assume-role-with-web-identity&para;<br>      --role-arn "$AWS_ROLE_TO_ASSUME"&para;<br>      --role-session-name "gitlab-claude-$(date +%s)"&para;<br>      --web-identity-token "file://$AWS_WEB_IDENTITY_TOKEN_FILE"&para;<br>      --duration-seconds 3600 &gt; /tmp/aws_creds.json&para;<br>    - export AWS_ACCESS_KEY_ID="$(jq -r .Credentials.AccessKeyId /tmp/aws_creds.json)"&para;<br>    - export AWS_SECRET_ACCESS_KEY="$(jq -r .Credentials.SecretAccessKey /tmp/aws_creds.json)"&para;<br>    - export AWS_SESSION_TOKEN="$(jq -r .Credentials.SessionToken /tmp/aws_creds.json)"&para;<br>  script:&para;<br>    - /bin/gitlab-mcp-server || true&para;<br>    - &gt;&para;<br>      claude&para;<br>      -p "${AI_FLOW_INPUT:-'Implement the requested changes and open an MR'}"&para;<br>      --permission-mode acceptEdits&para;<br>      --allowedTools "Bash Read Edit Write mcp__gitlab"&para;<br>      --debug&para;<br>  variables:&para;<br>    AWS_REGION: "us-west-2"&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Model IDs for Bedrock include region-specific prefixes and version suffixes (for example, `us.anthropic.claude-sonnet-4-5-20250929-v1:0`). Pass the desired model via your job configuration or prompt if your workflow supports it.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Google Vertex AI job example (Workload Identity Federation)&para;<br>&para;<br>**Prerequisites:**&para;<br>&para;<br>* Vertex AI API enabled in your GCP project&para;<br>* Workload Identity Federation configured to trust GitLab OIDC&para;<br>* A service account with Vertex AI permissions&para;<br>&para;<br>**Required CI/CD variables:**&para;<br>&para;<br>* `GCP_WORKLOAD_IDENTITY_PROVIDER`: Full provider resource name&para;<br>* `GCP_SERVICE_ACCOUNT`: Service account email&para;<br>* `CLOUD_ML_REGION`: Vertex region (for example, `us-east5`)&para;<br>&para;<br>```yaml  theme={null}&para;<br>claude-vertex:&para;<br>  stage: ai&para;<br>  image: gcr.io/google.com/cloudsdktool/google-cloud-cli:slim&para;<br>  rules:&para;<br>    - if: '$CI_PIPELINE_SOURCE == "web"'&para;<br>  before_script:&para;<br>    - apt-get update &amp;&amp; apt-get install -y git &amp;&amp; apt-get clean&para;<br>    - curl -fsSL https://claude.ai/install.sh | bash&para;<br>    # Authenticate to Google Cloud via WIF (no downloaded keys)&para;<br>    - &gt;&para;<br>      gcloud auth login --cred-file=&lt;(cat &lt;&lt;EOF&para;<br>      {&para;<br>        "type": "external_account",&para;<br>        "audience": "${GCP_WORKLOAD_IDENTITY_PROVIDER}",&para;<br>        "subject_token_type": "urn:ietf:params:oauth:token-type:jwt",&para;<br>        "service_account_impersonation_url": "https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/${GCP_SERVICE_ACCOUNT}:generateAccessToken",&para;<br>        "token_url": "https://sts.googleapis.com/v1/token"&para;<br>      }&para;<br>      EOF&para;<br>      )&para;<br>    - gcloud config set project "$(gcloud projects list --format='value(projectId)' --filter="name:${CI_PROJECT_NAMESPACE}" | head -n1)" || true&para;<br>  script:&para;<br>    - /bin/gitlab-mcp-server || true&para;<br>    - &gt;&para;<br>      CLOUD_ML_REGION="${CLOUD_ML_REGION:-us-east5}"&para;<br>      claude&para;<br>      -p "${AI_FLOW_INPUT:-'Review and update code as requested'}"&para;<br>      --permission-mode acceptEdits&para;<br>      --allowedTools "Bash Read Edit Write mcp__gitlab"&para;<br>      --debug&para;<br>  variables:&para;<br>    CLOUD_ML_REGION: "us-east5"&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  With Workload Identity Federation, you do not need to store service account keys. Use repository-specific trust conditions and least-privilege service accounts.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Best practices&para;<br>&para;<br>### CLAUDE.md configuration&para;<br>&para;<br>Create a `CLAUDE.md` file at the repository root to define coding standards, review criteria, and project-specific rules. Claude reads this file during runs and follows your conventions when proposing changes.&para;<br>&para;<br>### Security considerations&para;<br>&para;<br>**Never commit API keys or cloud credentials to your repository**. Always use GitLab CI/CD variables:&para;<br>&para;<br>* Add `ANTHROPIC_API_KEY` as a masked variable (and protect it if needed)&para;<br>* Use provider-specific OIDC where possible (no long-lived keys)&para;<br>* Limit job permissions and network egress&para;<br>* Review Claude's MRs like any other contributor&para;<br>&para;<br>### Optimizing performance&para;<br>&para;<br>* Keep `CLAUDE.md` focused and concise&para;<br>* Provide clear issue/MR descriptions to reduce iterations&para;<br>* Configure sensible job timeouts to avoid runaway runs&para;<br>* Cache npm and package installs in runners where possible&para;<br>&para;<br>### CI costs&para;<br>&para;<br>When using Claude Code with GitLab CI/CD, be aware of associated costs:&para;<br>&para;<br>* **GitLab Runner time**:&para;<br>  * Claude runs on your GitLab runners and consumes compute minutes&para;<br>  * See your GitLab plan's runner billing for details&para;<br>&para;<br>* **API costs**:&para;<br>  * Each Claude interaction consumes tokens based on prompt and response size&para;<br>  * Token usage varies by task complexity and codebase size&para;<br>  * See [Anthropic pricing](https://</span><del style="background:#ffe6e6;">docs</del><ins style="background:#e6ffe6;">platform</ins><span>.claude.com/</span><del style="background:#ffe6e6;">en/</del><span>docs/</span><ins style="background:#e6ffe6;">en/</ins><span>about-claude/pricing) for details&para;<br>&para;<br>* **Cost optimization tips**:&para;<br>  * Use specific `@claude` commands to reduce unnecessary turns&para;<br>  * Set appropriate `max_turns` and job timeout values&para;<br>  * Limit concurrency to control parallel runs&para;<br>&para;<br>## Security and governance&para;<br>&para;<br>* Each job runs in an isolated container with restricted network access&para;<br>* Claude's changes flow through MRs so reviewers see every diff&para;<br>* Branch protection and approval rules apply to AI-generated code&para;<br>* Claude Code uses workspace-scoped permissions to constrain writes&para;<br>* Costs remain under your control because you bring your own provider credentials&para;<br>&para;<br>## Troubleshooting&para;<br>&para;<br>### Claude not responding to @claude commands&para;<br>&para;<br>* Verify your pipeline is being triggered (manually, MR event, or via a note event listener/webhook)&para;<br>* Ensure CI/CD variables (`ANTHROPIC_API_KEY` or cloud provider settings) are present and unmasked&para;<br>* Check that the comment contains `@claude` (not `/claude`) and that your mention trigger is configured&para;<br>&para;<br>### Job can't write comments or open MRs&para;<br>&para;<br>* Ensure `CI_JOB_TOKEN` has sufficient permissions for the project, or use a Project Access Token with `api` scope&para;<br>* Check the `mcp__gitlab` tool is enabled in `--allowedTools`&para;<br>* Confirm the job runs in the context of the MR or has enough context via `AI_FLOW_*` variables&para;<br>&para;<br>### Authentication errors&para;<br>&para;<br>* **For Claude API**: Confirm `ANTHROPIC_API_KEY` is valid and unexpired&para;<br>* **For Bedrock/Vertex**: Verify OIDC/WIF configuration, role impersonation, and secret names; confirm region and model availability&para;<br>&para;<br>## Advanced configuration&para;<br>&para;<br>### Common parameters and variables&para;<br>&para;<br>Claude Code supports these commonly used inputs:&para;<br>&para;<br>* `prompt` / `prompt_file`: Provide instructions inline (`-p`) or via a file&para;<br>* `max_turns`: Limit the number of back-and-forth iterations&para;<br>* `timeout_minutes`: Limit total execution time&para;<br>* `ANTHROPIC_API_KEY`: Required for the Claude API (not used for Bedrock/Vertex)&para;<br>* Provider-specific environment: `AWS_REGION`, project/region vars for Vertex&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Exact flags and parameters may vary by version of `@anthropic-ai/claude-code`. Run `claude --help` in your job to see supported options.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Customizing Claude's behavior&para;<br>&para;<br>You can guide Claude in two primary ways:&para;<br>&para;<br>1. **CLAUDE.md**: Define coding standards, security requirements, and project conventions. Claude reads this during runs and follows your rules.&para;<br>2. **Custom prompts**: Pass task-specific instructions via `prompt`/`prompt_file` in the job. Use different prompts for different jobs (for example, review, implement, refactor).&para;<br></span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/gitlab-ci-cd.md
+++ b/gitlab-ci-cd.md
@@ -13,7 +13,7 @@
 &lt;/Info&gt;
 
 &lt;Note&gt;
-  This integration is built on top of the [Claude Code CLI and SDK](https://docs.claude.com/en/docs/agent-sdk), enabling programmatic use of Claude in your CI/CD jobs and custom automation workflows.
+  This integration is built on top of the [Claude Code CLI and Agent SDK](https://platform.claude.com/docs/en/agent-sdk/overview), enabling programmatic use of Claude in your CI/CD jobs and custom automation workflows.
 &lt;/Note&gt;
 
 ## Why use Claude Code with GitLab?
@@ -408,7 +408,7 @@
 * **API costs**:
   * Each Claude interaction consumes tokens based on prompt and response size
   * Token usage varies by task complexity and codebase size
-  * See [Anthropic pricing](https://docs.claude.com/en/docs/about-claude/pricing) for details
+  * See [Anthropic pricing](https://platform.claude.com/docs/en/about-claude/pricing) for details
 
 * **Cost optimization tips**:
   * Use specific `@claude` commands to reduce unnecessary turns
</code></pre>
    </div>
</body>
</html>