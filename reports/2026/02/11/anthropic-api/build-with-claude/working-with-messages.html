<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>build-with-claude/working-with-messages - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>build-with-claude/working-with-messages.md</h1>
            <p class="meta">Changed on 2026-02-11 10:56:44 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+33</span> lines added
            </div>
            <div class="stat removed">
                <span>-16</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span># Using the Messages API&para;<br>&para;<br>Practical patterns and examples for using the Messages API effectively&para;<br>&para;<br>---&para;<br>&para;<br>This guide covers common patterns for working with the Messages API, including basic requests, multi-turn conversations, prefill techniques, and vision capabilities. For complete API specifications, see the [Messages API reference](/docs/en/api/messages).&para;<br>&para;<br>## Basic request and response&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>  ```bash Shell&para;<br>  #!/bin/sh&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>       --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>       --header "anthropic-version: 2023-06-01" \&para;<br>       --header "content-type: application/json" \&para;<br>       --data \&para;<br>  '{&para;<br>      "model": "claude-opus-4-6",&para;<br>      "max_tokens": 1024,&para;<br>      "messages": [&para;<br>          {"role": "user", "content": "Hello, Claude"}&para;<br>      ]&para;<br>  }'&para;<br>  ```&para;<br>&para;<br>  ```python Python&para;<br>  import anthropic&para;<br>&para;<br>  message = anthropic.Anthropic().messages.create(&para;<br>      model="claude-opus-4-6",&para;<br>      max_tokens=1024,&para;<br>      messages=[</span><del style="background:#ffe6e6;">&para;<br>          </del><span>{"role": "user", "content": "Hello, Claude"}</span><del style="background:#ffe6e6;">&para;<br>      </del><span>]</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>  )&para;<br>  print(message)&para;<br>  ```&para;<br>&para;<br>  ```typescript TypeScript&para;<br>  import Anthropic from </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>@anthropic-ai/sdk</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>;&para;<br>&para;<br>  const anthropic = new Anthropic();&para;<br>&para;<br>  const message = await anthropic.messages.create({&para;<br>    model: </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>claude-opus-4-6</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>,&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "Hello, Claude"</span><ins style="background:#e6ffe6;"> </ins><span>}&para;<br>    ]&para;<br>  });&para;<br>  console.log(message);&para;<br>  ```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "id": "msg_01XFDUDYJgAACzvnptvVoYEL",&para;<br>  "type": "message",&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "Hello!"&para;<br>    }&para;<br>  ],&para;<br>  "model": "claude-opus-4-6",&para;<br>  "stop_reason": "end_turn",&para;<br>  "stop_sequence": null,&para;<br>  "usage": {&para;<br>    "input_tokens": 12,&para;<br>    "output_tokens": 6&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>## Multiple conversational turns&para;<br>&para;<br>The Messages API is stateless, which means that you always send the full conversational history to the API. You can use this pattern to build up a conversation over time. Earlier conversational turns don't necessarily need to actually originate from Claude â€” you can use synthetic `assistant` messages.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>#!/bin/sh&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-opus-4-6",&para;<br>    "max_tokens": 1024,&para;<br>    "messages": [&para;<br>        {"role": "user", "content": "Hello, Claude"},&para;<br>        {"role": "assistant", "content": "Hello!"},&para;<br>        {"role": "user", "content": "Can you describe LLMs to me?"}&para;<br>&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>message = anthropic.Anthropic().messages.create(&para;<br>    model="claude-opus-4-6",&para;<br>    max_tokens=1024,&para;<br>    messages=[&para;<br>        {"role": "user", "content": "Hello, Claude"},&para;<br>        {"role": "assistant", "content": "Hello!"},&para;<br>        {"role": "user", "content": "Can you describe LLMs to me?"}</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>    ],&para;<br>)&para;<br>print(message)&para;<br></span><del style="background:#ffe6e6;">&para;<br></del><span>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import Anthropic from </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>@anthropic-ai/sdk</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>;&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>await anthropic.messages.create({&para;<br>  model: </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>claude-opus-4-6</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>,&para;<br>  max_tokens: 1024,&para;<br>  messages: [&para;<br>    {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "Hello, Claude"</span><ins style="background:#e6ffe6;"> </ins><span>},&para;<br>    {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "assistant", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "Hello!"</span><ins style="background:#e6ffe6;"> </ins><span>},&para;<br>    {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "Can you describe LLMs to me?"</span><ins style="background:#e6ffe6;"> </ins><span>}&para;<br>  ]&para;<br>});&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>    "id": "msg_018gCsTGsXkYJVqYPxTgDHBU",&para;<br>    "type": "message",&para;<br>    "role": "assistant",&para;<br>    "content": [&para;<br>        {&para;<br>            "type": "text",&para;<br>            "text": "Sure, I'd be happy to provide..."&para;<br>        }&para;<br>    ],&para;<br>    "stop_reason": "end_turn",&para;<br>    "stop_sequence": null,&para;<br>    "usage": {&para;<br>      "input_tokens": 30,&para;<br>      "output_tokens": 309&para;<br>    }&para;<br>}&para;<br>```&para;<br>&para;<br>## Putting words in Claude's mouth&para;<br>&para;<br>You can pre-fill part of Claude's response in the last position of the input messages list. This can be used to shape Claude's response. The example below uses `"max_tokens": 1` to get a single multiple choice answer from Claude.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>  ```bash Shell&para;<br>  #!/bin/sh&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>       --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>       --header "anthropic-version: 2023-06-01" \&para;<br>       --header "content-type: application/json" \&para;<br>       --data \&para;<br>  '{&para;<br>      "model": "claude-opus-4-6",&para;<br>      "max_tokens": 1,&para;<br>      "messages": [&para;<br>          {"role": "user", "content": "What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae"},&para;<br>          {"role": "assistant", "content": "The answer is ("}&para;<br>      ]&para;<br>  }'&para;<br>  ```&para;<br>&para;<br>  ```python Python&para;<br>  import anthropic&para;<br>&para;<br>  message = anthropic.Anthropic().messages.create(&para;<br>      model="claude-opus-4-6",&para;<br>      max_tokens=1,&para;<br>      messages=[&para;<br>          {</span><ins style="background:#e6ffe6;">&para;<br>              </ins><span>"role": "user",</span><ins style="background:#e6ffe6;">&para;<br>             </ins><span> "content": "What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae"</span><ins style="background:#e6ffe6;">,&para;<br>          </ins><span>},&para;<br>          {"role": "assistant", "content": "The answer is ("}</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>      ]</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>  )&para;<br>  print(message)&para;<br>  ```&para;<br>&para;<br>  ```typescript TypeScript&para;<br>  import Anthropic from </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>@anthropic-ai/sdk</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>;&para;<br>&para;<br>  const anthropic = new Anthropic();&para;<br>&para;<br>  const message = await anthropic.messages.create({&para;<br>    model: </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>claude-opus-4-6</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>,&para;<br>    max_tokens: 1,&para;<br>    messages: [&para;<br>      {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae"</span><ins style="background:#e6ffe6;"> </ins><span>},&para;<br>      {</span><del style="background:#ffe6e6;">"</del><ins style="background:#e6ffe6;"> </ins><span>role</span><del style="background:#ffe6e6;">"</del><span>: "assistant", </span><del style="background:#ffe6e6;">"</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: "The answer is ("</span><ins style="background:#e6ffe6;"> </ins><span>}&para;<br>    ]&para;<br>  });&para;<br>  console.log(message);&para;<br>  ```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "id": "msg_01Q8Faay6S7QPTvEUUQARt7h",&para;<br>  "type": "message",&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "C"&para;<br>    }&para;<br>  ],&para;<br>  "model": "claude-opus-4-6",&para;<br>  "stop_reason": "max_tokens",&para;<br>  "stop_sequence": null,&para;<br>  "usage": {&para;<br>    "input_tokens": 42,&para;<br>    "output_tokens": 1&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Prefilling is deprecated and not supported on Claude Opus 4.6 and Claude Sonnet 4.5. Use [structured outputs](/docs/en/build-with-claude/structured-outputs) or system prompt instructions instead.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>## Vision&para;<br>&para;<br>Claude can read both text and images in requests. We support both `base64` and `url` source types for images, and the `image/jpeg`, `image/png`, `image/gif`, and `image/webp` media types. See our [vision guide](/docs/en/build-with-claude/vision) for more details.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>  ```bash Shell&para;<br>  #!/bin/sh&para;<br>&para;<br>  # Option 1: Base64-encoded image&para;<br>  IMAGE_URL="https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg"&para;<br>  IMAGE_MEDIA_TYPE="image/jpeg"&para;<br>  IMAGE_BASE64=$(curl "$IMAGE_URL" | base64)&para;<br>&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>       --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>       --header "anthropic-version: 2023-06-01" \&para;<br>       --header "content-type: application/json" \&para;<br>       --data \&para;<br>  '{&para;<br>      "model": "claude-opus-4-6",&para;<br>      "max_tokens": 1024,&para;<br>      "messages": [&para;<br>          {"role": "user", "content": [&para;<br>              {"type": "image", "source": {&para;<br>                  "type": "base64",&para;<br>                  "media_type": "'$IMAGE_MEDIA_TYPE'",&para;<br>                  "data": "'$IMAGE_BASE64'"&para;<br>              }},&para;<br>              {"type": "text", "text": "What is in the above image?"}&para;<br>          ]}&para;<br>      ]&para;<br>  }'&para;<br>&para;<br>  # Option 2: URL-referenced image&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>       --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>       --header "anthropic-version: 2023-06-01" \&para;<br>       --header "content-type: application/json" \&para;<br>       --data \&para;<br>  '{&para;<br>      "model": "claude-opus-4-6",&para;<br>      "max_tokens": 1024,&para;<br>      "messages": [&para;<br>          {"role": "user", "content": [&para;<br>              {"type": "image", "source": {&para;<br>                  "type": "url",&para;<br>                  "url": "https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg"&para;<br>              }},&para;<br>              {"type": "text", "text": "What is in the above image?"}&para;<br>          ]}&para;<br>      ]&para;<br>  }'&para;<br>  ```&para;<br>&para;<br>  ```python Python&para;<br>  import anthropic&para;<br>  import base64&para;<br>  import httpx&para;<br>&para;<br>  # Option 1: Base64-encoded image&para;<br>  image_url = "https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg"&para;<br>  image_media_type = "image/jpeg"&para;<br>  image_data = base64.standard_b64encode(httpx.get(image_url).content).decode("utf-8")&para;<br>&para;<br>  message = anthropic.Anthropic().messages.create(&para;<br>      model="claude-opus-4-6",&para;<br>      max_tokens=1024,&para;<br>      messages=[&para;<br>          {&para;<br>              "role": "user",&para;<br>              "content": [&para;<br>                  {&para;<br>                      "type": "image",&para;<br>                      "source": {&para;<br>                          "type": "base64",&para;<br>                          "media_type": image_media_type,&para;<br>                          "data": image_data,&para;<br>                      },&para;<br>                  },&para;<br>                  {</span><del style="background:#ffe6e6;">&para;<br>                      "type": "text",&para;<br>                     </del><ins style="background:#e6ffe6;">"type": "text",</ins><span> "text": "What is in the above image?"</span><del style="background:#ffe6e6;">&para;<br>                  </del><span>}</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>              ],&para;<br>          }&para;<br>      ],&para;<br>  )&para;<br>  print(message)&para;<br>&para;<br>  # Option 2: URL-referenced image&para;<br>  message_from_url = anthropic.Anthropic().messages.create(&para;<br>      model="claude-opus-4-6",&para;<br>      max_tokens=1024,&para;<br>      messages=[&para;<br>          {&para;<br>              "role": "user",&para;<br>              "content": [&para;<br>                  {&para;<br>                      "type": "image",&para;<br>                      "source": {&para;<br>                          "type": "url",&para;<br>                          "url": "https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg",&para;<br>                      },&para;<br>                  },&para;<br>                  {</span><del style="background:#ffe6e6;">&para;<br>                      "type": "text",&para;<br>                     </del><ins style="background:#e6ffe6;">"type": "text",</ins><span> "text": "What is in the above image?"</span><del style="background:#ffe6e6;">&para;<br>                  </del><span>}</span><ins style="background:#e6ffe6;">,</ins><span>&para;<br>              ],&para;<br>          }&para;<br>      ],&para;<br>  )&para;<br>  print(message_from_url)&para;<br>  ```&para;<br>&para;<br>  ```typescript TypeScript&para;<br>  import Anthropic from </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>@anthropic-ai/sdk</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>;&para;<br>&para;<br>  const anthropic = new Anthropic();&para;<br>&para;<br>  // Option 1: Base64-encoded image&para;<br>  const image_url = "https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg"</span><ins style="background:#e6ffe6;">;</ins><span>&para;<br>  const image_media_type = "image/jpeg"</span><ins style="background:#e6ffe6;">;</ins><span>&para;<br>  const image_array_buffer = await ((await fetch(image_url)).arrayBuffer());&para;<br>  const image_data = Buffer.from(image_array_buffer).toString(</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>base64</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>);&para;<br>&para;<br>  const message = await anthropic.messages.create({&para;<br>    model: </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>claude-opus-4-6</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>,&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      </span><del style="background:#ffe6e6;">    {&para;<br>  </del><ins style="background:#e6ffe6;">{&para;<br></ins><span>        </span><del style="background:#ffe6e6;">    "</del><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user",&para;<br>        </span><del style="background:#ffe6e6;">      "</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: [&para;<br>          </span><del style="background:#ffe6e6;">   </del><del style="background:#ffe6e6;">     {&para;<br>       </del><ins style="background:#e6ffe6;">{&para;<br></ins><span>            </span><del style="background:#ffe6e6;">   "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "image",&para;<br>            </span><del style="background:#ffe6e6;">      </del><del style="background:#ffe6e6;">    "</del><span>source</span><del style="background:#ffe6e6;">"</del><span>: {&para;<br>              </span><del style="background:#ffe6e6;">      </del><del style="background:#ffe6e6;">      "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "base64",&para;<br>              </span><del style="background:#ffe6e6;">   </del><del style="background:#ffe6e6;">         "</del><span>media_type</span><del style="background:#ffe6e6;">"</del><span>: image_media_type,&para;<br>              </span><del style="background:#ffe6e6;">            </del><del style="background:#ffe6e6;">"</del><span>data</span><del style="background:#ffe6e6;">"</del><span>: image_data</span><del style="background:#ffe6e6;">,&para;<br>         </del><ins style="background:#e6ffe6;">&para;<br></ins><span>            </span><del style="background:#ffe6e6;"> },&para;<br>        </del><ins style="background:#e6ffe6;">}&para;<br></ins><span>          },&para;<br>          </span><del style="background:#ffe6e6;"> </del><del style="background:#ffe6e6;">       {&para;<br>     </del><ins style="background:#e6ffe6;">{&para;<br></ins><span>            </span><del style="background:#ffe6e6;">     "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "text",&para;<br>            </span><del style="background:#ffe6e6;">    </del><del style="background:#ffe6e6;">      "</del><span>text</span><del style="background:#ffe6e6;">"</del><span>: "What is in the above image?"&para;<br></span><del style="background:#ffe6e6;">                  }&para;<br>              ],&para;<br></del><span>          }&para;<br>        ]&para;<br></span><ins style="background:#e6ffe6;">      }&para;<br>    ]&para;<br></ins><span>  });&para;<br>  console.log(message);&para;<br>&para;<br>  // Option 2: URL-referenced image&para;<br>  const messageFromUrl = await anthropic.messages.create({&para;<br>    model: </span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>claude-opus-4-6</span><del style="background:#ffe6e6;">'</del><ins style="background:#e6ffe6;">"</ins><span>,&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      </span><del style="background:#ffe6e6;">    {&para;<br>      </del><ins style="background:#e6ffe6;">{&para;<br></ins><span>        </span><del style="background:#ffe6e6;">"</del><span>role</span><del style="background:#ffe6e6;">"</del><span>: "user",&para;<br>        </span><del style="background:#ffe6e6;">   </del><del style="background:#ffe6e6;">   "</del><span>content</span><del style="background:#ffe6e6;">"</del><span>: [&para;<br>          </span><del style="background:#ffe6e6;">        </del><span>{&para;<br>            </span><del style="background:#ffe6e6;">          "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "image",&para;<br>            </span><del style="background:#ffe6e6;">         </del><del style="background:#ffe6e6;"> "</del><span>source</span><del style="background:#ffe6e6;">"</del><span>: {&para;<br>              </span><del style="background:#ffe6e6;">       </del><del style="background:#ffe6e6;">     "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "url",&para;<br>              </span><del style="background:#ffe6e6;">            </del><del style="background:#ffe6e6;">"</del><span>url</span><del style="background:#ffe6e6;">"</del><span>: "https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg"</span><del style="background:#ffe6e6;">,&para;<br>         </del><ins style="background:#e6ffe6;">&para;<br></ins><span>            </span><del style="background:#ffe6e6;"> },&para;<br>       </del><ins style="background:#e6ffe6;">}&para;<br></ins><span>          </span><del style="background:#ffe6e6;"> </del><span>},&para;<br></span><del style="background:#ffe6e6;">        </del><span>          {&para;<br>            </span><del style="background:#ffe6e6;">         </del><del style="background:#ffe6e6;"> "</del><span>type</span><del style="background:#ffe6e6;">"</del><span>: "text",&para;<br>            </span><del style="background:#ffe6e6;">       </del><del style="background:#ffe6e6;">   "</del><span>text</span><del style="background:#ffe6e6;">"</del><span>: "What is in the above image?"&para;<br>          </span><del style="background:#ffe6e6;">    </del><del style="background:#ffe6e6;">    }&para;<br>      </del><ins style="background:#e6ffe6;">}&para;<br></ins><span>        ]</span><del style="background:#ffe6e6;">,&para;<br>    </del><ins style="background:#e6ffe6;">&para;<br></ins><span>      }&para;<br></span><del style="background:#ffe6e6;">    </del><span>    ]&para;<br>  });&para;<br>  console.log(messageFromUrl);&para;<br>  ```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "id": "msg_01EcyWo6m4hyW8KHs2y2pei5",&para;<br>  "type": "message",&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "This image shows an ant, specifically a close-up view of an ant. The ant is shown in detail, with its distinct head, antennae, and legs clearly visible. The image is focused on capturing the intricate details and features of the ant, likely taken with a macro lens to get an extreme close-up perspective."&para;<br>    }&para;<br>  ],&para;<br>  "model": "claude-opus-4-6",&para;<br>  "stop_reason": "end_turn",&para;<br>  "stop_sequence": null,&para;<br>  "usage": {&para;<br>    "input_tokens": 1551,&para;<br>    "output_tokens": 71&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>## Tool use and computer use&para;<br>&para;<br>See our [guide](/docs/en/agents-and-tools/tool-use/overview) for examples of how to use tools with the Messages API.&para;<br>See our [computer use guide](/docs/en/agents-and-tools/tool-use/computer-use-tool) for examples of how to control desktop computer environments with the Messages API.&para;<br>For guaranteed JSON output, see [Structured Outputs](/docs/en/build-with-claude/structured-outputs).</span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/build-with-claude/working-with-messages.md
+++ b/build-with-claude/working-with-messages.md
@@ -31,23 +31,21 @@
   message = anthropic.Anthropic().messages.create(
       model=&#34;claude-opus-4-6&#34;,
       max_tokens=1024,
-      messages=[
-          {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, Claude&#34;}
-      ]
+      messages=[{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, Claude&#34;}],
   )
   print(message)
   ```
 
   ```typescript TypeScript
-  import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+  import Anthropic from &#34;@anthropic-ai/sdk&#34;;
 
   const anthropic = new Anthropic();
 
   const message = await anthropic.messages.create({
-    model: &#39;claude-opus-4-6&#39;,
+    model: &#34;claude-opus-4-6&#34;,
     max_tokens: 1024,
     messages: [
-      {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, Claude&#34;}
+      { role: &#34;user&#34;, content: &#34;Hello, Claude&#34; }
     ]
   });
   console.log(message);
@@ -108,25 +106,24 @@
     messages=[
         {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, Claude&#34;},
         {&#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: &#34;Hello!&#34;},
-        {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Can you describe LLMs to me?&#34;}
+        {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Can you describe LLMs to me?&#34;},
     ],
 )
 print(message)
-
 ```
 
 ```typescript TypeScript
-import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+import Anthropic from &#34;@anthropic-ai/sdk&#34;;
 
 const anthropic = new Anthropic();
 
 await anthropic.messages.create({
-  model: &#39;claude-opus-4-6&#39;,
+  model: &#34;claude-opus-4-6&#34;,
   max_tokens: 1024,
   messages: [
-    {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello, Claude&#34;},
-    {&#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: &#34;Hello!&#34;},
-    {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Can you describe LLMs to me?&#34;}
+    { role: &#34;user&#34;, content: &#34;Hello, Claude&#34; },
+    { role: &#34;assistant&#34;, content: &#34;Hello!&#34; },
+    { role: &#34;user&#34;, content: &#34;Can you describe LLMs to me?&#34; }
   ]
 });
 ```
@@ -181,24 +178,27 @@
       model=&#34;claude-opus-4-6&#34;,
       max_tokens=1,
       messages=[
-          {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae&#34;},
-          {&#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: &#34;The answer is (&#34;}
-      ]
+          {
+              &#34;role&#34;: &#34;user&#34;,
+              &#34;content&#34;: &#34;What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae&#34;,
+          },
+          {&#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: &#34;The answer is (&#34;},
+      ],
   )
   print(message)
   ```
 
   ```typescript TypeScript
-  import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+  import Anthropic from &#34;@anthropic-ai/sdk&#34;;
 
   const anthropic = new Anthropic();
 
   const message = await anthropic.messages.create({
-    model: &#39;claude-opus-4-6&#39;,
+    model: &#34;claude-opus-4-6&#34;,
     max_tokens: 1,
     messages: [
-      {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae&#34;},
-      {&#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: &#34;The answer is (&#34;}
+      { role: &#34;user&#34;, content: &#34;What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae&#34; },
+      { role: &#34;assistant&#34;, content: &#34;The answer is (&#34; }
     ]
   });
   console.log(message);
@@ -309,10 +309,7 @@
                           &#34;data&#34;: image_data,
                       },
                   },
-                  {
-                      &#34;type&#34;: &#34;text&#34;,
-                      &#34;text&#34;: &#34;What is in the above image?&#34;
-                  }
+                  {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;What is in the above image?&#34;},
               ],
           }
       ],
@@ -334,10 +331,7 @@
                           &#34;url&#34;: &#34;https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg&#34;,
                       },
                   },
-                  {
-                      &#34;type&#34;: &#34;text&#34;,
-                      &#34;text&#34;: &#34;What is in the above image?&#34;
-                  }
+                  {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;What is in the above image?&#34;},
               ],
           }
       ],
@@ -346,63 +340,63 @@
   ```
 
   ```typescript TypeScript
-  import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+  import Anthropic from &#34;@anthropic-ai/sdk&#34;;
 
   const anthropic = new Anthropic();
 
   // Option 1: Base64-encoded image
-  const image_url = &#34;https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg&#34;
-  const image_media_type = &#34;image/jpeg&#34;
+  const image_url = &#34;https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg&#34;;
+  const image_media_type = &#34;image/jpeg&#34;;
   const image_array_buffer = await ((await fetch(image_url)).arrayBuffer());
-  const image_data = Buffer.from(image_array_buffer).toString(&#39;base64&#39;);
+  const image_data = Buffer.from(image_array_buffer).toString(&#34;base64&#34;);
 
   const message = await anthropic.messages.create({
-    model: &#39;claude-opus-4-6&#39;,
+    model: &#34;claude-opus-4-6&#34;,
     max_tokens: 1024,
     messages: [
-          {
-              &#34;role&#34;: &#34;user&#34;,
-              &#34;content&#34;: [
-                  {
-                      &#34;type&#34;: &#34;image&#34;,
-                      &#34;source&#34;: {
-                          &#34;type&#34;: &#34;base64&#34;,
-                          &#34;media_type&#34;: image_media_type,
-                          &#34;data&#34;: image_data,
-                      },
-                  },
-                  {
-                      &#34;type&#34;: &#34;text&#34;,
-                      &#34;text&#34;: &#34;What is in the above image?&#34;
-                  }
-              ],
+      {
+        role: &#34;user&#34;,
+        content: [
+          {
+            type: &#34;image&#34;,
+            source: {
+              type: &#34;base64&#34;,
+              media_type: image_media_type,
+              data: image_data
+            }
+          },
+          {
+            type: &#34;text&#34;,
+            text: &#34;What is in the above image?&#34;
           }
         ]
+      }
+    ]
   });
   console.log(message);
 
   // Option 2: URL-referenced image
   const messageFromUrl = await anthropic.messages.create({
-    model: &#39;claude-opus-4-6&#39;,
+    model: &#34;claude-opus-4-6&#34;,
     max_tokens: 1024,
     messages: [
-          {
-              &#34;role&#34;: &#34;user&#34;,
-              &#34;content&#34;: [
-                  {
-                      &#34;type&#34;: &#34;image&#34;,
-                      &#34;source&#34;: {
-                          &#34;type&#34;: &#34;url&#34;,
-                          &#34;url&#34;: &#34;https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg&#34;,
-                      },
-                  },
-                  {
-                      &#34;type&#34;: &#34;text&#34;,
-                      &#34;text&#34;: &#34;What is in the above image?&#34;
-                  }
-              ],
+      {
+        role: &#34;user&#34;,
+        content: [
+          {
+            type: &#34;image&#34;,
+            source: {
+              type: &#34;url&#34;,
+              url: &#34;https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg&#34;
+            }
+          },
+          {
+            type: &#34;text&#34;,
+            text: &#34;What is in the above image?&#34;
           }
         ]
+      }
+    ]
   });
   console.log(messageFromUrl);
   ```
</code></pre>
    </div>
</body>
</html>