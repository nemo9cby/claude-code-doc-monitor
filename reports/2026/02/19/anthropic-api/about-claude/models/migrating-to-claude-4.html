<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>about-claude/models/migrating-to-claude-4 - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>about-claude/models/migrating-to-claude-4.md</h1>
            <p class="meta">Changed on 2026-02-19 15:26:36 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+3</span> lines added
            </div>
            <div class="stat removed">
                <span>-1</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span># Migration guide&para;<br>&para;<br>Guide for migrating to Claude 4.6 models from previous Claude versions&para;<br>&para;<br>---&para;<br>&para;<br>## Migrating to Claude 4.6&para;<br>&para;<br>Claude Opus 4.6 is a near drop-in replacement for Claude 4.5, with a few breaking changes to be aware of. For a full list of new features, see [What's new in Claude 4.6](/docs/en/about-claude/models/whats-new-claude-4-6).&para;<br>&para;<br>### Update your model name&para;<br>&para;<br>```python&para;<br># Opus migration&para;<br>model = "claude-opus-4-5"  # Before&para;<br>model = "claude-opus-4-6"  # After&para;<br>```&para;<br>&para;<br>### Breaking changes&para;<br>&para;<br>1. **Prefill removal:** Prefilling assistant messages returns a 400 error on Claude 4.6 models. Use [structured outputs](/docs/en/build-with-claude/structured-outputs), system prompt instructions, or `output_config.format` instead.&para;<br>&para;<br>2. **Tool parameter quoting:** Claude 4.6 models may produce slightly different JSON string escaping in tool call arguments (e.g., different handling of Unicode escapes or forward slash escaping). If you parse tool call `input` as a raw string rather than using a JSON parser, verify your parsing logic. Standard JSON parsers (like `json.loads()` or `JSON.parse()`) handle these differences automatically.&para;<br>&para;<br>### Recommended changes&para;<br>&para;<br>These are not required but will improve your experience:&para;<br>&para;<br>1. **Migrate to adaptive thinking:** `thinking: {type: "enabled", budget_tokens: N}` is deprecated on Claude 4.6 models and will be removed in a future model release. Switch to `thinking: {type: "adaptive"}` and use the [effort parameter](/docs/en/build-with-claude/effort) to control thinking depth. See [Adaptive thinking](/docs/en/build-with-claude/adaptive-thinking).&para;<br>&para;<br>   &lt;CodeGroup&gt;&para;<br>   ```python Before&para;<br>   response = client.beta.messages.create(&para;<br>       model="claude-opus-4-5",&para;<br>       max_tokens=16000,&para;<br>       thinking={"type": "enabled", "budget_tokens": 32000},&para;<br>       betas=["interleaved-thinking-2025-05-14"],&para;<br>       messages=[...],&para;<br>   )&para;<br>   ```&para;<br>&para;<br>   ```python After&para;<br>   response = client.messages.create(&para;<br>       model="claude-opus-4-6",&para;<br>       max_tokens=16000,&para;<br>       thinking={"type": "adaptive"},&para;<br>       output_config={"effort": "high"},&para;<br>       messages=[...],&para;<br>   )&para;<br>   ```&para;<br>   &lt;/CodeGroup&gt;&para;<br>&para;<br>   Note that the migration also moves from `client.beta.messages.create` to `client.messages.create`. Adaptive thinking and effort are GA features and do not require the beta SDK namespace or any beta headers.&para;<br>&para;<br>2. **Remove effort beta header:** The effort parameter is now GA. Remove `betas=["effort-2025-11-24"]` from your requests.&para;<br>&para;<br>3. **Remove fine-grained tool streaming beta header:** Fine-grained tool streaming is now GA. Remove `betas=["fine-grained-tool-streaming-2025-05-14"]` from your requests.&para;<br>&para;<br>4. **Remove interleaved thinking beta header (Opus 4.6 only):** Adaptive thinking automatically enables interleaved thinking on Opus 4.6. Remove `betas=["interleaved-thinking-2025-05-14"]` from your Opus 4.6 requests. Note: Sonnet 4.6 continues to support this beta header with manual extended thinking.&para;<br>&para;<br>5. **Migrate to output_config.format:** If using structured outputs, update `output_format={...}` to `output_config={"format": {...}}`. The old parameter remains functional but is deprecated and will be removed in a future model release.&para;<br>&para;<br>### Migrating from Claude 4.1 or earlier to Claude 4.6&para;<br>&para;<br>If you're migrating from Opus 4.1, Sonnet 4, or earlier models directly to Claude 4.6, apply the Claude 4.6 breaking changes above plus the additional changes in this section.&para;<br>&para;<br>```python&para;<br># From Opus 4.1&para;<br>model = "claude-opus-4-1-20250805"  # Before&para;<br>model = "claude-opus-4-6"  # After&para;<br>&para;<br># From Sonnet 4&para;<br>model = "claude-sonnet-4-20250514"  # Before&para;<br>model = "claude-opus-4-6"  # After&para;<br>&para;<br># From Sonnet 3.7&para;<br>model = "claude-3-7-sonnet-20250219"  # Before&para;<br>model = "claude-opus-4-6"  # After&para;<br>```&para;<br>&para;<br>#### Additional breaking changes&para;<br>&para;<br>1. **Update sampling parameters**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Use only `temperature` OR `top_p`, not both:&para;<br>&para;<br>   ```python&para;<br>   # Before - This will error in Claude 4+ models&para;<br>   response = client.messages.create(&para;<br>       model="claude-3-7-sonnet-20250219",&para;<br>       temperature=0.7,&para;<br>       top_p=0.9,  # Cannot use both&para;<br>       # ...&para;<br>   )&para;<br>&para;<br>   # After&para;<br>   response = client.messages.create(&para;<br>       model="claude-opus-4-6",&para;<br>       temperature=0.7,  # Use temperature OR top_p, not both&para;<br>       # ...&para;<br>   )&para;<br>   ```&para;<br>&para;<br>2. **Update tool versions**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Update to the latest tool versions. Remove any code using the `undo_edit` command.&para;<br>&para;<br>   ```python&para;<br>   # Before&para;<br>   tools = [{"type": "text_editor_20250124", "name": "str_replace_editor"}]&para;<br>&para;<br>   # After&para;<br>   tools = [{"type": "text_editor_20250728", "name": "str_replace_based_edit_tool"}]&para;<br>   ```&para;<br>&para;<br>   - **Text editor:** Use `text_editor_20250728` and `str_replace_based_edit_tool`. See [Text editor tool documentation](/docs/en/agents-and-tools/tool-use/text-editor-tool) for details.&para;<br>   - **Code execution:** Upgrade to `code_execution_20250825`. See [Code execution tool documentation](/docs/en/agents-and-tools/tool-use/code-execution-tool#upgrade-to-latest-tool-version) for migration instructions.&para;<br>&para;<br>3. **Handle the `refusal` stop reason**&para;<br>&para;<br>   Update your application to [handle `refusal` stop reasons](/docs/en/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals):&para;<br>&para;<br>   ```python&para;<br>   response = client.messages.create(...)&para;<br>&para;<br>   if response.stop_reason == "refusal":&para;<br>       # Handle refusal appropriately&para;<br>       pass&para;<br>   ```&para;<br>&para;<br>4. **Handle the `model_context_window_exceeded` stop reason**&para;<br>&para;<br>   Claude 4.5+ models return a `model_context_window_exceeded` stop reason when generation stops due to hitting the context window limit, rather than the requested `max_tokens` limit. Update your application to handle this new stop reason:&para;<br>&para;<br>   ```python&para;<br>   response = client.messages.create(...)&para;<br>&para;<br>   if response.stop_reason == "model_context_window_exceeded":&para;<br>       # Handle context window limit appropriately&para;<br>       pass&para;<br>   ```&para;<br>&para;<br>5. **Verify tool parameter handling (trailing newlines)**&para;<br>&para;<br>   Claude 4.5+ models preserve trailing newlines in tool call string parameters that were previously stripped. If your tools rely on exact string matching against tool call parameters, verify your logic handles trailing newlines correctly.&para;<br>&para;<br>6. **Update your prompts for behavioral changes**&para;<br>&para;<br>   Claude 4+ models have a more concise, direct communication style and require explicit direction. Review [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices) for optimization guidance.&para;<br>&para;<br>#### Additional recommended changes&para;<br>&para;<br>- **Remove legacy beta headers:** Remove `token-efficient-tools-2025-02-19` and `output-128k-2025-02-19`. All Claude 4+ models have built-in token-efficient tool use and these headers have no effect.&para;<br>&para;<br>### Claude 4.6 migration checklist&para;<br>&para;<br>- [ ] Update model ID to `claude-opus-4-6`&para;<br>- [ ] **BREAKING:** Remove assistant message prefills (returns 400 error); use structured outputs or `output_config.format` instead&para;<br>- [ ] **Recommended:** Migrate from `thinking: {type: "enabled", budget_tokens: N}` to `thinking: {type: "adaptive"}` with the [effort parameter](/docs/en/build-with-claude/effort) (`budget_tokens` is deprecated and will be removed in a future release)&para;<br>- [ ] Verify tool call JSON parsing uses a standard JSON parser&para;<br>- [ ] Remove `effort-2025-11-24` beta header (effort is now GA)&para;<br>- [ ] Remove `fine-grained-tool-streaming-2025-05-14` beta header&para;<br>- [ ] Remove `interleaved-thinking-2025-05-14` beta header (Opus 4.6 only; Sonnet 4.6 still supports it)&para;<br>- [ ] Migrate `output_format` to `output_config.format` (if applicable)&para;<br>- [ ] If migrating from Claude 4.1 or earlier: update sampling parameters to use only `temperature` OR `top_p`&para;<br>- [ ] If migrating from Claude 4.1 or earlier: update tool versions (`text_editor_20250728`, `code_execution_20250825`)&para;<br>- [ ] If migrating from Claude 4.1 or earlier: handle `refusal` stop reason&para;<br>- [ ] If migrating from Claude 4.1 or earlier: handle `model_context_window_exceeded` stop reason&para;<br>- [ ] If migrating from Claude 4.1 or earlier: verify tool string parameter handling for trailing newlines&para;<br>- [ ] If migrating from Claude 4.1 or earlier: remove legacy beta headers (`token-efficient-tools-2025-02-19`, `output-128k-2025-02-19`)&para;<br>- [ ] Review and update prompts following [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices)&para;<br>- [ ] Test in development environment before production deployment&para;<br>&para;<br>---&para;<br>&para;<br>## Migrating to Claude Sonnet 4.6&para;<br>&para;<br>Claude Sonnet 4.6 combines strong intelligence with fast performance, featuring improved agentic search capabilities and free code execution when used with web search or web fetch. It is ideal for everyday coding, analysis, and content tasks.&para;<br>&para;<br>For a complete overview of capabilities, see the [models overview](/docs/en/about-claude/models/overview).&para;<br>&para;<br>&lt;Note&gt;&para;<br>Sonnet 4.6 pricing is $3 per million input tokens, $15 per million output tokens. See [Claude pricing](/docs/en/about-claude/pricing) for details.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>**Update your model name:**&para;<br>&para;<br>```python&para;<br># From Sonnet 4.5&para;<br>model = "claude-sonnet-4-5"  # Before&para;<br>model = "claude-sonnet-4-6"  # After&para;<br>&para;<br># From Sonnet 4&para;<br>model = "claude-sonnet-4-20250514"  # Before&para;<br>model = "claude-sonnet-4-6"  # After&para;<br>```&para;<br>&para;<br>### Breaking changes&para;<br>&para;<br>#### When migrating from Sonnet 4.5&para;<br>&para;<br>1. **Prefilling assistant messages is no longer supported**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Sonnet 4.5 or earlier.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Prefilling assistant messages returns a `400` error on Sonnet 4.6. Use [structured outputs](/docs/en/build-with-claude/structured-outputs), system prompt instructions, or `output_config.format` instead.&para;<br>&para;<br>   **Common prefill use cases and migrations:**&para;<br>&para;<br>   - **Controlling output formatting** (forcing JSON/YAML output): Use [structured outputs](/docs/en/build-with-claude/structured-outputs) or tools with enum fields for classification tasks.&para;<br>&para;<br>   - **Eliminating preambles** (removing "Here is..." phrases): Add direct instructions in the system prompt: "Respond directly without preamble. Do not start with phrases like 'Here is...', 'Based on...', etc."&para;<br>&para;<br>   - **Avoiding bad refusals**: Claude is much better at appropriate refusals now. Clear prompting in the user message without prefill should be sufficient.&para;<br>&para;<br>   - **Continuations** (resuming interrupted responses): Move the continuation to the user message: "Your previous response was interrupted and ended with `[previous_response]`. Continue from where you left off."&para;<br>&para;<br>   - **Context hydration / role consistency** (refreshing context in long conversations): Inject what were previously prefilled-assistant reminders into the user turn instead.&para;<br>&para;<br>2. **Tool parameter JSON escaping may differ**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Sonnet 4.5 or earlier.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   JSON string escaping in tool parameters may differ from previous models. Standard JSON parsers handle this automatically, but custom string-based parsing may need updates.&para;<br>&para;<br>#### When migrating from Claude 3.x&para;<br>&para;<br>3. **Update sampling parameters**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Use only `temperature` OR `top_p`, not both.&para;<br>&para;<br>4. **Update tool versions**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Update to the latest tool versions (`text_editor_20250728`, `code_execution_20250825`). Remove any code using the `undo_edit` command.&para;<br>&para;<br>5. **Handle the `refusal` stop reason**&para;<br>&para;<br>   Update your application to [handle `refusal` stop reasons](/docs/en/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals).&para;<br>&para;<br>6. **Update your prompts for behavioral changes**&para;<br>&para;<br>   Claude 4 models have a more concise, direct communication style. Review [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices) for optimization guidance.&para;<br>&para;<br>### Recommended changes&para;<br>&para;<br>1. **Remove `fine-grained-tool-streaming-2025-05-14` beta header:** Fine-grained tool streaming is now GA on Sonnet 4.6 and no longer requires a beta header.&para;<br>2. **Migrate `output_format` to `output_config.format`:** The `output_format` parameter is deprecated. Use `output_config.format` instead.&para;<br>&para;<br>### Migrating from Sonnet 4.5&para;<br>&para;<br>Consider migrating from Sonnet 4.5 to Sonnet 4.6, which delivers more intelligence at the same price point.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Sonnet 4.6 defaults to an effort level of `high`, in contrast to Sonnet 4.5 which had no effort parameter. Consider adjusting the effort parameter as you migrate from Sonnet 4.5 to Sonnet 4.6. If not explicitly set, you may experience higher latency with the default effort level.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>#### If you're not using extended thinking&para;<br>&para;<br>If you're not using extended thinking on Sonnet 4.5, you can continue without it on Sonnet 4.6. You should explicitly set effort to the level appropriate for your use case. At `low` effort with thinking disabled, you can expect similar or better performance relative to Sonnet 4.5 with no extended thinking.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```python Python&para;<br>response = client.messages.create(&para;<br>    model="claude-sonnet-4-6",&para;<br>    max_tokens=8192,&para;<br>    output_config={"effort": "low"},&para;<br>    messages=[{"role": "user", "content": "Your prompt here"}],&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>const response = await client.messages.create({&para;<br>  model: "claude-sonnet-4-6",&para;<br>  max_tokens: 8192,&para;<br>  output_config: { effort: "low" },&para;<br>  messages: [{ role: "user", content: "Your prompt here" }]&para;<br>});&para;<br>```&para;<br>&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-6",&para;<br>    "max_tokens": 8192,&para;<br>    "output_config": {&para;<br>        "effort": "low"&para;<br>    },&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Your prompt here"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>#### If you're using extended thinking&para;<br>&para;<br>If you're using extended thinking on Sonnet 4.5, it continues to be supported on Sonnet 4.6 with no changes needed to your thinking configuration. Consider keeping a thinking budget around 16k tokens. In practice, most tasks don't use that much, but it provides headroom for harder problems without risk of runaway token usage.&para;<br>&para;<br>##### Coding and agentic use cases&para;<br>&para;<br>For agentic coding, frontend design, tool-heavy workflows, and complex enterprise workflows, start with `medium` effort. If you find latency is too high, consider reducing effort to `low`. If you need higher intelligence, consider increasing effort to `high` or migrating to Opus 4.6.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```python Python&para;<br>response = client.beta.messages.create(&para;<br>    model="claude-sonnet-4-6",&para;<br>    max_tokens=16384,&para;<br>    thinking={"type": "enabled", "budget_tokens": 16384},&para;<br>    output_config={"effort": "medium"},&para;<br>    betas=["interleaved-thinking-2025-05-14"],&para;<br>    messages=[{"role": "user", "content": "Your prompt here"}],&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>const response = await client.beta.messages.create({&para;<br>  model: "claude-sonnet-4-6",&para;<br>  max_tokens: 16384,&para;<br>  thinking: { type: "enabled", budget_tokens: 16384 },&para;<br>  output_config: { effort: "medium" },&para;<br>  betas: ["interleaved-thinking-2025-05-14"],&para;<br>  messages: [{ role: "user", content: "Your prompt here" }]&para;<br>});&para;<br>```&para;<br>&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "anthropic-beta: interleaved-thinking-2025-05-14" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-6",&para;<br>    "max_tokens": 16384,&para;<br>    "thinking": {&para;<br>        "type": "enabled",&para;<br>        "budget_tokens": 16384&para;<br>    },&para;<br>    "output_config": {&para;<br>        "effort": "medium"&para;<br>    },&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Your prompt here"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>##### Chat and non-coding use cases&para;<br>&para;<br>For chat, content generation, search, classification, and other non-coding tasks, start with `low` effort with extended thinking. If you need more depth, increase effort to `medium`.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```python Python&para;<br>response = client.beta.messages.create(&para;<br>    model="claude-sonnet-4-6",&para;<br>    max_tokens=8192,&para;<br>    thinking={"type": "enabled", "budget_tokens": 16384},&para;<br>    output_config={"effort": "low"},&para;<br>    betas=["interleaved-thinking-2025-05-14"],&para;<br>    messages=[{"role": "user", "content": "Your prompt here"}],&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>const response = await client.beta.messages.create({&para;<br>  model: "claude-sonnet-4-6",&para;<br>  max_tokens: 8192,&para;<br>  thinking: { type: "enabled", budget_tokens: 16384 },&para;<br>  output_config: { effort: "low" },&para;<br>  betas: ["interleaved-thinking-2025-05-14"],&para;<br>  messages: [{ role: "user", content: "Your prompt here" }]&para;<br>});&para;<br>```&para;<br>&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "anthropic-beta: interleaved-thinking-2025-05-14" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-6",&para;<br>    "max_tokens": 8192,&para;<br>    "thinking": {&para;<br>        "type": "enabled",&para;<br>        "budget_tokens": 16384&para;<br>    },&para;<br>    "output_config": {&para;<br>        "effort": "low"&para;<br>    },&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Your prompt here"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>##### When to try adaptive thinking&para;<br>&para;<br>The migration paths above use extended thinking with `budget_tokens` for predictable token usage. If your workload fits one of the following patterns, consider trying [adaptive thinking](/docs/en/build-with-claude/adaptive-thinking) instead:&para;<br>&para;<br>- **Autonomous multi-step agents:** coding agents that turn requirements into working software, data analysis pipelines, and bug finding where the model runs independently across many steps. Adaptive thinking lets the model calibrate its reasoning per step, staying on path over longer trajectories. For these workloads, start at `high` effort. If latency or token usage is a concern, scale down to `medium`.&para;<br>- **Computer use agents:** Sonnet 4.6 achieved best-in-class accuracy on computer use evaluations using adaptive mode.&para;<br>- **Bimodal workloads:** a mix of easy and hard tasks where adaptive skips thinking on simple queries and reasons deeply on complex ones.&para;<br>&para;<br>When using adaptive thinking, evaluate `medium` and `high` effort on your tasks. The right level depends on your workload's tradeoff between quality, latency, and token usage.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```python Python&para;<br>response = client.messages.create(&para;<br>    model="claude-sonnet-4-6",&para;<br>    max_tokens=64000,&para;<br>    thinking={"type": "adaptive"},&para;<br>    output_config={"effort": "medium"},&para;<br>    messages=[{"role": "user", "content": "Your prompt here"}],&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>const response = await client.messages.create({&para;<br>  model: "claude-sonnet-4-6",&para;<br>  max_tokens: 64000,&para;<br>  thinking: { type: "adaptive" },&para;<br>  output_config: { effort: "medium" },&para;<br>  messages: [{ role: "user", content: "Your prompt here" }]&para;<br>});&para;<br>```&para;<br>&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-6",&para;<br>    "max_tokens": 64000,&para;<br>    "thinking": {&para;<br>        "type": "adaptive"&para;<br>    },&para;<br>    "output_config": {&para;<br>        "effort": "medium"&para;<br>    },&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Your prompt here"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>&lt;Note&gt;&para;<br>If you see inconsistent behavior or quality regressions with adaptive thinking, switch to extended thinking with `budget_tokens`. This provides more predictable results with a cap on thinking costs.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Sonnet 4.6 migration checklist&para;<br>&para;<br>- [ ] Update model ID to `claude-sonnet-4-6`&para;<br>- [ ] **BREAKING:** Remove assistant message prefilling; use structured outputs or `output_config.format` instead&para;<br>- [ ] **BREAKING:** Verify tool parameter JSON parsing handles escaping differences&para;<br>- [ ] **BREAKING:** Update tool versions to latest (`text_editor_20250728`, `code_execution_20250825`); legacy versions are not supported (if migrating from 3.x)&para;<br>- [ ] **BREAKING:** Remove any code using the `undo_edit` command (if applicable)&para;<br>- [ ] **BREAKING:** Update sampling parameters to use only `temperature` OR `top_p`, not both (if migrating from 3.x)&para;<br>- [ ] Handle new `refusal` stop reason in your application&para;<br>- [ ] Remove `fine-grained-tool-streaming-2025-05-14` beta header (now GA)&para;<br>- [ ] Migrate `output_format` to `output_config.format`&para;<br>- [ ] Review and update prompts following [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices)&para;<br>- [ ] Consider enabling extended thinking or adaptive thinking for complex reasoning tasks&para;<br>- [ ] Test in development environment before production deployment&para;<br>&para;<br>---&para;<br>&para;<br>## Migrating to Claude Sonnet 4.5&para;<br>&para;<br>Claude Sonnet 4.5 combines strong intelligence with fast performance, making it ideal for everyday coding, analysis, and content tasks.&para;<br>&para;<br>For a complete overview of capabilities, see the [models overview](/docs/en/about-claude/models/overview).&para;<br>&para;<br>&lt;Note&gt;&para;<br>Sonnet 4.5 pricing is $3 per million input tokens, $15 per million output tokens. See [Claude pricing](/docs/en/about-claude/pricing) for details.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>**Update your model name:**&para;<br>&para;<br>```python&para;<br># From Sonnet 4&para;<br>model = "claude-sonnet-4-20250514"  # Before&para;<br>model = "claude-sonnet-4-5-20250929"  # After&para;<br>&para;<br># From Sonnet 3.7&para;<br>model = "claude-3-7-sonnet-20250219"  # Before&para;<br>model = "claude-sonnet-4-5-20250929"  # After&para;<br>```&para;<br>&para;<br>### Breaking changes&para;<br>&para;<br>These breaking changes apply when migrating from Claude 3.x Sonnet models.&para;<br>&para;<br>1. **Update sampling parameters**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Use only `temperature` OR `top_p`, not both.&para;<br>&para;<br>2. **Update tool versions**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Update to the latest tool versions (`text_editor_20250728`, `code_execution_20250825`). Remove any code using the `undo_edit` command.&para;<br>&para;<br>3. **Handle the `refusal` stop reason**&para;<br>&para;<br>   Update your application to [handle `refusal` stop reasons](/docs/en/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals).&para;<br>&para;<br>4. **Update your prompts for behavioral changes**&para;<br>&para;<br>   Claude 4 models have a more concise, direct communication style. Review [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices) for optimization guidance.&para;<br>&para;<br>### Sonnet 4.5 migration checklist&para;<br>&para;<br>- [ ] Update model ID to `claude-sonnet-4-5-20250929`&para;<br>- [ ] **BREAKING:** Update tool versions to latest (`text_editor_20250728`, `code_execution_20250825`); legacy versions are not supported (if migrating from 3.x)&para;<br>- [ ] **BREAKING:** Remove any code using the `undo_edit` command (if applicable)&para;<br>- [ ] **BREAKING:** Update sampling parameters to use only `temperature` OR `top_p`, not both (if migrating from 3.x)&para;<br>- [ ] Handle new `refusal` stop reason in your application&para;<br>- [ ] Review and update prompts following [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices)&para;<br>- [ ] Consider enabling extended thinking for complex reasoning tasks&para;<br>- [ ] Test in development environment before production deployment&para;<br>&para;<br>---&para;<br>&para;<br>## Migrating to Claude Haiku 4.5&para;<br>&para;<br>Claude Haiku 4.5 is the fastest and most intelligent Haiku model with near-frontier performance, delivering premium model quality for interactive applications and high-volume processing.&para;<br>&para;<br>For a complete overview of capabilities, see the [models overview](/docs/en/about-claude/models/overview).&para;<br>&para;<br>&lt;Note&gt;&para;<br>Haiku 4.5 pricing is $1 per million input tokens, $5 per million output tokens. See [Claude pricing](/docs/en/about-claude/pricing) for details.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>**Update your model name:**&para;<br>&para;<br>```python&para;<br># From Haiku 3.5&para;<br>model = "claude-3-5-haiku-20241022"  # Before&para;<br>model = "claude-haiku-4-5-20251001"  # After</span><ins style="background:#e6ffe6;">&para;<br>&para;<br># From Haiku 3&para;<br>model = "claude-3-haiku-20240307"  # Before&para;<br>model = "claude-haiku-4-5-20251001"  # After</ins><span>&para;<br>```&para;<br>&para;<br>**Review new rate limits:** Haiku 4.5 has separate rate limits from Haiku 3.5</span><ins style="background:#e6ffe6;"> and Haiku 3</ins><span>. See [Rate limits documentation](/docs/en/api/rate-limits) for details.&para;<br>&para;<br>&lt;Tip&gt;&para;<br>For significant performance improvements on coding and reasoning tasks, consider enabling extended thinking with `thinking: {type: "enabled", budget_tokens: N}`.&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>&lt;Note&gt;&para;<br>Extended thinking impacts [prompt caching](/docs/en/build-with-claude/prompt-caching#caching-with-thinking-blocks) efficiency.&para;<br>&para;<br>Extended thinking is deprecated in Claude 4.6 or newer models. If using newer models, use [adaptive thinking](/docs/en/build-with-claude/adaptive-thinking) instead.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>**Explore new capabilities:** See the [models overview](/docs/en/about-claude/models/overview) for details on context awareness, increased output capacity (64K tokens), higher intelligence, and improved speed.&para;<br>&para;<br>### Breaking changes&para;<br>&para;<br>These breaking changes apply when migrating from Claude 3.x Haiku models.&para;<br>&para;<br>1. **Update sampling parameters**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Use only `temperature` OR `top_p`, not both.&para;<br>&para;<br>2. **Update tool versions**&para;<br>&para;<br>   &lt;Warning&gt;&para;<br>   This is a breaking change when migrating from Claude 3.x models.&para;<br>   &lt;/Warning&gt;&para;<br>&para;<br>   Update to the latest tool versions (`text_editor_20250728`, `code_execution_20250825`). Remove any code using the `undo_edit` command.&para;<br>&para;<br>3. **Handle the `refusal` stop reason**&para;<br>&para;<br>   Update your application to [handle `refusal` stop reasons](/docs/en/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals).&para;<br>&para;<br>4. **Update your prompts for behavioral changes**&para;<br>&para;<br>   Claude 4 models have a more concise, direct communication style. Review [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices) for optimization guidance.&para;<br>&para;<br>### Haiku 4.5 migration checklist&para;<br>&para;<br>- [ ] Update model ID to `claude-haiku-4-5-20251001`&para;<br>- [ ] **BREAKING:** Update tool versions to latest (`text_editor_20250728`, `code_execution_20250825`); legacy versions are not supported&para;<br>- [ ] **BREAKING:** Remove any code using the `undo_edit` command (if applicable)&para;<br>- [ ] **BREAKING:** Update sampling parameters to use only `temperature` OR `top_p`, not both&para;<br>- [ ] Handle new `refusal` stop reason in your application&para;<br>- [ ] Review and adjust for new rate limits (separate from Haiku 3.5)&para;<br>- [ ] Review and update prompts following [prompting best practices](/docs/en/build-with-claude/prompt-engineering/claude-prompting-best-practices)&para;<br>- [ ] Consider enabling extended thinking for complex reasoning tasks&para;<br>- [ ] Test in development environment before production deployment&para;<br>&para;<br>---&para;<br>&para;<br>## Need help?&para;<br>&para;<br>- Check the [API documentation](/docs/en/api/overview) for detailed specifications&para;<br>- Review [model capabilities](/docs/en/about-claude/models/overview) for performance comparisons&para;<br>- Review [API release notes](/docs/en/release-notes/api) for API updates&para;<br>- Contact support if you encounter any issues during migration</span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/about-claude/models/migrating-to-claude-4.md
+++ b/about-claude/models/migrating-to-claude-4.md
@@ -587,9 +587,13 @@
 # From Haiku 3.5
 model = &#34;claude-3-5-haiku-20241022&#34;  # Before
 model = &#34;claude-haiku-4-5-20251001&#34;  # After
-```
-
-**Review new rate limits:** Haiku 4.5 has separate rate limits from Haiku 3.5. See [Rate limits documentation](/docs/en/api/rate-limits) for details.
+
+# From Haiku 3
+model = &#34;claude-3-haiku-20240307&#34;  # Before
+model = &#34;claude-haiku-4-5-20251001&#34;  # After
+```
+
+**Review new rate limits:** Haiku 4.5 has separate rate limits from Haiku 3.5 and Haiku 3. See [Rate limits documentation](/docs/en/api/rate-limits) for details.
 
 &lt;Tip&gt;
 For significant performance improvements on coding and reasoning tasks, consider enabling extended thinking with `thinking: {type: &#34;enabled&#34;, budget_tokens: N}`.
</code></pre>
    </div>
</body>
</html>