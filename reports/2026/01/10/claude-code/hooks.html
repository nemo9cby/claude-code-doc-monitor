<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hooks - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>hooks.md</h1>
            <p class="meta">Changed on 2026-01-10 20:25:36 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+36</span> lines added
            </div>
            <div class="stat removed">
                <span>-1</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><span># Hooks reference&para;<br>&para;<br>&gt; This page provides reference documentation for implementing hooks in Claude Code.&para;<br>&para;<br>&lt;Tip&gt;&para;<br>  For a quickstart guide with examples, see [Get started with Claude Code hooks](/en/hooks-guide).&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>## Configuration&para;<br>&para;<br>Claude Code hooks are configured in your [settings files](/en/settings):&para;<br>&para;<br>* `~/.claude/settings.json` - User settings&para;<br>* `.claude/settings.json` - Project settings&para;<br>* `.claude/settings.local.json` - Local project settings (not committed)&para;<br>* Managed policy settings&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Enterprise administrators can use `allowManagedHooksOnly` to block user, project, and plugin hooks. See [Hook configuration](/en/settings#hook-configuration).&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Structure&para;<br>&para;<br>Hooks are organized by matchers, where each matcher can have multiple hooks:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "EventName": [&para;<br>      {&para;<br>        "matcher": "ToolPattern",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "your-command-here"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>* **matcher**: Pattern to match tool names, case-sensitive (only applicable for&para;<br>  `PreToolUse`, `PermissionRequest`, and `PostToolUse`)&para;<br>  * Simple strings match exactly: `Write` matches only the Write tool&para;<br>  * Supports regex: `Edit|Write` or `Notebook.*`&para;<br>  * Use `*` to match all tools. You can also use empty string (`""`) or leave&para;<br>    `matcher` blank.&para;<br>* **hooks**: Array of hooks to execute when the pattern matches&para;<br>  * `type`: Hook execution type - `"command"` for bash commands or `"prompt"` for LLM-based evaluation&para;<br>  * `command`: (For `type: "command"`) The bash command to execute (can use `$CLAUDE_PROJECT_DIR` environment variable)&para;<br>  * `prompt`: (For `type: "prompt"`) The prompt to send to the LLM for evaluation&para;<br>  * `timeout`: (Optional) How long a hook should run, in seconds, before canceling that specific hook&para;<br>&para;<br>For events like `UserPromptSubmit`, `Stop`, and `SubagentStop`&para;<br>that don't use matchers, you can omit the matcher field:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "UserPromptSubmit": [&para;<br>      {&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "/path/to/prompt-validator.py"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Project-Specific Hook Scripts&para;<br>&para;<br>You can use the environment variable `CLAUDE_PROJECT_DIR` (only available when&para;<br>Claude Code spawns the hook command) to reference scripts stored in your project,&para;<br>ensuring they work regardless of Claude's current directory:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "PostToolUse": [&para;<br>      {&para;<br>        "matcher": "Write|Edit",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/check-style.sh"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Plugin hooks&para;<br>&para;<br>[Plugins](/en/plugins) can provide hooks that integrate seamlessly with your user and project hooks. Plugin hooks are automatically merged with your configuration when plugins are enabled.&para;<br>&para;<br>**How plugin hooks work**:&para;<br>&para;<br>* Plugin hooks are defined in the plugin's `hooks/hooks.json` file or in a file given by a custom path to the `hooks` field.&para;<br>* When a plugin is enabled, its hooks are merged with user and project hooks&para;<br>* Multiple hooks from different sources can respond to the same event&para;<br>* Plugin hooks use the `${CLAUDE_PLUGIN_ROOT}` environment variable to reference plugin files&para;<br>&para;<br>**Example plugin hook configuration**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "description": "Automatic code formatting",&para;<br>  "hooks": {&para;<br>    "PostToolUse": [&para;<br>      {&para;<br>        "matcher": "Write|Edit",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/format.sh",&para;<br>            "timeout": 30&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Plugin hooks use the same format as regular hooks with an optional `description` field to explain the hook's purpose.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Plugin hooks run alongside your custom hooks. If multiple hooks match an event, they all execute in parallel.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>**Environment variables for plugins**:&para;<br>&para;<br>* `${CLAUDE_PLUGIN_ROOT}`: Absolute path to the plugin directory&para;<br>* `${CLAUDE_PROJECT_DIR}`: Project root directory (same as for project hooks)&para;<br>* All standard environment variables are available&para;<br>&para;<br>See the [plugin components reference](/en/plugins-reference#hooks) for details on creating plugin hooks.&para;<br>&para;<br>### Hooks in Skills, Agents, and Slash Commands&para;<br>&para;<br>In addition to settings files and plugins, hooks can be defined directly in [Skills](/en/skills), [subagents](/en/sub-agents), and [slash commands](/en/slash-commands) using frontmatter. These hooks are scoped to the component's lifecycle and only run when that component is active.&para;<br>&para;<br>**Supported events**: `PreToolUse`, `PostToolUse`, and `Stop`&para;<br>&para;<br>**Example in a Skill**:&para;<br>&para;<br>```yaml  theme={null}&para;<br>---&para;<br>name: secure-operations&para;<br>description: Perform operations with security checks&para;<br>hooks:&para;<br>  PreToolUse:&para;<br>    - matcher: "Bash"&para;<br>      hooks:&para;<br>        - type: command&para;<br>          command: "./scripts/security-check.sh"&para;<br>---&para;<br>```&para;<br>&para;<br>**Example in an agent**:&para;<br>&para;<br>```yaml  theme={null}&para;<br>---&para;<br>name: code-reviewer&para;<br>description: Review code changes&para;<br>hooks:&para;<br>  PostToolUse:&para;<br>    - matcher: "Edit|Write"&para;<br>      hooks:&para;<br>        - type: command&para;<br>          command: "./scripts/run-linter.sh"&para;<br>---&para;<br>```&para;<br>&para;<br>Component-scoped hooks follow the same configuration format as settings-based hooks but are automatically cleaned up when the component finishes executing.&para;<br>&para;<br>**Additional option for skills and slash commands:**&para;<br>&para;<br>* `once`: Set to `true` to run the hook only once per session. After the first successful execution, the hook is removed. Note: This option is currently only supported for skills and slash commands, not for agents.&para;<br>&para;<br>## Prompt-Based Hooks&para;<br>&para;<br>In addition to bash command hooks (`type: "command"`), Claude Code supports prompt-based hooks (`type: "prompt"`) that use an LLM to evaluate whether to allow or block an action. Prompt-based hooks are currently only supported for `Stop` and `SubagentStop` hooks, where they enable intelligent, context-aware decisions.&para;<br>&para;<br>### How prompt-based hooks work&para;<br>&para;<br>Instead of executing a bash command, prompt-based hooks:&para;<br>&para;<br>1. Send the hook input and your prompt to a fast LLM (Haiku)&para;<br>2. The LLM responds with structured JSON containing a decision&para;<br>3. Claude Code processes the decision automatically&para;<br>&para;<br>### Configuration&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "Stop": [&para;<br>      {&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "prompt",&para;<br>            "prompt": "Evaluate if Claude should stop: $ARGUMENTS. Check if all tasks are complete."&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**Fields:**&para;<br>&para;<br>* `type`: Must be `"prompt"`&para;<br>* `prompt`: The prompt text to send to the LLM&para;<br>  * Use `$ARGUMENTS` as a placeholder for the hook input JSON&para;<br>  * If `$ARGUMENTS` is not present, input JSON is appended to the prompt&para;<br>* `timeout`: (Optional) Timeout in seconds (default: 30 seconds)&para;<br>&para;<br>### Response schema&para;<br>&para;<br>The LLM must respond with JSON containing:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "ok": true | false,&para;<br>  "reason": "Explanation for the decision"&para;<br>}&para;<br>```&para;<br>&para;<br>**Response fields:**&para;<br>&para;<br>* `ok`: `true` allows the action, `false` prevents it&para;<br>* `reason`: Required when `ok` is `false`. Explanation shown to Claude&para;<br>&para;<br>### Supported hook events&para;<br>&para;<br>Prompt-based hooks work with any hook event, but are most useful for:&para;<br>&para;<br>* **Stop**: Intelligently decide if Claude should continue working&para;<br>* **SubagentStop**: Evaluate if a subagent has completed its task&para;<br>* **UserPromptSubmit**: Validate user prompts with LLM assistance&para;<br>* **PreToolUse**: Make context-aware permission decisions&para;<br>* **PermissionRequest**: Intelligently allow or deny permission dialogs&para;<br>&para;<br>### Example: Intelligent Stop hook&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "Stop": [&para;<br>      {&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "prompt",&para;<br>            "prompt": "You are evaluating whether Claude should stop working. Context: $ARGUMENTS\n\nAnalyze the conversation and determine if:\n1. All user-requested tasks are complete\n2. Any errors need to be addressed\n3. Follow-up work is needed\n\nRespond with JSON: {\"ok\": true} to allow stopping, or {\"ok\": false, \"reason\": \"your explanation\"} to continue working.",&para;<br>            "timeout": 30&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Example: SubagentStop with custom logic&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "SubagentStop": [&para;<br>      {&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "prompt",&para;<br>            "prompt": "Evaluate if this subagent should stop. Input: $ARGUMENTS\n\nCheck if:\n- The subagent completed its assigned task\n- Any errors occurred that need fixing\n- Additional context gathering is needed\n\nReturn: {\"ok\": true} to allow stopping, or {\"ok\": false, \"reason\": \"explanation\"} to continue."&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Comparison with bash command hooks&para;<br>&para;<br>| Feature               | Bash Command Hooks      | Prompt-Based Hooks             |&para;<br>| --------------------- | ----------------------- | ------------------------------ |&para;<br>| **Execution**         | Runs bash script        | Queries LLM                    |&para;<br>| **Decision logic**    | You implement in code   | LLM evaluates context          |&para;<br>| **Setup complexity**  | Requires script file    | Configure prompt               |&para;<br>| **Context awareness** | Limited to script logic | Natural language understanding |&para;<br>| **Performance**       | Fast (local execution)  | Slower (API call)              |&para;<br>| **Use case**          | Deterministic rules     | Context-aware decisions        |&para;<br>&para;<br>### Best practices&para;<br>&para;<br>* **Be specific in prompts**: Clearly state what you want the LLM to evaluate&para;<br>* **Include decision criteria**: List the factors the LLM should consider&para;<br>* **Test your prompts**: Verify the LLM makes correct decisions for your use cases&para;<br>* **Set appropriate timeouts**: Default is 30 seconds, adjust if needed&para;<br>* **Use for complex decisions**: Bash hooks are better for simple, deterministic rules&para;<br>&para;<br>See the [plugin components reference](/en/plugins-reference#hooks) for details on creating plugin hooks.&para;<br>&para;<br>## Hook Events&para;<br>&para;<br>### PreToolUse&para;<br>&para;<br>Runs after Claude creates tool parameters and before processing the tool call.&para;<br>&para;<br>**Common matchers:**&para;<br>&para;<br>* `Task` - Subagent tasks (see [subagents documentation](/en/sub-agents))&para;<br>* `Bash` - Shell commands&para;<br>* `Glob` - File pattern matching&para;<br>* `Grep` - Content search&para;<br>* `Read` - File reading&para;<br>* `Edit` - File editing&para;<br>* `Write` - File writing&para;<br>* `WebFetch`, `WebSearch` - Web operations&para;<br>&para;<br>Use [PreToolUse decision control](#pretooluse-decision-control) to allow, deny, or ask for permission to use the tool.&para;<br>&para;<br>### PermissionRequest&para;<br>&para;<br>Runs when the user is shown a permission dialog.&para;<br>Use [PermissionRequest decision control](#permissionrequest-decision-control) to allow or deny on behalf of the user.&para;<br>&para;<br>Recognizes the same matcher values as PreToolUse.&para;<br>&para;<br>### PostToolUse&para;<br>&para;<br>Runs immediately after a tool completes successfully.&para;<br>&para;<br>Recognizes the same matcher values as PreToolUse.&para;<br>&para;<br>### Notification&para;<br>&para;<br>Runs when Claude Code sends notifications. Supports matchers to filter by notification type.&para;<br>&para;<br>**Common matchers:**&para;<br>&para;<br>* `permission_prompt` - Permission requests from Claude Code&para;<br>* `idle_prompt` - When Claude is waiting for user input (after 60+ seconds of idle time)&para;<br>* `auth_success` - Authentication success notifications&para;<br>* `elicitation_dialog` - When Claude Code needs input for MCP tool elicitation&para;<br>&para;<br>You can use matchers to run different hooks for different notification types, or omit the matcher to run hooks for all notifications.&para;<br>&para;<br>**Example: Different notifications for different types**&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "Notification": [&para;<br>      {&para;<br>        "matcher": "permission_prompt",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "/path/to/permission-alert.sh"&para;<br>          }&para;<br>        ]&para;<br>      },&para;<br>      {&para;<br>        "matcher": "idle_prompt",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "/path/to/idle-notification.sh"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### UserPromptSubmit&para;<br>&para;<br>Runs when the user submits a prompt, before Claude processes it. This allows you&para;<br>to add additional context based on the prompt/conversation, validate prompts, or&para;<br>block certain types of prompts.&para;<br>&para;<br>### Stop&para;<br>&para;<br>Runs when the main Claude Code agent has finished responding. Does not run if&para;<br>the stoppage occurred due to a user interrupt.&para;<br>&para;<br>### SubagentStop&para;<br>&para;<br>Runs when a Claude Code subagent (Task tool call) has finished responding.&para;<br>&para;<br>### PreCompact&para;<br>&para;<br>Runs before Claude Code is about to run a compact operation.&para;<br>&para;<br>**Matchers:**&para;<br>&para;<br>* `manual` - Invoked from `/compact`&para;<br>* `auto` - Invoked from auto-compact (due to full context window)&para;<br>&para;<br>### SessionStart&para;<br>&para;<br>Runs when Claude Code starts a new session or resumes an existing session (which&para;<br>currently does start a new session under the hood). Useful for loading in&para;<br>development context like existing issues or recent changes to your codebase, installing dependencies, or setting up environment variables.&para;<br>&para;<br>**Matchers:**&para;<br>&para;<br>* `startup` - Invoked from startup&para;<br>* `resume` - Invoked from `--resume`, `--continue`, or `/resume`&para;<br>* `clear` - Invoked from `/clear`&para;<br>* `compact` - Invoked from auto or manual compact.&para;<br>&para;<br>#### Persisting environment variables&para;<br>&para;<br>SessionStart hooks have access to the `CLAUDE_ENV_FILE` environment variable, which provides a file path where you can persist environment variables for subsequent bash commands.&para;<br>&para;<br>**Example: Setting individual environment variables**&para;<br>&para;<br>```bash  theme={null}&para;<br>#!/bin/bash&para;<br>&para;<br>if [ -n "$CLAUDE_ENV_FILE" ]; then&para;<br>  echo 'export NODE_ENV=production' &gt;&gt; "$CLAUDE_ENV_FILE"&para;<br>  echo 'export API_KEY=your-api-key' &gt;&gt; "$CLAUDE_ENV_FILE"&para;<br>  echo 'export PATH="$PATH:./node_modules/.bin"' &gt;&gt; "$CLAUDE_ENV_FILE"&para;<br>fi&para;<br>&para;<br>exit 0&para;<br>```&para;<br>&para;<br>**Example: Persisting all environment changes from the hook**&para;<br>&para;<br>When your setup modifies the environment (for example, `nvm use`), capture and persist all changes by diffing the environment:&para;<br>&para;<br>```bash  theme={null}&para;<br>#!/bin/bash&para;<br>&para;<br>ENV_BEFORE=$(export -p | sort)&para;<br>&para;<br># Run your setup commands that modify the environment&para;<br>source ~/.nvm/nvm.sh&para;<br>nvm use 20&para;<br>&para;<br>if [ -n "$CLAUDE_ENV_FILE" ]; then&para;<br>  ENV_AFTER=$(export -p | sort)&para;<br>  comm -13 &lt;(echo "$ENV_BEFORE") &lt;(echo "$ENV_AFTER") &gt;&gt; "$CLAUDE_ENV_FILE"&para;<br>fi&para;<br>&para;<br>exit 0&para;<br>```&para;<br>&para;<br>Any variables written to this file will be available in all subsequent bash commands that Claude Code executes during the session.&para;<br>&para;<br>&lt;Note&gt;&para;<br>  `CLAUDE_ENV_FILE` is only available for SessionStart hooks. Other hook types do not have access to this variable.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### SessionEnd&para;<br>&para;<br>Runs when a Claude Code session ends. Useful for cleanup tasks, logging session&para;<br>statistics, or saving session state.&para;<br>&para;<br>The `reason` field in the hook input will be one of:&para;<br>&para;<br>* `clear` - Session cleared with /clear command&para;<br>* `logout` - User logged out&para;<br>* `prompt_input_exit` - User exited while prompt input was visible&para;<br>* `other` - Other exit reasons&para;<br>&para;<br>## Hook Input&para;<br>&para;<br>Hooks receive JSON data via stdin containing session information and&para;<br>event-specific data:&para;<br>&para;<br>```typescript  theme={null}&para;<br>{&para;<br>  // Common fields&para;<br>  session_id: string&para;<br>  transcript_path: string  // Path to conversation JSON&para;<br>  cwd: string              // The current working directory when the hook is invoked&para;<br>  permission_mode: string  // Current permission mode: "default", "plan", "acceptEdits", "dontAsk", or "bypassPermissions"&para;<br>&para;<br>  // Event-specific fields&para;<br>  hook_event_name: string&para;<br>  ...&para;<br>}&para;<br>```&para;<br>&para;<br>### PreToolUse Input&para;<br>&para;<br>The exact schema for `tool_input` depends on the tool.</span><del style="background:#ffe6e6;">&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreToolUse",&para;<br>  "tool_name": "Write",&para;<br>  "tool_input": {&para;<br>    "file_path": "/path/to/file.txt",&para;<br>    "content": "file content"&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```</del><ins style="background:#e6ffe6;"> Here are examples for commonly hooked tools.&para;<br>&para;<br>#### Bash tool&para;<br>&para;<br>The Bash tool is the most commonly hooked tool for command validation:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreToolUse",&para;<br>  "tool_name": "Bash",&para;<br>  "tool_input": {&para;<br>    "command": "psql -c 'SELECT * FROM users'",&para;<br>    "description": "Query the users table",&para;<br>    "timeout": 120000&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```&para;<br>&para;<br>| Field               | Type    | Description                                   |&para;<br>| :------------------ | :------ | :-------------------------------------------- |&para;<br>| `command`           | string  | The shell command to execute                  |&para;<br>| `description`       | string  | Optional description of what the command does |&para;<br>| `timeout`           | number  | Optional timeout in milliseconds              |&para;<br>| `run_in_background` | boolean | Whether to run the command in background      |&para;<br>&para;<br>#### Write tool&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreToolUse",&para;<br>  "tool_name": "Write",&para;<br>  "tool_input": {&para;<br>    "file_path": "/path/to/file.txt",&para;<br>    "content": "file content"&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```&para;<br>&para;<br>| Field       | Type   | Description                        |&para;<br>| :---------- | :----- | :--------------------------------- |&para;<br>| `file_path` | string | Absolute path to the file to write |&para;<br>| `content`   | string | Content to write to the file       |&para;<br>&para;<br>#### Edit tool&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreToolUse",&para;<br>  "tool_name": "Edit",&para;<br>  "tool_input": {&para;<br>    "file_path": "/path/to/file.txt",&para;<br>    "old_string": "original text",&para;<br>    "new_string": "replacement text"&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```&para;<br>&para;<br>| Field         | Type    | Description                                         |&para;<br>| :------------ | :------ | :-------------------------------------------------- |&para;<br>| `file_path`   | string  | Absolute path to the file to edit                   |&para;<br>| `old_string`  | string  | Text to find and replace                            |&para;<br>| `new_string`  | string  | Replacement text                                    |&para;<br>| `replace_all` | boolean | Whether to replace all occurrences (default: false) |&para;<br>&para;<br>#### Read tool&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreToolUse",&para;<br>  "tool_name": "Read",&para;<br>  "tool_input": {&para;<br>    "file_path": "/path/to/file.txt"&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```&para;<br>&para;<br>| Field       | Type   | Description                                |&para;<br>| :---------- | :----- | :----------------------------------------- |&para;<br>| `file_path` | string | Absolute path to the file to read          |&para;<br>| `offset`    | number | Optional line number to start reading from |&para;<br>| `limit`     | number | Optional number of lines to read           |</ins><span>&para;<br>&para;<br>### PostToolUse Input&para;<br>&para;<br>The exact schema for `tool_input` and `tool_response` depends on the tool.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PostToolUse",&para;<br>  "tool_name": "Write",&para;<br>  "tool_input": {&para;<br>    "file_path": "/path/to/file.txt",&para;<br>    "content": "file content"&para;<br>  },&para;<br>  "tool_response": {&para;<br>    "filePath": "/path/to/file.txt",&para;<br>    "success": true&para;<br>  },&para;<br>  "tool_use_id": "toolu_01ABC123..."&para;<br>}&para;<br>```&para;<br>&para;<br>### Notification Input&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "Notification",&para;<br>  "message": "Claude needs your permission to use Bash",&para;<br>  "notification_type": "permission_prompt"&para;<br>}&para;<br>```&para;<br>&para;<br>### UserPromptSubmit Input&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "UserPromptSubmit",&para;<br>  "prompt": "Write a function to calculate the factorial of a number"&para;<br>}&para;<br>```&para;<br>&para;<br>### Stop and SubagentStop Input&para;<br>&para;<br>`stop_hook_active` is true when Claude Code is already continuing as a result of&para;<br>a stop hook. Check this value or process the transcript to prevent Claude Code&para;<br>from running indefinitely.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "Stop",&para;<br>  "stop_hook_active": true&para;<br>}&para;<br>```&para;<br>&para;<br>### PreCompact Input&para;<br>&para;<br>For `manual`, `custom_instructions` comes from what the user passes into&para;<br>`/compact`. For `auto`, `custom_instructions` is empty.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "PreCompact",&para;<br>  "trigger": "manual",&para;<br>  "custom_instructions": ""&para;<br>}&para;<br>```&para;<br>&para;<br>### SessionStart Input&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "SessionStart",&para;<br>  "source": "startup"&para;<br>}&para;<br>```&para;<br>&para;<br>### SessionEnd Input&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "session_id": "abc123",&para;<br>  "transcript_path": "~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl",&para;<br>  "cwd": "/Users/...",&para;<br>  "permission_mode": "default",&para;<br>  "hook_event_name": "SessionEnd",&para;<br>  "reason": "exit"&para;<br>}&para;<br>```&para;<br>&para;<br>## Hook Output&para;<br>&para;<br>There are two mutually exclusive ways for hooks to return output back to Claude Code. The output&para;<br>communicates whether to block and any feedback that should be shown to Claude&para;<br>and the user.&para;<br>&para;<br>### Simple: Exit Code&para;<br>&para;<br>Hooks communicate status through exit codes, stdout, and stderr:&para;<br>&para;<br>* **Exit code 0**: Success. `stdout` is shown to the user in verbose mode&para;<br>  (ctrl+o), except for `UserPromptSubmit` and `SessionStart`, where stdout is&para;<br>  added to the context. JSON output in `stdout` is parsed for structured control&para;<br>  (see [Advanced: JSON Output](#advanced-json-output)).&para;<br>* **Exit code 2**: Blocking error. Only `stderr` is used as the error message&para;<br>  and fed back to Claude. The format is `[command]: {stderr}`. JSON in `stdout`&para;<br>  is **not** processed for exit code 2. See per-hook-event behavior below.&para;<br>* **Other exit codes**: Non-blocking error. `stderr` is shown to the user in verbose mode (ctrl+o) with&para;<br>  format `Failed with non-blocking status code: {stderr}`. If `stderr` is empty,&para;<br>  it shows `No stderr output`. Execution continues.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>  Reminder: Claude Code does not see stdout if the exit code is 0, except for&para;<br>  the `UserPromptSubmit` hook where stdout is injected as context.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>#### Exit Code 2 Behavior&para;<br>&para;<br>| Hook Event          | Behavior                                                           |&para;<br>| ------------------- | ------------------------------------------------------------------ |&para;<br>| `PreToolUse`        | Blocks the tool call, shows stderr to Claude                       |&para;<br>| `PermissionRequest` | Denies the permission, shows stderr to Claude                      |&para;<br>| `PostToolUse`       | Shows stderr to Claude (tool already ran)                          |&para;<br>| `Notification`      | N/A, shows stderr to user only                                     |&para;<br>| `UserPromptSubmit`  | Blocks prompt processing, erases prompt, shows stderr to user only |&para;<br>| `Stop`              | Blocks stoppage, shows stderr to Claude                            |&para;<br>| `SubagentStop`      | Blocks stoppage, shows stderr to Claude subagent                   |&para;<br>| `PreCompact`        | N/A, shows stderr to user only                                     |&para;<br>| `SessionStart`      | N/A, shows stderr to user only                                     |&para;<br>| `SessionEnd`        | N/A, shows stderr to user only                                     |&para;<br>&para;<br>### Advanced: JSON Output&para;<br>&para;<br>Hooks can return structured JSON in `stdout` for more sophisticated control.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>  JSON output is only processed when the hook exits with code 0. If your hook&para;<br>  exits with code 2 (blocking error), `stderr` text is used directly—any JSON in `stdout`&para;<br>  is ignored. For other non-zero exit codes, only `stderr` is shown to the user in verbose mode (ctrl+o).&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>#### Common JSON Fields&para;<br>&para;<br>All hook types can include these optional fields:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "continue": true, // Whether Claude should continue after hook execution (default: true)&para;<br>  "stopReason": "string", // Message shown when continue is false&para;<br>&para;<br>  "suppressOutput": true, // Hide stdout from transcript mode (default: false)&para;<br>  "systemMessage": "string" // Optional warning message shown to the user&para;<br>}&para;<br>```&para;<br>&para;<br>If `continue` is false, Claude stops processing after the hooks run.&para;<br>&para;<br>* For `PreToolUse`, this is different from `"permissionDecision": "deny"`, which&para;<br>  only blocks a specific tool call and provides automatic feedback to Claude.&para;<br>* For `PostToolUse`, this is different from `"decision": "block"`, which&para;<br>  provides automated feedback to Claude.&para;<br>* For `UserPromptSubmit`, this prevents the prompt from being processed.&para;<br>* For `Stop` and `SubagentStop`, this takes precedence over any&para;<br>  `"decision": "block"` output.&para;<br>* In all cases, `"continue" = false` takes precedence over any&para;<br>  `"decision": "block"` output.&para;<br>&para;<br>`stopReason` accompanies `continue` with a reason shown to the user, not shown&para;<br>to Claude.&para;<br>&para;<br>#### `PreToolUse` Decision Control&para;<br>&para;<br>`PreToolUse` hooks can control whether a tool call proceeds.&para;<br>&para;<br>* `"allow"` bypasses the permission system. `permissionDecisionReason` is shown&para;<br>  to the user but not to Claude.&para;<br>* `"deny"` prevents the tool call from executing. `permissionDecisionReason` is&para;<br>  shown to Claude.&para;<br>* `"ask"` asks the user to confirm the tool call in the UI.&para;<br>  `permissionDecisionReason` is shown to the user but not to Claude.&para;<br>&para;<br>Additionally, hooks can modify tool inputs before execution using `updatedInput`:&para;<br>&para;<br>* `updatedInput` modifies the tool's input parameters before the tool executes&para;<br>* Combine with `"permissionDecision": "allow"` to modify the input and auto-approve the tool call&para;<br>* Combine with `"permissionDecision": "ask"` to modify the input and show it to the user for confirmation&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "PreToolUse",&para;<br>    "permissionDecision": "allow",&para;<br>    "permissionDecisionReason": "My reason here",&para;<br>    "updatedInput": {&para;<br>      "field_to_modify": "new value"&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  The `decision` and `reason` fields are deprecated for PreToolUse hooks.&para;<br>  Use `hookSpecificOutput.permissionDecision` and&para;<br>  `hookSpecificOutput.permissionDecisionReason` instead. The deprecated fields&para;<br>  `"approve"` and `"block"` map to `"allow"` and `"deny"` respectively.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### `PermissionRequest` Decision Control&para;<br>&para;<br>`PermissionRequest` hooks can allow or deny permission requests shown to the user.&para;<br>&para;<br>* For `"behavior": "allow"` you can also optionally pass in an `"updatedInput"` that modifies the tool's input parameters before the tool executes.&para;<br>* For `"behavior": "deny"` you can also optionally pass in a `"message"` string that tells the model why the permission was denied, and a boolean `"interrupt"` which will stop Claude.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "PermissionRequest",&para;<br>    "decision": {&para;<br>      "behavior": "allow",&para;<br>      "updatedInput": {&para;<br>        "command": "npm run lint"&para;<br>      }&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### `PostToolUse` Decision Control&para;<br>&para;<br>`PostToolUse` hooks can provide feedback to Claude after tool execution.&para;<br>&para;<br>* `"block"` automatically prompts Claude with `reason`.&para;<br>* `undefined` does nothing. `reason` is ignored.&para;<br>* `"hookSpecificOutput.additionalContext"` adds context for Claude to consider.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "decision": "block" | undefined,&para;<br>  "reason": "Explanation for decision",&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "PostToolUse",&para;<br>    "additionalContext": "Additional information for Claude"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### `UserPromptSubmit` Decision Control&para;<br>&para;<br>`UserPromptSubmit` hooks can control whether a user prompt is processed and add context.&para;<br>&para;<br>**Adding context (exit code 0):**&para;<br>There are two ways to add context to the conversation:&para;<br>&para;<br>1. **Plain text stdout** (simpler): Any non-JSON text written to stdout is added&para;<br>   as context. This is the easiest way to inject information.&para;<br>&para;<br>2. **JSON with `additionalContext`** (structured): Use the JSON format below for&para;<br>   more control. The `additionalContext` field is added as context.&para;<br>&para;<br>Both methods work with exit code 0. Plain stdout is shown as hook output in&para;<br>the transcript; `additionalContext` is added more discretely.&para;<br>&para;<br>**Blocking prompts:**&para;<br>&para;<br>* `"decision": "block"` prevents the prompt from being processed. The submitted&para;<br>  prompt is erased from context. `"reason"` is shown to the user but not added&para;<br>  to context.&para;<br>* `"decision": undefined` (or omitted) allows the prompt to proceed normally.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "decision": "block" | undefined,&para;<br>  "reason": "Explanation for decision",&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "UserPromptSubmit",&para;<br>    "additionalContext": "My additional context here"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;Note&gt;&para;<br>  The JSON format isn't required for simple use cases. To add context, you can print plain text to stdout with exit code 0. Use JSON when you need to&para;<br>  block prompts or want more structured control.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### `Stop`/`SubagentStop` Decision Control&para;<br>&para;<br>`Stop` and `SubagentStop` hooks can control whether Claude must continue.&para;<br>&para;<br>* `"block"` prevents Claude from stopping. You must populate `reason` for Claude&para;<br>  to know how to proceed.&para;<br>* `undefined` allows Claude to stop. `reason` is ignored.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "decision": "block" | undefined,&para;<br>  "reason": "Must be provided when Claude is blocked from stopping"&para;<br>}&para;<br>```&para;<br>&para;<br>#### `SessionStart` Decision Control&para;<br>&para;<br>`SessionStart` hooks allow you to load in context at the start of a session.&para;<br>&para;<br>* `"hookSpecificOutput.additionalContext"` adds the string to the context.&para;<br>* Multiple hooks' `additionalContext` values are concatenated.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "SessionStart",&para;<br>    "additionalContext": "My additional context here"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### `SessionEnd` Decision Control&para;<br>&para;<br>`SessionEnd` hooks run when a session ends. They cannot block session termination&para;<br>but can perform cleanup tasks.&para;<br>&para;<br>#### Exit Code Example: Bash Command Validation&para;<br>&para;<br>```python  theme={null}&para;<br>#!/usr/bin/env python3&para;<br>import json&para;<br>import re&para;<br>import sys&para;<br>&para;<br># Define validation rules as a list of (regex pattern, message) tuples&para;<br>VALIDATION_RULES = [&para;<br>    (&para;<br>        r"\bgrep\b(?!.*\|)",&para;<br>        "Use 'rg' (ripgrep) instead of 'grep' for better performance and features",&para;<br>    ),&para;<br>    (&para;<br>        r"\bfind\s+\S+\s+-name\b",&para;<br>        "Use 'rg --files | rg pattern' or 'rg --files -g pattern' instead of 'find -name' for better performance",&para;<br>    ),&para;<br>]&para;<br>&para;<br>&para;<br>def validate_command(command: str) -&gt; list[str]:&para;<br>    issues = []&para;<br>    for pattern, message in VALIDATION_RULES:&para;<br>        if re.search(pattern, command):&para;<br>            issues.append(message)&para;<br>    return issues&para;<br>&para;<br>&para;<br>try:&para;<br>    input_data = json.load(sys.stdin)&para;<br>except json.JSONDecodeError as e:&para;<br>    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)&para;<br>    sys.exit(1)&para;<br>&para;<br>tool_name = input_data.get("tool_name", "")&para;<br>tool_input = input_data.get("tool_input", {})&para;<br>command = tool_input.get("command", "")&para;<br>&para;<br>if tool_name != "Bash" or not command:&para;<br>    sys.exit(1)&para;<br>&para;<br># Validate the command&para;<br>issues = validate_command(command)&para;<br>&para;<br>if issues:&para;<br>    for message in issues:&para;<br>        print(f"• {message}", file=sys.stderr)&para;<br>    # Exit code 2 blocks tool call and shows stderr to Claude&para;<br>    sys.exit(2)&para;<br>```&para;<br>&para;<br>#### JSON Output Example: UserPromptSubmit to Add Context and Validation&para;<br>&para;<br>&lt;Note&gt;&para;<br>  For `UserPromptSubmit` hooks, you can inject context using either method:&para;<br>&para;<br>  * **Plain text stdout** with exit code 0: Simplest approach, prints text&para;<br>  * **JSON output** with exit code 0: Use `"decision": "block"` to reject prompts,&para;<br>    or `additionalContext` for structured context injection&para;<br>&para;<br>  Remember: Exit code 2 only uses `stderr` for the error message. To block using&para;<br>  JSON (with a custom reason), use `"decision": "block"` with exit code 0.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>```python  theme={null}&para;<br>#!/usr/bin/env python3&para;<br>import json&para;<br>import sys&para;<br>import re&para;<br>import datetime&para;<br>&para;<br># Load input from stdin&para;<br>try:&para;<br>    input_data = json.load(sys.stdin)&para;<br>except json.JSONDecodeError as e:&para;<br>    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)&para;<br>    sys.exit(1)&para;<br>&para;<br>prompt = input_data.get("prompt", "")&para;<br>&para;<br># Check for sensitive patterns&para;<br>sensitive_patterns = [&para;<br>    (r"(?i)\b(password|secret|key|token)\s*[:=]", "Prompt contains potential secrets"),&para;<br>]&para;<br>&para;<br>for pattern, message in sensitive_patterns:&para;<br>    if re.search(pattern, prompt):&para;<br>        # Use JSON output to block with a specific reason&para;<br>        output = {&para;<br>            "decision": "block",&para;<br>            "reason": f"Security policy violation: {message}. Please rephrase your request without sensitive information."&para;<br>        }&para;<br>        print(json.dumps(output))&para;<br>        sys.exit(0)&para;<br>&para;<br># Add current time to context&para;<br>context = f"Current time: {datetime.datetime.now()}"&para;<br>print(context)&para;<br>&para;<br>"""&para;<br>The following is also equivalent:&para;<br>print(json.dumps({&para;<br>  "hookSpecificOutput": {&para;<br>    "hookEventName": "UserPromptSubmit",&para;<br>    "additionalContext": context,&para;<br>  },&para;<br>}))&para;<br>"""&para;<br>&para;<br># Allow the prompt to proceed with the additional context&para;<br>sys.exit(0)&para;<br>```&para;<br>&para;<br>#### JSON Output Example: PreToolUse with Approval&para;<br>&para;<br>```python  theme={null}&para;<br>#!/usr/bin/env python3&para;<br>import json&para;<br>import sys&para;<br>&para;<br># Load input from stdin&para;<br>try:&para;<br>    input_data = json.load(sys.stdin)&para;<br>except json.JSONDecodeError as e:&para;<br>    print(f"Error: Invalid JSON input: {e}", file=sys.stderr)&para;<br>    sys.exit(1)&para;<br>&para;<br>tool_name = input_data.get("tool_name", "")&para;<br>tool_input = input_data.get("tool_input", {})&para;<br>&para;<br># Example: Auto-approve file reads for documentation files&para;<br>if tool_name == "Read":&para;<br>    file_path = tool_input.get("file_path", "")&para;<br>    if file_path.endswith((".md", ".mdx", ".txt", ".json")):&para;<br>        # Use JSON output to auto-approve the tool call&para;<br>        output = {&para;<br>            "decision": "approve",&para;<br>            "reason": "Documentation file auto-approved",&para;<br>            "suppressOutput": True  # Don't show in verbose mode&para;<br>        }&para;<br>        print(json.dumps(output))&para;<br>        sys.exit(0)&para;<br>&para;<br># For other cases, let the normal permission flow proceed&para;<br>sys.exit(0)&para;<br>```&para;<br>&para;<br>## Working with MCP Tools&para;<br>&para;<br>Claude Code hooks work seamlessly with&para;<br>[Model Context Protocol (MCP) tools](/en/mcp). When MCP servers&para;<br>provide tools, they appear with a special naming pattern that you can match in&para;<br>your hooks.&para;<br>&para;<br>### MCP Tool Naming&para;<br>&para;<br>MCP tools follow the pattern `mcp__&lt;server&gt;__&lt;tool&gt;`, for example:&para;<br>&para;<br>* `mcp__memory__create_entities` - Memory server's create entities tool&para;<br>* `mcp__filesystem__read_file` - Filesystem server's read file tool&para;<br>* `mcp__github__search_repositories` - GitHub server's search tool&para;<br>&para;<br>### Configuring Hooks for MCP Tools&para;<br>&para;<br>You can target specific MCP tools or entire MCP servers:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "PreToolUse": [&para;<br>      {&para;<br>        "matcher": "mcp__memory__.*",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "echo 'Memory operation initiated' &gt;&gt; ~/mcp-operations.log"&para;<br>          }&para;<br>        ]&para;<br>      },&para;<br>      {&para;<br>        "matcher": "mcp__.*__write.*",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "/home/user/scripts/validate-mcp-write.py"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>## Examples&para;<br>&para;<br>&lt;Tip&gt;&para;<br>  For practical examples including code formatting, notifications, and file protection, see [More Examples](/en/hooks-guide#more-examples) in the get started guide.&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>## Security Considerations&para;<br>&para;<br>### Disclaimer&para;<br>&para;<br>**USE AT YOUR OWN RISK**: Claude Code hooks execute arbitrary shell commands on&para;<br>your system automatically. By using hooks, you acknowledge that:&para;<br>&para;<br>* You are solely responsible for the commands you configure&para;<br>* Hooks can modify, delete, or access any files your user account can access&para;<br>* Malicious or poorly written hooks can cause data loss or system damage&para;<br>* Anthropic provides no warranty and assumes no liability for any damages&para;<br>  resulting from hook usage&para;<br>* You should thoroughly test hooks in a safe environment before production use&para;<br>&para;<br>Always review and understand any hook commands before adding them to your&para;<br>configuration.&para;<br>&para;<br>### Security Best Practices&para;<br>&para;<br>Here are some key practices for writing more secure hooks:&para;<br>&para;<br>1. **Validate and sanitize inputs** - Never trust input data blindly&para;<br>2. **Always quote shell variables** - Use `"$VAR"` not `$VAR`&para;<br>3. **Block path traversal** - Check for `..` in file paths&para;<br>4. **Use absolute paths** - Specify full paths for scripts (use&para;<br>   "\$CLAUDE\_PROJECT\_DIR" for the project path)&para;<br>5. **Skip sensitive files** - Avoid `.env`, `.git/`, keys, etc.&para;<br>&para;<br>### Configuration Safety&para;<br>&para;<br>Direct edits to hooks in settings files don't take effect immediately. Claude&para;<br>Code:&para;<br>&para;<br>1. Captures a snapshot of hooks at startup&para;<br>2. Uses this snapshot throughout the session&para;<br>3. Warns if hooks are modified externally&para;<br>4. Requires review in `/hooks` menu for changes to apply&para;<br>&para;<br>This prevents malicious hook modifications from affecting your current session.&para;<br>&para;<br>## Hook Execution Details&para;<br>&para;<br>* **Timeout**: 60-second execution limit by default, configurable per command.&para;<br>  * A timeout for an individual command does not affect the other commands.&para;<br>* **Parallelization**: All matching hooks run in parallel&para;<br>* **Deduplication**: Multiple identical hook commands are deduplicated automatically&para;<br>* **Environment**: Runs in current directory with Claude Code's environment&para;<br>  * The `CLAUDE_PROJECT_DIR` environment variable is available and contains the&para;<br>    absolute path to the project root directory (where Claude Code was started)&para;<br>  * The `CLAUDE_CODE_REMOTE` environment variable indicates whether the hook is running in a remote (web) environment (`"true"`) or local CLI environment (not set or empty). Use this to run different logic based on execution context.&para;<br>* **Input**: JSON via stdin&para;<br>* **Output**:&para;<br>  * PreToolUse/PermissionRequest/PostToolUse/Stop/SubagentStop: Progress shown in verbose mode (ctrl+o)&para;<br>  * Notification/SessionEnd: Logged to debug only (`--debug`)&para;<br>  * UserPromptSubmit/SessionStart: stdout added as context for Claude&para;<br>&para;<br>## Debugging&para;<br>&para;<br>### Basic Troubleshooting&para;<br>&para;<br>If your hooks aren't working:&para;<br>&para;<br>1. **Check configuration** - Run `/hooks` to see if your hook is registered&para;<br>2. **Verify syntax** - Ensure your JSON settings are valid&para;<br>3. **Test commands** - Run hook commands manually first&para;<br>4. **Check permissions** - Make sure scripts are executable&para;<br>5. **Review logs** - Use `claude --debug` to see hook execution details&para;<br>&para;<br>Common issues:&para;<br>&para;<br>* **Quotes not escaped** - Use `\"` inside JSON strings&para;<br>* **Wrong matcher** - Check tool names match exactly (case-sensitive)&para;<br>* **Command not found** - Use full paths for scripts&para;<br>&para;<br>### Advanced Debugging&para;<br>&para;<br>For complex hook issues:&para;<br>&para;<br>1. **Inspect hook execution** - Use `claude --debug` to see detailed hook&para;<br>   execution&para;<br>2. **Validate JSON schemas** - Test hook input/output with external tools&para;<br>3. **Check environment variables** - Verify Claude Code's environment is correct&para;<br>4. **Test edge cases** - Try hooks with unusual file paths or inputs&para;<br>5. **Monitor system resources** - Check for resource exhaustion during hook&para;<br>   execution&para;<br>6. **Use structured logging** - Implement logging in your hook scripts&para;<br>&para;<br>### Debug Output Example&para;<br>&para;<br>Use `claude --debug` to see hook execution details:&para;<br>&para;<br>```&para;<br>[DEBUG] Executing hooks for PostToolUse:Write&para;<br>[DEBUG] Getting matching hook commands for PostToolUse with query: Write&para;<br>[DEBUG] Found 1 hook matchers in settings&para;<br>[DEBUG] Matched 1 hooks for query "Write"&para;<br>[DEBUG] Found 1 hook commands to execute&para;<br>[DEBUG] Executing hook command: &lt;Your command&gt; with timeout 60000ms&para;<br>[DEBUG] Hook command completed with status 0: &lt;Your stdout&gt;&para;<br>```&para;<br>&para;<br>Progress messages appear in verbose mode (ctrl+o) showing:&para;<br>&para;<br>* Which hook is running&para;<br>* Command being executed&para;<br>* Success/failure status&para;<br>* Output or error messages&para;<br>&para;<br>&para;<br>---&para;<br>&para;<br>&gt; To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt</span></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/hooks.md
+++ b/hooks.md
@@ -502,7 +502,37 @@
 
 ### PreToolUse Input
 
-The exact schema for `tool_input` depends on the tool.
+The exact schema for `tool_input` depends on the tool. Here are examples for commonly hooked tools.
+
+#### Bash tool
+
+The Bash tool is the most commonly hooked tool for command validation:
+
+```json  theme={null}
+{
+  &#34;session_id&#34;: &#34;abc123&#34;,
+  &#34;transcript_path&#34;: &#34;/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl&#34;,
+  &#34;cwd&#34;: &#34;/Users/...&#34;,
+  &#34;permission_mode&#34;: &#34;default&#34;,
+  &#34;hook_event_name&#34;: &#34;PreToolUse&#34;,
+  &#34;tool_name&#34;: &#34;Bash&#34;,
+  &#34;tool_input&#34;: {
+    &#34;command&#34;: &#34;psql -c &#39;SELECT * FROM users&#39;&#34;,
+    &#34;description&#34;: &#34;Query the users table&#34;,
+    &#34;timeout&#34;: 120000
+  },
+  &#34;tool_use_id&#34;: &#34;toolu_01ABC123...&#34;
+}
+```
+
+| Field               | Type    | Description                                   |
+| :------------------ | :------ | :-------------------------------------------- |
+| `command`           | string  | The shell command to execute                  |
+| `description`       | string  | Optional description of what the command does |
+| `timeout`           | number  | Optional timeout in milliseconds              |
+| `run_in_background` | boolean | Whether to run the command in background      |
+
+#### Write tool
 
 ```json  theme={null}
 {
@@ -519,6 +549,60 @@
   &#34;tool_use_id&#34;: &#34;toolu_01ABC123...&#34;
 }
 ```
+
+| Field       | Type   | Description                        |
+| :---------- | :----- | :--------------------------------- |
+| `file_path` | string | Absolute path to the file to write |
+| `content`   | string | Content to write to the file       |
+
+#### Edit tool
+
+```json  theme={null}
+{
+  &#34;session_id&#34;: &#34;abc123&#34;,
+  &#34;transcript_path&#34;: &#34;/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl&#34;,
+  &#34;cwd&#34;: &#34;/Users/...&#34;,
+  &#34;permission_mode&#34;: &#34;default&#34;,
+  &#34;hook_event_name&#34;: &#34;PreToolUse&#34;,
+  &#34;tool_name&#34;: &#34;Edit&#34;,
+  &#34;tool_input&#34;: {
+    &#34;file_path&#34;: &#34;/path/to/file.txt&#34;,
+    &#34;old_string&#34;: &#34;original text&#34;,
+    &#34;new_string&#34;: &#34;replacement text&#34;
+  },
+  &#34;tool_use_id&#34;: &#34;toolu_01ABC123...&#34;
+}
+```
+
+| Field         | Type    | Description                                         |
+| :------------ | :------ | :-------------------------------------------------- |
+| `file_path`   | string  | Absolute path to the file to edit                   |
+| `old_string`  | string  | Text to find and replace                            |
+| `new_string`  | string  | Replacement text                                    |
+| `replace_all` | boolean | Whether to replace all occurrences (default: false) |
+
+#### Read tool
+
+```json  theme={null}
+{
+  &#34;session_id&#34;: &#34;abc123&#34;,
+  &#34;transcript_path&#34;: &#34;/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl&#34;,
+  &#34;cwd&#34;: &#34;/Users/...&#34;,
+  &#34;permission_mode&#34;: &#34;default&#34;,
+  &#34;hook_event_name&#34;: &#34;PreToolUse&#34;,
+  &#34;tool_name&#34;: &#34;Read&#34;,
+  &#34;tool_input&#34;: {
+    &#34;file_path&#34;: &#34;/path/to/file.txt&#34;
+  },
+  &#34;tool_use_id&#34;: &#34;toolu_01ABC123...&#34;
+}
+```
+
+| Field       | Type   | Description                                |
+| :---------- | :----- | :----------------------------------------- |
+| `file_path` | string | Absolute path to the file to read          |
+| `offset`    | number | Optional line number to start reading from |
+| `limit`     | number | Optional number of lines to read           |
 
 ### PostToolUse Input
 
</code></pre>
    </div>
</body>
</html>