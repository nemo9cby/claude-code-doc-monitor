<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>plugins-reference - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>plugins-reference.md</h1>
            <p class="meta">Changed on 2026-01-03</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+453</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Plugins reference&para;<br>&para;<br>&gt; Complete technical reference for Claude Code plugin system, including schemas, CLI commands, and component specifications.&para;<br>&para;<br>&lt;Tip&gt;&para;<br>  Looking to install plugins? See [Discover and install plugins](/en/discover-plugins). For creating plugins, see [Plugins](/en/plugins). For distributing plugins, see [Plugin marketplaces](/en/plugin-marketplaces).&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>This reference provides complete technical specifications for the Claude Code plugin system, including component schemas, CLI commands, and development tools.&para;<br>&para;<br>## Plugin components reference&para;<br>&para;<br>This section documents the five types of components that plugins can provide.&para;<br>&para;<br>### Commands&para;<br>&para;<br>Plugins add custom slash commands that integrate seamlessly with Claude Code's command system.&para;<br>&para;<br>**Location**: `commands/` directory in plugin root&para;<br>&para;<br>**File format**: Markdown files with frontmatter&para;<br>&para;<br>For complete details on plugin command structure, invocation patterns, and features, see [Plugin commands](/en/slash-commands#plugin-commands).&para;<br>&para;<br>### Agents&para;<br>&para;<br>Plugins can provide specialized subagents for specific tasks that Claude can invoke automatically when appropriate.&para;<br>&para;<br>**Location**: `agents/` directory in plugin root&para;<br>&para;<br>**File format**: Markdown files describing agent capabilities&para;<br>&para;<br>**Agent structure**:&para;<br>&para;<br>```markdown  theme={null}&para;<br>---&para;<br>description: What this agent specializes in&para;<br>capabilities: ["task1", "task2", "task3"]&para;<br>---&para;<br>&para;<br># Agent Name&para;<br>&para;<br>Detailed description of the agent's role, expertise, and when Claude should invoke it.&para;<br>&para;<br>## Capabilities&para;<br>- Specific task the agent excels at&para;<br>- Another specialized capability&para;<br>- When to use this agent vs others&para;<br>&para;<br>## Context and examples&para;<br>Provide examples of when this agent should be used and what kinds of problems it solves.&para;<br>```&para;<br>&para;<br>**Integration points**:&para;<br>&para;<br>* Agents appear in the `/agents` interface&para;<br>* Claude can invoke agents automatically based on task context&para;<br>* Agents can be invoked manually by users&para;<br>* Plugin agents work alongside built-in Claude agents&para;<br>&para;<br>### Skills&para;<br>&para;<br>Plugins can provide Agent Skills that extend Claude's capabilities. Skills are model-invoked—Claude autonomously decides when to use them based on the task context.&para;<br>&para;<br>**Location**: `skills/` directory in plugin root&para;<br>&para;<br>**File format**: Directories containing `SKILL.md` files with frontmatter&para;<br>&para;<br>**Skill structure**:&para;<br>&para;<br>```&para;<br>skills/&para;<br>├── pdf-processor/&para;<br>│   ├── SKILL.md&para;<br>│   ├── reference.md (optional)&para;<br>│   └── scripts/ (optional)&para;<br>└── code-reviewer/&para;<br>    └── SKILL.md&para;<br>```&para;<br>&para;<br>**Integration behavior**:&para;<br>&para;<br>* Plugin Skills are automatically discovered when the plugin is installed&para;<br>* Claude autonomously invokes Skills based on matching task context&para;<br>* Skills can include supporting files alongside SKILL.md&para;<br>&para;<br>For SKILL.md format and complete Skill authoring guidance, see:&para;<br>&para;<br>* [Use Skills in Claude Code](/en/skills)&para;<br>* [Agent Skills overview](https://docs.claude.com/en/docs/agents-and-tools/agent-skills/overview#skill-structure)&para;<br>&para;<br>### Hooks&para;<br>&para;<br>Plugins can provide event handlers that respond to Claude Code events automatically.&para;<br>&para;<br>**Location**: `hooks/hooks.json` in plugin root, or inline in plugin.json&para;<br>&para;<br>**Format**: JSON configuration with event matchers and actions&para;<br>&para;<br>**Hook configuration**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "PostToolUse": [&para;<br>      {&para;<br>        "matcher": "Write|Edit",&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/format-code.sh"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**Available events**:&para;<br>&para;<br>* `PreToolUse`: Before Claude uses any tool&para;<br>* `PostToolUse`: After Claude successfully uses any tool&para;<br>* `PostToolUseFailure`: After Claude tool execution fails&para;<br>* `PermissionRequest`: When a permission dialog is shown&para;<br>* `UserPromptSubmit`: When user submits a prompt&para;<br>* `Notification`: When Claude Code sends notifications&para;<br>* `Stop`: When Claude attempts to stop&para;<br>* `SubagentStart`: When a subagent is started&para;<br>* `SubagentStop`: When a subagent attempts to stop&para;<br>* `SessionStart`: At the beginning of sessions&para;<br>* `SessionEnd`: At the end of sessions&para;<br>* `PreCompact`: Before conversation history is compacted&para;<br>&para;<br>**Hook types**:&para;<br>&para;<br>* `command`: Execute shell commands or scripts&para;<br>* `prompt`: Evaluate a prompt with an LLM (uses `$ARGUMENTS` placeholder for context)&para;<br>* `agent`: Run an agentic verifier with tools for complex verification tasks&para;<br>&para;<br>### MCP servers&para;<br>&para;<br>Plugins can bundle Model Context Protocol (MCP) servers to connect Claude Code with external tools and services.&para;<br>&para;<br>**Location**: `.mcp.json` in plugin root, or inline in plugin.json&para;<br>&para;<br>**Format**: Standard MCP server configuration&para;<br>&para;<br>**MCP server configuration**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "mcpServers": {&para;<br>    "plugin-database": {&para;<br>      "command": "${CLAUDE_PLUGIN_ROOT}/servers/db-server",&para;<br>      "args": ["--config", "${CLAUDE_PLUGIN_ROOT}/config.json"],&para;<br>      "env": {&para;<br>        "DB_PATH": "${CLAUDE_PLUGIN_ROOT}/data"&para;<br>      }&para;<br>    },&para;<br>    "plugin-api-client": {&para;<br>      "command": "npx",&para;<br>      "args": ["@company/mcp-server", "--plugin-mode"],&para;<br>      "cwd": "${CLAUDE_PLUGIN_ROOT}"&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**Integration behavior**:&para;<br>&para;<br>* Plugin MCP servers start automatically when the plugin is enabled&para;<br>* Servers appear as standard MCP tools in Claude's toolkit&para;<br>* Server capabilities integrate seamlessly with Claude's existing tools&para;<br>* Plugin servers can be configured independently of user MCP servers&para;<br>&para;<br>### LSP servers&para;<br>&para;<br>&lt;Tip&gt;&para;<br>  Looking to use LSP plugins? Install them from the official marketplace—search for "lsp" in the `/plugin` Discover tab. This section documents how to create LSP plugins for languages not covered by the official marketplace.&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>Plugins can provide [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) (LSP) servers to give Claude real-time code intelligence while working on your codebase.&para;<br>&para;<br>LSP integration provides:&para;<br>&para;<br>* **Instant diagnostics**: Claude sees errors and warnings immediately after each edit&para;<br>* **Code navigation**: go to definition, find references, and hover information&para;<br>* **Language awareness**: type information and documentation for code symbols&para;<br>&para;<br>**Location**: `.lsp.json` in plugin root, or inline in `plugin.json`&para;<br>&para;<br>**Format**: JSON configuration mapping language server names to their configurations&para;<br>&para;<br>**`.lsp.json` file format**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "go": {&para;<br>    "command": "gopls",&para;<br>    "args": ["serve"],&para;<br>    "extensionToLanguage": {&para;<br>      ".go": "go"&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**Inline in `plugin.json`**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "name": "my-plugin",&para;<br>  "lspServers": {&para;<br>    "go": {&para;<br>      "command": "gopls",&para;<br>      "args": ["serve"],&para;<br>      "extensionToLanguage": {&para;<br>        ".go": "go"&para;<br>      }&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**Required fields:**&para;<br>&para;<br>| Field                 | Description                                  |&para;<br>| :-------------------- | :------------------------------------------- |&para;<br>| `command`             | The LSP binary to execute (must be in PATH)  |&para;<br>| `extensionToLanguage` | Maps file extensions to language identifiers |&para;<br>&para;<br>**Optional fields:**&para;<br>&para;<br>| Field                   | Description                                               |&para;<br>| :---------------------- | :-------------------------------------------------------- |&para;<br>| `args`                  | Command-line arguments for the LSP server                 |&para;<br>| `transport`             | Communication transport: `stdio` (default) or `socket`    |&para;<br>| `env`                   | Environment variables to set when starting the server     |&para;<br>| `initializationOptions` | Options passed to the server during initialization        |&para;<br>| `settings`              | Settings passed via `workspace/didChangeConfiguration`    |&para;<br>| `workspaceFolder`       | Workspace folder path for the server                      |&para;<br>| `startupTimeout`        | Max time to wait for server startup (milliseconds)        |&para;<br>| `shutdownTimeout`       | Max time to wait for graceful shutdown (milliseconds)     |&para;<br>| `restartOnCrash`        | Whether to automatically restart the server if it crashes |&para;<br>| `maxRestarts`           | Maximum number of restart attempts before giving up       |&para;<br>| `loggingConfig`         | Debug logging configuration (see below)                   |&para;<br>&para;<br>**Debug logging configuration:**&para;<br>&para;<br>The `loggingConfig` field enables verbose LSP logging when users pass `--enable-lsp-logging`. This helps debug language server issues without impacting normal operation.&para;<br>&para;<br>```json  theme={null}&para;<br>"loggingConfig": {&para;<br>  "args": ["--log-level", "4"],&para;<br>  "env": {&para;<br>    "TSS_LOG": "-level verbose -file ${CLAUDE_PLUGIN_LSP_LOG_FILE}"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>| Field  | Description                                                        |&para;<br>| :----- | :----------------------------------------------------------------- |&para;<br>| `args` | Additional command-line arguments appended when logging is enabled |&para;<br>| `env`  | Additional environment variables merged when logging is enabled    |&para;<br>&para;<br>The `${CLAUDE_PLUGIN_LSP_LOG_FILE}` variable expands to the log file path. Logs are written to `~/.claude/debug/`.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>  **You must install the language server binary separately.** LSP plugins configure how Claude Code connects to a language server, but they don't include the server itself. If you see `Executable not found in $PATH` in the `/plugin` Errors tab, install the required binary for your language.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>**Available LSP plugins:**&para;<br>&para;<br>| Plugin           | Language server            | Install command                                                                            |&para;<br>| :--------------- | :------------------------- | :----------------------------------------------------------------------------------------- |&para;<br>| `pyright-lsp`    | Pyright (Python)           | `pip install pyright` or `npm install -g pyright`                                          |&para;<br>| `typescript-lsp` | TypeScript Language Server | `npm install -g typescript-language-server typescript`                                     |&para;<br>| `rust-lsp`       | rust-analyzer              | [See rust-analyzer installation](https://rust-analyzer.github.io/manual.html#installation) |&para;<br>&para;<br>Install the language server first, then install the plugin from the marketplace.&para;<br>&para;<br>***&para;<br>&para;<br>## Plugin installation scopes&para;<br>&para;<br>When you install a plugin, you choose a **scope** that determines where the plugin is available and who else can use it:&para;<br>&para;<br>| Scope     | Settings file                 | Use case                                                 |&para;<br>| :-------- | :---------------------------- | :------------------------------------------------------- |&para;<br>| `user`    | `~/.claude/settings.json`     | Personal plugins available across all projects (default) |&para;<br>| `project` | `.claude/settings.json`       | Team plugins shared via version control                  |&para;<br>| `local`   | `.claude/settings.local.json` | Project-specific plugins, gitignored                     |&para;<br>| `managed` | `managed-settings.json`       | Enterprise-managed plugins (read-only, update only)      |&para;<br>&para;<br>Plugins use the same scope system as other Claude Code configurations. For installation instructions and scope flags, see [Install plugins](/en/discover-plugins#install-plugins). For a complete explanation of scopes, see [Configuration scopes](/en/settings#configuration-scopes).&para;<br>&para;<br>***&para;<br>&para;<br>## Plugin manifest schema&para;<br>&para;<br>The `plugin.json` file defines your plugin's metadata and configuration. This section documents all supported fields and options.&para;<br>&para;<br>### Complete schema&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "name": "plugin-name",&para;<br>  "version": "1.2.0",&para;<br>  "description": "Brief plugin description",&para;<br>  "author": {&para;<br>    "name": "Author Name",&para;<br>    "email": "author@example.com",&para;<br>    "url": "https://github.com/author"&para;<br>  },&para;<br>  "homepage": "https://docs.example.com/plugin",&para;<br>  "repository": "https://github.com/author/plugin",&para;<br>  "license": "MIT",&para;<br>  "keywords": ["keyword1", "keyword2"],&para;<br>  "commands": ["./custom/commands/special.md"],&para;<br>  "agents": "./custom/agents/",&para;<br>  "skills": "./custom/skills/",&para;<br>  "hooks": "./config/hooks.json",&para;<br>  "mcpServers": "./mcp-config.json",&para;<br>  "outputStyles": "./styles/",&para;<br>  "lspServers": "./.lsp.json"&para;<br>}&para;<br>```&para;<br>&para;<br>### Required fields&para;<br>&para;<br>| Field  | Type   | Description                               | Example              |&para;<br>| :----- | :----- | :---------------------------------------- | :------------------- |&para;<br>| `name` | string | Unique identifier (kebab-case, no spaces) | `"deployment-tools"` |&para;<br>&para;<br>### Metadata fields&para;<br>&para;<br>| Field         | Type   | Description                         | Example                                            |&para;<br>| :------------ | :----- | :---------------------------------- | :------------------------------------------------- |&para;<br>| `version`     | string | Semantic version                    | `"2.1.0"`                                          |&para;<br>| `description` | string | Brief explanation of plugin purpose | `"Deployment automation tools"`                    |&para;<br>| `author`      | object | Author information                  | `{"name": "Dev Team", "email": "dev@company.com"}` |&para;<br>| `homepage`    | string | Documentation URL                   | `"https://docs.example.com"`                       |&para;<br>| `repository`  | string | Source code URL                     | `"https://github.com/user/plugin"`                 |&para;<br>| `license`     | string | License identifier                  | `"MIT"`, `"Apache-2.0"`                            |&para;<br>| `keywords`    | array  | Discovery tags                      | `["deployment", "ci-cd"]`                          |&para;<br>&para;<br>### Component path fields&para;<br>&para;<br>| Field          | Type           | Description                                                                                                                                              | Example                                |&para;<br>| :------------- | :------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------- |&para;<br>| `commands`     | string\|array  | Additional command files/directories                                                                                                                     | `"./custom/cmd.md"` or `["./cmd1.md"]` |&para;<br>| `agents`       | string\|array  | Additional agent files                                                                                                                                   | `"./custom/agents/"`                   |&para;<br>| `skills`       | string\|array  | Additional skill directories                                                                                                                             | `"./custom/skills/"`                   |&para;<br>| `hooks`        | string\|object | Hook config path or inline config                                                                                                                        | `"./hooks.json"`                       |&para;<br>| `mcpServers`   | string\|object | MCP config path or inline config                                                                                                                         | `"./mcp-config.json"`                  |&para;<br>| `outputStyles` | string\|array  | Additional output style files/directories                                                                                                                | `"./styles/"`                          |&para;<br>| `lspServers`   | string\|object | [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) config for code intelligence (go to definition, find references, etc.) | `"./.lsp.json"`                        |&para;<br>&para;<br>### Path behavior rules&para;<br>&para;<br>**Important**: Custom paths supplement default directories - they don't replace them.&para;<br>&para;<br>* If `commands/` exists, it's loaded in addition to custom command paths&para;<br>* All paths must be relative to plugin root and start with `./`&para;<br>* Commands from custom paths use the same naming and namespacing rules&para;<br>* Multiple paths can be specified as arrays for flexibility&para;<br>&para;<br>**Path examples**:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "commands": [&para;<br>    "./specialized/deploy.md",&para;<br>    "./utilities/batch-process.md"&para;<br>  ],&para;<br>  "agents": [&para;<br>    "./custom-agents/reviewer.md",&para;<br>    "./custom-agents/tester.md"&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>### Environment variables&para;<br>&para;<br>**`${CLAUDE_PLUGIN_ROOT}`**: Contains the absolute path to your plugin directory. Use this in hooks, MCP servers, and scripts to ensure correct paths regardless of installation location.&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "hooks": {&para;<br>    "PostToolUse": [&para;<br>      {&para;<br>        "hooks": [&para;<br>          {&para;<br>            "type": "command",&para;<br>            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/process.sh"&para;<br>          }&para;<br>        ]&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>***&para;<br>&para;<br>## Plugin caching and file resolution&para;<br>&para;<br>For security and verification purposes, Claude Code copies plugins to a cache directory rather than using them in-place. Understanding this behavior is important when developing plugins that reference external files.&para;<br>&para;<br>### How plugin caching works&para;<br>&para;<br>When you install a plugin, Claude Code copies the plugin files to a cache directory:&para;<br>&para;<br>* **For marketplace plugins with relative paths**: The path specified in the `source` field is copied recursively. For example, if your marketplace entry specifies `"source": "./plugins/my-plugin"`, the entire `./plugins` directory is copied.&para;<br>* **For plugins with `.claude-plugin/plugin.json`**: The implicit root directory (the directory containing `.claude-plugin/plugin.json`) is copied recursively.&para;<br>&para;<br>### Path traversal limitations&para;<br>&para;<br>Plugins cannot reference files outside their copied directory structure. Paths that traverse outside the plugin root (such as `../shared-utils`) will not work after installation because those external files are not copied to the cache.&para;<br>&para;<br>### Working with external dependencies&para;<br>&para;<br>If your plugin needs to access files outside its directory, you have two options:&para;<br>&para;<br>**Option 1: Use symlinks**&para;<br>&para;<br>Create symbolic links to external files within your plugin directory. Symlinks are honored during the copy process:&para;<br>&para;<br>```bash  theme={null}&para;<br># Inside your plugin directory&para;<br>ln -s /path/to/shared-utils ./shared-utils&para;<br>```&para;<br>&para;<br>The symlinked content will be copied into the plugin cache.&para;<br>&para;<br>**Option 2: Restructure your marketplace**&para;<br>&para;<br>Set the plugin path to a parent directory that contains all required files, then provide the rest of the plugin manifest directly in the marketplace entry:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "name": "my-plugin",&para;<br>  "source": "./",&para;<br>  "description": "Plugin that needs root-level access",&para;<br>  "commands": ["./plugins/my-plugin/commands/"],&para;<br>  "agents": ["./plugins/my-plugin/agents/"],&para;<br>  "strict": false&para;<br>}&para;<br>```&para;<br>&para;<br>This approach copies the entire marketplace root, giving your plugin access to sibling directories.&para;<br>&para;<br>&lt;Note&gt;&para;<br>  Symlinks that point to locations outside the plugin's logical root are followed during copying. This provides flexibility while maintaining the security benefits of the caching system.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>***&para;<br>&para;<br>## Plugin directory structure&para;<br>&para;<br>### Standard plugin layout&para;<br>&para;<br>A complete plugin follows this structure:&para;<br>&para;<br>```&para;<br>enterprise-plugin/&para;<br>├── .claude-plugin/           # Metadata directory&para;<br>│   └── plugin.json          # Required: plugin manifest&para;<br>├── commands/                 # Default command location&para;<br>│   ├── status.md&para;<br>│   └── logs.md&para;<br>├── agents/                   # Default agent location&para;<br>│   ├── security-reviewer.md&para;<br>│   ├── performance-tester.md&para;<br>│   └── compliance-checker.md&para;<br>├── skills/                   # Agent Skills&para;<br>│   ├── code-reviewer/&para;<br>│   │   └── SKILL.md&para;<br>│   └── pdf-processor/&para;<br>│       ├── SKILL.md&para;<br>│       └── scripts/&para;<br>├── hooks/                    # Hook configurations&para;<br>│   ├── hooks.json           # Main hook config&para;<br>│   └── security-hooks.json  # Additional hooks&para;<br>├── .mcp.json                # MCP server definitions&para;<br>├── .lsp.json                # LSP server configurations&para;<br>├── scripts/                 # Hook and utility scripts&para;<br>│   ├── security-scan.sh&para;<br>│   ├── format-code.py&para;<br>│   └── deploy.js&para;<br>├── LICENSE                  # License file&para;<br>└── CHANGELOG.md             # Version history&para;<br>```&para;<br>&para;<br>&lt;Warning&gt;&para;<br>  The `.claude-plugin/` directory contains the `plugin.json` file. All other directories (commands/, agents/, skills/, hooks/) must be at the plugin root, not inside `.claude-plugin/`.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>### File locations reference&para;<br>&para;<br>| Component       | Default Location             | Purpose                          |&para;<br>| :-------------- | :--------------------------- | :------------------------------- |&para;<br>| **Manifest**    | `.claude-plugin/plugin.json` | Required metadata file           |&para;<br>| **Commands**    | `commands/`                  | Slash command Markdown files     |&para;<br>| **Agents**      | `agents/`                    | Subagent Markdown files          |&para;<br>| **Skills**      | `skills/`                    | Agent Skills with SKILL.md files |&para;<br>| **Hooks**       | `hooks/hooks.json`           | Hook configuration               |&para;<br>| **MCP servers** | `.mcp.json`                  | MCP server definitions           |&para;<br>| **LSP servers** | `.lsp.json`                  | Language server configurations   |&para;<br>&para;<br>***&para;<br>&para;<br>## CLI commands reference&para;<br>&para;<br>Claude Code provides CLI commands for non-interactive plugin management, useful for scripting and automation.&para;<br>&para;<br>### plugin install&para;<br>&para;<br>Install a plugin from available marketplaces.&para;<br>&para;<br>```bash  theme={null}&para;<br>claude plugin install &lt;plugin&gt; [options]&para;<br>```&para;<br>&para;<br>**Arguments:**&para;<br>&para;<br>* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name` for a specific marketplace&para;<br>&para;<br>**Options:**&para;<br>&para;<br>| Option                | Description                                       | Default |&para;<br>| :-------------------- | :------------------------------------------------ | :------ |&para;<br>| `-s, --scope &lt;scope&gt;` | Installation scope: `user`, `project`, or `local` | `user`  |&para;<br>| `-h, --help`          | Display help for command                          |         |&para;<br>&para;<br>**Examples:**&para;<br>&para;<br>```bash  theme={null}&para;<br># Install to user scope (default)&para;<br>claude plugin install formatter@my-marketplace&para;<br>&para;<br># Install to project scope (shared with team)&para;<br>claude plugin install formatter@my-marketplace --scope project&para;<br>&para;<br># Install to local scope (gitignored)&para;<br>claude plugin install formatter@my-marketplace --scope local&para;<br>```&para;<br>&para;<br>### plugin uninstall&para;<br>&para;<br>Remove an installed plugin.&para;<br>&para;<br>```bash  theme={null}&para;<br>claude plugin uninstall &lt;plugin&gt; [options]&para;<br>```&para;<br>&para;<br>**Arguments:**&para;<br>&para;<br>* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`&para;<br>&para;<br>**Options:**&para;<br>&para;<br>| Option                | Description                                         | Default |&para;<br>| :-------------------- | :-------------------------------------------------- | :------ |&para;<br>| `-s, --scope &lt;scope&gt;` | Uninstall from scope: `user`, `project`, or `local` | `user`  |&para;<br>| `-h, --help`          | Display help for command                            |         |&para;<br>&para;<br>**Aliases:** `remove`, `rm`&para;<br>&para;<br>### plugin enable&para;<br>&para;<br>Enable a disabled plugin.&para;<br>&para;<br>```bash  theme={null}&para;<br>claude plugin enable &lt;plugin&gt; [options]&para;<br>```&para;<br>&para;<br>**Arguments:**&para;<br>&para;<br>* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`&para;<br>&para;<br>**Options:**&para;<br>&para;<br>| Option                | Description                                    | Default |&para;<br>| :-------------------- | :--------------------------------------------- | :------ |&para;<br>| `-s, --scope &lt;scope&gt;` | Scope to enable: `user`, `project`, or `local` | `user`  |&para;<br>| `-h, --help`          | Display help for command                       |         |&para;<br>&para;<br>### plugin disable&para;<br>&para;<br>Disable a plugin without uninstalling it.&para;<br>&para;<br>```bash  theme={null}&para;<br>claude plugin disable &lt;plugin&gt; [options]&para;<br>```&para;<br>&para;<br>**Arguments:**&para;<br>&para;<br>* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`&para;<br>&para;<br>**Options:**&para;<br>&para;<br>| Option                | Description                                     | Default |&para;<br>| :-------------------- | :---------------------------------------------- | :------ |&para;<br>| `-s, --scope &lt;scope&gt;` | Scope to disable: `user`, `project`, or `local` | `user`  |&para;<br>| `-h, --help`          | Display help for command                        |         |&para;<br>&para;<br>### plugin update&para;<br>&para;<br>Update a plugin to the latest version.&para;<br>&para;<br>```bash  theme={null}&para;<br>claude plugin update &lt;plugin&gt; [options]&para;<br>```&para;<br>&para;<br>**Arguments:**&para;<br>&para;<br>* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`&para;<br>&para;<br>**Options:**&para;<br>&para;<br>| Option                | Description                                               | Default |&para;<br>| :-------------------- | :-------------------------------------------------------- | :------ |&para;<br>| `-s, --scope &lt;scope&gt;` | Scope to update: `user`, `project`, `local`, or `managed` | `user`  |&para;<br>| `-h, --help`          | Display help for command                                  |         |&para;<br>&para;<br>***&para;<br>&para;<br>## Debugging and development tools&para;<br>&para;<br>### Debugging commands&para;<br>&para;<br>Use `claude --debug` to see plugin loading details:&para;<br>&para;<br>```bash  theme={null}&para;<br>claude --debug&para;<br>```&para;<br>&para;<br>This shows:&para;<br>&para;<br>* Which plugins are being loaded&para;<br>* Any errors in plugin manifests&para;<br>* Command, agent, and hook registration&para;<br>* MCP server initialization&para;<br>&para;<br>### Common issues&para;<br>&para;<br>| Issue                               | Cause                           | Solution                                                                          |&para;<br>| :---------------------------------- | :------------------------------ | :-------------------------------------------------------------------------------- |&para;<br>| Plugin not loading                  | Invalid `plugin.json`           | Validate JSON syntax with `claude plugin validate` or `/plugin validate`          |&para;<br>| Commands not appearing              | Wrong directory structure       | Ensure `commands/` at root, not in `.claude-plugin/`                              |&para;<br>| Hooks not firing                    | Script not executable           | Run `chmod +x script.sh`                                                          |&para;<br>| MCP server fails                    | Missing `${CLAUDE_PLUGIN_ROOT}` | Use variable for all plugin paths                                                 |&para;<br>| Path errors                         | Absolute paths used             | All paths must be relative and start with `./`                                    |&para;<br>| LSP `Executable not found in $PATH` | Language server not installed   | Install the binary (e.g., `npm install -g typescript-language-server typescript`) |&para;<br>&para;<br>### Example error messages&para;<br>&para;<br>**Manifest validation errors**:&para;<br>&para;<br>* `Invalid JSON syntax: Unexpected token } in JSON at position 142`: check for missing commas, extra commas, or unquoted strings&para;<br>* `Plugin has an invalid manifest file at .claude-plugin/plugin.json. Validation errors: name: Required`: a required field is missing&para;<br>* `Plugin has a corrupt manifest file at .claude-plugin/plugin.json. JSON parse error: ...`: JSON syntax error&para;<br>&para;<br>**Plugin loading errors**:&para;<br>&para;<br>* `Warning: No commands found in plugin my-plugin custom directory: ./cmds. Expected .md files or SKILL.md in subdirectories.`: command path exists but contains no valid command files&para;<br>* `Plugin directory not found at path: ./plugins/my-plugin. Check that the marketplace entry has the correct path.`: the `source` path in marketplace.json points to a non-existent directory&para;<br>* `Plugin my-plugin has conflicting manifests: both plugin.json and marketplace entry specify components.`: remove duplicate component definitions or set `strict: true` in marketplace entry&para;<br>&para;<br>### Hook troubleshooting&para;<br>&para;<br>**Hook script not executing**:&para;<br>&para;<br>1. Check the script is executable: `chmod +x ./scripts/your-script.sh`&para;<br>2. Verify the shebang line: First line should be `#!/bin/bash` or `#!/usr/bin/env bash`&para;<br>3. Check the path uses `${CLAUDE_PLUGIN_ROOT}`: `"command": "${CLAUDE_PLUGIN_ROOT}/scripts/your-script.sh"`&para;<br>4. Test the script manually: `./scripts/your-script.sh`&para;<br>&para;<br>**Hook not triggering on expected events**:&para;<br>&para;<br>1. Verify the event name is correct (case-sensitive): `PostToolUse`, not `postToolUse`&para;<br>2. Check the matcher pattern matches your tools: `"matcher": "Write|Edit"` for file operations&para;<br>3. Confirm the hook type is valid: `command`, `prompt`, or `agent`&para;<br>&para;<br>### MCP server troubleshooting&para;<br>&para;<br>**Server not starting**:&para;<br>&para;<br>1. Check the command exists and is executable&para;<br>2. Verify all paths use `${CLAUDE_PLUGIN_ROOT}` variable&para;<br>3. Check the MCP server logs: `claude --debug` shows initialization errors&para;<br>4. Test the server manually outside of Claude Code&para;<br>&para;<br>**Server tools not appearing**:&para;<br>&para;<br>1. Ensure the server is properly configured in `.mcp.json` or `plugin.json`&para;<br>2. Verify the server implements the MCP protocol correctly&para;<br>3. Check for connection timeouts in debug output&para;<br>&para;<br>### Directory structure mistakes&para;<br>&para;<br>**Symptoms**: Plugin loads but components (commands, agents, hooks) are missing.&para;<br>&para;<br>**Correct structure**: Components must be at the plugin root, not inside `.claude-plugin/`. Only `plugin.json` belongs in `.claude-plugin/`.&para;<br>&para;<br>```&para;<br>my-plugin/&para;<br>├── .claude-plugin/&para;<br>│   └── plugin.json      ← Only manifest here&para;<br>├── commands/            ← At root level&para;<br>├── agents/              ← At root level&para;<br>└── hooks/               ← At root level&para;<br>```&para;<br>&para;<br>If your components are inside `.claude-plugin/`, move them to the plugin root.&para;<br>&para;<br>**Debug checklist**:&para;<br>&para;<br>1. Run `claude --debug` and look for "loading plugin" messages&para;<br>2. Check that each component directory is listed in the debug output&para;<br>3. Verify file permissions allow reading the plugin files&para;<br>&para;<br>***&para;<br>&para;<br>## Distribution and versioning reference&para;<br>&para;<br>### Version management&para;<br>&para;<br>Follow semantic versioning for plugin releases:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "name": "my-plugin",&para;<br>  "version": "2.1.0"&para;<br>}&para;<br>```&para;<br>&para;<br>**Version format**: `MAJOR.MINOR.PATCH`&para;<br>&para;<br>* **MAJOR**: Breaking changes (incompatible API changes)&para;<br>* **MINOR**: New features (backward-compatible additions)&para;<br>* **PATCH**: Bug fixes (backward-compatible fixes)&para;<br>&para;<br>**Best practices**:&para;<br>&para;<br>* Start at `1.0.0` for your first stable release&para;<br>* Update the version in `plugin.json` before distributing changes&para;<br>* Document changes in a `CHANGELOG.md` file&para;<br>* Use pre-release versions like `2.0.0-beta.1` for testing&para;<br>&para;<br>***&para;<br>&para;<br>## See also&para;<br>&para;<br>* [Plugins](/en/plugins) - Tutorials and practical usage&para;<br>* [Plugin marketplaces](/en/plugin-marketplaces) - Creating and managing marketplaces&para;<br>* [Slash commands](/en/slash-commands) - Command development details&para;<br>* [Subagents](/en/sub-agents) - Agent configuration and capabilities&para;<br>* [Agent Skills](/en/skills) - Extend Claude's capabilities&para;<br>* [Hooks](/en/hooks) - Event handling and automation&para;<br>* [MCP](/en/mcp) - External tool integration&para;<br>* [Settings](/en/settings) - Configuration options for plugins&para;<br>&para;<br>&para;<br>---&para;<br>&para;<br>&gt; To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/plugins-reference.md
+++ b/plugins-reference.md
@@ -0,0 +1,769 @@
+# Plugins reference
+
+&gt; Complete technical reference for Claude Code plugin system, including schemas, CLI commands, and component specifications.
+
+&lt;Tip&gt;
+  Looking to install plugins? See [Discover and install plugins](/en/discover-plugins). For creating plugins, see [Plugins](/en/plugins). For distributing plugins, see [Plugin marketplaces](/en/plugin-marketplaces).
+&lt;/Tip&gt;
+
+This reference provides complete technical specifications for the Claude Code plugin system, including component schemas, CLI commands, and development tools.
+
+## Plugin components reference
+
+This section documents the five types of components that plugins can provide.
+
+### Commands
+
+Plugins add custom slash commands that integrate seamlessly with Claude Code&#39;s command system.
+
+**Location**: `commands/` directory in plugin root
+
+**File format**: Markdown files with frontmatter
+
+For complete details on plugin command structure, invocation patterns, and features, see [Plugin commands](/en/slash-commands#plugin-commands).
+
+### Agents
+
+Plugins can provide specialized subagents for specific tasks that Claude can invoke automatically when appropriate.
+
+**Location**: `agents/` directory in plugin root
+
+**File format**: Markdown files describing agent capabilities
+
+**Agent structure**:
+
+```markdown  theme={null}
+---
+description: What this agent specializes in
+capabilities: [&#34;task1&#34;, &#34;task2&#34;, &#34;task3&#34;]
+---
+
+# Agent Name
+
+Detailed description of the agent&#39;s role, expertise, and when Claude should invoke it.
+
+## Capabilities
+- Specific task the agent excels at
+- Another specialized capability
+- When to use this agent vs others
+
+## Context and examples
+Provide examples of when this agent should be used and what kinds of problems it solves.
+```
+
+**Integration points**:
+
+* Agents appear in the `/agents` interface
+* Claude can invoke agents automatically based on task context
+* Agents can be invoked manually by users
+* Plugin agents work alongside built-in Claude agents
+
+### Skills
+
+Plugins can provide Agent Skills that extend Claude&#39;s capabilities. Skills are model-invoked—Claude autonomously decides when to use them based on the task context.
+
+**Location**: `skills/` directory in plugin root
+
+**File format**: Directories containing `SKILL.md` files with frontmatter
+
+**Skill structure**:
+
+```
+skills/
+├── pdf-processor/
+│   ├── SKILL.md
+│   ├── reference.md (optional)
+│   └── scripts/ (optional)
+└── code-reviewer/
+    └── SKILL.md
+```
+
+**Integration behavior**:
+
+* Plugin Skills are automatically discovered when the plugin is installed
+* Claude autonomously invokes Skills based on matching task context
+* Skills can include supporting files alongside SKILL.md
+
+For SKILL.md format and complete Skill authoring guidance, see:
+
+* [Use Skills in Claude Code](/en/skills)
+* [Agent Skills overview](https://docs.claude.com/en/docs/agents-and-tools/agent-skills/overview#skill-structure)
+
+### Hooks
+
+Plugins can provide event handlers that respond to Claude Code events automatically.
+
+**Location**: `hooks/hooks.json` in plugin root, or inline in plugin.json
+
+**Format**: JSON configuration with event matchers and actions
+
+**Hook configuration**:
+
+```json  theme={null}
+{
+  &#34;hooks&#34;: {
+    &#34;PostToolUse&#34;: [
+      {
+        &#34;matcher&#34;: &#34;Write|Edit&#34;,
+        &#34;hooks&#34;: [
+          {
+            &#34;type&#34;: &#34;command&#34;,
+            &#34;command&#34;: &#34;${CLAUDE_PLUGIN_ROOT}/scripts/format-code.sh&#34;
+          }
+        ]
+      }
+    ]
+  }
+}
+```
+
+**Available events**:
+
+* `PreToolUse`: Before Claude uses any tool
+* `PostToolUse`: After Claude successfully uses any tool
+* `PostToolUseFailure`: After Claude tool execution fails
+* `PermissionRequest`: When a permission dialog is shown
+* `UserPromptSubmit`: When user submits a prompt
+* `Notification`: When Claude Code sends notifications
+* `Stop`: When Claude attempts to stop
+* `SubagentStart`: When a subagent is started
+* `SubagentStop`: When a subagent attempts to stop
+* `SessionStart`: At the beginning of sessions
+* `SessionEnd`: At the end of sessions
+* `PreCompact`: Before conversation history is compacted
+
+**Hook types**:
+
+* `command`: Execute shell commands or scripts
+* `prompt`: Evaluate a prompt with an LLM (uses `$ARGUMENTS` placeholder for context)
+* `agent`: Run an agentic verifier with tools for complex verification tasks
+
+### MCP servers
+
+Plugins can bundle Model Context Protocol (MCP) servers to connect Claude Code with external tools and services.
+
+**Location**: `.mcp.json` in plugin root, or inline in plugin.json
+
+**Format**: Standard MCP server configuration
+
+**MCP server configuration**:
+
+```json  theme={null}
+{
+  &#34;mcpServers&#34;: {
+    &#34;plugin-database&#34;: {
+      &#34;command&#34;: &#34;${CLAUDE_PLUGIN_ROOT}/servers/db-server&#34;,
+      &#34;args&#34;: [&#34;--config&#34;, &#34;${CLAUDE_PLUGIN_ROOT}/config.json&#34;],
+      &#34;env&#34;: {
+        &#34;DB_PATH&#34;: &#34;${CLAUDE_PLUGIN_ROOT}/data&#34;
+      }
+    },
+    &#34;plugin-api-client&#34;: {
+      &#34;command&#34;: &#34;npx&#34;,
+      &#34;args&#34;: [&#34;@company/mcp-server&#34;, &#34;--plugin-mode&#34;],
+      &#34;cwd&#34;: &#34;${CLAUDE_PLUGIN_ROOT}&#34;
+    }
+  }
+}
+```
+
+**Integration behavior**:
+
+* Plugin MCP servers start automatically when the plugin is enabled
+* Servers appear as standard MCP tools in Claude&#39;s toolkit
+* Server capabilities integrate seamlessly with Claude&#39;s existing tools
+* Plugin servers can be configured independently of user MCP servers
+
+### LSP servers
+
+&lt;Tip&gt;
+  Looking to use LSP plugins? Install them from the official marketplace—search for &#34;lsp&#34; in the `/plugin` Discover tab. This section documents how to create LSP plugins for languages not covered by the official marketplace.
+&lt;/Tip&gt;
+
+Plugins can provide [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) (LSP) servers to give Claude real-time code intelligence while working on your codebase.
+
+LSP integration provides:
+
+* **Instant diagnostics**: Claude sees errors and warnings immediately after each edit
+* **Code navigation**: go to definition, find references, and hover information
+* **Language awareness**: type information and documentation for code symbols
+
+**Location**: `.lsp.json` in plugin root, or inline in `plugin.json`
+
+**Format**: JSON configuration mapping language server names to their configurations
+
+**`.lsp.json` file format**:
+
+```json  theme={null}
+{
+  &#34;go&#34;: {
+    &#34;command&#34;: &#34;gopls&#34;,
+    &#34;args&#34;: [&#34;serve&#34;],
+    &#34;extensionToLanguage&#34;: {
+      &#34;.go&#34;: &#34;go&#34;
+    }
+  }
+}
+```
+
+**Inline in `plugin.json`**:
+
+```json  theme={null}
+{
+  &#34;name&#34;: &#34;my-plugin&#34;,
+  &#34;lspServers&#34;: {
+    &#34;go&#34;: {
+      &#34;command&#34;: &#34;gopls&#34;,
+      &#34;args&#34;: [&#34;serve&#34;],
+      &#34;extensionToLanguage&#34;: {
+        &#34;.go&#34;: &#34;go&#34;
+      }
+    }
+  }
+}
+```
+
+**Required fields:**
+
+| Field                 | Description                                  |
+| :-------------------- | :------------------------------------------- |
+| `command`             | The LSP binary to execute (must be in PATH)  |
+| `extensionToLanguage` | Maps file extensions to language identifiers |
+
+**Optional fields:**
+
+| Field                   | Description                                               |
+| :---------------------- | :-------------------------------------------------------- |
+| `args`                  | Command-line arguments for the LSP server                 |
+| `transport`             | Communication transport: `stdio` (default) or `socket`    |
+| `env`                   | Environment variables to set when starting the server     |
+| `initializationOptions` | Options passed to the server during initialization        |
+| `settings`              | Settings passed via `workspace/didChangeConfiguration`    |
+| `workspaceFolder`       | Workspace folder path for the server                      |
+| `startupTimeout`        | Max time to wait for server startup (milliseconds)        |
+| `shutdownTimeout`       | Max time to wait for graceful shutdown (milliseconds)     |
+| `restartOnCrash`        | Whether to automatically restart the server if it crashes |
+| `maxRestarts`           | Maximum number of restart attempts before giving up       |
+| `loggingConfig`         | Debug logging configuration (see below)                   |
+
+**Debug logging configuration:**
+
+The `loggingConfig` field enables verbose LSP logging when users pass `--enable-lsp-logging`. This helps debug language server issues without impacting normal operation.
+
+```json  theme={null}
+&#34;loggingConfig&#34;: {
+  &#34;args&#34;: [&#34;--log-level&#34;, &#34;4&#34;],
+  &#34;env&#34;: {
+    &#34;TSS_LOG&#34;: &#34;-level verbose -file ${CLAUDE_PLUGIN_LSP_LOG_FILE}&#34;
+  }
+}
+```
+
+| Field  | Description                                                        |
+| :----- | :----------------------------------------------------------------- |
+| `args` | Additional command-line arguments appended when logging is enabled |
+| `env`  | Additional environment variables merged when logging is enabled    |
+
+The `${CLAUDE_PLUGIN_LSP_LOG_FILE}` variable expands to the log file path. Logs are written to `~/.claude/debug/`.
+
+&lt;Warning&gt;
+  **You must install the language server binary separately.** LSP plugins configure how Claude Code connects to a language server, but they don&#39;t include the server itself. If you see `Executable not found in $PATH` in the `/plugin` Errors tab, install the required binary for your language.
+&lt;/Warning&gt;
+
+**Available LSP plugins:**
+
+| Plugin           | Language server            | Install command                                                                            |
+| :--------------- | :------------------------- | :----------------------------------------------------------------------------------------- |
+| `pyright-lsp`    | Pyright (Python)           | `pip install pyright` or `npm install -g pyright`                                          |
+| `typescript-lsp` | TypeScript Language Server | `npm install -g typescript-language-server typescript`                                     |
+| `rust-lsp`       | rust-analyzer              | [See rust-analyzer installation](https://rust-analyzer.github.io/manual.html#installation) |
+
+Install the language server first, then install the plugin from the marketplace.
+
+***
+
+## Plugin installation scopes
+
+When you install a plugin, you choose a **scope** that determines where the plugin is available and who else can use it:
+
+| Scope     | Settings file                 | Use case                                                 |
+| :-------- | :---------------------------- | :------------------------------------------------------- |
+| `user`    | `~/.claude/settings.json`     | Personal plugins available across all projects (default) |
+| `project` | `.claude/settings.json`       | Team plugins shared via version control                  |
+| `local`   | `.claude/settings.local.json` | Project-specific plugins, gitignored                     |
+| `managed` | `managed-settings.json`       | Enterprise-managed plugins (read-only, update only)      |
+
+Plugins use the same scope system as other Claude Code configurations. For installation instructions and scope flags, see [Install plugins](/en/discover-plugins#install-plugins). For a complete explanation of scopes, see [Configuration scopes](/en/settings#configuration-scopes).
+
+***
+
+## Plugin manifest schema
+
+The `plugin.json` file defines your plugin&#39;s metadata and configuration. This section documents all supported fields and options.
+
+### Complete schema
+
+```json  theme={null}
+{
+  &#34;name&#34;: &#34;plugin-name&#34;,
+  &#34;version&#34;: &#34;1.2.0&#34;,
+  &#34;description&#34;: &#34;Brief plugin description&#34;,
+  &#34;author&#34;: {
+    &#34;name&#34;: &#34;Author Name&#34;,
+    &#34;email&#34;: &#34;author@example.com&#34;,
+    &#34;url&#34;: &#34;https://github.com/author&#34;
+  },
+  &#34;homepage&#34;: &#34;https://docs.example.com/plugin&#34;,
+  &#34;repository&#34;: &#34;https://github.com/author/plugin&#34;,
+  &#34;license&#34;: &#34;MIT&#34;,
+  &#34;keywords&#34;: [&#34;keyword1&#34;, &#34;keyword2&#34;],
+  &#34;commands&#34;: [&#34;./custom/commands/special.md&#34;],
+  &#34;agents&#34;: &#34;./custom/agents/&#34;,
+  &#34;skills&#34;: &#34;./custom/skills/&#34;,
+  &#34;hooks&#34;: &#34;./config/hooks.json&#34;,
+  &#34;mcpServers&#34;: &#34;./mcp-config.json&#34;,
+  &#34;outputStyles&#34;: &#34;./styles/&#34;,
+  &#34;lspServers&#34;: &#34;./.lsp.json&#34;
+}
+```
+
+### Required fields
+
+| Field  | Type   | Description                               | Example              |
+| :----- | :----- | :---------------------------------------- | :------------------- |
+| `name` | string | Unique identifier (kebab-case, no spaces) | `&#34;deployment-tools&#34;` |
+
+### Metadata fields
+
+| Field         | Type   | Description                         | Example                                            |
+| :------------ | :----- | :---------------------------------- | :------------------------------------------------- |
+| `version`     | string | Semantic version                    | `&#34;2.1.0&#34;`                                          |
+| `description` | string | Brief explanation of plugin purpose | `&#34;Deployment automation tools&#34;`                    |
+| `author`      | object | Author information                  | `{&#34;name&#34;: &#34;Dev Team&#34;, &#34;email&#34;: &#34;dev@company.com&#34;}` |
+| `homepage`    | string | Documentation URL                   | `&#34;https://docs.example.com&#34;`                       |
+| `repository`  | string | Source code URL                     | `&#34;https://github.com/user/plugin&#34;`                 |
+| `license`     | string | License identifier                  | `&#34;MIT&#34;`, `&#34;Apache-2.0&#34;`                            |
+| `keywords`    | array  | Discovery tags                      | `[&#34;deployment&#34;, &#34;ci-cd&#34;]`                          |
+
+### Component path fields
+
+| Field          | Type           | Description                                                                                                                                              | Example                                |
+| :------------- | :------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------- |
+| `commands`     | string\|array  | Additional command files/directories                                                                                                                     | `&#34;./custom/cmd.md&#34;` or `[&#34;./cmd1.md&#34;]` |
+| `agents`       | string\|array  | Additional agent files                                                                                                                                   | `&#34;./custom/agents/&#34;`                   |
+| `skills`       | string\|array  | Additional skill directories                                                                                                                             | `&#34;./custom/skills/&#34;`                   |
+| `hooks`        | string\|object | Hook config path or inline config                                                                                                                        | `&#34;./hooks.json&#34;`                       |
+| `mcpServers`   | string\|object | MCP config path or inline config                                                                                                                         | `&#34;./mcp-config.json&#34;`                  |
+| `outputStyles` | string\|array  | Additional output style files/directories                                                                                                                | `&#34;./styles/&#34;`                          |
+| `lspServers`   | string\|object | [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) config for code intelligence (go to definition, find references, etc.) | `&#34;./.lsp.json&#34;`                        |
+
+### Path behavior rules
+
+**Important**: Custom paths supplement default directories - they don&#39;t replace them.
+
+* If `commands/` exists, it&#39;s loaded in addition to custom command paths
+* All paths must be relative to plugin root and start with `./`
+* Commands from custom paths use the same naming and namespacing rules
+* Multiple paths can be specified as arrays for flexibility
+
+**Path examples**:
+
+```json  theme={null}
+{
+  &#34;commands&#34;: [
+    &#34;./specialized/deploy.md&#34;,
+    &#34;./utilities/batch-process.md&#34;
+  ],
+  &#34;agents&#34;: [
+    &#34;./custom-agents/reviewer.md&#34;,
+    &#34;./custom-agents/tester.md&#34;
+  ]
+}
+```
+
+### Environment variables
+
+**`${CLAUDE_PLUGIN_ROOT}`**: Contains the absolute path to your plugin directory. Use this in hooks, MCP servers, and scripts to ensure correct paths regardless of installation location.
+
+```json  theme={null}
+{
+  &#34;hooks&#34;: {
+    &#34;PostToolUse&#34;: [
+      {
+        &#34;hooks&#34;: [
+          {
+            &#34;type&#34;: &#34;command&#34;,
+            &#34;command&#34;: &#34;${CLAUDE_PLUGIN_ROOT}/scripts/process.sh&#34;
+          }
+        ]
+      }
+    ]
+  }
+}
+```
+
+***
+
+## Plugin caching and file resolution
+
+For security and verification purposes, Claude Code copies plugins to a cache directory rather than using them in-place. Understanding this behavior is important when developing plugins that reference external files.
+
+### How plugin caching works
+
+When you install a plugin, Claude Code copies the plugin files to a cache directory:
+
+* **For marketplace plugins with relative paths**: The path specified in the `source` field is copied recursively. For example, if your marketplace entry specifies `&#34;source&#34;: &#34;./plugins/my-plugin&#34;`, the entire `./plugins` directory is copied.
+* **For plugins with `.claude-plugin/plugin.json`**: The implicit root directory (the directory containing `.claude-plugin/plugin.json`) is copied recursively.
+
+### Path traversal limitations
+
+Plugins cannot reference files outside their copied directory structure. Paths that traverse outside the plugin root (such as `../shared-utils`) will not work after installation because those external files are not copied to the cache.
+
+### Working with external dependencies
+
+If your plugin needs to access files outside its directory, you have two options:
+
+**Option 1: Use symlinks**
+
+Create symbolic links to external files within your plugin directory. Symlinks are honored during the copy process:
+
+```bash  theme={null}
+# Inside your plugin directory
+ln -s /path/to/shared-utils ./shared-utils
+```
+
+The symlinked content will be copied into the plugin cache.
+
+**Option 2: Restructure your marketplace**
+
+Set the plugin path to a parent directory that contains all required files, then provide the rest of the plugin manifest directly in the marketplace entry:
+
+```json  theme={null}
+{
+  &#34;name&#34;: &#34;my-plugin&#34;,
+  &#34;source&#34;: &#34;./&#34;,
+  &#34;description&#34;: &#34;Plugin that needs root-level access&#34;,
+  &#34;commands&#34;: [&#34;./plugins/my-plugin/commands/&#34;],
+  &#34;agents&#34;: [&#34;./plugins/my-plugin/agents/&#34;],
+  &#34;strict&#34;: false
+}
+```
+
+This approach copies the entire marketplace root, giving your plugin access to sibling directories.
+
+&lt;Note&gt;
+  Symlinks that point to locations outside the plugin&#39;s logical root are followed during copying. This provides flexibility while maintaining the security benefits of the caching system.
+&lt;/Note&gt;
+
+***
+
+## Plugin directory structure
+
+### Standard plugin layout
+
+A complete plugin follows this structure:
+
+```
+enterprise-plugin/
+├── .claude-plugin/           # Metadata directory
+│   └── plugin.json          # Required: plugin manifest
+├── commands/                 # Default command location
+│   ├── status.md
+│   └── logs.md
+├── agents/                   # Default agent location
+│   ├── security-reviewer.md
+│   ├── performance-tester.md
+│   └── compliance-checker.md
+├── skills/                   # Agent Skills
+│   ├── code-reviewer/
+│   │   └── SKILL.md
+│   └── pdf-processor/
+│       ├── SKILL.md
+│       └── scripts/
+├── hooks/                    # Hook configurations
+│   ├── hooks.json           # Main hook config
+│   └── security-hooks.json  # Additional hooks
+├── .mcp.json                # MCP server definitions
+├── .lsp.json                # LSP server configurations
+├── scripts/                 # Hook and utility scripts
+│   ├── security-scan.sh
+│   ├── format-code.py
+│   └── deploy.js
+├── LICENSE                  # License file
+└── CHANGELOG.md             # Version history
+```
+
+&lt;Warning&gt;
+  The `.claude-plugin/` directory contains the `plugin.json` file. All other directories (commands/, agents/, skills/, hooks/) must be at the plugin root, not inside `.claude-plugin/`.
+&lt;/Warning&gt;
+
+### File locations reference
+
+| Component       | Default Location             | Purpose                          |
+| :-------------- | :--------------------------- | :------------------------------- |
+| **Manifest**    | `.claude-plugin/plugin.json` | Required metadata file           |
+| **Commands**    | `commands/`                  | Slash command Markdown files     |
+| **Agents**      | `agents/`                    | Subagent Markdown files          |
+| **Skills**      | `skills/`                    | Agent Skills with SKILL.md files |
+| **Hooks**       | `hooks/hooks.json`           | Hook configuration               |
+| **MCP servers** | `.mcp.json`                  | MCP server definitions           |
+| **LSP servers** | `.lsp.json`                  | Language server configurations   |
+
+***
+
+## CLI commands reference
+
+Claude Code provides CLI commands for non-interactive plugin management, useful for scripting and automation.
+
+### plugin install
+
+Install a plugin from available marketplaces.
+
+```bash  theme={null}
+claude plugin install &lt;plugin&gt; [options]
+```
+
+**Arguments:**
+
+* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name` for a specific marketplace
+
+**Options:**
+
+| Option                | Description                                       | Default |
+| :-------------------- | :------------------------------------------------ | :------ |
+| `-s, --scope &lt;scope&gt;` | Installation scope: `user`, `project`, or `local` | `user`  |
+| `-h, --help`          | Display help for command                          |         |
+
+**Examples:**
+
+```bash  theme={null}
+# Install to user scope (default)
+claude plugin install formatter@my-marketplace
+
+# Install to project scope (shared with team)
+claude plugin install formatter@my-marketplace --scope project
+
+# Install to local scope (gitignored)
+claude plugin install formatter@my-marketplace --scope local
+```
+
+### plugin uninstall
+
+Remove an installed plugin.
+
+```bash  theme={null}
+claude plugin uninstall &lt;plugin&gt; [options]
+```
+
+**Arguments:**
+
+* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`
+
+**Options:**
+
+| Option                | Description                                         | Default |
+| :-------------------- | :-------------------------------------------------- | :------ |
+| `-s, --scope &lt;scope&gt;` | Uninstall from scope: `user`, `project`, or `local` | `user`  |
+| `-h, --help`          | Display help for command                            |         |
+
+**Aliases:** `remove`, `rm`
+
+### plugin enable
+
+Enable a disabled plugin.
+
+```bash  theme={null}
+claude plugin enable &lt;plugin&gt; [options]
+```
+
+**Arguments:**
+
+* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`
+
+**Options:**
+
+| Option                | Description                                    | Default |
+| :-------------------- | :--------------------------------------------- | :------ |
+| `-s, --scope &lt;scope&gt;` | Scope to enable: `user`, `project`, or `local` | `user`  |
+| `-h, --help`          | Display help for command                       |         |
+
+### plugin disable
+
+Disable a plugin without uninstalling it.
+
+```bash  theme={null}
+claude plugin disable &lt;plugin&gt; [options]
+```
+
+**Arguments:**
+
+* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`
+
+**Options:**
+
+| Option                | Description                                     | Default |
+| :-------------------- | :---------------------------------------------- | :------ |
+| `-s, --scope &lt;scope&gt;` | Scope to disable: `user`, `project`, or `local` | `user`  |
+| `-h, --help`          | Display help for command                        |         |
+
+### plugin update
+
+Update a plugin to the latest version.
+
+```bash  theme={null}
+claude plugin update &lt;plugin&gt; [options]
+```
+
+**Arguments:**
+
+* `&lt;plugin&gt;`: Plugin name or `plugin-name@marketplace-name`
+
+**Options:**
+
+| Option                | Description                                               | Default |
+| :-------------------- | :-------------------------------------------------------- | :------ |
+| `-s, --scope &lt;scope&gt;` | Scope to update: `user`, `project`, `local`, or `managed` | `user`  |
+| `-h, --help`          | Display help for command                                  |         |
+
+***
+
+## Debugging and development tools
+
+### Debugging commands
+
+Use `claude --debug` to see plugin loading details:
+
+```bash  theme={null}
+claude --debug
+```
+
+This shows:
+
+* Which plugins are being loaded
+* Any errors in plugin manifests
+* Command, agent, and hook registration
+* MCP server initialization
+
+### Common issues
+
+| Issue                               | Cause                           | Solution                                                                          |
+| :---------------------------------- | :------------------------------ | :-------------------------------------------------------------------------------- |
+| Plugin not loading                  | Invalid `plugin.json`           | Validate JSON syntax with `claude plugin validate` or `/plugin validate`          |
+| Commands not appearing              | Wrong directory structure       | Ensure `commands/` at root, not in `.claude-plugin/`                              |
+| Hooks not firing                    | Script not executable           | Run `chmod +x script.sh`                                                          |
+| MCP server fails                    | Missing `${CLAUDE_PLUGIN_ROOT}` | Use variable for all plugin paths                                                 |
+| Path errors                         | Absolute paths used             | All paths must be relative and start with `./`                                    |
+| LSP `Executable not found in $PATH` | Language server not installed   | Install the binary (e.g., `npm install -g typescript-language-server typescript`) |
+
+### Example error messages
+
+**Manifest validation errors**:
+
+* `Invalid JSON syntax: Unexpected token } in JSON at position 142`: check for missing commas, extra commas, or unquoted strings
+* `Plugin has an invalid manifest file at .claude-plugin/plugin.json. Validation errors: name: Required`: a required field is missing
+* `Plugin has a corrupt manifest file at .claude-plugin/plugin.json. JSON parse error: ...`: JSON syntax error
+
+**Plugin loading errors**:
+
+* `Warning: No commands found in plugin my-plugin custom directory: ./cmds. Expected .md files or SKILL.md in subdirectories.`: command path exists but contains no valid command files
+* `Plugin directory not found at path: ./plugins/my-plugin. Check that the marketplace entry has the correct path.`: the `source` path in marketplace.json points to a non-existent directory
+* `Plugin my-plugin has conflicting manifests: both plugin.json and marketplace entry specify components.`: remove duplicate component definitions or set `strict: true` in marketplace entry
+
+### Hook troubleshooting
+
+**Hook script not executing**:
+
+1. Check the script is executable: `chmod +x ./scripts/your-script.sh`
+2. Verify the shebang line: First line should be `#!/bin/bash` or `#!/usr/bin/env bash`
+3. Check the path uses `${CLAUDE_PLUGIN_ROOT}`: `&#34;command&#34;: &#34;${CLAUDE_PLUGIN_ROOT}/scripts/your-script.sh&#34;`
+4. Test the script manually: `./scripts/your-script.sh`
+
+**Hook not triggering on expected events**:
+
+1. Verify the event name is correct (case-sensitive): `PostToolUse`, not `postToolUse`
+2. Check the matcher pattern matches your tools: `&#34;matcher&#34;: &#34;Write|Edit&#34;` for file operations
+3. Confirm the hook type is valid: `command`, `prompt`, or `agent`
+
+### MCP server troubleshooting
+
+**Server not starting**:
+
+1. Check the command exists and is executable
+2. Verify all paths use `${CLAUDE_PLUGIN_ROOT}` variable
+3. Check the MCP server logs: `claude --debug` shows initialization errors
+4. Test the server manually outside of Claude Code
+
+**Server tools not appearing**:
+
+1. Ensure the server is properly configured in `.mcp.json` or `plugin.json`
+2. Verify the server implements the MCP protocol correctly
+3. Check for connection timeouts in debug output
+
+### Directory structure mistakes
+
+**Symptoms**: Plugin loads but components (commands, agents, hooks) are missing.
+
+**Correct structure**: Components must be at the plugin root, not inside `.claude-plugin/`. Only `plugin.json` belongs in `.claude-plugin/`.
+
+```
+my-plugin/
+├── .claude-plugin/
+│   └── plugin.json      ← Only manifest here
+├── commands/            ← At root level
+├── agents/              ← At root level
+└── hooks/               ← At root level
+```
+
+If your components are inside `.claude-plugin/`, move them to the plugin root.
+
+**Debug checklist**:
+
+1. Run `claude --debug` and look for &#34;loading plugin&#34; messages
+2. Check that each component directory is listed in the debug output
+3. Verify file permissions allow reading the plugin files
+
+***
+
+## Distribution and versioning reference
+
+### Version management
+
+Follow semantic versioning for plugin releases:
+
+```json  theme={null}
+{
+  &#34;name&#34;: &#34;my-plugin&#34;,
+  &#34;version&#34;: &#34;2.1.0&#34;
+}
+```
+
+**Version format**: `MAJOR.MINOR.PATCH`
+
+* **MAJOR**: Breaking changes (incompatible API changes)
+* **MINOR**: New features (backward-compatible additions)
+* **PATCH**: Bug fixes (backward-compatible fixes)
+
+**Best practices**:
+
+* Start at `1.0.0` for your first stable release
+* Update the version in `plugin.json` before distributing changes
+* Document changes in a `CHANGELOG.md` file
+* Use pre-release versions like `2.0.0-beta.1` for testing
+
+***
+
+## See also
+
+* [Plugins](/en/plugins) - Tutorials and practical usage
+* [Plugin marketplaces](/en/plugin-marketplaces) - Creating and managing marketplaces
+* [Slash commands](/en/slash-commands) - Command development details
+* [Subagents](/en/sub-agents) - Agent configuration and capabilities
+* [Agent Skills](/en/skills) - Extend Claude&#39;s capabilities
+* [Hooks](/en/hooks) - Event handling and automation
+* [MCP](/en/mcp) - External tool integration
+* [Settings](/en/settings) - Configuration options for plugins
+
+
+---
+
+&gt; To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt</code></pre>
    </div>
</body>
</html>