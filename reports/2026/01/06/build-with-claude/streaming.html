<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>build-with-claude/streaming - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>build-with-claude/streaming.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+272</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis for `streaming.md`

## Summary
The documentation for streaming messages with Claude has been significantly expanded to include detailed instructions on how to implement streaming using server-sent events (SSE) in various SDKs, along with comprehensive event types and error recovery strategies.

## Key Changes
- **Introduction of Streaming Messages**: Added a section explaining how to enable streaming responses by setting `&#34;stream&#34;: true` in the message request.
- **SDK Examples**: Provided code examples for both Python and TypeScript SDKs, demonstrating synchronous and asynchronous streaming implementations.
- **Detailed Event Types**: Introduced a structured overview of event types in the streaming response, including `message_start`, `content_block_delta`, and error events.
- **Content Block Delta Types**: Explained different types of content block deltas, including text deltas and input JSON deltas, with examples.
- **Error Recovery Strategies**: Included a section on how to handle interruptions in streaming requests, outlining best practices for resuming from partial responses.

## Impact
**High**: This change introduces new features and capabilities for developers, enhancing the functionality of the API with real-time streaming responses and robust error handling mechanisms. It empowers developers to build more responsive applications and improves overall user experience.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Streaming Messages&para;<br>&para;<br>---&para;<br>&para;<br>When creating a Message, you can set `"stream": true` to incrementally stream the response using [server-sent events](https://developer.mozilla.org/en-US/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents) (SSE).&para;<br>&para;<br>## Streaming with SDKs&para;<br>&para;<br>Our [Python](https://github.com/anthropics/anthropic-sdk-python) and [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript) SDKs offer multiple ways of streaming. The Python SDK allows both sync and async streams. See the documentation in each SDK for details.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>    ```python Python&para;<br>    import anthropic&para;<br>&para;<br>    client = anthropic.Anthropic()&para;<br>&para;<br>    with client.messages.stream(&para;<br>        max_tokens=1024,&para;<br>        messages=[{"role": "user", "content": "Hello"}],&para;<br>        model="claude-sonnet-4-5",&para;<br>    ) as stream:&para;<br>      for text in stream.text_stream:&para;<br>          print(text, end="", flush=True)&para;<br>    ```&para;<br>&para;<br>    ```typescript TypeScript&para;<br>    import Anthropic from '@anthropic-ai/sdk';&para;<br>&para;<br>    const client = new Anthropic();&para;<br>&para;<br>    await client.messages.stream({&para;<br>        messages: [{role: 'user', content: "Hello"}],&para;<br>        model: 'claude-sonnet-4-5',&para;<br>        max_tokens: 1024,&para;<br>    }).on('text', (text) =&gt; {&para;<br>        console.log(text);&para;<br>    });&para;<br>    ```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>## Event types&para;<br>&para;<br>Each server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data.&para;<br>&para;<br>Each stream uses the following event flow:&para;<br>&para;<br>1. `message_start`: contains a `Message` object with empty `content`.&para;<br>2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.&para;<br>3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.&para;<br>4. A final `message_stop` event.&para;<br>&para;<br>  &lt;Warning&gt;&para;<br>  The token counts shown in the `usage` field of the `message_delta` event are *cumulative*.&para;<br>  &lt;/Warning&gt;&para;<br>&para;<br>### Ping events&para;<br>&para;<br>Event streams may also include any number of `ping` events.&para;<br>&para;<br>### Error events&para;<br>&para;<br>We may occasionally send [errors](/docs/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:&para;<br>&para;<br>```json Example error&para;<br>event: error&para;<br>data: {"type": "error", "error": {"type": "overloaded_error", "message": "Overloaded"}}&para;<br>```&para;<br>&para;<br>### Other events&para;<br>&para;<br>In accordance with our [versioning policy](/docs/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.&para;<br>&para;<br>## Content block delta types&para;<br>&para;<br>Each `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.&para;<br>&para;<br>### Text delta&para;<br>&para;<br>A `text` content block delta looks like:&para;<br>```json Text delta&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta","index": 0,"delta": {"type": "text_delta", "text": "ello frien"}}&para;<br>```&para;<br>&para;<br>### Input JSON delta&para;<br>&para;<br>The deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are _partial JSON strings_, whereas the final `tool_use.input` is always an _object_.&para;<br>&para;<br>You can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/docs/en/api/client-sdks), which provide helpers to access parsed incremental values.&para;<br>&para;<br>A `tool_use` content block delta looks like:&para;<br>```json Input JSON delta&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta","index": 1,"delta": {"type": "input_json_delta","partial_json": "{\"location\": \"San Fra"}}}&para;<br>```&para;<br>Note: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.&para;<br>&para;<br>### Thinking delta&para;<br>&para;<br>When using [extended thinking](/docs/en/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you'll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks.&para;<br>&para;<br>For thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block.&para;<br>&para;<br>A typical thinking delta looks like:&para;<br>```json Thinking delta&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "Let me solve this step by step:\n\n1. First break down 27 * 453"}}&para;<br>```&para;<br>&para;<br>The signature delta looks like:&para;<br>```json Signature delta&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "signature_delta", "signature": "EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."}}&para;<br>```&para;<br>&para;<br>## Full HTTP Stream response&para;<br>&para;<br>We strongly recommend that you use our [client SDKs](/docs/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself.&para;<br>&para;<br>A stream response is comprised of:&para;<br>1. A `message_start` event&para;<br>2. Potentially multiple content blocks, each of which contains:&para;<br>    - A `content_block_start` event&para;<br>    - Potentially multiple `content_block_delta` events&para;<br>    - A `content_block_stop` event&para;<br>3. A `message_delta` event&para;<br>4. A `message_stop` event&para;<br>&para;<br>There may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.&para;<br>&para;<br>### Basic streaming request&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --data \&para;<br>'{&para;<br>  "model": "claude-sonnet-4-5",&para;<br>  "messages": [{"role": "user", "content": "Hello"}],&para;<br>  "max_tokens": 256,&para;<br>  "stream": true&para;<br>}'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>with client.messages.stream(&para;<br>    model="claude-sonnet-4-5",&para;<br>    messages=[{"role": "user", "content": "Hello"}],&para;<br>    max_tokens=256,&para;<br>) as stream:&para;<br>    for text in stream.text_stream:&para;<br>        print(text, end="", flush=True)&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json Response&para;<br>event: message_start&para;<br>data: {"type": "message_start", "message": {"id": "msg_1nZdL29xx5MUA1yADyHTEsnR8uuvGzszyY", "type": "message", "role": "assistant", "content": [], "model": "claude-sonnet-4-5-20250929", "stop_reason": null, "stop_sequence": null, "usage": {"input_tokens": 25, "output_tokens": 1}}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}&para;<br>&para;<br>event: ping&para;<br>data: {"type": "ping"}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "text_delta", "text": "Hello"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "text_delta", "text": "!"}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type": "content_block_stop", "index": 0}&para;<br>&para;<br>event: message_delta&para;<br>data: {"type": "message_delta", "delta": {"stop_reason": "end_turn", "stop_sequence":null}, "usage": {"output_tokens": 15}}&para;<br>&para;<br>event: message_stop&para;<br>data: {"type": "message_stop"}&para;<br>&para;<br>```&para;<br>&para;<br>### Streaming request with tool use&para;<br>&para;<br>&lt;Tip&gt;&para;<br>Tool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/docs/en/agents-and-tools/tool-use/fine-grained-tool-streaming).&para;<br>&lt;/Tip&gt;&para;<br>&para;<br>In this request, we ask Claude to use a tool to tell us the weather.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>    -H "content-type: application/json" \&para;<br>    -H "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    -H "anthropic-version: 2023-06-01" \&para;<br>    -d '{&para;<br>      "model": "claude-sonnet-4-5",&para;<br>      "max_tokens": 1024,&para;<br>      "tools": [&para;<br>        {&para;<br>          "name": "get_weather",&para;<br>          "description": "Get the current weather in a given location",&para;<br>          "input_schema": {&para;<br>            "type": "object",&para;<br>            "properties": {&para;<br>              "location": {&para;<br>                "type": "string",&para;<br>                "description": "The city and state, e.g. San Francisco, CA"&para;<br>              }&para;<br>            },&para;<br>            "required": ["location"]&para;<br>          }&para;<br>        }&para;<br>      ],&para;<br>      "tool_choice": {"type": "any"},&para;<br>      "messages": [&para;<br>        {&para;<br>          "role": "user",&para;<br>          "content": "What is the weather like in San Francisco?"&para;<br>        }&para;<br>      ],&para;<br>      "stream": true&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>tools = [&para;<br>    {&para;<br>        "name": "get_weather",&para;<br>        "description": "Get the current weather in a given location",&para;<br>        "input_schema": {&para;<br>            "type": "object",&para;<br>            "properties": {&para;<br>                "location": {&para;<br>                    "type": "string",&para;<br>                    "description": "The city and state, e.g. San Francisco, CA"&para;<br>                }&para;<br>            },&para;<br>            "required": ["location"]&para;<br>        }&para;<br>    }&para;<br>]&para;<br>&para;<br>with client.messages.stream(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    tools=tools,&para;<br>    tool_choice={"type": "any"},&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What is the weather like in San Francisco?"&para;<br>        }&para;<br>    ],&para;<br>) as stream:&para;<br>    for text in stream.text_stream:&para;<br>        print(text, end="", flush=True)&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json Response&para;<br>event: message_start&para;<br>data: {"type":"message_start","message":{"id":"msg_014p7gG3wDgGV9EUtLvnow3U","type":"message","role":"assistant","model":"claude-sonnet-4-5-20250929","stop_sequence":null,"usage":{"input_tokens":472,"output_tokens":2},"content":[],"stop_reason":null}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":0,"content_block":{"type":"text","text":""}}&para;<br>&para;<br>event: ping&para;<br>data: {"type": "ping"}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"Okay"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":","}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" let"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"'s"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" check"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" the"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" weather"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" for"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" San"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" Francisco"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":","}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" CA"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":":"}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":0}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":1,"content_block":{"type":"tool_use","id":"toolu_01T1x1fJ34qAmk2tNTrN7Up6","name":"get_weather","input":{}}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"{\"location\":"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" \"San"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" Francisc"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"o,"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" CA\""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":", "}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"\"unit\": \"fah"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"renheit\"}"}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":1}&para;<br>&para;<br>event: message_delta&para;<br>data: {"type":"message_delta","delta":{"stop_reason":"tool_use","stop_sequence":null},"usage":{"output_tokens":89}}&para;<br>&para;<br>event: message_stop&para;<br>data: {"type":"message_stop"}&para;<br>```&para;<br>&para;<br>### Streaming request with extended thinking&para;<br>&para;<br>In this request, we enable extended thinking with streaming to see Claude's step-by-step reasoning.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-5",&para;<br>    "max_tokens": 20000,&para;<br>    "stream": true,&para;<br>    "thinking": {&para;<br>        "type": "enabled",&para;<br>        "budget_tokens": 16000&para;<br>    },&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What is 27 * 453?"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>with client.messages.stream(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=20000,&para;<br>    thinking={&para;<br>        "type": "enabled",&para;<br>        "budget_tokens": 16000&para;<br>    },&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What is 27 * 453?"&para;<br>        }&para;<br>    ],&para;<br>) as stream:&para;<br>    for event in stream:&para;<br>        if event.type == "content_block_delta":&para;<br>            if event.delta.type == "thinking_delta":&para;<br>                print(event.delta.thinking, end="", flush=True)&para;<br>            elif event.delta.type == "text_delta":&para;<br>                print(event.delta.text, end="", flush=True)&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json Response&para;<br>event: message_start&para;<br>data: {"type": "message_start", "message": {"id": "msg_01...", "type": "message", "role": "assistant", "content": [], "model": "claude-sonnet-4-5-20250929", "stop_reason": null, "stop_sequence": null}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 0, "content_block": {"type": "thinking", "thinking": ""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "Let me solve this step by step:\n\n1. First break down 27 * 453"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n2. 453 = 400 + 50 + 3"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n3. 27 * 400 = 10,800"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n4. 27 * 50 = 1,350"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n5. 27 * 3 = 81"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n6. 10,800 + 1,350 + 81 = 12,231"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 0, "delta": {"type": "signature_delta", "signature": "EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type": "content_block_stop", "index": 0}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 1, "content_block": {"type": "text", "text": ""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 1, "delta": {"type": "text_delta", "text": "27 * 453 = 12,231"}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type": "content_block_stop", "index": 1}&para;<br>&para;<br>event: message_delta&para;<br>data: {"type": "message_delta", "delta": {"stop_reason": "end_turn", "stop_sequence": null}}&para;<br>&para;<br>event: message_stop&para;<br>data: {"type": "message_stop"}&para;<br>```&para;<br>&para;<br>### Streaming request with web search tool use&para;<br>&para;<br>In this request, we ask Claude to search the web for current weather information.&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>     --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>     --header "anthropic-version: 2023-06-01" \&para;<br>     --header "content-type: application/json" \&para;<br>     --data \&para;<br>'{&para;<br>    "model": "claude-sonnet-4-5",&para;<br>    "max_tokens": 1024,&para;<br>    "stream": true,&para;<br>    "tools": [&para;<br>        {&para;<br>            "type": "web_search_20250305",&para;<br>            "name": "web_search",&para;<br>            "max_uses": 5&para;<br>        }&para;<br>    ],&para;<br>    "messages": [&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What is the weather like in New York City today?"&para;<br>        }&para;<br>    ]&para;<br>}'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>with client.messages.stream(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    tools=[&para;<br>        {&para;<br>            "type": "web_search_20250305",&para;<br>            "name": "web_search",&para;<br>            "max_uses": 5&para;<br>        }&para;<br>    ],&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What is the weather like in New York City today?"&para;<br>        }&para;<br>    ],&para;<br>) as stream:&para;<br>    for text in stream.text_stream:&para;<br>        print(text, end="", flush=True)&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>```json Response&para;<br>event: message_start&para;<br>data: {"type":"message_start","message":{"id":"msg_01G...","type":"message","role":"assistant","model":"claude-sonnet-4-5-20250929","content":[],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2679,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":3}}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":0,"content_block":{"type":"text","text":""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"I'll check"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" the current weather in New York City for you"}}&para;<br>&para;<br>event: ping&para;<br>data: {"type": "ping"}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"."}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":0}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":1,"content_block":{"type":"server_tool_use","id":"srvtoolu_014hJH82Qum7Td6UV8gDXThB","name":"web_search","input":{}}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"{\"query"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"\":"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" \"weather"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" NY"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"C to"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"day\"}"}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":1 }&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":2,"content_block":{"type":"web_search_tool_result","tool_use_id":"srvtoolu_014hJH82Qum7Td6UV8gDXThB","content":[{"type":"web_search_result","title":"Weather in New York City in May 2025 (New York) - detailed Weather Forecast for a month","url":"https://world-weather.info/forecast/usa/new_york/may-2025/","encrypted_content":"Ev0DCioIAxgCIiQ3NmU4ZmI4OC1k...","page_age":null},...]}}&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":2}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type":"content_block_start","index":3,"content_block":{"type":"text","text":""}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":"Here's the current weather information for New York"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":" City:\n\n# Weather"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":" in New York City"}}&para;<br>&para;<br>event: content_block_delta&para;<br>data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":"\n\n"}}&para;<br>&para;<br>...&para;<br>&para;<br>event: content_block_stop&para;<br>data: {"type":"content_block_stop","index":17}&para;<br>&para;<br>event: message_delta&para;<br>data: {"type":"message_delta","delta":{"stop_reason":"end_turn","stop_sequence":null},"usage":{"input_tokens":10682,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":510,"server_tool_use":{"web_search_requests":1}}}&para;<br>&para;<br>event: message_stop&para;<br>data: {"type":"message_stop"}&para;<br>```&para;<br>&para;<br>## Error recovery&para;<br>&para;<br>When a streaming request is interrupted due to network issues, timeouts, or other errors, you can recover by resuming from where the stream was interrupted. This approach saves you from re-processing the entire response.&para;<br>&para;<br>The basic recovery strategy involves:&para;<br>&para;<br>1. **Capture the partial response**: Save all content that was successfully received before the error occurred&para;<br>2. **Construct a continuation request**: Create a new API request that includes the partial assistant response as the beginning of a new assistant message&para;<br>3. **Resume streaming**: Continue receiving the rest of the response from where it was interrupted&para;<br>&para;<br>### Error recovery best practices&para;<br>&para;<br>1. **Use SDK features**: Leverage the SDK's built-in message accumulation and error handling capabilities&para;<br>2. **Handle content types**: Be aware that messages can contain multiple content blocks (`text`, `tool_use`, `thinking`). Tool use and extended thinking blocks cannot be partially recovered. You can resume streaming from the most recent text block.</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/build-with-claude/streaming.md
+++ b/build-with-claude/streaming.md
@@ -0,0 +1,621 @@
+# Streaming Messages
+
+---
+
+When creating a Message, you can set `&#34;stream&#34;: true` to incrementally stream the response using [server-sent events](https://developer.mozilla.org/en-US/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents) (SSE).
+
+## Streaming with SDKs
+
+Our [Python](https://github.com/anthropics/anthropic-sdk-python) and [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript) SDKs offer multiple ways of streaming. The Python SDK allows both sync and async streams. See the documentation in each SDK for details.
+
+&lt;CodeGroup&gt;
+    ```python Python
+    import anthropic
+
+    client = anthropic.Anthropic()
+
+    with client.messages.stream(
+        max_tokens=1024,
+        messages=[{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello&#34;}],
+        model=&#34;claude-sonnet-4-5&#34;,
+    ) as stream:
+      for text in stream.text_stream:
+          print(text, end=&#34;&#34;, flush=True)
+    ```
+
+    ```typescript TypeScript
+    import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+
+    const client = new Anthropic();
+
+    await client.messages.stream({
+        messages: [{role: &#39;user&#39;, content: &#34;Hello&#34;}],
+        model: &#39;claude-sonnet-4-5&#39;,
+        max_tokens: 1024,
+    }).on(&#39;text&#39;, (text) =&gt; {
+        console.log(text);
+    });
+    ```
+&lt;/CodeGroup&gt;
+
+## Event types
+
+Each server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data.
+
+Each stream uses the following event flow:
+
+1. `message_start`: contains a `Message` object with empty `content`.
+2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.
+3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.
+4. A final `message_stop` event.
+
+  &lt;Warning&gt;
+  The token counts shown in the `usage` field of the `message_delta` event are *cumulative*.
+  &lt;/Warning&gt;
+
+### Ping events
+
+Event streams may also include any number of `ping` events.
+
+### Error events
+
+We may occasionally send [errors](/docs/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:
+
+```json Example error
+event: error
+data: {&#34;type&#34;: &#34;error&#34;, &#34;error&#34;: {&#34;type&#34;: &#34;overloaded_error&#34;, &#34;message&#34;: &#34;Overloaded&#34;}}
+```
+
+### Other events
+
+In accordance with our [versioning policy](/docs/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.
+
+## Content block delta types
+
+Each `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.
+
+### Text delta
+
+A `text` content block delta looks like:
+```json Text delta
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;,&#34;index&#34;: 0,&#34;delta&#34;: {&#34;type&#34;: &#34;text_delta&#34;, &#34;text&#34;: &#34;ello frien&#34;}}
+```
+
+### Input JSON delta
+
+The deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are _partial JSON strings_, whereas the final `tool_use.input` is always an _object_.
+
+You can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/docs/en/api/client-sdks), which provide helpers to access parsed incremental values.
+
+A `tool_use` content block delta looks like:
+```json Input JSON delta
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;,&#34;index&#34;: 1,&#34;delta&#34;: {&#34;type&#34;: &#34;input_json_delta&#34;,&#34;partial_json&#34;: &#34;{\&#34;location\&#34;: \&#34;San Fra&#34;}}}
+```
+Note: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.
+
+### Thinking delta
+
+When using [extended thinking](/docs/en/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you&#39;ll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks.
+
+For thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block.
+
+A typical thinking delta looks like:
+```json Thinking delta
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;Let me solve this step by step:\n\n1. First break down 27 * 453&#34;}}
+```
+
+The signature delta looks like:
+```json Signature delta
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;signature_delta&#34;, &#34;signature&#34;: &#34;EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds...&#34;}}
+```
+
+## Full HTTP Stream response
+
+We strongly recommend that you use our [client SDKs](/docs/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself.
+
+A stream response is comprised of:
+1. A `message_start` event
+2. Potentially multiple content blocks, each of which contains:
+    - A `content_block_start` event
+    - Potentially multiple `content_block_delta` events
+    - A `content_block_stop` event
+3. A `message_delta` event
+4. A `message_stop` event
+
+There may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.
+
+### Basic streaming request
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+     --header &#34;anthropic-version: 2023-06-01&#34; \
+     --header &#34;content-type: application/json&#34; \
+     --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+     --data \
+&#39;{
+  &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+  &#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello&#34;}],
+  &#34;max_tokens&#34;: 256,
+  &#34;stream&#34;: true
+}&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+with client.messages.stream(
+    model=&#34;claude-sonnet-4-5&#34;,
+    messages=[{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;Hello&#34;}],
+    max_tokens=256,
+) as stream:
+    for text in stream.text_stream:
+        print(text, end=&#34;&#34;, flush=True)
+```
+&lt;/CodeGroup&gt;
+
+```json Response
+event: message_start
+data: {&#34;type&#34;: &#34;message_start&#34;, &#34;message&#34;: {&#34;id&#34;: &#34;msg_1nZdL29xx5MUA1yADyHTEsnR8uuvGzszyY&#34;, &#34;type&#34;: &#34;message&#34;, &#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: [], &#34;model&#34;: &#34;claude-sonnet-4-5-20250929&#34;, &#34;stop_reason&#34;: null, &#34;stop_sequence&#34;: null, &#34;usage&#34;: {&#34;input_tokens&#34;: 25, &#34;output_tokens&#34;: 1}}}
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 0, &#34;content_block&#34;: {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;&#34;}}
+
+event: ping
+data: {&#34;type&#34;: &#34;ping&#34;}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;text_delta&#34;, &#34;text&#34;: &#34;Hello&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;text_delta&#34;, &#34;text&#34;: &#34;!&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;: &#34;content_block_stop&#34;, &#34;index&#34;: 0}
+
+event: message_delta
+data: {&#34;type&#34;: &#34;message_delta&#34;, &#34;delta&#34;: {&#34;stop_reason&#34;: &#34;end_turn&#34;, &#34;stop_sequence&#34;:null}, &#34;usage&#34;: {&#34;output_tokens&#34;: 15}}
+
+event: message_stop
+data: {&#34;type&#34;: &#34;message_stop&#34;}
+
+```
+
+### Streaming request with tool use
+
+&lt;Tip&gt;
+Tool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/docs/en/agents-and-tools/tool-use/fine-grained-tool-streaming).
+&lt;/Tip&gt;
+
+In this request, we ask Claude to use a tool to tell us the weather.
+
+&lt;CodeGroup&gt;
+```bash Shell
+  curl https://api.anthropic.com/v1/messages \
+    -H &#34;content-type: application/json&#34; \
+    -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+    -H &#34;anthropic-version: 2023-06-01&#34; \
+    -d &#39;{
+      &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+      &#34;max_tokens&#34;: 1024,
+      &#34;tools&#34;: [
+        {
+          &#34;name&#34;: &#34;get_weather&#34;,
+          &#34;description&#34;: &#34;Get the current weather in a given location&#34;,
+          &#34;input_schema&#34;: {
+            &#34;type&#34;: &#34;object&#34;,
+            &#34;properties&#34;: {
+              &#34;location&#34;: {
+                &#34;type&#34;: &#34;string&#34;,
+                &#34;description&#34;: &#34;The city and state, e.g. San Francisco, CA&#34;
+              }
+            },
+            &#34;required&#34;: [&#34;location&#34;]
+          }
+        }
+      ],
+      &#34;tool_choice&#34;: {&#34;type&#34;: &#34;any&#34;},
+      &#34;messages&#34;: [
+        {
+          &#34;role&#34;: &#34;user&#34;,
+          &#34;content&#34;: &#34;What is the weather like in San Francisco?&#34;
+        }
+      ],
+      &#34;stream&#34;: true
+    }&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+tools = [
+    {
+        &#34;name&#34;: &#34;get_weather&#34;,
+        &#34;description&#34;: &#34;Get the current weather in a given location&#34;,
+        &#34;input_schema&#34;: {
+            &#34;type&#34;: &#34;object&#34;,
+            &#34;properties&#34;: {
+                &#34;location&#34;: {
+                    &#34;type&#34;: &#34;string&#34;,
+                    &#34;description&#34;: &#34;The city and state, e.g. San Francisco, CA&#34;
+                }
+            },
+            &#34;required&#34;: [&#34;location&#34;]
+        }
+    }
+]
+
+with client.messages.stream(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    tools=tools,
+    tool_choice={&#34;type&#34;: &#34;any&#34;},
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What is the weather like in San Francisco?&#34;
+        }
+    ],
+) as stream:
+    for text in stream.text_stream:
+        print(text, end=&#34;&#34;, flush=True)
+```
+&lt;/CodeGroup&gt;
+
+```json Response
+event: message_start
+data: {&#34;type&#34;:&#34;message_start&#34;,&#34;message&#34;:{&#34;id&#34;:&#34;msg_014p7gG3wDgGV9EUtLvnow3U&#34;,&#34;type&#34;:&#34;message&#34;,&#34;role&#34;:&#34;assistant&#34;,&#34;model&#34;:&#34;claude-sonnet-4-5-20250929&#34;,&#34;stop_sequence&#34;:null,&#34;usage&#34;:{&#34;input_tokens&#34;:472,&#34;output_tokens&#34;:2},&#34;content&#34;:[],&#34;stop_reason&#34;:null}}
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:0,&#34;content_block&#34;:{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;&#34;}}
+
+event: ping
+data: {&#34;type&#34;: &#34;ping&#34;}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;Okay&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;,&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; let&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;&#39;s&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; check&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; the&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; weather&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; for&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; San&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; Francisco&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;,&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; CA&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;:&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:0}
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:1,&#34;content_block&#34;:{&#34;type&#34;:&#34;tool_use&#34;,&#34;id&#34;:&#34;toolu_01T1x1fJ34qAmk2tNTrN7Up6&#34;,&#34;name&#34;:&#34;get_weather&#34;,&#34;input&#34;:{}}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;{\&#34;location\&#34;:&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34; \&#34;San&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34; Francisc&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;o,&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34; CA\&#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;, &#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;\&#34;unit\&#34;: \&#34;fah&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;renheit\&#34;}&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:1}
+
+event: message_delta
+data: {&#34;type&#34;:&#34;message_delta&#34;,&#34;delta&#34;:{&#34;stop_reason&#34;:&#34;tool_use&#34;,&#34;stop_sequence&#34;:null},&#34;usage&#34;:{&#34;output_tokens&#34;:89}}
+
+event: message_stop
+data: {&#34;type&#34;:&#34;message_stop&#34;}
+```
+
+### Streaming request with extended thinking
+
+In this request, we enable extended thinking with streaming to see Claude&#39;s step-by-step reasoning.
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+     --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+     --header &#34;anthropic-version: 2023-06-01&#34; \
+     --header &#34;content-type: application/json&#34; \
+     --data \
+&#39;{
+    &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+    &#34;max_tokens&#34;: 20000,
+    &#34;stream&#34;: true,
+    &#34;thinking&#34;: {
+        &#34;type&#34;: &#34;enabled&#34;,
+        &#34;budget_tokens&#34;: 16000
+    },
+    &#34;messages&#34;: [
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What is 27 * 453?&#34;
+        }
+    ]
+}&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+with client.messages.stream(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=20000,
+    thinking={
+        &#34;type&#34;: &#34;enabled&#34;,
+        &#34;budget_tokens&#34;: 16000
+    },
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What is 27 * 453?&#34;
+        }
+    ],
+) as stream:
+    for event in stream:
+        if event.type == &#34;content_block_delta&#34;:
+            if event.delta.type == &#34;thinking_delta&#34;:
+                print(event.delta.thinking, end=&#34;&#34;, flush=True)
+            elif event.delta.type == &#34;text_delta&#34;:
+                print(event.delta.text, end=&#34;&#34;, flush=True)
+```
+&lt;/CodeGroup&gt;
+
+```json Response
+event: message_start
+data: {&#34;type&#34;: &#34;message_start&#34;, &#34;message&#34;: {&#34;id&#34;: &#34;msg_01...&#34;, &#34;type&#34;: &#34;message&#34;, &#34;role&#34;: &#34;assistant&#34;, &#34;content&#34;: [], &#34;model&#34;: &#34;claude-sonnet-4-5-20250929&#34;, &#34;stop_reason&#34;: null, &#34;stop_sequence&#34;: null}}
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 0, &#34;content_block&#34;: {&#34;type&#34;: &#34;thinking&#34;, &#34;thinking&#34;: &#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;Let me solve this step by step:\n\n1. First break down 27 * 453&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;\n2. 453 = 400 + 50 + 3&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;\n3. 27 * 400 = 10,800&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;\n4. 27 * 50 = 1,350&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;\n5. 27 * 3 = 81&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;thinking_delta&#34;, &#34;thinking&#34;: &#34;\n6. 10,800 + 1,350 + 81 = 12,231&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 0, &#34;delta&#34;: {&#34;type&#34;: &#34;signature_delta&#34;, &#34;signature&#34;: &#34;EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds...&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;: &#34;content_block_stop&#34;, &#34;index&#34;: 0}
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 1, &#34;content_block&#34;: {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 1, &#34;delta&#34;: {&#34;type&#34;: &#34;text_delta&#34;, &#34;text&#34;: &#34;27 * 453 = 12,231&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;: &#34;content_block_stop&#34;, &#34;index&#34;: 1}
+
+event: message_delta
+data: {&#34;type&#34;: &#34;message_delta&#34;, &#34;delta&#34;: {&#34;stop_reason&#34;: &#34;end_turn&#34;, &#34;stop_sequence&#34;: null}}
+
+event: message_stop
+data: {&#34;type&#34;: &#34;message_stop&#34;}
+```
+
+### Streaming request with web search tool use
+
+In this request, we ask Claude to search the web for current weather information.
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+     --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+     --header &#34;anthropic-version: 2023-06-01&#34; \
+     --header &#34;content-type: application/json&#34; \
+     --data \
+&#39;{
+    &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+    &#34;max_tokens&#34;: 1024,
+    &#34;stream&#34;: true,
+    &#34;tools&#34;: [
+        {
+            &#34;type&#34;: &#34;web_search_20250305&#34;,
+            &#34;name&#34;: &#34;web_search&#34;,
+            &#34;max_uses&#34;: 5
+        }
+    ],
+    &#34;messages&#34;: [
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What is the weather like in New York City today?&#34;
+        }
+    ]
+}&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+with client.messages.stream(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    tools=[
+        {
+            &#34;type&#34;: &#34;web_search_20250305&#34;,
+            &#34;name&#34;: &#34;web_search&#34;,
+            &#34;max_uses&#34;: 5
+        }
+    ],
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What is the weather like in New York City today?&#34;
+        }
+    ],
+) as stream:
+    for text in stream.text_stream:
+        print(text, end=&#34;&#34;, flush=True)
+```
+&lt;/CodeGroup&gt;
+
+```json Response
+event: message_start
+data: {&#34;type&#34;:&#34;message_start&#34;,&#34;message&#34;:{&#34;id&#34;:&#34;msg_01G...&#34;,&#34;type&#34;:&#34;message&#34;,&#34;role&#34;:&#34;assistant&#34;,&#34;model&#34;:&#34;claude-sonnet-4-5-20250929&#34;,&#34;content&#34;:[],&#34;stop_reason&#34;:null,&#34;stop_sequence&#34;:null,&#34;usage&#34;:{&#34;input_tokens&#34;:2679,&#34;cache_creation_input_tokens&#34;:0,&#34;cache_read_input_tokens&#34;:0,&#34;output_tokens&#34;:3}}}
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:0,&#34;content_block&#34;:{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;I&#39;ll check&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; the current weather in New York City for you&#34;}}
+
+event: ping
+data: {&#34;type&#34;: &#34;ping&#34;}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:0,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;.&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:0}
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:1,&#34;content_block&#34;:{&#34;type&#34;:&#34;server_tool_use&#34;,&#34;id&#34;:&#34;srvtoolu_014hJH82Qum7Td6UV8gDXThB&#34;,&#34;name&#34;:&#34;web_search&#34;,&#34;input&#34;:{}}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;{\&#34;query&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;\&#34;:&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34; \&#34;weather&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34; NY&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;C to&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:1,&#34;delta&#34;:{&#34;type&#34;:&#34;input_json_delta&#34;,&#34;partial_json&#34;:&#34;day\&#34;}&#34;}}
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:1 }
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:2,&#34;content_block&#34;:{&#34;type&#34;:&#34;web_search_tool_result&#34;,&#34;tool_use_id&#34;:&#34;srvtoolu_014hJH82Qum7Td6UV8gDXThB&#34;,&#34;content&#34;:[{&#34;type&#34;:&#34;web_search_result&#34;,&#34;title&#34;:&#34;Weather in New York City in May 2025 (New York) - detailed Weather Forecast for a month&#34;,&#34;url&#34;:&#34;https://world-weather.info/forecast/usa/new_york/may-2025/&#34;,&#34;encrypted_content&#34;:&#34;Ev0DCioIAxgCIiQ3NmU4ZmI4OC1k...&#34;,&#34;page_age&#34;:null},...]}}
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:2}
+
+event: content_block_start
+data: {&#34;type&#34;:&#34;content_block_start&#34;,&#34;index&#34;:3,&#34;content_block&#34;:{&#34;type&#34;:&#34;text&#34;,&#34;text&#34;:&#34;&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:3,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;Here&#39;s the current weather information for New York&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:3,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; City:\n\n# Weather&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:3,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34; in New York City&#34;}}
+
+event: content_block_delta
+data: {&#34;type&#34;:&#34;content_block_delta&#34;,&#34;index&#34;:3,&#34;delta&#34;:{&#34;type&#34;:&#34;text_delta&#34;,&#34;text&#34;:&#34;\n\n&#34;}}
+
+...
+
+event: content_block_stop
+data: {&#34;type&#34;:&#34;content_block_stop&#34;,&#34;index&#34;:17}
+
+event: message_delta
+data: {&#34;type&#34;:&#34;message_delta&#34;,&#34;delta&#34;:{&#34;stop_reason&#34;:&#34;end_turn&#34;,&#34;stop_sequence&#34;:null},&#34;usage&#34;:{&#34;input_tokens&#34;:10682,&#34;cache_creation_input_tokens&#34;:0,&#34;cache_read_input_tokens&#34;:0,&#34;output_tokens&#34;:510,&#34;server_tool_use&#34;:{&#34;web_search_requests&#34;:1}}}
+
+event: message_stop
+data: {&#34;type&#34;:&#34;message_stop&#34;}
+```
+
+## Error recovery
+
+When a streaming request is interrupted due to network issues, timeouts, or other errors, you can recover by resuming from where the stream was interrupted. This approach saves you from re-processing the entire response.
+
+The basic recovery strategy involves:
+
+1. **Capture the partial response**: Save all content that was successfully received before the error occurred
+2. **Construct a continuation request**: Create a new API request that includes the partial assistant response as the beginning of a new assistant message
+3. **Resume streaming**: Continue receiving the rest of the response from where it was interrupted
+
+### Error recovery best practices
+
+1. **Use SDK features**: Leverage the SDK&#39;s built-in message accumulation and error handling capabilities
+2. **Handle content types**: Be aware that messages can contain multiple content blocks (`text`, `tool_use`, `thinking`). Tool use and extended thinking blocks cannot be partially recovered. You can resume streaming from the most recent text block.</code></pre>
    </div>
</body>
</html>