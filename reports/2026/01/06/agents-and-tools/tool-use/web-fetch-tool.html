<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/tool-use/web-fetch-tool - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/tool-use/web-fetch-tool.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+307</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis for Web Fetch Tool

## Summary
The documentation for the web fetch tool has been significantly expanded to include detailed usage instructions, supported models, safety warnings, and examples for various programming languages. This change introduces a new feature that allows Claude to retrieve content from web pages and PDFs, enhancing its capabilities.

## Key Changes
- **Feature Introduction**: The web fetch tool now enables Claude to fetch content from specified URLs and PDFs, allowing for richer interactions.
- **Safety Warnings**: Added warnings about data exfiltration risks when using the tool in untrusted environments, emphasizing the importance of handling sensitive data carefully.
- **Usage Instructions**: Comprehensive examples in Bash, Python, and TypeScript demonstrate how to implement the web fetch tool in API requests.
- **Parameter Definitions**: Detailed explanations of parameters such as `max_uses`, `allowed_domains`, and `max_content_tokens`, providing developers with clear guidelines for configuration.
- **Error Handling**: Introduced a structured response format for errors encountered during fetch operations, improving clarity on troubleshooting.

## Impact
**High**: This change introduces a new feature that significantly enhances the functionality of the API, allowing developers to integrate web content retrieval into their applications. The detailed documentation also aids in safe and effective usage, which is crucial for developers managing sensitive data.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Web fetch tool&para;<br>&para;<br>---&para;<br>&para;<br>The web fetch tool allows Claude to retrieve full content from specified web pages and PDF documents.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The web fetch tool is currently in beta. To enable it, use the beta header `web-fetch-2025-09-10` in your API requests.&para;<br>&para;<br>Please use [this form](https://forms.gle/NhWcgmkcvPCMmPE86) to provide feedback on the quality of the model responses, the API itself, or the quality of the documentation.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Enabling the web fetch tool in environments where Claude processes untrusted input alongside sensitive data poses data exfiltration risks. We recommend only using this tool in trusted environments or when handling non-sensitive data. &para;<br>&para;<br>To minimize exfiltration risks, Claude is not allowed to dynamically construct URLs. Claude can only fetch URLs that have been explicitly provided by the user or that come from previous web search or web fetch results. However, there is still residual risk that should be carefully considered when using this tool.&para;<br>&para;<br>If data exfiltration is a concern, consider:&para;<br>- Disabling the web fetch tool entirely&para;<br>- Using the `max_uses` parameter to limit the number of requests&para;<br>- Using the `allowed_domains` parameter to restrict to known safe domains&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>## Supported models&para;<br>&para;<br>Web fetch is available on:&para;<br>&para;<br>- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)&para;<br>- Claude Sonnet 4 (`claude-sonnet-4-20250514`)&para;<br>- Claude Sonnet 3.7 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)&para;<br>- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)&para;<br>- Claude Haiku 3.5 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-5-haiku-latest`)&para;<br>- Claude Opus 4.5 (`claude-opus-4-5-20251101`)&para;<br>- Claude Opus 4.1 (`claude-opus-4-1-20250805`)&para;<br>- Claude Opus 4 (`claude-opus-4-20250514`)&para;<br>&para;<br>## How web fetch works&para;<br>&para;<br>When you add the web fetch tool to your API request:&para;<br>&para;<br>1. Claude decides when to fetch content based on the prompt and available URLs.&para;<br>2. The API retrieves the full text content from the specified URL.&para;<br>3. For PDFs, automatic text extraction is performed.&para;<br>4. Claude analyzes the fetched content and provides a response with optional citations.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The web fetch tool currently does not support web sites dynamically rendered via Javascript.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## How to use web fetch&para;<br>&para;<br>Provide the web fetch tool in your API request:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>    --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    --header "anthropic-version: 2023-06-01" \&para;<br>    --header "anthropic-beta: web-fetch-2025-09-10" \&para;<br>    --header "content-type: application/json" \&para;<br>    --data '{&para;<br>        "model": "claude-sonnet-4-5",&para;<br>        "max_tokens": 1024,&para;<br>        "messages": [&para;<br>            {&para;<br>                "role": "user",&para;<br>                "content": "Please analyze the content at https://example.com/article"&para;<br>            }&para;<br>        ],&para;<br>        "tools": [{&para;<br>            "type": "web_fetch_20250910",&para;<br>            "name": "web_fetch",&para;<br>            "max_uses": 5&para;<br>        }]&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Please analyze the content at https://example.com/article"&para;<br>        }&para;<br>    ],&para;<br>    tools=[{&para;<br>        "type": "web_fetch_20250910",&para;<br>        "name": "web_fetch",&para;<br>        "max_uses": 5&para;<br>    }],&para;<br>    extra_headers={&para;<br>        "anthropic-beta": "web-fetch-2025-09-10"&para;<br>    }&para;<br>)&para;<br>print(response)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import { Anthropic } from '@anthropic-ai/sdk';&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>async function main() {&para;<br>  const response = await anthropic.messages.create({&para;<br>    model: "claude-sonnet-4-5",&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      {&para;<br>        role: "user",&para;<br>        content: "Please analyze the content at https://example.com/article"&para;<br>      }&para;<br>    ],&para;<br>    tools: [{&para;<br>      type: "web_fetch_20250910",&para;<br>      name: "web_fetch",&para;<br>      max_uses: 5&para;<br>    }],&para;<br>    headers: {&para;<br>      "anthropic-beta": "web-fetch-2025-09-10"&para;<br>    }&para;<br>  });&para;<br>&para;<br>  console.log(response);&para;<br>}&para;<br>&para;<br>main().catch(console.error);&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>### Tool definition&para;<br>&para;<br>The web fetch tool supports the following parameters:&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "type": "web_fetch_20250910",&para;<br>  "name": "web_fetch",&para;<br>&para;<br>  // Optional: Limit the number of fetches per request&para;<br>  "max_uses": 10,&para;<br>&para;<br>  // Optional: Only fetch from these domains&para;<br>  "allowed_domains": ["example.com", "docs.example.com"],&para;<br>&para;<br>  // Optional: Never fetch from these domains&para;<br>  "blocked_domains": ["private.example.com"],&para;<br>&para;<br>  // Optional: Enable citations for fetched content&para;<br>  "citations": {&para;<br>    "enabled": true&para;<br>  },&para;<br>&para;<br>  // Optional: Maximum content length in tokens&para;<br>  "max_content_tokens": 100000&para;<br>}&para;<br>```&para;<br>&para;<br>#### Max uses&para;<br>&para;<br>The `max_uses` parameter limits the number of web fetches performed. If Claude attempts more fetches than allowed, the `web_fetch_tool_result` will be an error with the `max_uses_exceeded` error code. There is currently no default limit.&para;<br>&para;<br>#### Domain filtering&para;<br>&para;<br>When using domain filters:&para;<br>&para;<br>- Domains should not include the HTTP/HTTPS scheme (use `example.com` instead of `https://example.com`)&para;<br>- Subdomains are automatically included (`example.com` covers `docs.example.com`)&para;<br>- Subpaths are supported (`example.com/blog`)&para;<br>- You can use either `allowed_domains` or `blocked_domains`, but not both in the same request.&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Be aware that Unicode characters in domain names can create security vulnerabilities through homograph attacks, where visually similar characters from different scripts can bypass domain filters. For example, `Ð°mazon.com` (using Cyrillic 'Ð°') may appear identical to `amazon.com` but represents a different domain. &para;<br>&para;<br>When configuring domain allow/block lists:&para;<br>- Use ASCII-only domain names when possible&para;<br>- Consider that URL parsers may handle Unicode normalization differently&para;<br>- Test your domain filters with potential homograph variations&para;<br>- Regularly audit your domain configurations for suspicious Unicode characters&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>#### Content limits&para;<br>&para;<br>The `max_content_tokens` parameter limits the amount of content that will be included in the context. If the fetched content exceeds this limit, it will be truncated. This helps control token usage when fetching large documents.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The `max_content_tokens` parameter limit is approximate. The actual number of input tokens used can vary by a small amount.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### Citations&para;<br>&para;<br>Unlike web search where citations are always enabled, citations are optional for web fetch. Set `"citations": {"enabled": true}` to enable Claude to cite specific passages from fetched documents.&para;<br>&para;<br>&lt;Note&gt;&para;<br>When displaying API outputs directly to end users, citations must be included to the original source. If you are making modifications to API outputs, including by reprocessing and/or combining them with your own material before displaying them to end users, display citations as appropriate based on consultation with your legal team.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>### Response&para;<br>&para;<br>Here's an example response structure:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    // 1. Claude's decision to fetch&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "I'll fetch the content from the article to analyze it."&para;<br>    },&para;<br>    // 2. The fetch request&para;<br>    {&para;<br>      "type": "server_tool_use",&para;<br>      "id": "srvtoolu_01234567890abcdef",&para;<br>      "name": "web_fetch",&para;<br>      "input": {&para;<br>        "url": "https://example.com/article"&para;<br>      }&para;<br>    },&para;<br>    // 3. Fetch results&para;<br>    {&para;<br>      "type": "web_fetch_tool_result",&para;<br>      "tool_use_id": "srvtoolu_01234567890abcdef",&para;<br>      "content": {&para;<br>        "type": "web_fetch_result",&para;<br>        "url": "https://example.com/article",&para;<br>        "content": {&para;<br>          "type": "document",&para;<br>          "source": {&para;<br>            "type": "text",&para;<br>            "media_type": "text/plain",&para;<br>            "data": "Full text content of the article..."&para;<br>          },&para;<br>          "title": "Article Title",&para;<br>          "citations": {"enabled": true}&para;<br>        },&para;<br>        "retrieved_at": "2025-08-25T10:30:00Z"&para;<br>      }&para;<br>    },&para;<br>    // 4. Claude's analysis with citations (if enabled)&para;<br>    {&para;<br>      "text": "Based on the article, ",&para;<br>      "type": "text"&para;<br>    },&para;<br>    {&para;<br>      "text": "the main argument presented is that artificial intelligence will transform healthcare",&para;<br>      "type": "text",&para;<br>      "citations": [&para;<br>        {&para;<br>          "type": "char_location",&para;<br>          "document_index": 0,&para;<br>          "document_title": "Article Title",&para;<br>          "start_char_index": 1234,&para;<br>          "end_char_index": 1456,&para;<br>          "cited_text": "Artificial intelligence is poised to revolutionize healthcare delivery..."&para;<br>        }&para;<br>      ]&para;<br>    }&para;<br>  ],&para;<br>  "id": "msg_a930390d3a",&para;<br>  "usage": {&para;<br>    "input_tokens": 25039,&para;<br>    "output_tokens": 931,&para;<br>    "server_tool_use": {&para;<br>      "web_fetch_requests": 1&para;<br>    }&para;<br>  },&para;<br>  "stop_reason": "end_turn"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Fetch results&para;<br>&para;<br>Fetch results include:&para;<br>&para;<br>- `url`: The URL that was fetched&para;<br>- `content`: A document block containing the fetched content&para;<br>- `retrieved_at`: Timestamp when the content was retrieved&para;<br>&para;<br>&lt;Note&gt;&para;<br>The web fetch tool caches results to improve performance and reduce redundant requests. This means the content returned may not always be the latest version available at the URL. The cache behavior is managed automatically and may change over time to optimize for different content types and usage patterns.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>For PDF documents, the content will be returned as base64-encoded data:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "web_fetch_tool_result",&para;<br>  "tool_use_id": "srvtoolu_02",&para;<br>  "content": {&para;<br>    "type": "web_fetch_result",&para;<br>    "url": "https://example.com/paper.pdf",&para;<br>    "content": {&para;<br>      "type": "document",&para;<br>      "source": {&para;<br>        "type": "base64",&para;<br>        "media_type": "application/pdf",&para;<br>        "data": "JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmo..."&para;<br>      },&para;<br>      "citations": {"enabled": true}&para;<br>    },&para;<br>    "retrieved_at": "2025-08-25T10:30:02Z"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### Errors&para;<br>&para;<br>When the web fetch tool encounters an error, the Claude API returns a 200 (success) response with the error represented in the response body:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "web_fetch_tool_result",&para;<br>  "tool_use_id": "srvtoolu_a93jad",&para;<br>  "content": {&para;<br>    "type": "web_fetch_tool_error",&para;<br>    "error_code": "url_not_accessible"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>These are the possible error codes:&para;<br>&para;<br>- `invalid_input`: Invalid URL format&para;<br>- `url_too_long`: URL exceeds maximum length (250 characters)&para;<br>- `url_not_allowed`: URL blocked by domain filtering rules and model restrictions&para;<br>- `url_not_accessible`: Failed to fetch content (HTTP error)&para;<br>- `too_many_requests`: Rate limit exceeded&para;<br>- `unsupported_content_type`: Content type not supported (only text and PDF)&para;<br>- `max_uses_exceeded`: Maximum web fetch tool uses exceeded&para;<br>- `unavailable`: An internal error occurred&para;<br>&para;<br>## URL validation&para;<br>&para;<br>For security reasons, the web fetch tool can only fetch URLs that have previously appeared in the conversation context. This includes:&para;<br>&para;<br>- URLs in user messages&para;<br>- URLs in client-side tool results&para;<br>- URLs from previous web search or web fetch results&para;<br>&para;<br>The tool cannot fetch arbitrary URLs that Claude generates or URLs from container-based server tools (Code Execution, Bash, etc.).&para;<br>&para;<br>## Combined search and fetch&para;<br>&para;<br>Web fetch works seamlessly with web search for comprehensive information gathering:&para;<br>&para;<br>```python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=4096,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "Find recent articles about quantum computing and analyze the most relevant one in detail"&para;<br>        }&para;<br>    ],&para;<br>    tools=[&para;<br>        {&para;<br>            "type": "web_search_20250305",&para;<br>            "name": "web_search",&para;<br>            "max_uses": 3&para;<br>        },&para;<br>        {&para;<br>            "type": "web_fetch_20250910",&para;<br>            "name": "web_fetch",&para;<br>            "max_uses": 5,&para;<br>            "citations": {"enabled": True}&para;<br>        }&para;<br>    ],&para;<br>    extra_headers={&para;<br>        "anthropic-beta": "web-fetch-2025-09-10"&para;<br>    }&para;<br>)&para;<br>```&para;<br>&para;<br>In this workflow, Claude will:&para;<br>1. Use web search to find relevant articles&para;<br>2. Select the most promising results&para;<br>3. Use web fetch to retrieve full content&para;<br>4. Provide detailed analysis with citations&para;<br>&para;<br>## Prompt caching&para;<br>&para;<br>Web fetch works with [prompt caching](/docs/en/build-with-claude/prompt-caching). To enable prompt caching, add `cache_control` breakpoints in your request. Cached fetch results can be reused across conversation turns.&para;<br>&para;<br>```python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br># First request with web fetch&para;<br>messages = [&para;<br>    {&para;<br>        "role": "user",&para;<br>        "content": "Analyze this research paper: https://arxiv.org/abs/2024.12345"&para;<br>    }&para;<br>]&para;<br>&para;<br>response1 = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{&para;<br>        "type": "web_fetch_20250910",&para;<br>        "name": "web_fetch"&para;<br>    }],&para;<br>    extra_headers={&para;<br>        "anthropic-beta": "web-fetch-2025-09-10"&para;<br>    }&para;<br>)&para;<br>&para;<br># Add Claude's response to conversation&para;<br>messages.append({&para;<br>    "role": "assistant",&para;<br>    "content": response1.content&para;<br>})&para;<br>&para;<br># Second request with cache breakpoint&para;<br>messages.append({&para;<br>    "role": "user",&para;<br>    "content": "What methodology does the paper use?",&para;<br>    "cache_control": {"type": "ephemeral"}&para;<br>})&para;<br>&para;<br>response2 = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{&para;<br>        "type": "web_fetch_20250910",&para;<br>        "name": "web_fetch"&para;<br>    }],&para;<br>    extra_headers={&para;<br>        "anthropic-beta": "web-fetch-2025-09-10"&para;<br>    }&para;<br>)&para;<br>&para;<br># The second response benefits from cached fetch results&para;<br>print(f"Cache read tokens: {response2.usage.get('cache_read_input_tokens', 0)}")&para;<br>```&para;<br>&para;<br>## Streaming&para;<br>&para;<br>With streaming enabled, fetch events are part of the stream with a pause during content retrieval:&para;<br>&para;<br>```javascript&para;<br>event: message_start&para;<br>data: {"type": "message_start", "message": {"id": "msg_abc123", "type": "message"}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}&para;<br>&para;<br>// Claude's decision to fetch&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 1, "content_block": {"type": "server_tool_use", "id": "srvtoolu_xyz789", "name": "web_fetch"}}&para;<br>&para;<br>// Fetch URL streamed&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 1, "delta": {"type": "input_json_delta", "partial_json": "{\"url\":\"https://example.com/article\"}"}}&para;<br>&para;<br>// Pause while fetch executes&para;<br>&para;<br>// Fetch results streamed&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 2, "content_block": {"type": "web_fetch_tool_result", "tool_use_id": "srvtoolu_xyz789", "content": {"type": "web_fetch_result", "url": "https://example.com/article", "content": {"type": "document", "source": {"type": "text", "media_type": "text/plain", "data": "Article content..."}}}}}&para;<br>&para;<br>// Claude's response continues...&para;<br>```&para;<br>&para;<br>## Batch requests&para;<br>&para;<br>You can include the web fetch tool in the [Messages Batches API](/docs/en/build-with-claude/batch-processing). Web fetch tool calls through the Messages Batches API are priced the same as those in regular Messages API requests.&para;<br>&para;<br>## Usage and pricing&para;<br>&para;<br>Web fetch usage has **no additional charges** beyond standard token costs:&para;<br>&para;<br>```json&para;<br>"usage": {&para;<br>  "input_tokens": 25039,&para;<br>  "output_tokens": 931,&para;<br>  "cache_read_input_tokens": 0,&para;<br>  "cache_creation_input_tokens": 0,&para;<br>  "server_tool_use": {&para;<br>    "web_fetch_requests": 1&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>The web fetch tool is available on the Claude API at **no additional cost**. You only pay standard token costs for the fetched content that becomes part of your conversation context.&para;<br>&para;<br>To protect against inadvertently fetching large content that would consume excessive tokens, use the `max_content_tokens` parameter to set appropriate limits based on your use case and budget considerations.&para;<br>&para;<br>Example token usage for typical content:&para;<br>- Average web page (10KB): ~2,500 tokens&para;<br>- Large documentation page (100KB): ~25,000 tokens  &para;<br>- Research paper PDF (500KB): ~125,000 tokens</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/tool-use/web-fetch-tool.md
+++ b/agents-and-tools/tool-use/web-fetch-tool.md
@@ -0,0 +1,507 @@
+# Web fetch tool
+
+---
+
+The web fetch tool allows Claude to retrieve full content from specified web pages and PDF documents.
+
+&lt;Note&gt;
+The web fetch tool is currently in beta. To enable it, use the beta header `web-fetch-2025-09-10` in your API requests.
+
+Please use [this form](https://forms.gle/NhWcgmkcvPCMmPE86) to provide feedback on the quality of the model responses, the API itself, or the quality of the documentation.
+&lt;/Note&gt;
+
+&lt;Warning&gt;
+Enabling the web fetch tool in environments where Claude processes untrusted input alongside sensitive data poses data exfiltration risks. We recommend only using this tool in trusted environments or when handling non-sensitive data. 
+
+To minimize exfiltration risks, Claude is not allowed to dynamically construct URLs. Claude can only fetch URLs that have been explicitly provided by the user or that come from previous web search or web fetch results. However, there is still residual risk that should be carefully considered when using this tool.
+
+If data exfiltration is a concern, consider:
+- Disabling the web fetch tool entirely
+- Using the `max_uses` parameter to limit the number of requests
+- Using the `allowed_domains` parameter to restrict to known safe domains
+&lt;/Warning&gt;
+
+## Supported models
+
+Web fetch is available on:
+
+- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)
+- Claude Sonnet 4 (`claude-sonnet-4-20250514`)
+- Claude Sonnet 3.7 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)
+- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)
+- Claude Haiku 3.5 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-5-haiku-latest`)
+- Claude Opus 4.5 (`claude-opus-4-5-20251101`)
+- Claude Opus 4.1 (`claude-opus-4-1-20250805`)
+- Claude Opus 4 (`claude-opus-4-20250514`)
+
+## How web fetch works
+
+When you add the web fetch tool to your API request:
+
+1. Claude decides when to fetch content based on the prompt and available URLs.
+2. The API retrieves the full text content from the specified URL.
+3. For PDFs, automatic text extraction is performed.
+4. Claude analyzes the fetched content and provides a response with optional citations.
+
+&lt;Note&gt;
+The web fetch tool currently does not support web sites dynamically rendered via Javascript.
+&lt;/Note&gt;
+
+## How to use web fetch
+
+Provide the web fetch tool in your API request:
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+    --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+    --header &#34;anthropic-version: 2023-06-01&#34; \
+    --header &#34;anthropic-beta: web-fetch-2025-09-10&#34; \
+    --header &#34;content-type: application/json&#34; \
+    --data &#39;{
+        &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+        &#34;max_tokens&#34;: 1024,
+        &#34;messages&#34;: [
+            {
+                &#34;role&#34;: &#34;user&#34;,
+                &#34;content&#34;: &#34;Please analyze the content at https://example.com/article&#34;
+            }
+        ],
+        &#34;tools&#34;: [{
+            &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+            &#34;name&#34;: &#34;web_fetch&#34;,
+            &#34;max_uses&#34;: 5
+        }]
+    }&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+response = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;Please analyze the content at https://example.com/article&#34;
+        }
+    ],
+    tools=[{
+        &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+        &#34;name&#34;: &#34;web_fetch&#34;,
+        &#34;max_uses&#34;: 5
+    }],
+    extra_headers={
+        &#34;anthropic-beta&#34;: &#34;web-fetch-2025-09-10&#34;
+    }
+)
+print(response)
+```
+
+```typescript TypeScript
+import { Anthropic } from &#39;@anthropic-ai/sdk&#39;;
+
+const anthropic = new Anthropic();
+
+async function main() {
+  const response = await anthropic.messages.create({
+    model: &#34;claude-sonnet-4-5&#34;,
+    max_tokens: 1024,
+    messages: [
+      {
+        role: &#34;user&#34;,
+        content: &#34;Please analyze the content at https://example.com/article&#34;
+      }
+    ],
+    tools: [{
+      type: &#34;web_fetch_20250910&#34;,
+      name: &#34;web_fetch&#34;,
+      max_uses: 5
+    }],
+    headers: {
+      &#34;anthropic-beta&#34;: &#34;web-fetch-2025-09-10&#34;
+    }
+  });
+
+  console.log(response);
+}
+
+main().catch(console.error);
+```
+&lt;/CodeGroup&gt;
+
+### Tool definition
+
+The web fetch tool supports the following parameters:
+
+```json JSON
+{
+  &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+  &#34;name&#34;: &#34;web_fetch&#34;,
+
+  // Optional: Limit the number of fetches per request
+  &#34;max_uses&#34;: 10,
+
+  // Optional: Only fetch from these domains
+  &#34;allowed_domains&#34;: [&#34;example.com&#34;, &#34;docs.example.com&#34;],
+
+  // Optional: Never fetch from these domains
+  &#34;blocked_domains&#34;: [&#34;private.example.com&#34;],
+
+  // Optional: Enable citations for fetched content
+  &#34;citations&#34;: {
+    &#34;enabled&#34;: true
+  },
+
+  // Optional: Maximum content length in tokens
+  &#34;max_content_tokens&#34;: 100000
+}
+```
+
+#### Max uses
+
+The `max_uses` parameter limits the number of web fetches performed. If Claude attempts more fetches than allowed, the `web_fetch_tool_result` will be an error with the `max_uses_exceeded` error code. There is currently no default limit.
+
+#### Domain filtering
+
+When using domain filters:
+
+- Domains should not include the HTTP/HTTPS scheme (use `example.com` instead of `https://example.com`)
+- Subdomains are automatically included (`example.com` covers `docs.example.com`)
+- Subpaths are supported (`example.com/blog`)
+- You can use either `allowed_domains` or `blocked_domains`, but not both in the same request.
+
+&lt;Warning&gt;
+Be aware that Unicode characters in domain names can create security vulnerabilities through homograph attacks, where visually similar characters from different scripts can bypass domain filters. For example, `Ð°mazon.com` (using Cyrillic &#39;Ð°&#39;) may appear identical to `amazon.com` but represents a different domain. 
+
+When configuring domain allow/block lists:
+- Use ASCII-only domain names when possible
+- Consider that URL parsers may handle Unicode normalization differently
+- Test your domain filters with potential homograph variations
+- Regularly audit your domain configurations for suspicious Unicode characters
+&lt;/Warning&gt;
+
+#### Content limits
+
+The `max_content_tokens` parameter limits the amount of content that will be included in the context. If the fetched content exceeds this limit, it will be truncated. This helps control token usage when fetching large documents.
+
+&lt;Note&gt;
+The `max_content_tokens` parameter limit is approximate. The actual number of input tokens used can vary by a small amount.
+&lt;/Note&gt;
+
+#### Citations
+
+Unlike web search where citations are always enabled, citations are optional for web fetch. Set `&#34;citations&#34;: {&#34;enabled&#34;: true}` to enable Claude to cite specific passages from fetched documents.
+
+&lt;Note&gt;
+When displaying API outputs directly to end users, citations must be included to the original source. If you are making modifications to API outputs, including by reprocessing and/or combining them with your own material before displaying them to end users, display citations as appropriate based on consultation with your legal team.
+&lt;/Note&gt;
+
+### Response
+
+Here&#39;s an example response structure:
+
+```json
+{
+  &#34;role&#34;: &#34;assistant&#34;,
+  &#34;content&#34;: [
+    // 1. Claude&#39;s decision to fetch
+    {
+      &#34;type&#34;: &#34;text&#34;,
+      &#34;text&#34;: &#34;I&#39;ll fetch the content from the article to analyze it.&#34;
+    },
+    // 2. The fetch request
+    {
+      &#34;type&#34;: &#34;server_tool_use&#34;,
+      &#34;id&#34;: &#34;srvtoolu_01234567890abcdef&#34;,
+      &#34;name&#34;: &#34;web_fetch&#34;,
+      &#34;input&#34;: {
+        &#34;url&#34;: &#34;https://example.com/article&#34;
+      }
+    },
+    // 3. Fetch results
+    {
+      &#34;type&#34;: &#34;web_fetch_tool_result&#34;,
+      &#34;tool_use_id&#34;: &#34;srvtoolu_01234567890abcdef&#34;,
+      &#34;content&#34;: {
+        &#34;type&#34;: &#34;web_fetch_result&#34;,
+        &#34;url&#34;: &#34;https://example.com/article&#34;,
+        &#34;content&#34;: {
+          &#34;type&#34;: &#34;document&#34;,
+          &#34;source&#34;: {
+            &#34;type&#34;: &#34;text&#34;,
+            &#34;media_type&#34;: &#34;text/plain&#34;,
+            &#34;data&#34;: &#34;Full text content of the article...&#34;
+          },
+          &#34;title&#34;: &#34;Article Title&#34;,
+          &#34;citations&#34;: {&#34;enabled&#34;: true}
+        },
+        &#34;retrieved_at&#34;: &#34;2025-08-25T10:30:00Z&#34;
+      }
+    },
+    // 4. Claude&#39;s analysis with citations (if enabled)
+    {
+      &#34;text&#34;: &#34;Based on the article, &#34;,
+      &#34;type&#34;: &#34;text&#34;
+    },
+    {
+      &#34;text&#34;: &#34;the main argument presented is that artificial intelligence will transform healthcare&#34;,
+      &#34;type&#34;: &#34;text&#34;,
+      &#34;citations&#34;: [
+        {
+          &#34;type&#34;: &#34;char_location&#34;,
+          &#34;document_index&#34;: 0,
+          &#34;document_title&#34;: &#34;Article Title&#34;,
+          &#34;start_char_index&#34;: 1234,
+          &#34;end_char_index&#34;: 1456,
+          &#34;cited_text&#34;: &#34;Artificial intelligence is poised to revolutionize healthcare delivery...&#34;
+        }
+      ]
+    }
+  ],
+  &#34;id&#34;: &#34;msg_a930390d3a&#34;,
+  &#34;usage&#34;: {
+    &#34;input_tokens&#34;: 25039,
+    &#34;output_tokens&#34;: 931,
+    &#34;server_tool_use&#34;: {
+      &#34;web_fetch_requests&#34;: 1
+    }
+  },
+  &#34;stop_reason&#34;: &#34;end_turn&#34;
+}
+```
+
+#### Fetch results
+
+Fetch results include:
+
+- `url`: The URL that was fetched
+- `content`: A document block containing the fetched content
+- `retrieved_at`: Timestamp when the content was retrieved
+
+&lt;Note&gt;
+The web fetch tool caches results to improve performance and reduce redundant requests. This means the content returned may not always be the latest version available at the URL. The cache behavior is managed automatically and may change over time to optimize for different content types and usage patterns.
+&lt;/Note&gt;
+
+For PDF documents, the content will be returned as base64-encoded data:
+
+```json
+{
+  &#34;type&#34;: &#34;web_fetch_tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;srvtoolu_02&#34;,
+  &#34;content&#34;: {
+    &#34;type&#34;: &#34;web_fetch_result&#34;,
+    &#34;url&#34;: &#34;https://example.com/paper.pdf&#34;,
+    &#34;content&#34;: {
+      &#34;type&#34;: &#34;document&#34;,
+      &#34;source&#34;: {
+        &#34;type&#34;: &#34;base64&#34;,
+        &#34;media_type&#34;: &#34;application/pdf&#34;,
+        &#34;data&#34;: &#34;JVBERi0xLjQKJcOkw7zDtsOfCjIgMCBvYmo...&#34;
+      },
+      &#34;citations&#34;: {&#34;enabled&#34;: true}
+    },
+    &#34;retrieved_at&#34;: &#34;2025-08-25T10:30:02Z&#34;
+  }
+}
+```
+
+#### Errors
+
+When the web fetch tool encounters an error, the Claude API returns a 200 (success) response with the error represented in the response body:
+
+```json
+{
+  &#34;type&#34;: &#34;web_fetch_tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;srvtoolu_a93jad&#34;,
+  &#34;content&#34;: {
+    &#34;type&#34;: &#34;web_fetch_tool_error&#34;,
+    &#34;error_code&#34;: &#34;url_not_accessible&#34;
+  }
+}
+```
+
+These are the possible error codes:
+
+- `invalid_input`: Invalid URL format
+- `url_too_long`: URL exceeds maximum length (250 characters)
+- `url_not_allowed`: URL blocked by domain filtering rules and model restrictions
+- `url_not_accessible`: Failed to fetch content (HTTP error)
+- `too_many_requests`: Rate limit exceeded
+- `unsupported_content_type`: Content type not supported (only text and PDF)
+- `max_uses_exceeded`: Maximum web fetch tool uses exceeded
+- `unavailable`: An internal error occurred
+
+## URL validation
+
+For security reasons, the web fetch tool can only fetch URLs that have previously appeared in the conversation context. This includes:
+
+- URLs in user messages
+- URLs in client-side tool results
+- URLs from previous web search or web fetch results
+
+The tool cannot fetch arbitrary URLs that Claude generates or URLs from container-based server tools (Code Execution, Bash, etc.).
+
+## Combined search and fetch
+
+Web fetch works seamlessly with web search for comprehensive information gathering:
+
+```python
+import anthropic
+
+client = anthropic.Anthropic()
+
+response = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=4096,
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;Find recent articles about quantum computing and analyze the most relevant one in detail&#34;
+        }
+    ],
+    tools=[
+        {
+            &#34;type&#34;: &#34;web_search_20250305&#34;,
+            &#34;name&#34;: &#34;web_search&#34;,
+            &#34;max_uses&#34;: 3
+        },
+        {
+            &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+            &#34;name&#34;: &#34;web_fetch&#34;,
+            &#34;max_uses&#34;: 5,
+            &#34;citations&#34;: {&#34;enabled&#34;: True}
+        }
+    ],
+    extra_headers={
+        &#34;anthropic-beta&#34;: &#34;web-fetch-2025-09-10&#34;
+    }
+)
+```
+
+In this workflow, Claude will:
+1. Use web search to find relevant articles
+2. Select the most promising results
+3. Use web fetch to retrieve full content
+4. Provide detailed analysis with citations
+
+## Prompt caching
+
+Web fetch works with [prompt caching](/docs/en/build-with-claude/prompt-caching). To enable prompt caching, add `cache_control` breakpoints in your request. Cached fetch results can be reused across conversation turns.
+
+```python
+import anthropic
+
+client = anthropic.Anthropic()
+
+# First request with web fetch
+messages = [
+    {
+        &#34;role&#34;: &#34;user&#34;,
+        &#34;content&#34;: &#34;Analyze this research paper: https://arxiv.org/abs/2024.12345&#34;
+    }
+]
+
+response1 = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=messages,
+    tools=[{
+        &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+        &#34;name&#34;: &#34;web_fetch&#34;
+    }],
+    extra_headers={
+        &#34;anthropic-beta&#34;: &#34;web-fetch-2025-09-10&#34;
+    }
+)
+
+# Add Claude&#39;s response to conversation
+messages.append({
+    &#34;role&#34;: &#34;assistant&#34;,
+    &#34;content&#34;: response1.content
+})
+
+# Second request with cache breakpoint
+messages.append({
+    &#34;role&#34;: &#34;user&#34;,
+    &#34;content&#34;: &#34;What methodology does the paper use?&#34;,
+    &#34;cache_control&#34;: {&#34;type&#34;: &#34;ephemeral&#34;}
+})
+
+response2 = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=messages,
+    tools=[{
+        &#34;type&#34;: &#34;web_fetch_20250910&#34;,
+        &#34;name&#34;: &#34;web_fetch&#34;
+    }],
+    extra_headers={
+        &#34;anthropic-beta&#34;: &#34;web-fetch-2025-09-10&#34;
+    }
+)
+
+# The second response benefits from cached fetch results
+print(f&#34;Cache read tokens: {response2.usage.get(&#39;cache_read_input_tokens&#39;, 0)}&#34;)
+```
+
+## Streaming
+
+With streaming enabled, fetch events are part of the stream with a pause during content retrieval:
+
+```javascript
+event: message_start
+data: {&#34;type&#34;: &#34;message_start&#34;, &#34;message&#34;: {&#34;id&#34;: &#34;msg_abc123&#34;, &#34;type&#34;: &#34;message&#34;}}
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 0, &#34;content_block&#34;: {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;&#34;}}
+
+// Claude&#39;s decision to fetch
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 1, &#34;content_block&#34;: {&#34;type&#34;: &#34;server_tool_use&#34;, &#34;id&#34;: &#34;srvtoolu_xyz789&#34;, &#34;name&#34;: &#34;web_fetch&#34;}}
+
+// Fetch URL streamed
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 1, &#34;delta&#34;: {&#34;type&#34;: &#34;input_json_delta&#34;, &#34;partial_json&#34;: &#34;{\&#34;url\&#34;:\&#34;https://example.com/article\&#34;}&#34;}}
+
+// Pause while fetch executes
+
+// Fetch results streamed
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 2, &#34;content_block&#34;: {&#34;type&#34;: &#34;web_fetch_tool_result&#34;, &#34;tool_use_id&#34;: &#34;srvtoolu_xyz789&#34;, &#34;content&#34;: {&#34;type&#34;: &#34;web_fetch_result&#34;, &#34;url&#34;: &#34;https://example.com/article&#34;, &#34;content&#34;: {&#34;type&#34;: &#34;document&#34;, &#34;source&#34;: {&#34;type&#34;: &#34;text&#34;, &#34;media_type&#34;: &#34;text/plain&#34;, &#34;data&#34;: &#34;Article content...&#34;}}}}}
+
+// Claude&#39;s response continues...
+```
+
+## Batch requests
+
+You can include the web fetch tool in the [Messages Batches API](/docs/en/build-with-claude/batch-processing). Web fetch tool calls through the Messages Batches API are priced the same as those in regular Messages API requests.
+
+## Usage and pricing
+
+Web fetch usage has **no additional charges** beyond standard token costs:
+
+```json
+&#34;usage&#34;: {
+  &#34;input_tokens&#34;: 25039,
+  &#34;output_tokens&#34;: 931,
+  &#34;cache_read_input_tokens&#34;: 0,
+  &#34;cache_creation_input_tokens&#34;: 0,
+  &#34;server_tool_use&#34;: {
+    &#34;web_fetch_requests&#34;: 1
+  }
+}
+```
+
+The web fetch tool is available on the Claude API at **no additional cost**. You only pay standard token costs for the fetched content that becomes part of your conversation context.
+
+To protect against inadvertently fetching large content that would consume excessive tokens, use the `max_content_tokens` parameter to set appropriate limits based on your use case and budget considerations.
+
+Example token usage for typical content:
+- Average web page (10KB): ~2,500 tokens
+- Large documentation page (100KB): ~25,000 tokens  
+- Research paper PDF (500KB): ~125,000 tokens</code></pre>
    </div>
</body>
</html>