<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/tool-use/web-search-tool - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/tool-use/web-search-tool.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+262</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis

## Summary
The documentation for the web search tool has been significantly expanded to provide comprehensive details on its functionality, usage, and integration with the Claude API, including examples in multiple programming languages.

## Key Changes
- **Introduction of Web Search Tool**: A new section explaining the web search tool&#39;s capability to access real-time web content and automatically cite sources.
- **Supported Models**: A list of models compatible with the web search tool, indicating which versions can utilize this feature.
- **Detailed Usage Instructions**: Step-by-step guidance on how to implement the web search tool in API requests, including example code snippets in Bash, Python, and TypeScript.
- **Tool Parameters**: Clear definitions of parameters like `max_uses`, `allowed_domains`, and `user_location`, along with their implications for search behavior.
- **Error Handling and Response Structure**: Comprehensive information on error codes, response formats, and how to handle various scenarios, including rate limits and invalid inputs.

## Impact
**High**: This change introduces a new feature that enhances the capabilities of the Claude API, allowing developers to integrate real-time information retrieval into their applications. The detailed documentation will facilitate easier implementation and better error handling, ultimately improving developer experience and application functionality.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Web search tool&para;<br>&para;<br>---&para;<br>&para;<br>The web search tool gives Claude direct access to real-time web content, allowing it to answer questions with up-to-date information beyond its knowledge cutoff. Claude automatically cites sources from search results as part of its answer.&para;<br>&para;<br>&lt;Note&gt;&para;<br>Please reach out through our [feedback form](https://forms.gle/sWjBtsrNEY2oKGuE8) to share your experience with the web search tool.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Supported models&para;<br>&para;<br>Web search is available on:&para;<br>&para;<br>- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)&para;<br>- Claude Sonnet 4 (`claude-sonnet-4-20250514`)&para;<br>- Claude Sonnet 3.7 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)&para;<br>- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)&para;<br>- Claude Haiku 3.5 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-5-haiku-latest`)&para;<br>- Claude Opus 4.5 (`claude-opus-4-5-20251101`)&para;<br>- Claude Opus 4.1 (`claude-opus-4-1-20250805`)&para;<br>- Claude Opus 4 (`claude-opus-4-20250514`)&para;<br>&para;<br>## How web search works&para;<br>&para;<br>When you add the web search tool to your API request:&para;<br>&para;<br>1. Claude decides when to search based on the prompt.&para;<br>2. The API executes the searches and provides Claude with the results. This process may repeat multiple times throughout a single request.&para;<br>3. At the end of its turn, Claude provides a final response with cited sources.&para;<br>&para;<br>## How to use web search&para;<br>&para;<br>&lt;Note&gt;&para;<br>Your organization's administrator must enable web search in [Console](/settings/privacy).&para;<br>&lt;/Note&gt;&para;<br>&para;<br>Provide the web search tool in your API request:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>    --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    --header "anthropic-version: 2023-06-01" \&para;<br>    --header "content-type: application/json" \&para;<br>    --data '{&para;<br>        "model": "claude-sonnet-4-5",&para;<br>        "max_tokens": 1024,&para;<br>        "messages": [&para;<br>            {&para;<br>                "role": "user",&para;<br>                "content": "What is the weather in NYC?"&para;<br>            }&para;<br>        ],&para;<br>        "tools": [{&para;<br>            "type": "web_search_20250305",&para;<br>            "name": "web_search",&para;<br>            "max_uses": 5&para;<br>        }]&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "What's the weather in NYC?"&para;<br>        }&para;<br>    ],&para;<br>    tools=[{&para;<br>        "type": "web_search_20250305",&para;<br>        "name": "web_search",&para;<br>        "max_uses": 5&para;<br>    }]&para;<br>)&para;<br>print(response)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import { Anthropic } from '@anthropic-ai/sdk';&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>async function main() {&para;<br>  const response = await anthropic.messages.create({&para;<br>    model: "claude-sonnet-4-5",&para;<br>    max_tokens: 1024,&para;<br>    messages: [&para;<br>      {&para;<br>        role: "user",&para;<br>        content: "What's the weather in NYC?"&para;<br>      }&para;<br>    ],&para;<br>    tools: [{&para;<br>      type: "web_search_20250305",&para;<br>      name: "web_search",&para;<br>      max_uses: 5&para;<br>    }]&para;<br>  });&para;<br>&para;<br>  console.log(response);&para;<br>}&para;<br>&para;<br>main().catch(console.error);&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>### Tool definition&para;<br>&para;<br>The web search tool supports the following parameters:&para;<br>&para;<br>```json JSON&para;<br>{&para;<br>  "type": "web_search_20250305",&para;<br>  "name": "web_search",&para;<br>&para;<br>  // Optional: Limit the number of searches per request&para;<br>  "max_uses": 5,&para;<br>&para;<br>  // Optional: Only include results from these domains&para;<br>  "allowed_domains": ["example.com", "trusteddomain.org"],&para;<br>&para;<br>  // Optional: Never include results from these domains&para;<br>  "blocked_domains": ["untrustedsource.com"],&para;<br>&para;<br>  // Optional: Localize search results&para;<br>  "user_location": {&para;<br>    "type": "approximate",&para;<br>    "city": "San Francisco",&para;<br>    "region": "California",&para;<br>    "country": "US",&para;<br>    "timezone": "America/Los_Angeles"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>#### Max uses&para;<br>&para;<br>The `max_uses` parameter limits the number of searches performed. If Claude attempts more searches than allowed, the `web_search_tool_result` will be an error with the `max_uses_exceeded` error code.&para;<br>&para;<br>#### Domain filtering&para;<br>&para;<br>When using domain filters:&para;<br>&para;<br>- Domains should not include the HTTP/HTTPS scheme (use `example.com` instead of `https://example.com`)&para;<br>- Subdomains are automatically included (`example.com` covers `docs.example.com`)&para;<br>- Specific subdomains restrict results to only that subdomain (`docs.example.com` returns only results from that subdomain, not from `example.com` or `api.example.com`)&para;<br>- Subpaths are supported and match anything after the path (`example.com/blog` matches `example.com/blog/post-1`)&para;<br>- You can use either `allowed_domains` or `blocked_domains`, but not both in the same request.&para;<br>&para;<br>**Wildcard support:**&para;<br>&para;<br>- Only one wildcard (`*`) is allowed per domain entry, and it must appear after the domain part (in the path)&para;<br>- Valid: `example.com/*`, `example.com/*/articles`&para;<br>- Invalid: `*.example.com`, `ex*.com`, `example.com/*/news/*`&para;<br>&para;<br>Invalid domain formats will return an `invalid_tool_input` tool error.&para;<br>&para;<br>&lt;Note&gt;&para;<br>Request-level domain restrictions must be compatible with organization-level domain restrictions configured in the Console. Request-level domains can only further restrict domains, not override or expand beyond the organization-level list. If your request includes domains that conflict with organization settings, the API will return a validation error.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### Localization&para;<br>&para;<br>The `user_location` parameter allows you to localize search results based on a user's location.&para;<br>&para;<br>- `type`: The type of location (must be `approximate`)&para;<br>- `city`: The city name&para;<br>- `region`: The region or state&para;<br>- `country`: The country&para;<br>- `timezone`: The [IANA timezone ID](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones).&para;<br>&para;<br>### Response&para;<br>&para;<br>Here's an example response structure:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "role": "assistant",&para;<br>  "content": [&para;<br>    // 1. Claude's decision to search&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "I'll search for when Claude Shannon was born."&para;<br>    },&para;<br>    // 2. The search query used&para;<br>    {&para;<br>      "type": "server_tool_use",&para;<br>      "id": "srvtoolu_01WYG3ziw53XMcoyKL4XcZmE",&para;<br>      "name": "web_search",&para;<br>      "input": {&para;<br>        "query": "claude shannon birth date"&para;<br>      }&para;<br>    },&para;<br>    // 3. Search results&para;<br>    {&para;<br>      "type": "web_search_tool_result",&para;<br>      "tool_use_id": "srvtoolu_01WYG3ziw53XMcoyKL4XcZmE",&para;<br>      "content": [&para;<br>        {&para;<br>          "type": "web_search_result",&para;<br>          "url": "https://en.wikipedia.org/wiki/Claude_Shannon",&para;<br>          "title": "Claude Shannon - Wikipedia",&para;<br>          "encrypted_content": "EqgfCioIARgBIiQ3YTAwMjY1Mi1mZjM5LTQ1NGUtODgxNC1kNjNjNTk1ZWI3Y...",&para;<br>          "page_age": "April 30, 2025"&para;<br>        }&para;<br>      ]&para;<br>    },&para;<br>    {&para;<br>      "text": "Based on the search results, ",&para;<br>      "type": "text"&para;<br>    },&para;<br>    // 4. Claude's response with citations&para;<br>    {&para;<br>      "text": "Claude Shannon was born on April 30, 1916, in Petoskey, Michigan",&para;<br>      "type": "text",&para;<br>      "citations": [&para;<br>        {&para;<br>          "type": "web_search_result_location",&para;<br>          "url": "https://en.wikipedia.org/wiki/Claude_Shannon",&para;<br>          "title": "Claude Shannon - Wikipedia",&para;<br>          "encrypted_index": "Eo8BCioIAhgBIiQyYjQ0OWJmZi1lNm..",&para;<br>          "cited_text": "Claude Elwood Shannon (April 30, 1916 â€“ February 24, 2001) was an American mathematician, electrical engineer, computer scientist, cryptographer and i..."&para;<br>        }&para;<br>      ]&para;<br>    }&para;<br>  ],&para;<br>  "id": "msg_a930390d3a",&para;<br>  "usage": {&para;<br>    "input_tokens": 6039,&para;<br>    "output_tokens": 931,&para;<br>    "server_tool_use": {&para;<br>      "web_search_requests": 1&para;<br>    }&para;<br>  },&para;<br>  "stop_reason": "end_turn"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Search results&para;<br>&para;<br>Search results include:&para;<br>&para;<br>- `url`: The URL of the source page&para;<br>- `title`: The title of the source page&para;<br>- `page_age`: When the site was last updated&para;<br>- `encrypted_content`: Encrypted content that must be passed back in multi-turn conversations for citations&para;<br>&para;<br>#### Citations&para;<br>&para;<br>Citations are always enabled for web search, and each `web_search_result_location` includes:&para;<br>&para;<br>- `url`: The URL of the cited source&para;<br>- `title`: The title of the cited source&para;<br>- `encrypted_index`: A reference that must be passed back for multi-turn conversations.&para;<br>- `cited_text`: Up to 150 characters of the cited content&para;<br>&para;<br>The web search citation fields `cited_text`, `title`, and `url` do not count towards input or output token usage. &para;<br>&para;<br>&lt;Note&gt;&para;<br>  When displaying API outputs directly to end users, citations must be included to the original source. If you are making modifications to API outputs, including by reprocessing and/or combining them with your own material before displaying them to end users, display citations as appropriate based on consultation with your legal team.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>#### Errors&para;<br>&para;<br>When the web search tool encounters an error (such as hitting rate limits), the Claude API still returns a 200 (success) response. The error is represented within the response body using the following structure:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "web_search_tool_result",&para;<br>  "tool_use_id": "servertoolu_a93jad",&para;<br>  "content": {&para;<br>    "type": "web_search_tool_result_error",&para;<br>    "error_code": "max_uses_exceeded"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>These are the possible error codes:&para;<br>&para;<br>- `too_many_requests`: Rate limit exceeded&para;<br>- `invalid_input`: Invalid search query parameter&para;<br>- `max_uses_exceeded`: Maximum web search tool uses exceeded&para;<br>- `query_too_long`: Query exceeds maximum length&para;<br>- `unavailable`: An internal error occurred&para;<br>&para;<br>#### `pause_turn` stop reason&para;<br>&para;<br>The response may include a `pause_turn` stop reason, which indicates that the API paused a long-running turn. You may provide the response back as-is in a subsequent request to let Claude continue its turn, or modify the content if you wish to interrupt the conversation.&para;<br>&para;<br>## Prompt caching&para;<br>&para;<br>Web search works with [prompt caching](/docs/en/build-with-claude/prompt-caching). To enable prompt caching, add at least one `cache_control` breakpoint in your request. The system will automatically cache up until the last `web_search_tool_result` block when executing the tool.&para;<br>&para;<br>For multi-turn conversations, set a `cache_control` breakpoint on or after the last `web_search_tool_result` block to reuse cached content.&para;<br>&para;<br>For example, to use prompt caching with web search for a multi-turn conversation:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br># First request with web search and cache breakpoint&para;<br>messages = [&para;<br>    {&para;<br>        "role": "user",&para;<br>        "content": "What's the current weather in San Francisco today?"&para;<br>    }&para;<br>]&para;<br>&para;<br>response1 = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{&para;<br>        "type": "web_search_20250305",&para;<br>        "name": "web_search",&para;<br>        "user_location": {&para;<br>            "type": "approximate",&para;<br>            "city": "San Francisco",&para;<br>            "region": "California",&para;<br>            "country": "US",&para;<br>            "timezone": "America/Los_Angeles"&para;<br>        }&para;<br>    }]&para;<br>)&para;<br>&para;<br># Add Claude's response to the conversation&para;<br>messages.append({&para;<br>    "role": "assistant",&para;<br>    "content": response1.content&para;<br>})&para;<br>&para;<br># Second request with cache breakpoint after the search results&para;<br>messages.append({&para;<br>    "role": "user",&para;<br>    "content": "Should I expect rain later this week?",&para;<br>    "cache_control": {"type": "ephemeral"}  # Cache up to this point&para;<br>})&para;<br>&para;<br>response2 = client.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1024,&para;<br>    messages=messages,&para;<br>    tools=[{&para;<br>        "type": "web_search_20250305",&para;<br>        "name": "web_search",&para;<br>        "user_location": {&para;<br>            "type": "approximate",&para;<br>            "city": "San Francisco",&para;<br>            "region": "California",&para;<br>            "country": "US",&para;<br>            "timezone": "America/Los_Angeles"&para;<br>        }&para;<br>    }]&para;<br>)&para;<br># The second response will benefit from cached search results&para;<br># while still being able to perform new searches if needed&para;<br>print(f"Cache read tokens: {response2.usage.get('cache_read_input_tokens', 0)}")&para;<br>```&para;<br>&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>## Streaming&para;<br>&para;<br>With streaming enabled, you'll receive search events as part of the stream. There will be a pause while the search executes:&para;<br>&para;<br>```javascript&para;<br>event: message_start&para;<br>data: {"type": "message_start", "message": {"id": "msg_abc123", "type": "message"}}&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}&para;<br>&para;<br>// Claude's decision to search&para;<br>&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 1, "content_block": {"type": "server_tool_use", "id": "srvtoolu_xyz789", "name": "web_search"}}&para;<br>&para;<br>// Search query streamed&para;<br>event: content_block_delta&para;<br>data: {"type": "content_block_delta", "index": 1, "delta": {"type": "input_json_delta", "partial_json": "{\"query\":\"latest quantum computing breakthroughs 2025\"}"}}&para;<br>&para;<br>// Pause while search executes&para;<br>&para;<br>// Search results streamed&para;<br>event: content_block_start&para;<br>data: {"type": "content_block_start", "index": 2, "content_block": {"type": "web_search_tool_result", "tool_use_id": "srvtoolu_xyz789", "content": [{"type": "web_search_result", "title": "Quantum Computing Breakthroughs in 2025", "url": "https://example.com"}]}}&para;<br>&para;<br>// Claude's response with citations (omitted in this example)&para;<br>```&para;<br>&para;<br>## Batch requests&para;<br>&para;<br>You can include the web search tool in the [Messages Batches API](/docs/en/build-with-claude/batch-processing). Web search tool calls through the Messages Batches API are priced the same as those in regular Messages API requests.&para;<br>&para;<br>## Usage and pricing&para;<br>&para;<br>Web search usage is charged in addition to token usage:&para;<br>&para;<br>```json&para;<br>"usage": {&para;<br>  "input_tokens": 105,&para;<br>  "output_tokens": 6039,&para;<br>  "cache_read_input_tokens": 7123,&para;<br>  "cache_creation_input_tokens": 7345,&para;<br>  "server_tool_use": {&para;<br>    "web_search_requests": 1&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>Web search is available on the Claude API for **$10 per 1,000 searches**, plus standard token costs for search-generated content. Web search results retrieved throughout a conversation are counted as input tokens, in search iterations executed during a single turn and in subsequent conversation turns.&para;<br>&para;<br>Each web search counts as one use, regardless of the number of results returned. If an error occurs during web search, the web search will not be billed.</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/tool-use/web-search-tool.md
+++ b/agents-and-tools/tool-use/web-search-tool.md
@@ -0,0 +1,424 @@
+# Web search tool
+
+---
+
+The web search tool gives Claude direct access to real-time web content, allowing it to answer questions with up-to-date information beyond its knowledge cutoff. Claude automatically cites sources from search results as part of its answer.
+
+&lt;Note&gt;
+Please reach out through our [feedback form](https://forms.gle/sWjBtsrNEY2oKGuE8) to share your experience with the web search tool.
+&lt;/Note&gt;
+
+## Supported models
+
+Web search is available on:
+
+- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)
+- Claude Sonnet 4 (`claude-sonnet-4-20250514`)
+- Claude Sonnet 3.7 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)
+- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)
+- Claude Haiku 3.5 ([deprecated](/docs/en/about-claude/model-deprecations)) (`claude-3-5-haiku-latest`)
+- Claude Opus 4.5 (`claude-opus-4-5-20251101`)
+- Claude Opus 4.1 (`claude-opus-4-1-20250805`)
+- Claude Opus 4 (`claude-opus-4-20250514`)
+
+## How web search works
+
+When you add the web search tool to your API request:
+
+1. Claude decides when to search based on the prompt.
+2. The API executes the searches and provides Claude with the results. This process may repeat multiple times throughout a single request.
+3. At the end of its turn, Claude provides a final response with cited sources.
+
+## How to use web search
+
+&lt;Note&gt;
+Your organization&#39;s administrator must enable web search in [Console](/settings/privacy).
+&lt;/Note&gt;
+
+Provide the web search tool in your API request:
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+    --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+    --header &#34;anthropic-version: 2023-06-01&#34; \
+    --header &#34;content-type: application/json&#34; \
+    --data &#39;{
+        &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+        &#34;max_tokens&#34;: 1024,
+        &#34;messages&#34;: [
+            {
+                &#34;role&#34;: &#34;user&#34;,
+                &#34;content&#34;: &#34;What is the weather in NYC?&#34;
+            }
+        ],
+        &#34;tools&#34;: [{
+            &#34;type&#34;: &#34;web_search_20250305&#34;,
+            &#34;name&#34;: &#34;web_search&#34;,
+            &#34;max_uses&#34;: 5
+        }]
+    }&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+response = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;What&#39;s the weather in NYC?&#34;
+        }
+    ],
+    tools=[{
+        &#34;type&#34;: &#34;web_search_20250305&#34;,
+        &#34;name&#34;: &#34;web_search&#34;,
+        &#34;max_uses&#34;: 5
+    }]
+)
+print(response)
+```
+
+```typescript TypeScript
+import { Anthropic } from &#39;@anthropic-ai/sdk&#39;;
+
+const anthropic = new Anthropic();
+
+async function main() {
+  const response = await anthropic.messages.create({
+    model: &#34;claude-sonnet-4-5&#34;,
+    max_tokens: 1024,
+    messages: [
+      {
+        role: &#34;user&#34;,
+        content: &#34;What&#39;s the weather in NYC?&#34;
+      }
+    ],
+    tools: [{
+      type: &#34;web_search_20250305&#34;,
+      name: &#34;web_search&#34;,
+      max_uses: 5
+    }]
+  });
+
+  console.log(response);
+}
+
+main().catch(console.error);
+```
+&lt;/CodeGroup&gt;
+
+### Tool definition
+
+The web search tool supports the following parameters:
+
+```json JSON
+{
+  &#34;type&#34;: &#34;web_search_20250305&#34;,
+  &#34;name&#34;: &#34;web_search&#34;,
+
+  // Optional: Limit the number of searches per request
+  &#34;max_uses&#34;: 5,
+
+  // Optional: Only include results from these domains
+  &#34;allowed_domains&#34;: [&#34;example.com&#34;, &#34;trusteddomain.org&#34;],
+
+  // Optional: Never include results from these domains
+  &#34;blocked_domains&#34;: [&#34;untrustedsource.com&#34;],
+
+  // Optional: Localize search results
+  &#34;user_location&#34;: {
+    &#34;type&#34;: &#34;approximate&#34;,
+    &#34;city&#34;: &#34;San Francisco&#34;,
+    &#34;region&#34;: &#34;California&#34;,
+    &#34;country&#34;: &#34;US&#34;,
+    &#34;timezone&#34;: &#34;America/Los_Angeles&#34;
+  }
+}
+```
+
+#### Max uses
+
+The `max_uses` parameter limits the number of searches performed. If Claude attempts more searches than allowed, the `web_search_tool_result` will be an error with the `max_uses_exceeded` error code.
+
+#### Domain filtering
+
+When using domain filters:
+
+- Domains should not include the HTTP/HTTPS scheme (use `example.com` instead of `https://example.com`)
+- Subdomains are automatically included (`example.com` covers `docs.example.com`)
+- Specific subdomains restrict results to only that subdomain (`docs.example.com` returns only results from that subdomain, not from `example.com` or `api.example.com`)
+- Subpaths are supported and match anything after the path (`example.com/blog` matches `example.com/blog/post-1`)
+- You can use either `allowed_domains` or `blocked_domains`, but not both in the same request.
+
+**Wildcard support:**
+
+- Only one wildcard (`*`) is allowed per domain entry, and it must appear after the domain part (in the path)
+- Valid: `example.com/*`, `example.com/*/articles`
+- Invalid: `*.example.com`, `ex*.com`, `example.com/*/news/*`
+
+Invalid domain formats will return an `invalid_tool_input` tool error.
+
+&lt;Note&gt;
+Request-level domain restrictions must be compatible with organization-level domain restrictions configured in the Console. Request-level domains can only further restrict domains, not override or expand beyond the organization-level list. If your request includes domains that conflict with organization settings, the API will return a validation error.
+&lt;/Note&gt;
+
+#### Localization
+
+The `user_location` parameter allows you to localize search results based on a user&#39;s location.
+
+- `type`: The type of location (must be `approximate`)
+- `city`: The city name
+- `region`: The region or state
+- `country`: The country
+- `timezone`: The [IANA timezone ID](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones).
+
+### Response
+
+Here&#39;s an example response structure:
+
+```json
+{
+  &#34;role&#34;: &#34;assistant&#34;,
+  &#34;content&#34;: [
+    // 1. Claude&#39;s decision to search
+    {
+      &#34;type&#34;: &#34;text&#34;,
+      &#34;text&#34;: &#34;I&#39;ll search for when Claude Shannon was born.&#34;
+    },
+    // 2. The search query used
+    {
+      &#34;type&#34;: &#34;server_tool_use&#34;,
+      &#34;id&#34;: &#34;srvtoolu_01WYG3ziw53XMcoyKL4XcZmE&#34;,
+      &#34;name&#34;: &#34;web_search&#34;,
+      &#34;input&#34;: {
+        &#34;query&#34;: &#34;claude shannon birth date&#34;
+      }
+    },
+    // 3. Search results
+    {
+      &#34;type&#34;: &#34;web_search_tool_result&#34;,
+      &#34;tool_use_id&#34;: &#34;srvtoolu_01WYG3ziw53XMcoyKL4XcZmE&#34;,
+      &#34;content&#34;: [
+        {
+          &#34;type&#34;: &#34;web_search_result&#34;,
+          &#34;url&#34;: &#34;https://en.wikipedia.org/wiki/Claude_Shannon&#34;,
+          &#34;title&#34;: &#34;Claude Shannon - Wikipedia&#34;,
+          &#34;encrypted_content&#34;: &#34;EqgfCioIARgBIiQ3YTAwMjY1Mi1mZjM5LTQ1NGUtODgxNC1kNjNjNTk1ZWI3Y...&#34;,
+          &#34;page_age&#34;: &#34;April 30, 2025&#34;
+        }
+      ]
+    },
+    {
+      &#34;text&#34;: &#34;Based on the search results, &#34;,
+      &#34;type&#34;: &#34;text&#34;
+    },
+    // 4. Claude&#39;s response with citations
+    {
+      &#34;text&#34;: &#34;Claude Shannon was born on April 30, 1916, in Petoskey, Michigan&#34;,
+      &#34;type&#34;: &#34;text&#34;,
+      &#34;citations&#34;: [
+        {
+          &#34;type&#34;: &#34;web_search_result_location&#34;,
+          &#34;url&#34;: &#34;https://en.wikipedia.org/wiki/Claude_Shannon&#34;,
+          &#34;title&#34;: &#34;Claude Shannon - Wikipedia&#34;,
+          &#34;encrypted_index&#34;: &#34;Eo8BCioIAhgBIiQyYjQ0OWJmZi1lNm..&#34;,
+          &#34;cited_text&#34;: &#34;Claude Elwood Shannon (April 30, 1916 â€“ February 24, 2001) was an American mathematician, electrical engineer, computer scientist, cryptographer and i...&#34;
+        }
+      ]
+    }
+  ],
+  &#34;id&#34;: &#34;msg_a930390d3a&#34;,
+  &#34;usage&#34;: {
+    &#34;input_tokens&#34;: 6039,
+    &#34;output_tokens&#34;: 931,
+    &#34;server_tool_use&#34;: {
+      &#34;web_search_requests&#34;: 1
+    }
+  },
+  &#34;stop_reason&#34;: &#34;end_turn&#34;
+}
+```
+
+#### Search results
+
+Search results include:
+
+- `url`: The URL of the source page
+- `title`: The title of the source page
+- `page_age`: When the site was last updated
+- `encrypted_content`: Encrypted content that must be passed back in multi-turn conversations for citations
+
+#### Citations
+
+Citations are always enabled for web search, and each `web_search_result_location` includes:
+
+- `url`: The URL of the cited source
+- `title`: The title of the cited source
+- `encrypted_index`: A reference that must be passed back for multi-turn conversations.
+- `cited_text`: Up to 150 characters of the cited content
+
+The web search citation fields `cited_text`, `title`, and `url` do not count towards input or output token usage. 
+
+&lt;Note&gt;
+  When displaying API outputs directly to end users, citations must be included to the original source. If you are making modifications to API outputs, including by reprocessing and/or combining them with your own material before displaying them to end users, display citations as appropriate based on consultation with your legal team.
+&lt;/Note&gt;
+
+#### Errors
+
+When the web search tool encounters an error (such as hitting rate limits), the Claude API still returns a 200 (success) response. The error is represented within the response body using the following structure:
+
+```json
+{
+  &#34;type&#34;: &#34;web_search_tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;servertoolu_a93jad&#34;,
+  &#34;content&#34;: {
+    &#34;type&#34;: &#34;web_search_tool_result_error&#34;,
+    &#34;error_code&#34;: &#34;max_uses_exceeded&#34;
+  }
+}
+```
+
+These are the possible error codes:
+
+- `too_many_requests`: Rate limit exceeded
+- `invalid_input`: Invalid search query parameter
+- `max_uses_exceeded`: Maximum web search tool uses exceeded
+- `query_too_long`: Query exceeds maximum length
+- `unavailable`: An internal error occurred
+
+#### `pause_turn` stop reason
+
+The response may include a `pause_turn` stop reason, which indicates that the API paused a long-running turn. You may provide the response back as-is in a subsequent request to let Claude continue its turn, or modify the content if you wish to interrupt the conversation.
+
+## Prompt caching
+
+Web search works with [prompt caching](/docs/en/build-with-claude/prompt-caching). To enable prompt caching, add at least one `cache_control` breakpoint in your request. The system will automatically cache up until the last `web_search_tool_result` block when executing the tool.
+
+For multi-turn conversations, set a `cache_control` breakpoint on or after the last `web_search_tool_result` block to reuse cached content.
+
+For example, to use prompt caching with web search for a multi-turn conversation:
+
+&lt;CodeGroup&gt;
+```python
+import anthropic
+
+client = anthropic.Anthropic()
+
+# First request with web search and cache breakpoint
+messages = [
+    {
+        &#34;role&#34;: &#34;user&#34;,
+        &#34;content&#34;: &#34;What&#39;s the current weather in San Francisco today?&#34;
+    }
+]
+
+response1 = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=messages,
+    tools=[{
+        &#34;type&#34;: &#34;web_search_20250305&#34;,
+        &#34;name&#34;: &#34;web_search&#34;,
+        &#34;user_location&#34;: {
+            &#34;type&#34;: &#34;approximate&#34;,
+            &#34;city&#34;: &#34;San Francisco&#34;,
+            &#34;region&#34;: &#34;California&#34;,
+            &#34;country&#34;: &#34;US&#34;,
+            &#34;timezone&#34;: &#34;America/Los_Angeles&#34;
+        }
+    }]
+)
+
+# Add Claude&#39;s response to the conversation
+messages.append({
+    &#34;role&#34;: &#34;assistant&#34;,
+    &#34;content&#34;: response1.content
+})
+
+# Second request with cache breakpoint after the search results
+messages.append({
+    &#34;role&#34;: &#34;user&#34;,
+    &#34;content&#34;: &#34;Should I expect rain later this week?&#34;,
+    &#34;cache_control&#34;: {&#34;type&#34;: &#34;ephemeral&#34;}  # Cache up to this point
+})
+
+response2 = client.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1024,
+    messages=messages,
+    tools=[{
+        &#34;type&#34;: &#34;web_search_20250305&#34;,
+        &#34;name&#34;: &#34;web_search&#34;,
+        &#34;user_location&#34;: {
+            &#34;type&#34;: &#34;approximate&#34;,
+            &#34;city&#34;: &#34;San Francisco&#34;,
+            &#34;region&#34;: &#34;California&#34;,
+            &#34;country&#34;: &#34;US&#34;,
+            &#34;timezone&#34;: &#34;America/Los_Angeles&#34;
+        }
+    }]
+)
+# The second response will benefit from cached search results
+# while still being able to perform new searches if needed
+print(f&#34;Cache read tokens: {response2.usage.get(&#39;cache_read_input_tokens&#39;, 0)}&#34;)
+```
+
+&lt;/CodeGroup&gt;
+
+## Streaming
+
+With streaming enabled, you&#39;ll receive search events as part of the stream. There will be a pause while the search executes:
+
+```javascript
+event: message_start
+data: {&#34;type&#34;: &#34;message_start&#34;, &#34;message&#34;: {&#34;id&#34;: &#34;msg_abc123&#34;, &#34;type&#34;: &#34;message&#34;}}
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 0, &#34;content_block&#34;: {&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: &#34;&#34;}}
+
+// Claude&#39;s decision to search
+
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 1, &#34;content_block&#34;: {&#34;type&#34;: &#34;server_tool_use&#34;, &#34;id&#34;: &#34;srvtoolu_xyz789&#34;, &#34;name&#34;: &#34;web_search&#34;}}
+
+// Search query streamed
+event: content_block_delta
+data: {&#34;type&#34;: &#34;content_block_delta&#34;, &#34;index&#34;: 1, &#34;delta&#34;: {&#34;type&#34;: &#34;input_json_delta&#34;, &#34;partial_json&#34;: &#34;{\&#34;query\&#34;:\&#34;latest quantum computing breakthroughs 2025\&#34;}&#34;}}
+
+// Pause while search executes
+
+// Search results streamed
+event: content_block_start
+data: {&#34;type&#34;: &#34;content_block_start&#34;, &#34;index&#34;: 2, &#34;content_block&#34;: {&#34;type&#34;: &#34;web_search_tool_result&#34;, &#34;tool_use_id&#34;: &#34;srvtoolu_xyz789&#34;, &#34;content&#34;: [{&#34;type&#34;: &#34;web_search_result&#34;, &#34;title&#34;: &#34;Quantum Computing Breakthroughs in 2025&#34;, &#34;url&#34;: &#34;https://example.com&#34;}]}}
+
+// Claude&#39;s response with citations (omitted in this example)
+```
+
+## Batch requests
+
+You can include the web search tool in the [Messages Batches API](/docs/en/build-with-claude/batch-processing). Web search tool calls through the Messages Batches API are priced the same as those in regular Messages API requests.
+
+## Usage and pricing
+
+Web search usage is charged in addition to token usage:
+
+```json
+&#34;usage&#34;: {
+  &#34;input_tokens&#34;: 105,
+  &#34;output_tokens&#34;: 6039,
+  &#34;cache_read_input_tokens&#34;: 7123,
+  &#34;cache_creation_input_tokens&#34;: 7345,
+  &#34;server_tool_use&#34;: {
+    &#34;web_search_requests&#34;: 1
+  }
+}
+```
+
+Web search is available on the Claude API for **$10 per 1,000 searches**, plus standard token costs for search-generated content. Web search results retrieved throughout a conversation are counted as input tokens, in search iterations executed during a single turn and in subsequent conversation turns.
+
+Each web search counts as one use, regardless of the number of results returned. If an error occurs during web search, the web search will not be billed.</code></pre>
    </div>
</body>
</html>