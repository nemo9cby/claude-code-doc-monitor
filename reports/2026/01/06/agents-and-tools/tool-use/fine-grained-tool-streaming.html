<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/tool-use/fine-grained-tool-streaming - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/tool-use/fine-grained-tool-streaming.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+135</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis

## Summary
The documentation for fine-grained tool streaming has been introduced, detailing a new beta feature that allows developers to stream tool use parameters without buffering or JSON validation, significantly reducing latency.

## Key Changes
- **Introduction of Fine-grained Tool Streaming**: A new feature that enables streaming of tool parameters directly, improving response times.
- **Beta Feature Notice**: Clear labeling of the feature as beta, advising caution before production use.
- **Usage Examples**: Added examples in Bash, Python, and TypeScript to demonstrate how to implement fine-grained tool streaming.
- **Handling Invalid JSON**: Guidance on managing potential invalid or incomplete JSON responses due to the nature of streaming.
- **Performance Comparison**: Illustrative examples showing the difference in chunking behavior and latency between standard and fine-grained streaming.

## Impact
**High**: This change introduces a significant new feature that can enhance performance and user experience for developers working with the API, but it also requires careful handling of potential edge cases with JSON responses.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Fine-grained tool streaming&para;<br>&para;<br>---&para;<br>&para;<br>Tool use now supports fine-grained [streaming](/docs/en/build-with-claude/streaming) for parameter values. This allows developers to stream tool use parameters without buffering / JSON validation, reducing the latency to begin receiving large parameters.&para;<br>&para;<br>Fine-grained tool streaming is available via the Claude API, AWS Bedrock, Google Cloud's Vertex AI, and Microsoft Foundry.&para;<br>&para;<br>&lt;Note&gt;&para;<br>Fine-grained tool streaming is a beta feature. Please make sure to evaluate your responses before using it in production. &para;<br>&para;<br>Please use [this form](https://forms.gle/D4Fjr7GvQRzfTZT96) to provide feedback on the quality of the model responses, the API itself, or the quality of the documentationâ€”we cannot wait to hear from you!&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Warning&gt;&para;<br>When using fine-grained tool streaming, you may potentially receive invalid or partial JSON inputs. Please make sure to account for these edge cases in your code.&para;<br>&lt;/Warning&gt;&para;<br>## How to use fine-grained tool streaming&para;<br>To use this beta feature, simply add the beta header `fine-grained-tool-streaming-2025-05-14` to a tool use request and turn on streaming.&para;<br>&para;<br>Here's an example of how to use fine-grained tool streaming with the API:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>&para;<br>  ```bash Shell&para;<br>  curl https://api.anthropic.com/v1/messages \&para;<br>    -H "content-type: application/json" \&para;<br>    -H "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    -H "anthropic-version: 2023-06-01" \&para;<br>    -H "anthropic-beta: fine-grained-tool-streaming-2025-05-14" \&para;<br>    -d '{&para;<br>      "model": "claude-sonnet-4-5",&para;<br>      "max_tokens": 65536,&para;<br>      "tools": [&para;<br>        {&para;<br>          "name": "make_file",&para;<br>          "description": "Write text to a file",&para;<br>          "input_schema": {&para;<br>            "type": "object",&para;<br>            "properties": {&para;<br>              "filename": {&para;<br>                "type": "string",&para;<br>                "description": "The filename to write text to"&para;<br>              },&para;<br>              "lines_of_text": {&para;<br>                "type": "array",&para;<br>                "description": "An array of lines of text to write to the file"&para;<br>              }&para;<br>            },&para;<br>            "required": ["filename", "lines_of_text"]&para;<br>          }&para;<br>        }&para;<br>      ],&para;<br>      "messages": [&para;<br>        {&para;<br>          "role": "user",&para;<br>          "content": "Can you write a long poem and make a file called poem.txt?"&para;<br>        }&para;<br>      ],&para;<br>      "stream": true&para;<br>    }' | jq '.usage'&para;<br>  ```&para;<br>&para;<br>  ```python Python&para;<br>  import anthropic&para;<br>&para;<br>  client = anthropic.Anthropic()&para;<br>&para;<br>  response = client.beta.messages.stream(&para;<br>      max_tokens=65536,&para;<br>      model="claude-sonnet-4-5",&para;<br>      tools=[{&para;<br>        "name": "make_file",&para;<br>        "description": "Write text to a file",&para;<br>        "input_schema": {&para;<br>          "type": "object",&para;<br>          "properties": {&para;<br>            "filename": {&para;<br>              "type": "string",&para;<br>              "description": "The filename to write text to"&para;<br>            },&para;<br>            "lines_of_text": {&para;<br>              "type": "array",&para;<br>              "description": "An array of lines of text to write to the file"&para;<br>            }&para;<br>          },&para;<br>          "required": ["filename", "lines_of_text"]&para;<br>        }&para;<br>      }],&para;<br>      messages=[{&para;<br>        "role": "user",&para;<br>        "content": "Can you write a long poem and make a file called poem.txt?"&para;<br>      }],&para;<br>      betas=["fine-grained-tool-streaming-2025-05-14"]&para;<br>  )&para;<br>&para;<br>  print(response.usage)&para;<br>  ```&para;<br>&para;<br>  ```typescript TypeScript&para;<br>  import Anthropic from '@anthropic-ai/sdk';&para;<br>&para;<br>  const anthropic = new Anthropic();&para;<br>&para;<br>  const message = await anthropic.beta.messages.stream({&para;<br>    model: "claude-sonnet-4-5",&para;<br>    max_tokens: 65536,&para;<br>    tools: [{&para;<br>      "name": "make_file",&para;<br>      "description": "Write text to a file",&para;<br>      "input_schema": {&para;<br>        "type": "object",&para;<br>        "properties": {&para;<br>          "filename": {&para;<br>            "type": "string",&para;<br>            "description": "The filename to write text to"&para;<br>          },&para;<br>          "lines_of_text": {&para;<br>            "type": "array",&para;<br>            "description": "An array of lines of text to write to the file"&para;<br>          }&para;<br>        },&para;<br>        "required": ["filename", "lines_of_text"]&para;<br>      }&para;<br>    }],&para;<br>    messages: [{ &para;<br>      role: "user", &para;<br>      content: "Can you write a long poem and make a file called poem.txt?" &para;<br>    }],&para;<br>    betas: ["fine-grained-tool-streaming-2025-05-14"]&para;<br>  });&para;<br>&para;<br>  console.log(message.usage);&para;<br>  ```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>In this example, fine-grained tool streaming enables Claude to stream the lines of a long poem into the tool call `make_file` without buffering to validate if the `lines_of_text` parameter is valid JSON. This means you can see the parameter stream as it arrives, without having to wait for the entire parameter to buffer and validate.&para;<br>&para;<br>&lt;Note&gt;&para;<br>With fine-grained tool streaming, tool use chunks start streaming faster, and are often longer and contain fewer word breaks. This is due to differences in chunking behavior.&para;<br>&para;<br>Example: &para;<br>&para;<br>Without fine-grained streaming (15s delay):&para;<br>```&para;<br>Chunk 1: '{"'&para;<br>Chunk 2: 'query": "Ty'&para;<br>Chunk 3: 'peScri'&para;<br>Chunk 4: 'pt 5.0 5.1 '&para;<br>Chunk 5: '5.2 5'&para;<br>Chunk 6: '.3'&para;<br>Chunk 8: ' new f'&para;<br>Chunk 9: 'eatur'&para;<br>...&para;<br>```&para;<br>&para;<br>With fine-grained streaming (3s delay):&para;<br>```&para;<br>Chunk 1: '{"query": "TypeScript 5.0 5.1 5.2 5.3'&para;<br>Chunk 2: ' new features comparison'&para;<br>```&para;<br>&lt;/Note&gt;&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Because fine-grained streaming sends parameters without buffering or JSON validation, there is no guarantee that the resulting stream will complete in a valid JSON string.&para;<br>Particularly, if the [stop reason](/docs/en/build-with-claude/handling-stop-reasons) `max_tokens` is reached, the stream may end midway through a parameter and may be incomplete. You will generally have to write specific support to handle when `max_tokens` is reached.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>## Handling invalid JSON in tool responses&para;<br>&para;<br>When using fine-grained tool streaming, you may receive invalid or incomplete JSON from the model. If you need to pass this invalid JSON back to the model in an error response block, you may wrap it in a JSON object to ensure proper handling (with a reasonable key). For example:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "INVALID_JSON": "&lt;your invalid json string&gt;"&para;<br>}&para;<br>```&para;<br>&para;<br>This approach helps the model understand that the content is invalid JSON while preserving the original malformed data for debugging purposes.&para;<br>&para;<br>&lt;Note&gt;&para;<br>When wrapping invalid JSON, make sure to properly escape any quotes or special characters in the invalid JSON string to maintain valid JSON structure in the wrapper object.&para;<br>&lt;/Note&gt;</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/tool-use/fine-grained-tool-streaming.md
+++ b/agents-and-tools/tool-use/fine-grained-tool-streaming.md
@@ -0,0 +1,183 @@
+# Fine-grained tool streaming
+
+---
+
+Tool use now supports fine-grained [streaming](/docs/en/build-with-claude/streaming) for parameter values. This allows developers to stream tool use parameters without buffering / JSON validation, reducing the latency to begin receiving large parameters.
+
+Fine-grained tool streaming is available via the Claude API, AWS Bedrock, Google Cloud&#39;s Vertex AI, and Microsoft Foundry.
+
+&lt;Note&gt;
+Fine-grained tool streaming is a beta feature. Please make sure to evaluate your responses before using it in production. 
+
+Please use [this form](https://forms.gle/D4Fjr7GvQRzfTZT96) to provide feedback on the quality of the model responses, the API itself, or the quality of the documentationâ€”we cannot wait to hear from you!
+&lt;/Note&gt;
+
+&lt;Warning&gt;
+When using fine-grained tool streaming, you may potentially receive invalid or partial JSON inputs. Please make sure to account for these edge cases in your code.
+&lt;/Warning&gt;
+## How to use fine-grained tool streaming
+To use this beta feature, simply add the beta header `fine-grained-tool-streaming-2025-05-14` to a tool use request and turn on streaming.
+
+Here&#39;s an example of how to use fine-grained tool streaming with the API:
+
+&lt;CodeGroup&gt;
+
+  ```bash Shell
+  curl https://api.anthropic.com/v1/messages \
+    -H &#34;content-type: application/json&#34; \
+    -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+    -H &#34;anthropic-version: 2023-06-01&#34; \
+    -H &#34;anthropic-beta: fine-grained-tool-streaming-2025-05-14&#34; \
+    -d &#39;{
+      &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+      &#34;max_tokens&#34;: 65536,
+      &#34;tools&#34;: [
+        {
+          &#34;name&#34;: &#34;make_file&#34;,
+          &#34;description&#34;: &#34;Write text to a file&#34;,
+          &#34;input_schema&#34;: {
+            &#34;type&#34;: &#34;object&#34;,
+            &#34;properties&#34;: {
+              &#34;filename&#34;: {
+                &#34;type&#34;: &#34;string&#34;,
+                &#34;description&#34;: &#34;The filename to write text to&#34;
+              },
+              &#34;lines_of_text&#34;: {
+                &#34;type&#34;: &#34;array&#34;,
+                &#34;description&#34;: &#34;An array of lines of text to write to the file&#34;
+              }
+            },
+            &#34;required&#34;: [&#34;filename&#34;, &#34;lines_of_text&#34;]
+          }
+        }
+      ],
+      &#34;messages&#34;: [
+        {
+          &#34;role&#34;: &#34;user&#34;,
+          &#34;content&#34;: &#34;Can you write a long poem and make a file called poem.txt?&#34;
+        }
+      ],
+      &#34;stream&#34;: true
+    }&#39; | jq &#39;.usage&#39;
+  ```
+
+  ```python Python
+  import anthropic
+
+  client = anthropic.Anthropic()
+
+  response = client.beta.messages.stream(
+      max_tokens=65536,
+      model=&#34;claude-sonnet-4-5&#34;,
+      tools=[{
+        &#34;name&#34;: &#34;make_file&#34;,
+        &#34;description&#34;: &#34;Write text to a file&#34;,
+        &#34;input_schema&#34;: {
+          &#34;type&#34;: &#34;object&#34;,
+          &#34;properties&#34;: {
+            &#34;filename&#34;: {
+              &#34;type&#34;: &#34;string&#34;,
+              &#34;description&#34;: &#34;The filename to write text to&#34;
+            },
+            &#34;lines_of_text&#34;: {
+              &#34;type&#34;: &#34;array&#34;,
+              &#34;description&#34;: &#34;An array of lines of text to write to the file&#34;
+            }
+          },
+          &#34;required&#34;: [&#34;filename&#34;, &#34;lines_of_text&#34;]
+        }
+      }],
+      messages=[{
+        &#34;role&#34;: &#34;user&#34;,
+        &#34;content&#34;: &#34;Can you write a long poem and make a file called poem.txt?&#34;
+      }],
+      betas=[&#34;fine-grained-tool-streaming-2025-05-14&#34;]
+  )
+
+  print(response.usage)
+  ```
+
+  ```typescript TypeScript
+  import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+
+  const anthropic = new Anthropic();
+
+  const message = await anthropic.beta.messages.stream({
+    model: &#34;claude-sonnet-4-5&#34;,
+    max_tokens: 65536,
+    tools: [{
+      &#34;name&#34;: &#34;make_file&#34;,
+      &#34;description&#34;: &#34;Write text to a file&#34;,
+      &#34;input_schema&#34;: {
+        &#34;type&#34;: &#34;object&#34;,
+        &#34;properties&#34;: {
+          &#34;filename&#34;: {
+            &#34;type&#34;: &#34;string&#34;,
+            &#34;description&#34;: &#34;The filename to write text to&#34;
+          },
+          &#34;lines_of_text&#34;: {
+            &#34;type&#34;: &#34;array&#34;,
+            &#34;description&#34;: &#34;An array of lines of text to write to the file&#34;
+          }
+        },
+        &#34;required&#34;: [&#34;filename&#34;, &#34;lines_of_text&#34;]
+      }
+    }],
+    messages: [{ 
+      role: &#34;user&#34;, 
+      content: &#34;Can you write a long poem and make a file called poem.txt?&#34; 
+    }],
+    betas: [&#34;fine-grained-tool-streaming-2025-05-14&#34;]
+  });
+
+  console.log(message.usage);
+  ```
+&lt;/CodeGroup&gt;
+
+In this example, fine-grained tool streaming enables Claude to stream the lines of a long poem into the tool call `make_file` without buffering to validate if the `lines_of_text` parameter is valid JSON. This means you can see the parameter stream as it arrives, without having to wait for the entire parameter to buffer and validate.
+
+&lt;Note&gt;
+With fine-grained tool streaming, tool use chunks start streaming faster, and are often longer and contain fewer word breaks. This is due to differences in chunking behavior.
+
+Example: 
+
+Without fine-grained streaming (15s delay):
+```
+Chunk 1: &#39;{&#34;&#39;
+Chunk 2: &#39;query&#34;: &#34;Ty&#39;
+Chunk 3: &#39;peScri&#39;
+Chunk 4: &#39;pt 5.0 5.1 &#39;
+Chunk 5: &#39;5.2 5&#39;
+Chunk 6: &#39;.3&#39;
+Chunk 8: &#39; new f&#39;
+Chunk 9: &#39;eatur&#39;
+...
+```
+
+With fine-grained streaming (3s delay):
+```
+Chunk 1: &#39;{&#34;query&#34;: &#34;TypeScript 5.0 5.1 5.2 5.3&#39;
+Chunk 2: &#39; new features comparison&#39;
+```
+&lt;/Note&gt;
+
+&lt;Warning&gt;
+Because fine-grained streaming sends parameters without buffering or JSON validation, there is no guarantee that the resulting stream will complete in a valid JSON string.
+Particularly, if the [stop reason](/docs/en/build-with-claude/handling-stop-reasons) `max_tokens` is reached, the stream may end midway through a parameter and may be incomplete. You will generally have to write specific support to handle when `max_tokens` is reached.
+&lt;/Warning&gt;
+
+## Handling invalid JSON in tool responses
+
+When using fine-grained tool streaming, you may receive invalid or incomplete JSON from the model. If you need to pass this invalid JSON back to the model in an error response block, you may wrap it in a JSON object to ensure proper handling (with a reasonable key). For example:
+
+```json
+{
+  &#34;INVALID_JSON&#34;: &#34;&lt;your invalid json string&gt;&#34;
+}
+```
+
+This approach helps the model understand that the content is invalid JSON while preserving the original malformed data for debugging purposes.
+
+&lt;Note&gt;
+When wrapping invalid JSON, make sure to properly escape any quotes or special characters in the invalid JSON string to maintain valid JSON structure in the wrapper object.
+&lt;/Note&gt;</code></pre>
    </div>
</body>
</html>