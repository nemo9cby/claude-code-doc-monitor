<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/tool-use/memory-tool - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/tool-use/memory-tool.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+301</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis

## Summary
The documentation for the Memory Tool has been significantly expanded, detailing its functionality, use cases, commands, and security considerations, now providing developers with a comprehensive guide to implementing and utilizing this feature.

## Key Changes
- **Introduction of Memory Tool**: A new section explaining the purpose and capabilities of the Memory Tool, including its ability to store and retrieve information across sessions.
- **Use Cases**: Added examples of how developers can leverage the Memory Tool to maintain context, learn from interactions, and build knowledge bases.
- **Detailed Command Specifications**: Comprehensive descriptions of commands (view, create, str_replace, etc.) for managing memory files, including expected inputs and outputs.
- **Security Considerations**: New guidelines on handling sensitive information, path validation, and memory file management to ensure secure implementation.
- **Integration with Context Editing**: Instructions on how to combine the Memory Tool with context editing for enhanced functionality in long-running workflows.

## Impact
**High**: This change introduces a new feature with extensive documentation, enabling developers to enhance their applications with persistent memory capabilities, which can significantly improve user experience and workflow efficiency.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># Memory tool&para;<br>&para;<br>---&para;<br>&para;<br>The memory tool enables Claude to store and retrieve information across conversations through a memory file directory. Claude can create, read, update, and delete files that persist between sessions, allowing it to build knowledge over time without keeping everything in the context window.&para;<br>&para;<br>The memory tool operates client-sideâ€”you control where and how the data is stored through your own infrastructure.&para;<br>&para;<br>&lt;Note&gt;&para;<br>The memory tool is currently in beta. To enable it, use the beta header `context-management-2025-06-27` in your API requests.&para;<br>&para;<br>Please reach out through our [feedback form](https://forms.gle/YXC2EKGMhjN1c4L88) to share your feedback on this feature.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Use cases&para;<br>&para;<br>- Maintain project context across multiple agent executions&para;<br>- Learn from past interactions, decisions, and feedback&para;<br>- Build knowledge bases over time&para;<br>- Enable cross-conversation learning where Claude improves at recurring workflows&para;<br>&para;<br>## How it works&para;<br>&para;<br>When enabled, Claude automatically checks its memory directory before starting tasks. Claude can create, read, update, and delete files in the `/memories` directory to store what it learns while working, then reference those memories in future conversations to handle similar tasks more effectively or pick up where it left off.&para;<br>&para;<br>Since this is a client-side tool, Claude makes tool calls to perform memory operations, and your application executes those operations locally. This gives you complete control over where and how the memory is stored. For security, you should restrict all memory operations to the `/memories` directory.&para;<br>&para;<br>### Example: How memory tool calls work&para;<br>&para;<br>When you ask Claude to help with a task, Claude automatically checks its memory directory first. Here's what a typical interaction looks like:&para;<br>&para;<br>**1. User request:**&para;<br>```&para;<br>"Help me respond to this customer service ticket."&para;<br>```&para;<br>&para;<br>**2. Claude checks the memory directory:**&para;<br>```&para;<br>"I'll help you respond to the customer service ticket. Let me check my memory for any previous context."&para;<br>```&para;<br>&para;<br>Claude calls the memory tool:&para;<br>```json&para;<br>{&para;<br>  "type": "tool_use",&para;<br>  "id": "toolu_01C4D5E6F7G8H9I0J1K2L3M4",&para;<br>  "name": "memory",&para;<br>  "input": {&para;<br>    "command": "view",&para;<br>    "path": "/memories"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**3. Your application returns the directory contents:**&para;<br>```json&para;<br>{&para;<br>  "type": "tool_result",&para;<br>  "tool_use_id": "toolu_01C4D5E6F7G8H9I0J1K2L3M4",&para;<br>  "content": "Here're the files and directories up to 2 levels deep in /memories, excluding hidden items and node_modules:\n4.0K\t/memories\n1.5K\t/memories/customer_service_guidelines.xml\n2.0K\t/memories/refund_policies.xml"&para;<br>}&para;<br>```&para;<br>&para;<br>**4. Claude reads relevant files:**&para;<br>```json&para;<br>{&para;<br>  "type": "tool_use",&para;<br>  "id": "toolu_01D5E6F7G8H9I0J1K2L3M4N5",&para;<br>  "name": "memory",&para;<br>  "input": {&para;<br>    "command": "view",&para;<br>    "path": "/memories/customer_service_guidelines.xml"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>**5. Your application returns the file contents:**&para;<br>```json&para;<br>{&para;<br>  "type": "tool_result",&para;<br>  "tool_use_id": "toolu_01D5E6F7G8H9I0J1K2L3M4N5",&para;<br>  "content": "Here's the content of /memories/customer_service_guidelines.xml with line numbers:\n     1\t&lt;guidelines&gt;\n     2\t&lt;addressing_customers&gt;\n     3\t- Always address customers by their first name\n     4\t- Use empathetic language\n..."&para;<br>}&para;<br>```&para;<br>&para;<br>**6. Claude uses the memory to help:**&para;<br>```&para;<br>"Based on your customer service guidelines, I can help you craft a response. Please share the ticket details..."&para;<br>```&para;<br>&para;<br>## Supported models&para;<br>&para;<br>The memory tool is available on:&para;<br>&para;<br>- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)&para;<br>- Claude Sonnet 4 (`claude-sonnet-4-20250514`)&para;<br>- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)&para;<br>- Claude Opus 4.5 (`claude-opus-4-5-20251101`)&para;<br>- Claude Opus 4.1 (`claude-opus-4-1-20250805`)&para;<br>- Claude Opus 4 (`claude-opus-4-20250514`)&para;<br>&para;<br>## Getting started&para;<br>&para;<br>To use the memory tool:&para;<br>&para;<br>1. Include the beta header `context-management-2025-06-27` in your API requests&para;<br>2. Add the memory tool to your request&para;<br>3. Implement client-side handlers for memory operations&para;<br>&para;<br>&lt;Note&gt;&para;<br>To handle memory tool operations in your application, you need to implement handlers for each memory command. Our SDKs provide memory tool helpers that handle the tool interfaceâ€”you can subclass `BetaAbstractMemoryTool` (Python) or use `betaMemoryTool` (TypeScript) to implement your own memory backend (file-based, database, cloud storage, encrypted files, etc.).&para;<br>&para;<br>For working examples, see:&para;<br>- Python: [examples/memory/basic.py](https://github.com/anthropics/anthropic-sdk-python/blob/main/examples/memory/basic.py)&para;<br>- TypeScript: [examples/tools-helpers-memory.ts](https://github.com/anthropics/anthropic-sdk-typescript/blob/main/examples/tools-helpers-memory.ts)&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Basic usage&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>&para;<br>```bash cURL&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>    --header "x-api-key: $ANTHROPIC_API_KEY" \&para;<br>    --header "anthropic-version: 2023-06-01" \&para;<br>    --header "content-type: application/json" \&para;<br>    --header "anthropic-beta: context-management-2025-06-27" \&para;<br>    --data '{&para;<br>        "model": "claude-sonnet-4-5",&para;<br>        "max_tokens": 2048,&para;<br>        "messages": [&para;<br>            {&para;<br>                "role": "user",&para;<br>                "content": "I'\''m working on a Python web scraper that keeps crashing with a timeout error. Here'\''s the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this."&para;<br>            }&para;<br>        ],&para;<br>        "tools": [{&para;<br>            "type": "memory_20250818",&para;<br>            "name": "memory"&para;<br>        }]&para;<br>    }'&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>message = client.beta.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=2048,&para;<br>    messages=[&para;<br>        {&para;<br>            "role": "user",&para;<br>            "content": "I'm working on a Python web scraper that keeps crashing with a timeout error. Here's the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this."&para;<br>        }&para;<br>    ],&para;<br>    tools=[{&para;<br>        "type": "memory_20250818",&para;<br>        "name": "memory"&para;<br>    }],&para;<br>    betas=["context-management-2025-06-27"]&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import Anthropic from '@anthropic-ai/sdk';&para;<br>&para;<br>const anthropic = new Anthropic({&para;<br>  apiKey: process.env.ANTHROPIC_API_KEY,&para;<br>});&para;<br>&para;<br>const message = await anthropic.beta.messages.create({&para;<br>  model: "claude-sonnet-4-5",&para;<br>  max_tokens: 2048,&para;<br>  messages: [&para;<br>    {&para;<br>      role: "user",&para;<br>      content: "I'm working on a Python web scraper that keeps crashing with a timeout error. Here's the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this."&para;<br>    }&para;<br>  ],&para;<br>  tools: [{&para;<br>    type: "memory_20250818",&para;<br>    name: "memory"&para;<br>  }],&para;<br>  betas: ["context-management-2025-06-27"]&para;<br>});&para;<br>```&para;<br>&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>## Tool commands&para;<br>&para;<br>Your client-side implementation needs to handle these memory tool commands. While these specifications describe the recommended behaviors that Claude is most familiar with, you can modify your implementation and return strings as needed for your use case.&para;<br>&para;<br>### view&para;<br>Shows directory contents or file contents with optional line ranges:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "view",&para;<br>  "path": "/memories",&para;<br>  "view_range": [1, 10]  // Optional: view specific lines&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>**For directories:** Return a listing that shows files and directories with their sizes:&para;<br>```&para;<br>Here're the files and directories up to 2 levels deep in {path}, excluding hidden items and node_modules:&para;<br>{size}    {path}&para;<br>{size}    {path}/{filename1}&para;<br>{size}    {path}/{filename2}&para;<br>```&para;<br>&para;<br>- Lists files up to 2 levels deep&para;<br>- Shows human-readable sizes (e.g., `5.5K`, `1.2M`)&para;<br>- Excludes hidden items (files starting with `.`) and `node_modules`&para;<br>- Uses tab character between size and path&para;<br>&para;<br>**For files:** Return file contents with a header and line numbers:&para;<br>```&para;<br>Here's the content of {path} with line numbers:&para;<br>{line_numbers}{tab}{content}&para;<br>```&para;<br>&para;<br>Line number formatting:&para;<br>- **Width**: 6 characters, right-aligned with space padding&para;<br>- **Separator**: Tab character between line number and content&para;<br>- **Indexing**: 1-indexed (first line is line 1)&para;<br>- **Line limit**: Files with more than 999,999 lines should return an error: `"File {path} exceeds maximum line limit of 999,999 lines."`&para;<br>&para;<br>**Example output:**&para;<br>```&para;<br>Here's the content of /memories/notes.txt with line numbers:&para;<br>     1	Hello World&para;<br>     2	This is line two&para;<br>    10	Line ten&para;<br>   100	Line one hundred&para;<br>```&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **File/directory does not exist**: `"The path {path} does not exist. Please provide a valid path."`&para;<br>&para;<br>### create&para;<br>Create a new file:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "create",&para;<br>  "path": "/memories/notes.txt",&para;<br>  "file_text": "Meeting notes:\n- Discussed project timeline\n- Next steps defined\n"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>- **Success**: `"File created successfully at: {path}"`&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **File already exists**: `"Error: File {path} already exists"`&para;<br>&para;<br>### str_replace&para;<br>Replace text in a file:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "str_replace",&para;<br>  "path": "/memories/preferences.txt",&para;<br>  "old_str": "Favorite color: blue",&para;<br>  "new_str": "Favorite color: green"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>- **Success**: `"The memory file has been edited."` followed by a snippet of the edited file with line numbers&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **File does not exist**: `"Error: The path {path} does not exist. Please provide a valid path."`&para;<br>- **Text not found**: ``"No replacement was performed, old_str `{old_str}` did not appear verbatim in {path}."``&para;<br>- **Duplicate text**: When `old_str` appears multiple times, return: ``"No replacement was performed. Multiple occurrences of old_str `{old_str}` in lines: {line_numbers}. Please ensure it is unique"``&para;<br>&para;<br>#### Directory handling&para;<br>&para;<br>If the path is a directory, return a "file does not exist" error.&para;<br>&para;<br>### insert&para;<br>Insert text at a specific line:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "insert",&para;<br>  "path": "/memories/todo.txt",&para;<br>  "insert_line": 2,&para;<br>  "insert_text": "- Review memory tool documentation\n"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>- **Success**: `"The file {path} has been edited."`&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **File does not exist**: `"Error: The path {path} does not exist"`&para;<br>- **Invalid line number**: ``"Error: Invalid `insert_line` parameter: {insert_line}. It should be within the range of lines of the file: [0, {n_lines}]"``&para;<br>&para;<br>#### Directory handling&para;<br>&para;<br>If the path is a directory, return a "file does not exist" error.&para;<br>&para;<br>### delete&para;<br>Delete a file or directory:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "delete",&para;<br>  "path": "/memories/old_file.txt"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>- **Success**: `"Successfully deleted {path}"`&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **File/directory does not exist**: `"Error: The path {path} does not exist"`&para;<br>&para;<br>#### Directory handling&para;<br>&para;<br>Deletes the directory and all its contents recursively.&para;<br>&para;<br>### rename&para;<br>Rename or move a file/directory:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "command": "rename",&para;<br>  "old_path": "/memories/draft.txt",&para;<br>  "new_path": "/memories/final.txt"&para;<br>}&para;<br>```&para;<br>&para;<br>#### Return values&para;<br>&para;<br>- **Success**: `"Successfully renamed {old_path} to {new_path}"`&para;<br>&para;<br>#### Error handling&para;<br>&para;<br>- **Source does not exist**: `"Error: The path {old_path} does not exist"`&para;<br>- **Destination already exists**: Return an error (do not overwrite): `"Error: The destination {new_path} already exists"`&para;<br>&para;<br>#### Directory handling&para;<br>&para;<br>Renames the directory.&para;<br>&para;<br>## Prompting guidance&para;<br>&para;<br>We automatically include this instruction to the system prompt when the memory tool is included:&para;<br>&para;<br>```&para;<br>IMPORTANT: ALWAYS VIEW YOUR MEMORY DIRECTORY BEFORE DOING ANYTHING ELSE.&para;<br>MEMORY PROTOCOL:&para;<br>1. Use the `view` command of your `memory` tool to check for earlier progress.&para;<br>2. ... (work on the task) ...&para;<br>     - As you make progress, record status / progress / thoughts etc in your memory.&para;<br>ASSUME INTERRUPTION: Your context window might be reset at any moment, so you risk losing any progress that is not recorded in your memory directory.&para;<br>```&para;<br>&para;<br>If you observe Claude creating cluttered memory files, you can include this instruction:&para;<br>&para;<br>&gt; Note: when editing your memory folder, always try to keep its content up-to-date, coherent and organized. You can rename or delete files that are no longer relevant. Do not create new files unless necessary.&para;<br>&para;<br>You can also guide what Claude writes to memory, e.g., "Only write down information relevant to \&lt;topic\&gt; in your memory system."&para;<br>&para;<br>## Security considerations&para;<br>&para;<br>Here are important security concerns when implementing your memory store:&para;<br>&para;<br>### Sensitive information&para;<br>Claude will usually refuse to write down sensitive information in memory files. However, you may want to implement stricter validation that strips out potentially sensitive information.&para;<br>&para;<br>### File storage size&para;<br>Consider tracking memory file sizes and preventing files from growing too large. Consider adding a maximum number of characters the memory read command can return, and let Claude paginate through contents.&para;<br>&para;<br>### Memory expiration&para;<br>Consider clearing out memory files periodically that haven't been accessed in an extended time.&para;<br>&para;<br>### Path traversal protection&para;<br>&para;<br>&lt;Warning&gt;&para;<br>Malicious path inputs could attempt to access files outside the `/memories` directory. Your implementation **MUST** validate all paths to prevent directory traversal attacks.&para;<br>&lt;/Warning&gt;&para;<br>&para;<br>Consider these safeguards:&para;<br>&para;<br>- Validate that all paths start with `/memories`&para;<br>- Resolve paths to their canonical form and verify they remain within the memory directory&para;<br>- Reject paths containing sequences like `../`, `..\\`, or other traversal patterns&para;<br>- Watch for URL-encoded traversal sequences (`%2e%2e%2f`)&para;<br>- Use your language's built-in path security utilities (e.g., Python's `pathlib.Path.resolve()` and `relative_to()`)&para;<br>&para;<br>## Error handling&para;<br>&para;<br>The memory tool uses similar error handling patterns to the [text editor tool](/docs/en/agents-and-tools/tool-use/text-editor-tool#handle-errors). See the individual tool command sections above for detailed error messages and behaviors. Common errors include file not found, permission errors, invalid paths, and duplicate text matches.&para;<br>&para;<br>## Using with Context Editing&para;<br>&para;<br>The memory tool can be combined with [context editing](/docs/en/build-with-claude/context-editing), which automatically clears old tool results when conversation context grows beyond a configured threshold. This combination enables long-running agentic workflows that would otherwise exceed context limits.&para;<br>&para;<br>### How they work together&para;<br>&para;<br>When context editing is enabled and your conversation approaches the clearing threshold, Claude automatically receives a warning notification. This prompts Claude to preserve any important information from tool results into memory files before those results are cleared from the context window.&para;<br>&para;<br>After tool results are cleared, Claude can retrieve the stored information from memory files whenever needed, effectively treating memory as an extension of its working context. This allows Claude to:&para;<br>&para;<br>- Continue complex, multi-step workflows without losing critical information&para;<br>- Reference past work and decisions even after tool results are removed&para;<br>- Maintain coherent context across conversations that would exceed typical context limits&para;<br>- Build up a knowledge base over time while keeping the active context window manageable&para;<br>&para;<br>### Example workflow&para;<br>&para;<br>Consider a code refactoring project with many file operations:&para;<br>&para;<br>1. Claude makes numerous edits to files, generating many tool results&para;<br>2. As the context grows and approaches your threshold, Claude receives a warning&para;<br>3. Claude summarizes the changes made so far to a memory file (e.g., `/memories/refactoring_progress.xml`)&para;<br>4. Context editing clears the older tool results automatically&para;<br>5. Claude continues working, referencing the memory file when it needs to recall what changes were already completed&para;<br>6. The workflow can continue indefinitely, with Claude managing both active context and persistent memory&para;<br>&para;<br>### Configuration&para;<br>&para;<br>To use both features together:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>&para;<br>```python Python&para;<br>response = client.beta.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=4096,&para;<br>    messages=[...],&para;<br>    tools=[&para;<br>        {&para;<br>            "type": "memory_20250818",&para;<br>            "name": "memory"&para;<br>        },&para;<br>        # Your other tools&para;<br>    ],&para;<br>    betas=["context-management-2025-06-27"],&para;<br>    context_management={&para;<br>        "edits": [&para;<br>            {&para;<br>                "type": "clear_tool_uses_20250919",&para;<br>                "trigger": {&para;<br>                    "type": "input_tokens",&para;<br>                    "value": 100000&para;<br>                },&para;<br>                "keep": {&para;<br>                    "type": "tool_uses",&para;<br>                    "value": 3&para;<br>                }&para;<br>            }&para;<br>        ]&para;<br>    }&para;<br>)&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import Anthropic from '@anthropic-ai/sdk';&para;<br>&para;<br>const anthropic = new Anthropic({&para;<br>  apiKey: process.env.ANTHROPIC_API_KEY,&para;<br>});&para;<br>&para;<br>const response = await anthropic.beta.messages.create({&para;<br>  model: "claude-sonnet-4-5",&para;<br>  max_tokens: 4096,&para;<br>  messages: [...],&para;<br>  tools: [&para;<br>    {&para;<br>      type: "memory_20250818",&para;<br>      name: "memory"&para;<br>    },&para;<br>    // Your other tools&para;<br>  ],&para;<br>  betas: ["context-management-2025-06-27"],&para;<br>  context_management: {&para;<br>    edits: [&para;<br>      {&para;<br>        type: "clear_tool_uses_20250919",&para;<br>        trigger: {&para;<br>          type: "input_tokens",&para;<br>          value: 100000&para;<br>        },&para;<br>        keep: {&para;<br>          type: "tool_uses",&para;<br>          value: 3&para;<br>        }&para;<br>      }&para;<br>    ]&para;<br>  }&para;<br>});&para;<br>```&para;<br>&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>You can also exclude memory tool calls from being cleared to ensure Claude always has access to recent memory operations:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>&para;<br>```python Python&para;<br>context_management={&para;<br>    "edits": [&para;<br>        {&para;<br>            "type": "clear_tool_uses_20250919",&para;<br>            "exclude_tools": ["memory"]&para;<br>        }&para;<br>    ]&para;<br>}&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>context_management: {&para;<br>  edits: [&para;<br>    {&para;<br>      type: "clear_tool_uses_20250919",&para;<br>      exclude_tools: ["memory"]&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>&lt;/CodeGroup&gt;</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/tool-use/memory-tool.md
+++ b/agents-and-tools/tool-use/memory-tool.md
@@ -0,0 +1,541 @@
+# Memory tool
+
+---
+
+The memory tool enables Claude to store and retrieve information across conversations through a memory file directory. Claude can create, read, update, and delete files that persist between sessions, allowing it to build knowledge over time without keeping everything in the context window.
+
+The memory tool operates client-sideâ€”you control where and how the data is stored through your own infrastructure.
+
+&lt;Note&gt;
+The memory tool is currently in beta. To enable it, use the beta header `context-management-2025-06-27` in your API requests.
+
+Please reach out through our [feedback form](https://forms.gle/YXC2EKGMhjN1c4L88) to share your feedback on this feature.
+&lt;/Note&gt;
+
+## Use cases
+
+- Maintain project context across multiple agent executions
+- Learn from past interactions, decisions, and feedback
+- Build knowledge bases over time
+- Enable cross-conversation learning where Claude improves at recurring workflows
+
+## How it works
+
+When enabled, Claude automatically checks its memory directory before starting tasks. Claude can create, read, update, and delete files in the `/memories` directory to store what it learns while working, then reference those memories in future conversations to handle similar tasks more effectively or pick up where it left off.
+
+Since this is a client-side tool, Claude makes tool calls to perform memory operations, and your application executes those operations locally. This gives you complete control over where and how the memory is stored. For security, you should restrict all memory operations to the `/memories` directory.
+
+### Example: How memory tool calls work
+
+When you ask Claude to help with a task, Claude automatically checks its memory directory first. Here&#39;s what a typical interaction looks like:
+
+**1. User request:**
+```
+&#34;Help me respond to this customer service ticket.&#34;
+```
+
+**2. Claude checks the memory directory:**
+```
+&#34;I&#39;ll help you respond to the customer service ticket. Let me check my memory for any previous context.&#34;
+```
+
+Claude calls the memory tool:
+```json
+{
+  &#34;type&#34;: &#34;tool_use&#34;,
+  &#34;id&#34;: &#34;toolu_01C4D5E6F7G8H9I0J1K2L3M4&#34;,
+  &#34;name&#34;: &#34;memory&#34;,
+  &#34;input&#34;: {
+    &#34;command&#34;: &#34;view&#34;,
+    &#34;path&#34;: &#34;/memories&#34;
+  }
+}
+```
+
+**3. Your application returns the directory contents:**
+```json
+{
+  &#34;type&#34;: &#34;tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;toolu_01C4D5E6F7G8H9I0J1K2L3M4&#34;,
+  &#34;content&#34;: &#34;Here&#39;re the files and directories up to 2 levels deep in /memories, excluding hidden items and node_modules:\n4.0K\t/memories\n1.5K\t/memories/customer_service_guidelines.xml\n2.0K\t/memories/refund_policies.xml&#34;
+}
+```
+
+**4. Claude reads relevant files:**
+```json
+{
+  &#34;type&#34;: &#34;tool_use&#34;,
+  &#34;id&#34;: &#34;toolu_01D5E6F7G8H9I0J1K2L3M4N5&#34;,
+  &#34;name&#34;: &#34;memory&#34;,
+  &#34;input&#34;: {
+    &#34;command&#34;: &#34;view&#34;,
+    &#34;path&#34;: &#34;/memories/customer_service_guidelines.xml&#34;
+  }
+}
+```
+
+**5. Your application returns the file contents:**
+```json
+{
+  &#34;type&#34;: &#34;tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;toolu_01D5E6F7G8H9I0J1K2L3M4N5&#34;,
+  &#34;content&#34;: &#34;Here&#39;s the content of /memories/customer_service_guidelines.xml with line numbers:\n     1\t&lt;guidelines&gt;\n     2\t&lt;addressing_customers&gt;\n     3\t- Always address customers by their first name\n     4\t- Use empathetic language\n...&#34;
+}
+```
+
+**6. Claude uses the memory to help:**
+```
+&#34;Based on your customer service guidelines, I can help you craft a response. Please share the ticket details...&#34;
+```
+
+## Supported models
+
+The memory tool is available on:
+
+- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)
+- Claude Sonnet 4 (`claude-sonnet-4-20250514`)
+- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)
+- Claude Opus 4.5 (`claude-opus-4-5-20251101`)
+- Claude Opus 4.1 (`claude-opus-4-1-20250805`)
+- Claude Opus 4 (`claude-opus-4-20250514`)
+
+## Getting started
+
+To use the memory tool:
+
+1. Include the beta header `context-management-2025-06-27` in your API requests
+2. Add the memory tool to your request
+3. Implement client-side handlers for memory operations
+
+&lt;Note&gt;
+To handle memory tool operations in your application, you need to implement handlers for each memory command. Our SDKs provide memory tool helpers that handle the tool interfaceâ€”you can subclass `BetaAbstractMemoryTool` (Python) or use `betaMemoryTool` (TypeScript) to implement your own memory backend (file-based, database, cloud storage, encrypted files, etc.).
+
+For working examples, see:
+- Python: [examples/memory/basic.py](https://github.com/anthropics/anthropic-sdk-python/blob/main/examples/memory/basic.py)
+- TypeScript: [examples/tools-helpers-memory.ts](https://github.com/anthropics/anthropic-sdk-typescript/blob/main/examples/tools-helpers-memory.ts)
+&lt;/Note&gt;
+
+## Basic usage
+
+&lt;CodeGroup&gt;
+
+```bash cURL
+curl https://api.anthropic.com/v1/messages \
+    --header &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
+    --header &#34;anthropic-version: 2023-06-01&#34; \
+    --header &#34;content-type: application/json&#34; \
+    --header &#34;anthropic-beta: context-management-2025-06-27&#34; \
+    --data &#39;{
+        &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+        &#34;max_tokens&#34;: 2048,
+        &#34;messages&#34;: [
+            {
+                &#34;role&#34;: &#34;user&#34;,
+                &#34;content&#34;: &#34;I&#39;\&#39;&#39;m working on a Python web scraper that keeps crashing with a timeout error. Here&#39;\&#39;&#39;s the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this.&#34;
+            }
+        ],
+        &#34;tools&#34;: [{
+            &#34;type&#34;: &#34;memory_20250818&#34;,
+            &#34;name&#34;: &#34;memory&#34;
+        }]
+    }&#39;
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+message = client.beta.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=2048,
+    messages=[
+        {
+            &#34;role&#34;: &#34;user&#34;,
+            &#34;content&#34;: &#34;I&#39;m working on a Python web scraper that keeps crashing with a timeout error. Here&#39;s the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this.&#34;
+        }
+    ],
+    tools=[{
+        &#34;type&#34;: &#34;memory_20250818&#34;,
+        &#34;name&#34;: &#34;memory&#34;
+    }],
+    betas=[&#34;context-management-2025-06-27&#34;]
+)
+```
+
+```typescript TypeScript
+import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+
+const anthropic = new Anthropic({
+  apiKey: process.env.ANTHROPIC_API_KEY,
+});
+
+const message = await anthropic.beta.messages.create({
+  model: &#34;claude-sonnet-4-5&#34;,
+  max_tokens: 2048,
+  messages: [
+    {
+      role: &#34;user&#34;,
+      content: &#34;I&#39;m working on a Python web scraper that keeps crashing with a timeout error. Here&#39;s the problematic function:\n\n```python\ndef fetch_page(url, retries=3):\n    for i in range(retries):\n        try:\n            response = requests.get(url, timeout=5)\n            return response.text\n        except requests.exceptions.Timeout:\n            if i == retries - 1:\n                raise\n            time.sleep(1)\n```\n\nPlease help me debug this.&#34;
+    }
+  ],
+  tools: [{
+    type: &#34;memory_20250818&#34;,
+    name: &#34;memory&#34;
+  }],
+  betas: [&#34;context-management-2025-06-27&#34;]
+});
+```
+
+&lt;/CodeGroup&gt;
+
+## Tool commands
+
+Your client-side implementation needs to handle these memory tool commands. While these specifications describe the recommended behaviors that Claude is most familiar with, you can modify your implementation and return strings as needed for your use case.
+
+### view
+Shows directory contents or file contents with optional line ranges:
+
+```json
+{
+  &#34;command&#34;: &#34;view&#34;,
+  &#34;path&#34;: &#34;/memories&#34;,
+  &#34;view_range&#34;: [1, 10]  // Optional: view specific lines
+}
+```
+
+#### Return values
+
+**For directories:** Return a listing that shows files and directories with their sizes:
+```
+Here&#39;re the files and directories up to 2 levels deep in {path}, excluding hidden items and node_modules:
+{size}    {path}
+{size}    {path}/{filename1}
+{size}    {path}/{filename2}
+```
+
+- Lists files up to 2 levels deep
+- Shows human-readable sizes (e.g., `5.5K`, `1.2M`)
+- Excludes hidden items (files starting with `.`) and `node_modules`
+- Uses tab character between size and path
+
+**For files:** Return file contents with a header and line numbers:
+```
+Here&#39;s the content of {path} with line numbers:
+{line_numbers}{tab}{content}
+```
+
+Line number formatting:
+- **Width**: 6 characters, right-aligned with space padding
+- **Separator**: Tab character between line number and content
+- **Indexing**: 1-indexed (first line is line 1)
+- **Line limit**: Files with more than 999,999 lines should return an error: `&#34;File {path} exceeds maximum line limit of 999,999 lines.&#34;`
+
+**Example output:**
+```
+Here&#39;s the content of /memories/notes.txt with line numbers:
+     1	Hello World
+     2	This is line two
+    10	Line ten
+   100	Line one hundred
+```
+
+#### Error handling
+
+- **File/directory does not exist**: `&#34;The path {path} does not exist. Please provide a valid path.&#34;`
+
+### create
+Create a new file:
+
+```json
+{
+  &#34;command&#34;: &#34;create&#34;,
+  &#34;path&#34;: &#34;/memories/notes.txt&#34;,
+  &#34;file_text&#34;: &#34;Meeting notes:\n- Discussed project timeline\n- Next steps defined\n&#34;
+}
+```
+
+#### Return values
+
+- **Success**: `&#34;File created successfully at: {path}&#34;`
+
+#### Error handling
+
+- **File already exists**: `&#34;Error: File {path} already exists&#34;`
+
+### str_replace
+Replace text in a file:
+
+```json
+{
+  &#34;command&#34;: &#34;str_replace&#34;,
+  &#34;path&#34;: &#34;/memories/preferences.txt&#34;,
+  &#34;old_str&#34;: &#34;Favorite color: blue&#34;,
+  &#34;new_str&#34;: &#34;Favorite color: green&#34;
+}
+```
+
+#### Return values
+
+- **Success**: `&#34;The memory file has been edited.&#34;` followed by a snippet of the edited file with line numbers
+
+#### Error handling
+
+- **File does not exist**: `&#34;Error: The path {path} does not exist. Please provide a valid path.&#34;`
+- **Text not found**: ``&#34;No replacement was performed, old_str `{old_str}` did not appear verbatim in {path}.&#34;``
+- **Duplicate text**: When `old_str` appears multiple times, return: ``&#34;No replacement was performed. Multiple occurrences of old_str `{old_str}` in lines: {line_numbers}. Please ensure it is unique&#34;``
+
+#### Directory handling
+
+If the path is a directory, return a &#34;file does not exist&#34; error.
+
+### insert
+Insert text at a specific line:
+
+```json
+{
+  &#34;command&#34;: &#34;insert&#34;,
+  &#34;path&#34;: &#34;/memories/todo.txt&#34;,
+  &#34;insert_line&#34;: 2,
+  &#34;insert_text&#34;: &#34;- Review memory tool documentation\n&#34;
+}
+```
+
+#### Return values
+
+- **Success**: `&#34;The file {path} has been edited.&#34;`
+
+#### Error handling
+
+- **File does not exist**: `&#34;Error: The path {path} does not exist&#34;`
+- **Invalid line number**: ``&#34;Error: Invalid `insert_line` parameter: {insert_line}. It should be within the range of lines of the file: [0, {n_lines}]&#34;``
+
+#### Directory handling
+
+If the path is a directory, return a &#34;file does not exist&#34; error.
+
+### delete
+Delete a file or directory:
+
+```json
+{
+  &#34;command&#34;: &#34;delete&#34;,
+  &#34;path&#34;: &#34;/memories/old_file.txt&#34;
+}
+```
+
+#### Return values
+
+- **Success**: `&#34;Successfully deleted {path}&#34;`
+
+#### Error handling
+
+- **File/directory does not exist**: `&#34;Error: The path {path} does not exist&#34;`
+
+#### Directory handling
+
+Deletes the directory and all its contents recursively.
+
+### rename
+Rename or move a file/directory:
+
+```json
+{
+  &#34;command&#34;: &#34;rename&#34;,
+  &#34;old_path&#34;: &#34;/memories/draft.txt&#34;,
+  &#34;new_path&#34;: &#34;/memories/final.txt&#34;
+}
+```
+
+#### Return values
+
+- **Success**: `&#34;Successfully renamed {old_path} to {new_path}&#34;`
+
+#### Error handling
+
+- **Source does not exist**: `&#34;Error: The path {old_path} does not exist&#34;`
+- **Destination already exists**: Return an error (do not overwrite): `&#34;Error: The destination {new_path} already exists&#34;`
+
+#### Directory handling
+
+Renames the directory.
+
+## Prompting guidance
+
+We automatically include this instruction to the system prompt when the memory tool is included:
+
+```
+IMPORTANT: ALWAYS VIEW YOUR MEMORY DIRECTORY BEFORE DOING ANYTHING ELSE.
+MEMORY PROTOCOL:
+1. Use the `view` command of your `memory` tool to check for earlier progress.
+2. ... (work on the task) ...
+     - As you make progress, record status / progress / thoughts etc in your memory.
+ASSUME INTERRUPTION: Your context window might be reset at any moment, so you risk losing any progress that is not recorded in your memory directory.
+```
+
+If you observe Claude creating cluttered memory files, you can include this instruction:
+
+&gt; Note: when editing your memory folder, always try to keep its content up-to-date, coherent and organized. You can rename or delete files that are no longer relevant. Do not create new files unless necessary.
+
+You can also guide what Claude writes to memory, e.g., &#34;Only write down information relevant to \&lt;topic\&gt; in your memory system.&#34;
+
+## Security considerations
+
+Here are important security concerns when implementing your memory store:
+
+### Sensitive information
+Claude will usually refuse to write down sensitive information in memory files. However, you may want to implement stricter validation that strips out potentially sensitive information.
+
+### File storage size
+Consider tracking memory file sizes and preventing files from growing too large. Consider adding a maximum number of characters the memory read command can return, and let Claude paginate through contents.
+
+### Memory expiration
+Consider clearing out memory files periodically that haven&#39;t been accessed in an extended time.
+
+### Path traversal protection
+
+&lt;Warning&gt;
+Malicious path inputs could attempt to access files outside the `/memories` directory. Your implementation **MUST** validate all paths to prevent directory traversal attacks.
+&lt;/Warning&gt;
+
+Consider these safeguards:
+
+- Validate that all paths start with `/memories`
+- Resolve paths to their canonical form and verify they remain within the memory directory
+- Reject paths containing sequences like `../`, `..\\`, or other traversal patterns
+- Watch for URL-encoded traversal sequences (`%2e%2e%2f`)
+- Use your language&#39;s built-in path security utilities (e.g., Python&#39;s `pathlib.Path.resolve()` and `relative_to()`)
+
+## Error handling
+
+The memory tool uses similar error handling patterns to the [text editor tool](/docs/en/agents-and-tools/tool-use/text-editor-tool#handle-errors). See the individual tool command sections above for detailed error messages and behaviors. Common errors include file not found, permission errors, invalid paths, and duplicate text matches.
+
+## Using with Context Editing
+
+The memory tool can be combined with [context editing](/docs/en/build-with-claude/context-editing), which automatically clears old tool results when conversation context grows beyond a configured threshold. This combination enables long-running agentic workflows that would otherwise exceed context limits.
+
+### How they work together
+
+When context editing is enabled and your conversation approaches the clearing threshold, Claude automatically receives a warning notification. This prompts Claude to preserve any important information from tool results into memory files before those results are cleared from the context window.
+
+After tool results are cleared, Claude can retrieve the stored information from memory files whenever needed, effectively treating memory as an extension of its working context. This allows Claude to:
+
+- Continue complex, multi-step workflows without losing critical information
+- Reference past work and decisions even after tool results are removed
+- Maintain coherent context across conversations that would exceed typical context limits
+- Build up a knowledge base over time while keeping the active context window manageable
+
+### Example workflow
+
+Consider a code refactoring project with many file operations:
+
+1. Claude makes numerous edits to files, generating many tool results
+2. As the context grows and approaches your threshold, Claude receives a warning
+3. Claude summarizes the changes made so far to a memory file (e.g., `/memories/refactoring_progress.xml`)
+4. Context editing clears the older tool results automatically
+5. Claude continues working, referencing the memory file when it needs to recall what changes were already completed
+6. The workflow can continue indefinitely, with Claude managing both active context and persistent memory
+
+### Configuration
+
+To use both features together:
+
+&lt;CodeGroup&gt;
+
+```python Python
+response = client.beta.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=4096,
+    messages=[...],
+    tools=[
+        {
+            &#34;type&#34;: &#34;memory_20250818&#34;,
+            &#34;name&#34;: &#34;memory&#34;
+        },
+        # Your other tools
+    ],
+    betas=[&#34;context-management-2025-06-27&#34;],
+    context_management={
+        &#34;edits&#34;: [
+            {
+                &#34;type&#34;: &#34;clear_tool_uses_20250919&#34;,
+                &#34;trigger&#34;: {
+                    &#34;type&#34;: &#34;input_tokens&#34;,
+                    &#34;value&#34;: 100000
+                },
+                &#34;keep&#34;: {
+                    &#34;type&#34;: &#34;tool_uses&#34;,
+                    &#34;value&#34;: 3
+                }
+            }
+        ]
+    }
+)
+```
+
+```typescript TypeScript
+import Anthropic from &#39;@anthropic-ai/sdk&#39;;
+
+const anthropic = new Anthropic({
+  apiKey: process.env.ANTHROPIC_API_KEY,
+});
+
+const response = await anthropic.beta.messages.create({
+  model: &#34;claude-sonnet-4-5&#34;,
+  max_tokens: 4096,
+  messages: [...],
+  tools: [
+    {
+      type: &#34;memory_20250818&#34;,
+      name: &#34;memory&#34;
+    },
+    // Your other tools
+  ],
+  betas: [&#34;context-management-2025-06-27&#34;],
+  context_management: {
+    edits: [
+      {
+        type: &#34;clear_tool_uses_20250919&#34;,
+        trigger: {
+          type: &#34;input_tokens&#34;,
+          value: 100000
+        },
+        keep: {
+          type: &#34;tool_uses&#34;,
+          value: 3
+        }
+      }
+    ]
+  }
+});
+```
+
+&lt;/CodeGroup&gt;
+
+You can also exclude memory tool calls from being cleared to ensure Claude always has access to recent memory operations:
+
+&lt;CodeGroup&gt;
+
+```python Python
+context_management={
+    &#34;edits&#34;: [
+        {
+            &#34;type&#34;: &#34;clear_tool_uses_20250919&#34;,
+            &#34;exclude_tools&#34;: [&#34;memory&#34;]
+        }
+    ]
+}
+```
+
+```typescript TypeScript
+context_management: {
+  edits: [
+    {
+      type: &#34;clear_tool_uses_20250919&#34;,
+      exclude_tools: [&#34;memory&#34;]
+    }
+  ]
+}
+```
+
+&lt;/CodeGroup&gt;</code></pre>
    </div>
</body>
</html>