<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agents-and-tools/mcp-connector - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>agents-and-tools/mcp-connector.md</h1>
            <p class="meta">Changed on 2026-01-06 14:35:17 UTC</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+272</span> lines added
            </div>
            <div class="stat removed">
                <span>-0</span> lines removed
            </div>
        </div>

        
        <div class="analysis">
            <div class="analysis-header">ðŸ¤– AI Analysis</div>
            <div class="analysis-content"># Documentation Change Analysis: MCP Connector

## Summary
The documentation for the MCP connector has been significantly expanded to include comprehensive details about its features, usage, configuration, and migration from a deprecated version. This new content provides developers with essential guidance for utilizing the MCP connector effectively.

## Key Changes
- **Introduction of MCP Connector**: A new section detailing the MCP connector&#39;s purpose and capabilities, allowing direct connections to MCP servers via the Messages API.
- **Key Features Listed**: Highlights of features such as direct API integration, tool calling support, and flexible tool configuration options.
- **Detailed Usage Examples**: Added code snippets in Bash, TypeScript, and Python to demonstrate how to implement the MCP connector in various environments.
- **Migration Guide**: Clear instructions for transitioning from the deprecated `mcp-client-2025-04-04` to the new `mcp-client-2025-11-20`, outlining key changes in configuration.
- **Validation Rules and Common Patterns**: New sections that clarify how to structure requests and common configuration patterns for enabling/disabling tools.

## Impact
**High**: This change introduces new features and a migration path, significantly affecting how developers will implement and configure the MCP connector in their applications. The detailed guidance and examples will enhance developer productivity and reduce the likelihood of errors during implementation.</div>
        </div>
        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;"># MCP connector&para;<br>&para;<br>---&para;<br>&para;<br>Claude's Model Context Protocol (MCP) connector feature enables you to connect to remote MCP servers directly from the Messages API without a separate MCP client.&para;<br>&para;<br>&lt;Note&gt;&para;<br>  **Current version**: This feature requires the beta header: `"anthropic-beta": "mcp-client-2025-11-20"`&para;<br>&para;<br>  The previous version (`mcp-client-2025-04-04`) is deprecated. See the [deprecated version documentation](#deprecated-version-mcp-client-2025-04-04) below.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## Key features&para;<br>&para;<br>- **Direct API integration**: Connect to MCP servers without implementing an MCP client&para;<br>- **Tool calling support**: Access MCP tools through the Messages API&para;<br>- **Flexible tool configuration**: Enable all tools, allowlist specific tools, or denylist unwanted tools&para;<br>- **Per-tool configuration**: Configure individual tools with custom settings&para;<br>- **OAuth authentication**: Support for OAuth Bearer tokens for authenticated servers&para;<br>- **Multiple servers**: Connect to multiple MCP servers in a single request&para;<br>&para;<br>## Limitations&para;<br>&para;<br>- Of the feature set of the [MCP specification](https://modelcontextprotocol.io/introduction#explore-mcp), only [tool calls](https://modelcontextprotocol.io/docs/concepts/tools) are currently supported.&para;<br>- The server must be publicly exposed through HTTP (supports both Streamable HTTP and SSE transports). Local STDIO servers cannot be connected directly.&para;<br>- The MCP connector is currently not supported on Amazon Bedrock and Google Vertex.&para;<br>&para;<br>## Using the MCP connector in the Messages API&para;<br>&para;<br>The MCP connector uses two components:&para;<br>&para;<br>1. **MCP Server Definition** (`mcp_servers` array): Defines server connection details (URL, authentication)&para;<br>2. **MCP Toolset** (`tools` array): Configures which tools to enable and how to configure them&para;<br>&para;<br>### Basic example&para;<br>&para;<br>This example enables all tools from an MCP server with default configuration:&para;<br>&para;<br>&lt;CodeGroup&gt;&para;<br>```bash Shell&para;<br>curl https://api.anthropic.com/v1/messages \&para;<br>  -H "Content-Type: application/json" \&para;<br>  -H "X-API-Key: $ANTHROPIC_API_KEY" \&para;<br>  -H "anthropic-version: 2023-06-01" \&para;<br>  -H "anthropic-beta: mcp-client-2025-11-20" \&para;<br>  -d '{&para;<br>    "model": "claude-sonnet-4-5",&para;<br>    "max_tokens": 1000,&para;<br>    "messages": [{"role": "user", "content": "What tools do you have available?"}],&para;<br>    "mcp_servers": [&para;<br>      {&para;<br>        "type": "url",&para;<br>        "url": "https://example-server.modelcontextprotocol.io/sse",&para;<br>        "name": "example-mcp",&para;<br>        "authorization_token": "YOUR_TOKEN"&para;<br>      }&para;<br>    ],&para;<br>    "tools": [&para;<br>      {&para;<br>        "type": "mcp_toolset",&para;<br>        "mcp_server_name": "example-mcp"&para;<br>      }&para;<br>    ]&para;<br>  }'&para;<br>```&para;<br>&para;<br>```typescript TypeScript&para;<br>import { Anthropic } from '@anthropic-ai/sdk';&para;<br>&para;<br>const anthropic = new Anthropic();&para;<br>&para;<br>const response = await anthropic.beta.messages.create({&para;<br>  model: "claude-sonnet-4-5",&para;<br>  max_tokens: 1000,&para;<br>  messages: [&para;<br>    {&para;<br>      role: "user",&para;<br>      content: "What tools do you have available?",&para;<br>    },&para;<br>  ],&para;<br>  mcp_servers: [&para;<br>    {&para;<br>      type: "url",&para;<br>      url: "https://example-server.modelcontextprotocol.io/sse",&para;<br>      name: "example-mcp",&para;<br>      authorization_token: "YOUR_TOKEN",&para;<br>    },&para;<br>  ],&para;<br>  tools: [&para;<br>    {&para;<br>      type: "mcp_toolset",&para;<br>      mcp_server_name: "example-mcp",&para;<br>    },&para;<br>  ],&para;<br>  betas: ["mcp-client-2025-11-20"],&para;<br>});&para;<br>```&para;<br>&para;<br>```python Python&para;<br>import anthropic&para;<br>&para;<br>client = anthropic.Anthropic()&para;<br>&para;<br>response = client.beta.messages.create(&para;<br>    model="claude-sonnet-4-5",&para;<br>    max_tokens=1000,&para;<br>    messages=[{&para;<br>        "role": "user",&para;<br>        "content": "What tools do you have available?"&para;<br>    }],&para;<br>    mcp_servers=[{&para;<br>        "type": "url",&para;<br>        "url": "https://mcp.example.com/sse",&para;<br>        "name": "example-mcp",&para;<br>        "authorization_token": "YOUR_TOKEN"&para;<br>    }],&para;<br>    tools=[{&para;<br>        "type": "mcp_toolset",&para;<br>        "mcp_server_name": "example-mcp"&para;<br>    }],&para;<br>    betas=["mcp-client-2025-11-20"]&para;<br>)&para;<br>```&para;<br>&lt;/CodeGroup&gt;&para;<br>&para;<br>## MCP server configuration&para;<br>&para;<br>Each MCP server in the `mcp_servers` array defines the connection details:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "url",&para;<br>  "url": "https://example-server.modelcontextprotocol.io/sse",&para;<br>  "name": "example-mcp",&para;<br>  "authorization_token": "YOUR_TOKEN"&para;<br>}&para;<br>```&para;<br>&para;<br>### Field descriptions&para;<br>&para;<br>| Property | Type | Required | Description |&para;<br>|----------|------|----------|-------------|&para;<br>| `type` | string | Yes | Currently only "url" is supported |&para;<br>| `url` | string | Yes | The URL of the MCP server. Must start with https:// |&para;<br>| `name` | string | Yes | A unique identifier for this MCP server. Must be referenced by exactly one MCPToolset in the `tools` array. |&para;<br>| `authorization_token` | string | No | OAuth authorization token if required by the MCP server. See [MCP specification](https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization). |&para;<br>&para;<br>## MCP toolset configuration&para;<br>&para;<br>The MCPToolset lives in the `tools` array and configures which tools from the MCP server are enabled and how they should be configured.&para;<br>&para;<br>### Basic structure&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "example-mcp",&para;<br>  "default_config": {&para;<br>    "enabled": true,&para;<br>    "defer_loading": false&para;<br>  },&para;<br>  "configs": {&para;<br>    "specific_tool_name": {&para;<br>      "enabled": true,&para;<br>      "defer_loading": true&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Field descriptions&para;<br>&para;<br>| Property | Type | Required | Description |&para;<br>|----------|------|----------|-------------|&para;<br>| `type` | string | Yes | Must be "mcp_toolset" |&para;<br>| `mcp_server_name` | string | Yes | Must match a server name defined in the `mcp_servers` array |&para;<br>| `default_config` | object | No | Default configuration applied to all tools in this set. Individual tool configs in `configs` will override these defaults. |&para;<br>| `configs` | object | No | Per-tool configuration overrides. Keys are tool names, values are configuration objects. |&para;<br>| `cache_control` | object | No | Cache breakpoint configuration for this toolset |&para;<br>&para;<br>### Tool configuration options&para;<br>&para;<br>Each tool (whether configured in `default_config` or in `configs`) supports the following fields:&para;<br>&para;<br>| Property | Type | Default | Description |&para;<br>|----------|------|---------|-------------|&para;<br>| `enabled` | boolean | `true` | Whether this tool is enabled |&para;<br>| `defer_loading` | boolean | `false` | If true, tool description is not sent to the model initially. Used with [Tool Search Tool](/docs/en/agents-and-tools/tool-use/tool-search-tool). |&para;<br>&para;<br>### Configuration merging&para;<br>&para;<br>Configuration values merge with this precedence (highest to lowest):&para;<br>&para;<br>1. Tool-specific settings in `configs`&para;<br>2. Set-level `default_config`&para;<br>3. System defaults&para;<br>&para;<br>Example:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "google-calendar-mcp",&para;<br>  "default_config": {&para;<br>    "defer_loading": true&para;<br>  },&para;<br>  "configs": {&para;<br>    "search_events": {&para;<br>      "enabled": false&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>Results in:&para;<br>- `search_events`: `enabled: false` (from configs), `defer_loading: true` (from default_config)&para;<br>- All other tools: `enabled: true` (system default), `defer_loading: true` (from default_config)&para;<br>&para;<br>## Common configuration patterns&para;<br>&para;<br>### Enable all tools with default configuration&para;<br>&para;<br>The simplest pattern - enable all tools from a server:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "google-calendar-mcp",&para;<br>}&para;<br>```&para;<br>&para;<br>### Allowlist - Enable only specific tools&para;<br>&para;<br>Set `enabled: false` as the default, then explicitly enable specific tools:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "google-calendar-mcp",&para;<br>  "default_config": {&para;<br>    "enabled": false&para;<br>  },&para;<br>  "configs": {&para;<br>    "search_events": {&para;<br>      "enabled": true&para;<br>    },&para;<br>    "create_event": {&para;<br>      "enabled": true&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Denylist - Disable specific tools&para;<br>&para;<br>Enable all tools by default, then explicitly disable unwanted tools:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "google-calendar-mcp",&para;<br>  "configs": {&para;<br>    "delete_all_events": {&para;<br>      "enabled": false&para;<br>    },&para;<br>    "share_calendar_publicly": {&para;<br>      "enabled": false&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### Mixed - Allowlist with per-tool configuration&para;<br>&para;<br>Combine allowlisting with custom configuration for each tool:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_toolset",&para;<br>  "mcp_server_name": "google-calendar-mcp",&para;<br>  "default_config": {&para;<br>    "enabled": false,&para;<br>    "defer_loading": true&para;<br>  },&para;<br>  "configs": {&para;<br>    "search_events": {&para;<br>      "enabled": true,&para;<br>      "defer_loading": false&para;<br>    },&para;<br>    "list_events": {&para;<br>      "enabled": true&para;<br>    }&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>In this example:&para;<br>- `search_events` is enabled with `defer_loading: false`&para;<br>- `list_events` is enabled with `defer_loading: true` (inherited from default_config)&para;<br>- All other tools are disabled&para;<br>&para;<br>## Validation rules&para;<br>&para;<br>The API enforces these validation rules:&para;<br>&para;<br>- **Server must exist**: The `mcp_server_name` in an MCPToolset must match a server defined in the `mcp_servers` array&para;<br>- **Server must be used**: Every MCP server defined in `mcp_servers` must be referenced by exactly one MCPToolset&para;<br>- **Unique toolset per server**: Each MCP server can only be referenced by one MCPToolset&para;<br>- **Unknown tool names**: If a tool name in `configs` doesn't exist on the MCP server, a backend warning is logged but no error is returned (MCP servers may have dynamic tool availability)&para;<br>&para;<br>## Response content types&para;<br>&para;<br>When Claude uses MCP tools, the response will include two new content block types:&para;<br>&para;<br>### MCP Tool Use Block&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_tool_use",&para;<br>  "id": "mcptoolu_014Q35RayjACSWkSj4X2yov1",&para;<br>  "name": "echo",&para;<br>  "server_name": "example-mcp",&para;<br>  "input": { "param1": "value1", "param2": "value2" }&para;<br>}&para;<br>```&para;<br>&para;<br>### MCP Tool Result Block&para;<br>&para;<br>```json&para;<br>{&para;<br>  "type": "mcp_tool_result",&para;<br>  "tool_use_id": "mcptoolu_014Q35RayjACSWkSj4X2yov1",&para;<br>  "is_error": false,&para;<br>  "content": [&para;<br>    {&para;<br>      "type": "text",&para;<br>      "text": "Hello"&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>## Multiple MCP servers&para;<br>&para;<br>You can connect to multiple MCP servers by including multiple server definitions in `mcp_servers` and a corresponding MCPToolset for each in the `tools` array:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "model": "claude-sonnet-4-5",&para;<br>  "max_tokens": 1000,&para;<br>  "messages": [&para;<br>    {&para;<br>      "role": "user",&para;<br>      "content": "Use tools from both mcp-server-1 and mcp-server-2 to complete this task"&para;<br>    }&para;<br>  ],&para;<br>  "mcp_servers": [&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://mcp.example1.com/sse",&para;<br>      "name": "mcp-server-1",&para;<br>      "authorization_token": "TOKEN1"&para;<br>    },&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://mcp.example2.com/sse",&para;<br>      "name": "mcp-server-2",&para;<br>      "authorization_token": "TOKEN2"&para;<br>    }&para;<br>  ],&para;<br>  "tools": [&para;<br>    {&para;<br>      "type": "mcp_toolset",&para;<br>      "mcp_server_name": "mcp-server-1"&para;<br>    },&para;<br>    {&para;<br>      "type": "mcp_toolset",&para;<br>      "mcp_server_name": "mcp-server-2",&para;<br>      "default_config": {&para;<br>        "defer_loading": true&para;<br>      }&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>## Authentication&para;<br>&para;<br>For MCP servers that require OAuth authentication, you'll need to obtain an access token. The MCP connector beta supports passing an `authorization_token` parameter in the MCP server definition.&para;<br>API consumers are expected to handle the OAuth flow and obtain the access token prior to making the API call, as well as refreshing the token as needed.&para;<br>&para;<br>### Obtaining an access token for testing&para;<br>&para;<br>The MCP inspector can guide you through the process of obtaining an access token for testing purposes.&para;<br>&para;<br>1. Run the inspector with the following command. You need Node.js installed on your machine.&para;<br>&para;<br>   ```bash&para;<br>   npx @modelcontextprotocol/inspector&para;<br>   ```&para;<br>&para;<br>2. In the sidebar on the left, for "Transport type", select either "SSE" or "Streamable HTTP".&para;<br>3. Enter the URL of the MCP server.&para;<br>4. In the right area, click on the "Open Auth Settings" button after "Need to configure authentication?".&para;<br>5. Click "Quick OAuth Flow" and authorize on the OAuth screen.&para;<br>6. Follow the steps in the "OAuth Flow Progress" section of the inspector and click "Continue" until you reach "Authentication complete".&para;<br>7. Copy the `access_token` value.&para;<br>8. Paste it into the `authorization_token` field in your MCP server configuration.&para;<br>&para;<br>### Using the access token&para;<br>&para;<br>Once you've obtained an access token using either OAuth flow above, you can use it in your MCP server configuration:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "mcp_servers": [&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://example-server.modelcontextprotocol.io/sse",&para;<br>      "name": "authenticated-server",&para;<br>      "authorization_token": "YOUR_ACCESS_TOKEN_HERE"&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>For detailed explanations of the OAuth flow, refer to the [Authorization section](https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization) in the MCP specification.&para;<br>&para;<br>## Migration guide&para;<br>&para;<br>If you're using the deprecated `mcp-client-2025-04-04` beta header, follow this guide to migrate to the new version.&para;<br>&para;<br>### Key changes&para;<br>&para;<br>1. **New beta header**: Change from `mcp-client-2025-04-04` to `mcp-client-2025-11-20`&para;<br>2. **Tool configuration moved**: Tool configuration now lives in the `tools` array as MCPToolset objects, not in the MCP server definition&para;<br>3. **More flexible configuration**: New pattern supports allowlisting, denylisting, and per-tool configuration&para;<br>&para;<br>### Migration steps&para;<br>&para;<br>**Before (deprecated):**&para;<br>&para;<br>```json&para;<br>{&para;<br>  "model": "claude-sonnet-4-5",&para;<br>  "max_tokens": 1000,&para;<br>  "messages": [...],&para;<br>  "mcp_servers": [&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://mcp.example.com/sse",&para;<br>      "name": "example-mcp",&para;<br>      "authorization_token": "YOUR_TOKEN",&para;<br>      "tool_configuration": {&para;<br>        "enabled": true,&para;<br>        "allowed_tools": ["tool1", "tool2"]&para;<br>      }&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>**After (current):**&para;<br>&para;<br>```json&para;<br>{&para;<br>  "model": "claude-sonnet-4-5",&para;<br>  "max_tokens": 1000,&para;<br>  "messages": [...],&para;<br>  "mcp_servers": [&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://mcp.example.com/sse",&para;<br>      "name": "example-mcp",&para;<br>      "authorization_token": "YOUR_TOKEN"&para;<br>    }&para;<br>  ],&para;<br>  "tools": [&para;<br>    {&para;<br>      "type": "mcp_toolset",&para;<br>      "mcp_server_name": "example-mcp",&para;<br>      "default_config": {&para;<br>        "enabled": false&para;<br>      },&para;<br>      "configs": {&para;<br>        "tool1": {&para;<br>          "enabled": true&para;<br>        },&para;<br>        "tool2": {&para;<br>          "enabled": true&para;<br>        }&para;<br>      }&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>### Common migration patterns&para;<br>&para;<br>| Old pattern | New pattern |&para;<br>|-------------|-------------|&para;<br>| No `tool_configuration` (all tools enabled) | MCPToolset with no `default_config` or `configs` |&para;<br>| `tool_configuration.enabled: false` | MCPToolset with `default_config.enabled: false` |&para;<br>| `tool_configuration.allowed_tools: [...]` | MCPToolset with `default_config.enabled: false` and specific tools enabled in `configs` |&para;<br>&para;<br>## Deprecated version: mcp-client-2025-04-04&para;<br>&para;<br>&lt;Note type="warning"&gt;&para;<br>  This version is deprecated. Please migrate to `mcp-client-2025-11-20` using the [migration guide](#migration-guide) above.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>The previous version of the MCP connector included tool configuration directly in the MCP server definition:&para;<br>&para;<br>```json&para;<br>{&para;<br>  "mcp_servers": [&para;<br>    {&para;<br>      "type": "url",&para;<br>      "url": "https://example-server.modelcontextprotocol.io/sse",&para;<br>      "name": "example-mcp",&para;<br>      "authorization_token": "YOUR_TOKEN",&para;<br>      "tool_configuration": {&para;<br>        "enabled": true,&para;<br>        "allowed_tools": ["example_tool_1", "example_tool_2"]&para;<br>      }&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>### Deprecated field descriptions&para;<br>&para;<br>| Property | Type | Description |&para;<br>|----------|------|-------------|&para;<br>| `tool_configuration` | object | **Deprecated**: Use MCPToolset in the `tools` array instead |&para;<br>| `tool_configuration.enabled` | boolean | **Deprecated**: Use `default_config.enabled` in MCPToolset |&para;<br>| `tool_configuration.allowed_tools` | array | **Deprecated**: Use allowlist pattern with `configs` in MCPToolset |</ins></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/agents-and-tools/mcp-connector.md
+++ b/agents-and-tools/mcp-connector.md
@@ -0,0 +1,537 @@
+# MCP connector
+
+---
+
+Claude&#39;s Model Context Protocol (MCP) connector feature enables you to connect to remote MCP servers directly from the Messages API without a separate MCP client.
+
+&lt;Note&gt;
+  **Current version**: This feature requires the beta header: `&#34;anthropic-beta&#34;: &#34;mcp-client-2025-11-20&#34;`
+
+  The previous version (`mcp-client-2025-04-04`) is deprecated. See the [deprecated version documentation](#deprecated-version-mcp-client-2025-04-04) below.
+&lt;/Note&gt;
+
+## Key features
+
+- **Direct API integration**: Connect to MCP servers without implementing an MCP client
+- **Tool calling support**: Access MCP tools through the Messages API
+- **Flexible tool configuration**: Enable all tools, allowlist specific tools, or denylist unwanted tools
+- **Per-tool configuration**: Configure individual tools with custom settings
+- **OAuth authentication**: Support for OAuth Bearer tokens for authenticated servers
+- **Multiple servers**: Connect to multiple MCP servers in a single request
+
+## Limitations
+
+- Of the feature set of the [MCP specification](https://modelcontextprotocol.io/introduction#explore-mcp), only [tool calls](https://modelcontextprotocol.io/docs/concepts/tools) are currently supported.
+- The server must be publicly exposed through HTTP (supports both Streamable HTTP and SSE transports). Local STDIO servers cannot be connected directly.
+- The MCP connector is currently not supported on Amazon Bedrock and Google Vertex.
+
+## Using the MCP connector in the Messages API
+
+The MCP connector uses two components:
+
+1. **MCP Server Definition** (`mcp_servers` array): Defines server connection details (URL, authentication)
+2. **MCP Toolset** (`tools` array): Configures which tools to enable and how to configure them
+
+### Basic example
+
+This example enables all tools from an MCP server with default configuration:
+
+&lt;CodeGroup&gt;
+```bash Shell
+curl https://api.anthropic.com/v1/messages \
+  -H &#34;Content-Type: application/json&#34; \
+  -H &#34;X-API-Key: $ANTHROPIC_API_KEY&#34; \
+  -H &#34;anthropic-version: 2023-06-01&#34; \
+  -H &#34;anthropic-beta: mcp-client-2025-11-20&#34; \
+  -d &#39;{
+    &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+    &#34;max_tokens&#34;: 1000,
+    &#34;messages&#34;: [{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;What tools do you have available?&#34;}],
+    &#34;mcp_servers&#34;: [
+      {
+        &#34;type&#34;: &#34;url&#34;,
+        &#34;url&#34;: &#34;https://example-server.modelcontextprotocol.io/sse&#34;,
+        &#34;name&#34;: &#34;example-mcp&#34;,
+        &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;
+      }
+    ],
+    &#34;tools&#34;: [
+      {
+        &#34;type&#34;: &#34;mcp_toolset&#34;,
+        &#34;mcp_server_name&#34;: &#34;example-mcp&#34;
+      }
+    ]
+  }&#39;
+```
+
+```typescript TypeScript
+import { Anthropic } from &#39;@anthropic-ai/sdk&#39;;
+
+const anthropic = new Anthropic();
+
+const response = await anthropic.beta.messages.create({
+  model: &#34;claude-sonnet-4-5&#34;,
+  max_tokens: 1000,
+  messages: [
+    {
+      role: &#34;user&#34;,
+      content: &#34;What tools do you have available?&#34;,
+    },
+  ],
+  mcp_servers: [
+    {
+      type: &#34;url&#34;,
+      url: &#34;https://example-server.modelcontextprotocol.io/sse&#34;,
+      name: &#34;example-mcp&#34;,
+      authorization_token: &#34;YOUR_TOKEN&#34;,
+    },
+  ],
+  tools: [
+    {
+      type: &#34;mcp_toolset&#34;,
+      mcp_server_name: &#34;example-mcp&#34;,
+    },
+  ],
+  betas: [&#34;mcp-client-2025-11-20&#34;],
+});
+```
+
+```python Python
+import anthropic
+
+client = anthropic.Anthropic()
+
+response = client.beta.messages.create(
+    model=&#34;claude-sonnet-4-5&#34;,
+    max_tokens=1000,
+    messages=[{
+        &#34;role&#34;: &#34;user&#34;,
+        &#34;content&#34;: &#34;What tools do you have available?&#34;
+    }],
+    mcp_servers=[{
+        &#34;type&#34;: &#34;url&#34;,
+        &#34;url&#34;: &#34;https://mcp.example.com/sse&#34;,
+        &#34;name&#34;: &#34;example-mcp&#34;,
+        &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;
+    }],
+    tools=[{
+        &#34;type&#34;: &#34;mcp_toolset&#34;,
+        &#34;mcp_server_name&#34;: &#34;example-mcp&#34;
+    }],
+    betas=[&#34;mcp-client-2025-11-20&#34;]
+)
+```
+&lt;/CodeGroup&gt;
+
+## MCP server configuration
+
+Each MCP server in the `mcp_servers` array defines the connection details:
+
+```json
+{
+  &#34;type&#34;: &#34;url&#34;,
+  &#34;url&#34;: &#34;https://example-server.modelcontextprotocol.io/sse&#34;,
+  &#34;name&#34;: &#34;example-mcp&#34;,
+  &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;
+}
+```
+
+### Field descriptions
+
+| Property | Type | Required | Description |
+|----------|------|----------|-------------|
+| `type` | string | Yes | Currently only &#34;url&#34; is supported |
+| `url` | string | Yes | The URL of the MCP server. Must start with https:// |
+| `name` | string | Yes | A unique identifier for this MCP server. Must be referenced by exactly one MCPToolset in the `tools` array. |
+| `authorization_token` | string | No | OAuth authorization token if required by the MCP server. See [MCP specification](https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization). |
+
+## MCP toolset configuration
+
+The MCPToolset lives in the `tools` array and configures which tools from the MCP server are enabled and how they should be configured.
+
+### Basic structure
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;example-mcp&#34;,
+  &#34;default_config&#34;: {
+    &#34;enabled&#34;: true,
+    &#34;defer_loading&#34;: false
+  },
+  &#34;configs&#34;: {
+    &#34;specific_tool_name&#34;: {
+      &#34;enabled&#34;: true,
+      &#34;defer_loading&#34;: true
+    }
+  }
+}
+```
+
+### Field descriptions
+
+| Property | Type | Required | Description |
+|----------|------|----------|-------------|
+| `type` | string | Yes | Must be &#34;mcp_toolset&#34; |
+| `mcp_server_name` | string | Yes | Must match a server name defined in the `mcp_servers` array |
+| `default_config` | object | No | Default configuration applied to all tools in this set. Individual tool configs in `configs` will override these defaults. |
+| `configs` | object | No | Per-tool configuration overrides. Keys are tool names, values are configuration objects. |
+| `cache_control` | object | No | Cache breakpoint configuration for this toolset |
+
+### Tool configuration options
+
+Each tool (whether configured in `default_config` or in `configs`) supports the following fields:
+
+| Property | Type | Default | Description |
+|----------|------|---------|-------------|
+| `enabled` | boolean | `true` | Whether this tool is enabled |
+| `defer_loading` | boolean | `false` | If true, tool description is not sent to the model initially. Used with [Tool Search Tool](/docs/en/agents-and-tools/tool-use/tool-search-tool). |
+
+### Configuration merging
+
+Configuration values merge with this precedence (highest to lowest):
+
+1. Tool-specific settings in `configs`
+2. Set-level `default_config`
+3. System defaults
+
+Example:
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;google-calendar-mcp&#34;,
+  &#34;default_config&#34;: {
+    &#34;defer_loading&#34;: true
+  },
+  &#34;configs&#34;: {
+    &#34;search_events&#34;: {
+      &#34;enabled&#34;: false
+    }
+  }
+}
+```
+
+Results in:
+- `search_events`: `enabled: false` (from configs), `defer_loading: true` (from default_config)
+- All other tools: `enabled: true` (system default), `defer_loading: true` (from default_config)
+
+## Common configuration patterns
+
+### Enable all tools with default configuration
+
+The simplest pattern - enable all tools from a server:
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;google-calendar-mcp&#34;,
+}
+```
+
+### Allowlist - Enable only specific tools
+
+Set `enabled: false` as the default, then explicitly enable specific tools:
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;google-calendar-mcp&#34;,
+  &#34;default_config&#34;: {
+    &#34;enabled&#34;: false
+  },
+  &#34;configs&#34;: {
+    &#34;search_events&#34;: {
+      &#34;enabled&#34;: true
+    },
+    &#34;create_event&#34;: {
+      &#34;enabled&#34;: true
+    }
+  }
+}
+```
+
+### Denylist - Disable specific tools
+
+Enable all tools by default, then explicitly disable unwanted tools:
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;google-calendar-mcp&#34;,
+  &#34;configs&#34;: {
+    &#34;delete_all_events&#34;: {
+      &#34;enabled&#34;: false
+    },
+    &#34;share_calendar_publicly&#34;: {
+      &#34;enabled&#34;: false
+    }
+  }
+}
+```
+
+### Mixed - Allowlist with per-tool configuration
+
+Combine allowlisting with custom configuration for each tool:
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_toolset&#34;,
+  &#34;mcp_server_name&#34;: &#34;google-calendar-mcp&#34;,
+  &#34;default_config&#34;: {
+    &#34;enabled&#34;: false,
+    &#34;defer_loading&#34;: true
+  },
+  &#34;configs&#34;: {
+    &#34;search_events&#34;: {
+      &#34;enabled&#34;: true,
+      &#34;defer_loading&#34;: false
+    },
+    &#34;list_events&#34;: {
+      &#34;enabled&#34;: true
+    }
+  }
+}
+```
+
+In this example:
+- `search_events` is enabled with `defer_loading: false`
+- `list_events` is enabled with `defer_loading: true` (inherited from default_config)
+- All other tools are disabled
+
+## Validation rules
+
+The API enforces these validation rules:
+
+- **Server must exist**: The `mcp_server_name` in an MCPToolset must match a server defined in the `mcp_servers` array
+- **Server must be used**: Every MCP server defined in `mcp_servers` must be referenced by exactly one MCPToolset
+- **Unique toolset per server**: Each MCP server can only be referenced by one MCPToolset
+- **Unknown tool names**: If a tool name in `configs` doesn&#39;t exist on the MCP server, a backend warning is logged but no error is returned (MCP servers may have dynamic tool availability)
+
+## Response content types
+
+When Claude uses MCP tools, the response will include two new content block types:
+
+### MCP Tool Use Block
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_tool_use&#34;,
+  &#34;id&#34;: &#34;mcptoolu_014Q35RayjACSWkSj4X2yov1&#34;,
+  &#34;name&#34;: &#34;echo&#34;,
+  &#34;server_name&#34;: &#34;example-mcp&#34;,
+  &#34;input&#34;: { &#34;param1&#34;: &#34;value1&#34;, &#34;param2&#34;: &#34;value2&#34; }
+}
+```
+
+### MCP Tool Result Block
+
+```json
+{
+  &#34;type&#34;: &#34;mcp_tool_result&#34;,
+  &#34;tool_use_id&#34;: &#34;mcptoolu_014Q35RayjACSWkSj4X2yov1&#34;,
+  &#34;is_error&#34;: false,
+  &#34;content&#34;: [
+    {
+      &#34;type&#34;: &#34;text&#34;,
+      &#34;text&#34;: &#34;Hello&#34;
+    }
+  ]
+}
+```
+
+## Multiple MCP servers
+
+You can connect to multiple MCP servers by including multiple server definitions in `mcp_servers` and a corresponding MCPToolset for each in the `tools` array:
+
+```json
+{
+  &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+  &#34;max_tokens&#34;: 1000,
+  &#34;messages&#34;: [
+    {
+      &#34;role&#34;: &#34;user&#34;,
+      &#34;content&#34;: &#34;Use tools from both mcp-server-1 and mcp-server-2 to complete this task&#34;
+    }
+  ],
+  &#34;mcp_servers&#34;: [
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://mcp.example1.com/sse&#34;,
+      &#34;name&#34;: &#34;mcp-server-1&#34;,
+      &#34;authorization_token&#34;: &#34;TOKEN1&#34;
+    },
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://mcp.example2.com/sse&#34;,
+      &#34;name&#34;: &#34;mcp-server-2&#34;,
+      &#34;authorization_token&#34;: &#34;TOKEN2&#34;
+    }
+  ],
+  &#34;tools&#34;: [
+    {
+      &#34;type&#34;: &#34;mcp_toolset&#34;,
+      &#34;mcp_server_name&#34;: &#34;mcp-server-1&#34;
+    },
+    {
+      &#34;type&#34;: &#34;mcp_toolset&#34;,
+      &#34;mcp_server_name&#34;: &#34;mcp-server-2&#34;,
+      &#34;default_config&#34;: {
+        &#34;defer_loading&#34;: true
+      }
+    }
+  ]
+}
+```
+
+## Authentication
+
+For MCP servers that require OAuth authentication, you&#39;ll need to obtain an access token. The MCP connector beta supports passing an `authorization_token` parameter in the MCP server definition.
+API consumers are expected to handle the OAuth flow and obtain the access token prior to making the API call, as well as refreshing the token as needed.
+
+### Obtaining an access token for testing
+
+The MCP inspector can guide you through the process of obtaining an access token for testing purposes.
+
+1. Run the inspector with the following command. You need Node.js installed on your machine.
+
+   ```bash
+   npx @modelcontextprotocol/inspector
+   ```
+
+2. In the sidebar on the left, for &#34;Transport type&#34;, select either &#34;SSE&#34; or &#34;Streamable HTTP&#34;.
+3. Enter the URL of the MCP server.
+4. In the right area, click on the &#34;Open Auth Settings&#34; button after &#34;Need to configure authentication?&#34;.
+5. Click &#34;Quick OAuth Flow&#34; and authorize on the OAuth screen.
+6. Follow the steps in the &#34;OAuth Flow Progress&#34; section of the inspector and click &#34;Continue&#34; until you reach &#34;Authentication complete&#34;.
+7. Copy the `access_token` value.
+8. Paste it into the `authorization_token` field in your MCP server configuration.
+
+### Using the access token
+
+Once you&#39;ve obtained an access token using either OAuth flow above, you can use it in your MCP server configuration:
+
+```json
+{
+  &#34;mcp_servers&#34;: [
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://example-server.modelcontextprotocol.io/sse&#34;,
+      &#34;name&#34;: &#34;authenticated-server&#34;,
+      &#34;authorization_token&#34;: &#34;YOUR_ACCESS_TOKEN_HERE&#34;
+    }
+  ]
+}
+```
+
+For detailed explanations of the OAuth flow, refer to the [Authorization section](https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization) in the MCP specification.
+
+## Migration guide
+
+If you&#39;re using the deprecated `mcp-client-2025-04-04` beta header, follow this guide to migrate to the new version.
+
+### Key changes
+
+1. **New beta header**: Change from `mcp-client-2025-04-04` to `mcp-client-2025-11-20`
+2. **Tool configuration moved**: Tool configuration now lives in the `tools` array as MCPToolset objects, not in the MCP server definition
+3. **More flexible configuration**: New pattern supports allowlisting, denylisting, and per-tool configuration
+
+### Migration steps
+
+**Before (deprecated):**
+
+```json
+{
+  &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+  &#34;max_tokens&#34;: 1000,
+  &#34;messages&#34;: [...],
+  &#34;mcp_servers&#34;: [
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://mcp.example.com/sse&#34;,
+      &#34;name&#34;: &#34;example-mcp&#34;,
+      &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;,
+      &#34;tool_configuration&#34;: {
+        &#34;enabled&#34;: true,
+        &#34;allowed_tools&#34;: [&#34;tool1&#34;, &#34;tool2&#34;]
+      }
+    }
+  ]
+}
+```
+
+**After (current):**
+
+```json
+{
+  &#34;model&#34;: &#34;claude-sonnet-4-5&#34;,
+  &#34;max_tokens&#34;: 1000,
+  &#34;messages&#34;: [...],
+  &#34;mcp_servers&#34;: [
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://mcp.example.com/sse&#34;,
+      &#34;name&#34;: &#34;example-mcp&#34;,
+      &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;
+    }
+  ],
+  &#34;tools&#34;: [
+    {
+      &#34;type&#34;: &#34;mcp_toolset&#34;,
+      &#34;mcp_server_name&#34;: &#34;example-mcp&#34;,
+      &#34;default_config&#34;: {
+        &#34;enabled&#34;: false
+      },
+      &#34;configs&#34;: {
+        &#34;tool1&#34;: {
+          &#34;enabled&#34;: true
+        },
+        &#34;tool2&#34;: {
+          &#34;enabled&#34;: true
+        }
+      }
+    }
+  ]
+}
+```
+
+### Common migration patterns
+
+| Old pattern | New pattern |
+|-------------|-------------|
+| No `tool_configuration` (all tools enabled) | MCPToolset with no `default_config` or `configs` |
+| `tool_configuration.enabled: false` | MCPToolset with `default_config.enabled: false` |
+| `tool_configuration.allowed_tools: [...]` | MCPToolset with `default_config.enabled: false` and specific tools enabled in `configs` |
+
+## Deprecated version: mcp-client-2025-04-04
+
+&lt;Note type=&#34;warning&#34;&gt;
+  This version is deprecated. Please migrate to `mcp-client-2025-11-20` using the [migration guide](#migration-guide) above.
+&lt;/Note&gt;
+
+The previous version of the MCP connector included tool configuration directly in the MCP server definition:
+
+```json
+{
+  &#34;mcp_servers&#34;: [
+    {
+      &#34;type&#34;: &#34;url&#34;,
+      &#34;url&#34;: &#34;https://example-server.modelcontextprotocol.io/sse&#34;,
+      &#34;name&#34;: &#34;example-mcp&#34;,
+      &#34;authorization_token&#34;: &#34;YOUR_TOKEN&#34;,
+      &#34;tool_configuration&#34;: {
+        &#34;enabled&#34;: true,
+        &#34;allowed_tools&#34;: [&#34;example_tool_1&#34;, &#34;example_tool_2&#34;]
+      }
+    }
+  ]
+}
+```
+
+### Deprecated field descriptions
+
+| Property | Type | Description |
+|----------|------|-------------|
+| `tool_configuration` | object | **Deprecated**: Use MCPToolset in the `tools` array instead |
+| `tool_configuration.enabled` | boolean | **Deprecated**: Use `default_config.enabled` in MCPToolset |
+| `tool_configuration.allowed_tools` | array | **Deprecated**: Use allowlist pattern with `configs` in MCPToolset |</code></pre>
    </div>
</body>
</html>