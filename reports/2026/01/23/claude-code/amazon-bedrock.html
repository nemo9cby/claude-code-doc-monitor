<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>amazon-bedrock - Diff Report</title>
    <link rel="stylesheet" href="../../css/diff.css">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --accent: #0f3460;
            --add-bg: #1a4d1a;
            --del-bg: #4d1a1a;
            --add-text: #4ade80;
            --del-text: #f87171;
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f5;
                --card-bg: #fff;
                --text-color: #333;
                --accent: #e0e0e0;
                --add-bg: #d4edda;
                --del-bg: #f8d7da;
                --add-text: #155724;
                --del-text: #721c24;
            }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .meta { color: #888; font-size: 0.9rem; }
        .summary {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
        }
        .stat { display: flex; align-items: center; gap: 0.5rem; }
        .stat.added { color: var(--add-text); }
        .stat.removed { color: var(--del-text); }
        .analysis {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #8b5cf6;
        }
        .analysis-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #8b5cf6;
        }
        .analysis-content {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .diff-container {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }
        .diff-header {
            background: var(--accent);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        .diff-content {
            padding: 1rem;
            overflow-x: auto;
        }
        .diff-content ins {
            background: var(--add-bg);
            color: var(--add-text);
            text-decoration: none;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        .diff-content del {
            background: var(--del-bg);
            color: var(--del-text);
            text-decoration: line-through;
            padding: 0.1em 0.2em;
            border-radius: 2px;
        }
        pre {
            background: var(--accent);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            margin-top: 2rem;
        }
        a { color: #60a5fa; }
        .back-link { margin-bottom: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">&larr; Back to daily report</a>

        <header>
            <h1>amazon-bedrock.md</h1>
            <p class="meta">Changed on 2026-01-23 22:23:14 EST</p>
        </header>

        <div class="summary">
            <div class="stat added">
                <span>+3</span> lines added
            </div>
            <div class="stat removed">
                <span>-2</span> lines removed
            </div>
        </div>

        

        <div class="diff-container">
            <div class="diff-header">Visual Diff</div>
            <div class="diff-content"><ins style="background:#e6ffe6;">&gt; ## Documentation Index&para;<br>&gt; Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt&para;<br>&gt; Use this file to discover all available pages before exploring further.&para;<br>&para;<br></ins><span># Claude Code on Amazon Bedrock&para;<br>&para;<br>&gt; Learn about configuring Claude Code through Amazon Bedrock, including setup, IAM configuration, and troubleshooting.&para;<br>&para;<br>## Prerequisites&para;<br>&para;<br>Before configuring Claude Code with Bedrock, ensure you have:&para;<br>&para;<br>* An AWS account with Bedrock access enabled&para;<br>* Access to desired Claude models (for example, Claude Sonnet 4.5) in Bedrock&para;<br>* AWS CLI installed and configured (optional - only needed if you don't have another mechanism for getting credentials)&para;<br>* Appropriate IAM permissions&para;<br>&para;<br>## Setup&para;<br>&para;<br>### 1. Submit use case details&para;<br>&para;<br>First-time users of Anthropic models are required to submit use case details before invoking a model. This is done once per account.&para;<br>&para;<br>1. Ensure you have the right IAM permissions (see more on that below)&para;<br>2. Navigate to the [Amazon Bedrock console](https://console.aws.amazon.com/bedrock/)&para;<br>3. Select **Chat/Text playground**&para;<br>4. Choose any Anthropic model and you will be prompted to fill out the use case form&para;<br>&para;<br>### 2. Configure AWS credentials&para;<br>&para;<br>Claude Code uses the default AWS SDK credential chain. Set up your credentials using one of these methods:&para;<br>&para;<br>**Option A: AWS CLI configuration**&para;<br>&para;<br>```bash  theme={null}&para;<br>aws configure&para;<br>```&para;<br>&para;<br>**Option B: Environment variables (access key)**&para;<br>&para;<br>```bash  theme={null}&para;<br>export AWS_ACCESS_KEY_ID=your-access-key-id&para;<br>export AWS_SECRET_ACCESS_KEY=your-secret-access-key&para;<br>export AWS_SESSION_TOKEN=your-session-token&para;<br>```&para;<br>&para;<br>**Option C: Environment variables (SSO profile)**&para;<br>&para;<br>```bash  theme={null}&para;<br>aws sso login --profile=&lt;your-profile-name&gt;&para;<br>&para;<br>export AWS_PROFILE=your-profile-name&para;<br>```&para;<br>&para;<br>**Option D: AWS Management Console credentials**&para;<br>&para;<br>```bash  theme={null}&para;<br>aws login&para;<br>```&para;<br>&para;<br>[Learn more](https://docs.aws.amazon.com/signin/latest/userguide/command-line-sign-in.html) about `aws login`.&para;<br>&para;<br>**Option E: Bedrock API keys**&para;<br>&para;<br>```bash  theme={null}&para;<br>export AWS_BEARER_TOKEN_BEDROCK=your-bedrock-api-key&para;<br>```&para;<br>&para;<br>Bedrock API keys provide a simpler authentication method without needing full AWS credentials. [Learn more about Bedrock API keys](https://aws.amazon.com/blogs/machine-learning/accelerate-ai-development-with-amazon-bedrock-api-keys/).&para;<br>&para;<br>#### Advanced credential configuration&para;<br>&para;<br>Claude Code supports automatic credential refresh for AWS SSO and corporate identity providers. Add these settings to your Claude Code settings file (see [Settings](/en/settings) for file locations).&para;<br>&para;<br>When Claude Code detects that your AWS credentials are expired (either locally based on their timestamp or when Bedrock returns a credential error), it will automatically run your configured `awsAuthRefresh` and/or `awsCredentialExport` commands to obtain new credentials before retrying the request.&para;<br>&para;<br>##### Example configuration&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "awsAuthRefresh": "aws sso login --profile myprofile",&para;<br>  "env": {&para;<br>    "AWS_PROFILE": "myprofile"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>##### Configuration settings explained&para;<br>&para;<br>**`awsAuthRefresh`**: Use this for commands that modify the `.aws` directory, such as updating credentials, SSO cache, or config files. The command's output is displayed to the user, but interactive input isn't supported. This works well for browser-based SSO flows where the CLI displays a URL or code and you complete authentication in the browser.&para;<br>&para;<br>**`awsCredentialExport`**: Only use this if you can't modify `.aws` and must directly return credentials. Output is captured silently and not shown to the user. The command must output JSON in this format:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "Credentials": {&para;<br>    "AccessKeyId": "value",&para;<br>    "SecretAccessKey": "value",&para;<br>    "SessionToken": "value"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>### 3. Configure Claude Code&para;<br>&para;<br>Set the following environment variables to enable Bedrock:&para;<br>&para;<br>```bash  theme={null}&para;<br># Enable Bedrock integration&para;<br>export CLAUDE_CODE_USE_BEDROCK=1&para;<br>export AWS_REGION=us-east-1  # or your preferred region&para;<br>&para;<br># Optional: Override the region for the small/fast model (Haiku)&para;<br>export ANTHROPIC_SMALL_FAST_MODEL_AWS_REGION=us-west-2&para;<br>```&para;<br>&para;<br>When enabling Bedrock for Claude Code, keep the following in mind:&para;<br>&para;<br>* `AWS_REGION` is a required environment variable. Claude Code does not read from the `.aws` config file for this setting.&para;<br>* When using Bedrock, the `/login` and `/logout` commands are disabled since authentication is handled through AWS credentials.&para;<br>* You can use settings files for environment variables like `AWS_PROFILE` that you don't want to leak to other processes. See [Settings](/en/settings) for more information.&para;<br>&para;<br>### 4. Model configuration&para;<br>&para;<br>Claude Code uses these default models for Bedrock:&para;<br>&para;<br>| Model type       | Default value                                      |&para;<br>| :--------------- | :------------------------------------------------- |&para;<br>| Primary model    | `global.anthropic.claude-sonnet-4-5-20250929-v1:0` |&para;<br>| Small/fast model | `us.anthropic.claude-haiku-4-5-20251001-v1:0`      |&para;<br>&para;<br>&lt;Note&gt;&para;<br>  For Bedrock users, Claude Code won't automatically upgrade from Haiku 3.5 to Haiku 4.5. To manually switch to a newer Haiku model, set the `ANTHROPIC_DEFAULT_HAIKU_MODEL` environment variable to the full model name (for example, `us.anthropic.claude-haiku-4-5-20251001-v1:0`).&para;<br>&lt;/Note&gt;&para;<br>&para;<br>To customize models, use one of these methods:&para;<br>&para;<br>```bash  theme={null}&para;<br># Using inference profile ID&para;<br>export ANTHROPIC_MODEL='global.anthropic.claude-sonnet-4-5-20250929-v1:0'&para;<br>export ANTHROPIC_SMALL_FAST_MODEL='us.anthropic.claude-haiku-4-5-20251001-v1:0'&para;<br>&para;<br># Using application inference profile ARN&para;<br>export ANTHROPIC_MODEL='arn:aws:bedrock:us-east-2:your-account-id:application-inference-profile/your-model-id'&para;<br>&para;<br># Optional: Disable prompt caching if needed&para;<br>export DISABLE_PROMPT_CACHING=1&para;<br>```&para;<br>&para;<br>&lt;Note&gt;[Prompt caching](https://docs.claude.com/en/docs/build-with-claude/prompt-caching) may not be available in all regions.&lt;/Note&gt;&para;<br>&para;<br>### 5. Output token configuration&para;<br>&para;<br>These are the recommended token settings for Claude Code with Amazon Bedrock:&para;<br>&para;<br>```bash  theme={null}&para;<br># Recommended output token settings for Bedrock&para;<br>export CLAUDE_CODE_MAX_OUTPUT_TOKENS=4096&para;<br>export MAX_THINKING_TOKENS=1024&para;<br>```&para;<br>&para;<br>**Why these values:**&para;<br>&para;<br>* **`CLAUDE_CODE_MAX_OUTPUT_TOKENS=4096`**: Bedrock's burndown throttling logic sets a minimum of 4096 tokens as the `max_token` penalty. Setting this lower won't reduce costs but may cut off long tool uses, causing the Claude Code agent loop to fail persistently. Claude Code typically uses less than 4096 output tokens without extended thinking, but may need this headroom for tasks involving significant file creation or Write tool usage.&para;<br>&para;<br>* **`MAX_THINKING_TOKENS=1024`**: This provides space for extended thinking without cutting off tool use responses, while still maintaining focused reasoning chains. This balance helps prevent trajectory changes that aren't always helpful for coding tasks specifically.&para;<br>&para;<br>## IAM configuration&para;<br>&para;<br>Create an IAM policy with the required permissions for Claude Code:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "Version": "2012-10-17",&para;<br>  "Statement": [&para;<br>    {&para;<br>      "Sid": "AllowModelAndInferenceProfileAccess",&para;<br>      "Effect": "Allow",&para;<br>      "Action": [&para;<br>        "bedrock:InvokeModel",&para;<br>        "bedrock:InvokeModelWithResponseStream",&para;<br>        "bedrock:ListInferenceProfiles"&para;<br>      ],&para;<br>      "Resource": [&para;<br>        "arn:aws:bedrock:*:*:inference-profile/*",&para;<br>        "arn:aws:bedrock:*:*:application-inference-profile/*",&para;<br>        "arn:aws:bedrock:*:*:foundation-model/*"&para;<br>      ]&para;<br>    },&para;<br>    {&para;<br>      "Sid": "AllowMarketplaceSubscription",&para;<br>      "Effect": "Allow",&para;<br>      "Action": [&para;<br>        "aws-marketplace:ViewSubscriptions",&para;<br>        "aws-marketplace:Subscribe"&para;<br>      ],&para;<br>      "Resource": "*",&para;<br>      "Condition": {&para;<br>        "StringEquals": {&para;<br>          "aws:CalledViaLast": "bedrock.amazonaws.com"&para;<br>        }&para;<br>      }&para;<br>    }&para;<br>  ]&para;<br>}&para;<br>```&para;<br>&para;<br>For more restrictive permissions, you can limit the Resource to specific inference profile ARNs.&para;<br>&para;<br>For details, see [Bedrock IAM documentation](https://docs.aws.amazon.com/bedrock/latest/userguide/security-iam.html).&para;<br>&para;<br>&lt;Note&gt;&para;<br>  We recommend creating a dedicated AWS account for Claude Code to simplify cost tracking and access control.&para;<br>&lt;/Note&gt;&para;<br>&para;<br>## AWS Guardrails&para;<br>&para;<br>[Amazon Bedrock Guardrails](https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails.html) let you implement content filtering for Claude Code. Create a Guardrail in the [Amazon Bedrock console](https://console.aws.amazon.com/bedrock/), publish a version, then add the Guardrail headers to your [settings file](/en/settings). Enable Cross-Region inference on your Guardrail if you're using cross-region inference profiles.&para;<br>&para;<br>Example configuration:&para;<br>&para;<br>```json  theme={null}&para;<br>{&para;<br>  "env": {&para;<br>    "ANTHROPIC_CUSTOM_HEADERS": "X-Amzn-Bedrock-GuardrailIdentifier: your-guardrail-id\nX-Amzn-Bedrock-GuardrailVersion: 1"&para;<br>  }&para;<br>}&para;<br>```&para;<br>&para;<br>## Troubleshooting&para;<br>&para;<br>If you encounter region issues:&para;<br>&para;<br>* Check model availability: `aws bedrock list-inference-profiles --region your-region`&para;<br>* Switch to a supported region: `export AWS_REGION=us-east-1`&para;<br>* Consider using inference profiles for cross-region access&para;<br>&para;<br>If you receive an error "on-demand throughput isnâ€™t supported":&para;<br>&para;<br>* Specify the model as an [inference profile](https://docs.aws.amazon.com/bedrock/latest/userguide/inference-profiles-support.html) ID&para;<br>&para;<br>Claude Code uses the Bedrock [Invoke API](https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_InvokeModelWithResponseStream.html) and does not support the Converse API.&para;<br>&para;<br>## Additional resources&para;<br>&para;<br>* [Bedrock documentation](https://docs.aws.amazon.com/bedrock/)&para;<br>* [Bedrock pricing](https://aws.amazon.com/bedrock/pricing/)&para;<br>* [Bedrock inference profiles](https://docs.aws.amazon.com/bedrock/latest/userguide/inference-profiles-support.html)&para;<br>* [Claude Code on Amazon Bedrock: Quick Setup Guide](https://community.aws/content/2tXkZKrZzlrlu0KfH8gST5Dkppq/claude-code-on-amazon-bedrock-quick-setup-guide)- [Claude Code Monitoring Implementation (Bedrock)](https://github.com/aws-solutions-library-samples/guidance-for-claude-code-with-amazon-bedrock/blob/main/assets/docs/MONITORING.md)&para;<br></span><del style="background:#ffe6e6;">&para;<br>&para;<br>---&para;<br>&para;<br>&gt; To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt</del></div>
        </div>

        <h2 style="margin-top: 2rem; margin-bottom: 1rem;">Unified Diff</h2>
        <pre><code>--- a/amazon-bedrock.md
+++ b/amazon-bedrock.md
@@ -1,3 +1,7 @@
+&gt; ## Documentation Index
+&gt; Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt
+&gt; Use this file to discover all available pages before exploring further.
+
 # Claude Code on Amazon Bedrock
 
 &gt; Learn about configuring Claude Code through Amazon Bedrock, including setup, IAM configuration, and troubleshooting.
@@ -243,8 +247,3 @@
 * [Bedrock pricing](https://aws.amazon.com/bedrock/pricing/)
 * [Bedrock inference profiles](https://docs.aws.amazon.com/bedrock/latest/userguide/inference-profiles-support.html)
 * [Claude Code on Amazon Bedrock: Quick Setup Guide](https://community.aws/content/2tXkZKrZzlrlu0KfH8gST5Dkppq/claude-code-on-amazon-bedrock-quick-setup-guide)- [Claude Code Monitoring Implementation (Bedrock)](https://github.com/aws-solutions-library-samples/guidance-for-claude-code-with-amazon-bedrock/blob/main/assets/docs/MONITORING.md)
-
-
----
-
-&gt; To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt</code></pre>
    </div>
</body>
</html>